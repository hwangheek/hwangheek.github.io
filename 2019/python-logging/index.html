<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CNanum+Gothic+Coding:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hwangheek.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="IntroductionPython으로 코드를 짤 때, 로그를 띄우는 방법으로 print(&#39;[*] Message&#39;)를 정말 많이 써 왔습니다. 군더더기 없고, 유연하고, dependency 없이 아무 위치에나 넣을 수 있다는 점이 좋았습니다. ‘좋았다’ 보다는 ‘편했다’ 혹은 ‘귀찮았다’가 더 적절한 것 같습니다. 혼자서 사용하는 프로그램을 짤">
<meta property="og:type" content="article">
<meta property="og:title" content="조금 더 체계적인 Python Logging">
<meta property="og:url" content="https://hwangheek.github.io/2019/python-logging/index.html">
<meta property="og:site_name" content="ㅎㅎㅋ">
<meta property="og:description" content="IntroductionPython으로 코드를 짤 때, 로그를 띄우는 방법으로 print(&#39;[*] Message&#39;)를 정말 많이 써 왔습니다. 군더더기 없고, 유연하고, dependency 없이 아무 위치에나 넣을 수 있다는 점이 좋았습니다. ‘좋았다’ 보다는 ‘편했다’ 혹은 ‘귀찮았다’가 더 적절한 것 같습니다. 혼자서 사용하는 프로그램을 짤">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://hwangheek.github.io/images/2019-03-morpheus_logging.jpg">
<meta property="og:image" content="https://hwangheek.github.io/images/2019-03-logging_flow.png">
<meta property="og:image" content="https://hwangheek.github.io/images/2019-03-python-logging-slack.png">
<meta property="article:published_time" content="2019-03-12T13:12:28.000Z">
<meta property="article:modified_time" content="2022-07-23T14:39:52.357Z">
<meta property="article:author" content="Hwanghee Kim">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hwangheek.github.io/images/2019-03-morpheus_logging.jpg">


<link rel="canonical" href="https://hwangheek.github.io/2019/python-logging/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://hwangheek.github.io/2019/python-logging/","path":"2019/python-logging/","title":"조금 더 체계적인 Python Logging"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>조금 더 체계적인 Python Logging | ㅎㅎㅋ</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132879183-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-132879183-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="ㅎㅎㅋ" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ㅎㅎㅋ</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ㅎㅎㅋ의 개인 연구실</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-홈"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li><li class="menu-item menu-item-아카이브"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References"><span class="nav-text">References</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Step-1-%EA%B0%84%EB%8B%A8%ED%95%98%EA%B2%8C-%EB%A1%9C%EA%B7%B8-%EC%83%9D%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="nav-text">Step 1 : 간단하게 로그 생성해보기</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Log-Level-%EB%A1%9C%EA%B7%B8%EC%9D%98-%E2%80%98%EC%8B%AC%EA%B0%81%ED%95%9C-%EC%A0%95%EB%8F%84%E2%80%99"><span class="nav-text">1-1. Log Level : 로그의 ‘심각한 정도’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Root-Logger%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EB%A1%9C%EA%B7%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"><span class="nav-text">1-2. Root Logger를 이용하여 로그 생성하기</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Step-2-%EC%97%AD%ED%95%A0-%EB%B6%84%EB%8B%B4%ED%95%98%EA%B8%B0"><span class="nav-text">Step 2 : 역할 분담하기</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Loggers"><span class="nav-text">2-1. Loggers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Handlers"><span class="nav-text">2-2. Handlers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Formatters"><span class="nav-text">2-3. Formatters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Putting-all-together"><span class="nav-text">2-4. Putting all together</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Step-3-%EC%8B%A4%EC%A0%9C%EB%A1%9C-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="nav-text">Step 3 : 실제로 사용해보기</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Logging-Configuration-File-in-JSON-or-YAML"><span class="nav-text">3-1. Logging Configuration File in JSON or YAML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-Slack-Bot%EC%9C%BC%EB%A1%9C-%EB%A1%9C%EA%B7%B8-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0"><span class="nav-text">3-2. Slack Bot으로 로그 전송하기</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hwanghee Kim</p>
  <div class="site-description" itemprop="description">ㅎㅎㅋ의 개인 연구실</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">카테고리</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">태그</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/hwanghee-kim-66a628154/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;hwanghee-kim-66a628154&#x2F;" rel="noopener" target="_blank"><i class="linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://hwangheek.github.io/2019/python-logging/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hwanghee Kim">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ㅎㅎㅋ">
      <meta itemprop="description" content="ㅎㅎㅋ의 개인 연구실">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="조금 더 체계적인 Python Logging | ㅎㅎㅋ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          조금 더 체계적인 Python Logging
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2019-03-12 22:12:28" itemprop="dateCreated datePublished" datetime="2019-03-12T22:12:28+09:00">2019-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Updated at: 2022-07-23 23:39:52" itemprop="dateModified" datetime="2022-07-23T23:39:52+09:00">2022-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/python-logging/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/python-logging/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Python으로 코드를 짤 때, 로그를 띄우는 방법으로 <code>print(&#39;[*] Message&#39;)</code>를 정말 많이 써 왔습니다. 군더더기 없고, 유연하고, dependency 없이 아무 위치에나 넣을 수 있다는 점이 좋았습니다. ‘좋았다’ 보다는 ‘편했다’ 혹은 ‘귀찮았다’가 더 적절한 것 같습니다. 혼자서 사용하는 프로그램을 짤 때는 exception 처리나 로그 처리에 신경을 쓰지 않아도 문제가 없었기 때문인 것 같습니다.</p>
<p>이러한 방법은 문제가 많이 있습니다. 중요도에 따라서 로그를 분류할 수도 없을 뿐더러, 코드를 수정하지 않는 이상 로그를 컨트롤 할 수도 없습니다. 정말로 print 되어야 하는 내용과 로그가 뒤섞여 버려서 화면이 지저분해지는 것도 문제입니다. <em>(Fang’s coding note)</em> 가끔은 조용히 프로그램을 돌리고 싶을 때도 있고, 가끔은 verbose 해지고 싶어질 때도 있잖아요?</p>
<img src="/images/2019-03-morpheus_logging.jpg" class="" width="500" title="Better Logging">

<p><strong>Python에서는 <code>logging</code> 모듈을 기본적으로 제공합니다.</strong> 이제 <code>print(&#39;[*] ...&#39;)</code>만 사용하지 말고, <code>logging</code> 모듈을 통해 멋지고 깔끔한 로깅을 해봅시다. 이번 포스트를 통해 Python에서 제공하는 <code>logging</code> 모듈을 어떻게 사용하는지 알아보도록 하겠습니다. 또한, ‘좋은 로그 처리 방법’이 어떤 성질을 지니고 있을 지에 대한 고민도 해보겠습니다.</p>
<span id="more"></span>

<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li>Python Official Document, <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html"><code>logging</code></a>, <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging.html">Logging HOWTO</a>, <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging-cookbook.html">Logging Cookbook</a></li>
<li>Fang’s coding note (2012), <a target="_blank" rel="noopener" href="https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/">Good logging practice in Python</a></li>
<li>이승현 (2017), <a target="_blank" rel="noopener" href="https://hamait.tistory.com/880">파이썬 로깅의 모든것</a></li>
</ul>
<!-- https://stackoverflow.com/questions/4577376/should-i-log-before-or-after-an-operation -->

<hr>
<h1 id="Step-1-간단하게-로그-생성해보기"><a href="#Step-1-간단하게-로그-생성해보기" class="headerlink" title="Step 1 : 간단하게 로그 생성해보기"></a>Step 1 : 간단하게 로그 생성해보기</h1><h2 id="1-1-Log-Level-로그의-‘심각한-정도’"><a href="#1-1-Log-Level-로그의-‘심각한-정도’" class="headerlink" title="1-1. Log Level : 로그의 ‘심각한 정도’"></a>1-1. Log Level : 로그의 ‘심각한 정도’</h2><p>들어가기에 앞서서, <strong>로그 레벨</strong>에 대하여 짚고 넘어갑시다. 로그는 <strong>중요도에 따라 서로 다른 레벨을 가지게 되고</strong>, 이 중요도에 따라 로그를 관리할 수 있습니다. 아래는 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging.html#when-to-use-logging">Logging HOWTO</a>에 소개된 로그의 각 레벨과 설명입니다.</p>
<table>
<thead>
<tr>
<th align="center">Level</th>
<th align="center">Value</th>
<th align="center">When to use</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>DEBUG</code></td>
<td align="center">10</td>
<td align="center">(주로 문제 해결을 할 때 필요한) 자세한 정보.</td>
</tr>
<tr>
<td align="center"><code>INFO</code></td>
<td align="center">20</td>
<td align="center">작업이 정상적으로 작동하고 있다는 확인 메시지.</td>
</tr>
<tr>
<td align="center"><code>WARNING</code></td>
<td align="center">30</td>
<td align="center">예상하지 못한 일이 발생하거나, 발생 가능한 문제점을 명시. (e.g. ‘disk space low’) 작업은 정상적으로 진행.</td>
</tr>
<tr>
<td align="center"><code>ERROR</code></td>
<td align="center">40</td>
<td align="center">프로그램이 함수를 실행하지 못 할 정도의 심각한 문제.</td>
</tr>
<tr>
<td align="center"><code>CRITICAL</code></td>
<td align="center">50</td>
<td align="center">프로그램이 동작할 수 없을 정도의 심각한 문제.</td>
</tr>
</tbody></table>
<p>Python의 기본 logging 시스템의 레벨은 <code>WARNING</code>으로 설정되어 있습니다. 따라서 특별한 설정을 하지 않을 경우, <code>WARNING</code> 레벨과 이보다 더 심각한 레벨의 로그만 처리됩니다.</p>
<p>다음은 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging.html#when-to-use-logging">Logging HOWTO</a>에 소개된 상황에 따른 가장 적합한 로깅 방법입니다.</p>
<table>
<thead>
<tr>
<th align="center">상황</th>
<th align="center">방법</th>
</tr>
</thead>
<tbody><tr>
<td align="center">일반적인 console 출력</td>
<td align="center"><code>print()</code></td>
</tr>
<tr>
<td align="center">프로그램의 실행 중 발생하는 정상적인 이벤트 알림</td>
<td align="center"><code>logging.info()</code><br>(진단 등을 위한) 자세한 수준의 로그인 경우에는 <code>logging.debug()</code></td>
</tr>
<tr>
<td align="center">런타임 중 발생한 이벤트와 관련하여 경고</td>
<td align="center">사용자가 프로그램을 수정해서 문제를 해결할 수 있는 경우 <code>warnings.warn()</code><br>사용자가 처리할 수 있는 문제가 아닌 경우 <code>logging.warning()</code></td>
</tr>
<tr>
<td align="center">런타임 중 발생한 이벤트와 관련한 에러</td>
<td align="center">예외 처리 (<code>raise Exception</code>)</td>
</tr>
<tr>
<td align="center">발생한 예외를 suppress하고 raise 하지 않은 경우 (e.g. long-running 서버 프로세스에서 에러 발생 시)</td>
<td align="center"><code>logging.error()</code>, <code>logging.exception()</code>, <code>logging.critical()</code></td>
</tr>
</tbody></table>
<p>이제 본격적으로, 각 레벨의 로그를 어떻게 생성할 수 있는지 알아봅시다.</p>
<h2 id="1-2-Root-Logger를-이용하여-로그-생성하기"><a href="#1-2-Root-Logger를-이용하여-로그-생성하기" class="headerlink" title="1-2. Root Logger를 이용하여 로그 생성하기"></a>1-2. Root Logger를 이용하여 로그 생성하기</h2><p>가장 간단하게 로그를 생성하는 법은, <strong>module-level로 정의되어 있는 root logger를 사용하는 방법</strong>입니다. 아래와 같이 로그를 생성할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.warning(<span class="string">&#x27;This is a warning message&#x27;</span>)</span><br><span class="line"><span class="comment"># 아래와 같은 메시지가 콘솔에 출력됩니다</span></span><br><span class="line"><span class="comment"># WARNING:root:This is a warning message</span></span><br><span class="line"></span><br><span class="line">logging.info(<span class="string">&#x27;This is an info message&#x27;</span>)</span><br><span class="line"><span class="comment"># 아무 것도 프린트 되지 않습니다</span></span><br></pre></td></tr></table></figure>

<p><code>WARNING</code> 로그는 출력이 되었지만, <code>INFO</code> 로그는 아무것도 출력이 되지 않습니다. 이는 <strong>root logger의 기본 level이 <code>WARNING</code> 수준으로 설정되어 있어서, 해당 수준 이상의 로그만 처리되기 때문입니다.</strong> Logger가 처리하는 로그의 레벨을 조정하는 방법은 아래와 같습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line">logging.info(<span class="string">&#x27;This is an info message&#x27;</span>)</span><br><span class="line"><span class="comment"># 아래와 같은 메시지가 출력됩니다!</span></span><br><span class="line"><span class="comment"># INFO:root:This is an info message</span></span><br></pre></td></tr></table></figure>

<p>콘솔로 출력이 되는 로그를 다음과 같은 방법으로 파일에 저장할 수도 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;dummy.log&#x27;</span>, level=logging.INFO)</span><br><span class="line">logging.debug(<span class="string">&#x27;this is a debug&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;this is an info&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;this is a warning&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>위를 실행할 경우, <code>dummy.log</code> 파일에 다음과 같이 로그가 저장됩니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO:root:this is an info</span><br><span class="line">WARNING:root:this is a warning</span><br></pre></td></tr></table></figure>

<p>이렇게 설정을 할 경우, 콘솔에는 로그 메시지가 출력되지 않습니다. <code>basicConfig</code>를 여러번 실행해도 가장 처음 호출된 설정만 유효하고, 나머지는 설정이 적용되지 않습니다. <strong>Root logger에 이미 handler가 설정 되어 있다면 <code>basicConfig</code>는 아무런 처리도 하지 않습니다.</strong> 여러개의 handler를 등록하고 싶은 경우 <code>handlers</code> 인자로 전달하는 방법이 있지만, 가장 처음의 설정만 유효하다는 점은 변함이 없습니다. 하나의 logger에서 발생한 로그를 여러 handler가 처리하도록 설정하는 방법은 다음 step에서 살펴보도록 합시다.</p>
<p>출력되는 로그를 다음과 같이 formatting 할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(</span><br><span class="line">  <span class="built_in">format</span> = <span class="string">&#x27;%(asctime)s:%(levelname)s:%(message)s&#x27;</span>,</span><br><span class="line">  datefmt = <span class="string">&#x27;%m/%d/%Y %I:%M:%S %p&#x27;</span>,</span><br><span class="line">  level = logging.DEBUG</span><br><span class="line">)</span><br><span class="line">logging.debug(<span class="string">&#x27;This is a formatted debug message&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03/12/2019 05:20:12 PM:DE<span class="doctag">BUG:</span>This is a formatted debug message</span></span><br></pre></td></tr></table></figure>

<p><code>format</code>에 사용되는 속성들은 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/library/logging.html#logrecord-attributes">document (LogRecord attributes)</a>에서, <code>datefmt</code>에 사용되는 속성들은 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/library/time.html#time.strftime">document (<code>time.strftime(...)</code>)</a>에서 확인할 수 있습니다.</p>
<hr>
<h1 id="Step-2-역할-분담하기"><a href="#Step-2-역할-분담하기" class="headerlink" title="Step 2 : 역할 분담하기"></a>Step 2 : 역할 분담하기</h1><p>로깅 시스템은 다음과 같은 구성요소들로 이루어져 있습니다.</p>
<ul>
<li><strong>Loggers</strong> : 어플리케이션 코드가 직접 사용할 수 있는 인터페이스를 제공합니다.</li>
<li><strong>Handlers</strong> : Loggers에 의해 생성된 LogRecord를 처리하여 적절한 위치로 보냅니다.</li>
<li><strong>Filters</strong> : 출력되어야 하는 로그를 필터링합니다.</li>
<li><strong>Formatters</strong> : LogRecord의 출력 형태를 지정합니다.</li>
</ul>
<p>로그 이벤트는 <code>LogRecord</code> 형태로 Loggers에서부터 Handlers, Formatters 순서로 전달됩니다. 자세한 순서는 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging.html#logging-flow">document (Logging Flow)</a>에 포함된 아래의 flow chart와 같습니다.</p>
<p><img src="/images/2019-03-logging_flow.png" alt="Logging Flowchart"></p>
<h2 id="2-1-Loggers"><a href="#2-1-Loggers" class="headerlink" title="2-1. Loggers"></a>2-1. Loggers</h2><p>Logger는 세가지 주요 역할을 합니다.</p>
<ol>
<li>로그를 생성할 수 있는 method를 제공해줍니다. (<code>Logger.debug()</code>, <code>Logger.info()</code>, …)</li>
<li>로그 레벨과 Logger에 적용된 filter를 바탕으로 처리해야 할 메시지를 판단합니다.</li>
<li>적절한 Handler들에게 로그 메시지에 부가정보가 더해진 <code>LogRecord</code> 인스턴스를 전달해줍니다.</li>
</ol>
<p>Logger 오브젝트는 <code>logging.getLogger(name)</code> method를 통해 사용할 수 있습니다. 이와 관련한 몇 가지 특징을 살펴보겠습니다.</p>
<ul>
<li><code>name</code>이 주어진 경우, 해당 이름에 해당하는 logger를, <code>name</code>이 주어지지 않은 경우 root logger를 전달받습니다.</li>
<li><code>name</code>은 마침표(<code>.</code>)로 구분되는 계층구조를 가지고 있습니다. 예를 들어, <code>getLogger(&#39;foo.bar&#39;)</code>는 <code>getLogger(&#39;foo&#39;)</code>의 자식 logger를 반환합니다.</li>
<li><strong>Logger의 레벨이 정해지지 않은 경우 (<code>logger.setLevel(...)</code>을 설정해주지 않은 경우), 자신의 부모 logger의 레벨을 사용합니다.</strong> 부모의 로그 레벨이 정해지지 않은 경우, 그 부모의 로그 레벨을 참조하는 식으로 반복됩니다. Root logger는 항상 로그 레벨이 설정되어있습니다. (기본값 <code>WARNING</code>)</li>
<li><strong>자식 logger는 메시지를 자기 부모 logger의 handler에게 propagate합니다.</strong> 따라서, 부모 logger에 handler가 설정되어 있는 경우라면, 자식 logger에서 handler를 다시 설정해야 하는 중복 업무를 줄일 수 있습니다. (<code>Logger.propagate = False</code>로 설정해줌으로써, propagation을 막을 수 있습니다.)</li>
</ul>
<p>로깅 전략에 따라서 다양한 범위를 커버하는 Logger를 선언할 수 있습니다. 아래는 이승현님의 게시글 <a target="_blank" rel="noopener" href="https://hamait.tistory.com/880">파이썬 로깅의 모든것</a>에서 소개하는 ‘로거를 만드는 대표적인 범위’에 대한 내용입니다.</p>
<ul>
<li><strong>Module-wise</strong> : Python에서는 하나의 파일이 하나의 모듈입니다. 따라서, 파일의 제일 위쪽에서 모듈명(<code>__name__</code>)으로 Logger를 만드는 방법이 있습니다.</li>
<li><strong>Instance-wise</strong> : <code>__init__()</code> method 내에서 Logger를 생성하는 방법으로, 각 인스턴스마다 고유한 Logger를 가지게 됩니다.</li>
<li><strong>Class-wise</strong> : <code>__class__.__qualname__</code>에 해당하는 Logger를 생성하는 방법입니다. 클래스별로 고유한 Logger를 가지게 됩니다.</li>
<li><strong>Function-wise</strong> : 함수 내에서 Logger를 생성할 수도 있습니다. (e.g. <code>main()</code>)</li>
</ul>
<p>생성된 <code>Logger</code>를 설정하는 주요 method들은 다음과 같습니다.</p>
<ul>
<li><strong><code>Logger.setLevel()</code></strong> : 처리할 메시지의 최소 레벨을 설정합니다. 만약, <code>logging.INFO</code> 값을 설정하면, <code>DEBUG</code> 레벨의 로그는 무시됩니다.</li>
<li><strong><code>Logger.addHandler()</code></strong>, <strong><code>Logger.removeHandler()</code></strong> : Handler 오브젝트를 추가하고 제거합니다. Handler가 없는 경우도 있고, 여러개의 Handler가 하나의 Logger에 추가되는 경우도 있습니다.</li>
<li><strong><code>Logger.addFilter()</code></strong>, <strong><code>Logger.removeFilter()</code></strong> : Filter 오브젝트를 추가하고 제거합니다.</li>
</ul>
<p>로그를 생성하는 method들은 다음과 같습니다.</p>
<ul>
<li><strong><code>Logger.debug()</code></strong>, <strong><code>Logger.info()</code></strong>, <strong><code>Logger.warning()</code></strong>, <strong><code>Logger.error()</code></strong>, <strong><code>Logger.critical()</code></strong></li>
<li><strong><code>Logger.exception()</code></strong> : Stack Trace 정보가 담긴 <code>ERROR</code> 레벨의 로그를 발생시킵니다. Exception handler 안에서만 사용해야합니다.</li>
<li><strong><code>Logger.log()</code></strong> : 로그 레벨을 인자로 전달할 수 있습니다.</li>
</ul>
<h2 id="2-2-Handlers"><a href="#2-2-Handlers" class="headerlink" title="2-2. Handlers"></a>2-2. Handlers</h2><p>Handler는 로그 메시지를 출력하는 역할을 합니다. <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/howto/logging.html#useful-handlers">Useful Handlers</a>에서 Handler의 종류를 확인할 수 있습니다.</p>
<p>Handler를 설정하는 method는 다음과 같습니다.</p>
<ul>
<li><strong>Handler.setLevel()</strong> : 처리할 메시지의 최소 레벨을 설정합니다. Logger의 설정 레벨과 다를 수 있습니다. Logger에서는 통과가 된 로그 메시지가 Handler에서 filtering 될 수 있습니다.</li>
<li><strong>Handler.setFormatter()</strong> : Handler가 사용할 formatter를 설정합니다.</li>
<li><strong>Handler.addFilter()</strong>, <strong>Handler.removeFilter()</strong> : Filter 오브젝트를 추가하고 제거합니다.</li>
</ul>
<p>몇 가지 예시를 살펴봅시다. 스트림으로 로그를 출력하는 <code>StreamHandler</code>는 다음과 같이 사용할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;This is an INFO message&#x27;</span>)</span><br><span class="line"><span class="comment"># This is an INFO message</span></span><br></pre></td></tr></table></figure>

<p>파일로 로그를 출력하는 <code>FileHandler</code>는 다음과 같이 사용할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;dummy.log&#x27;</span>)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;This is an INFO message. Hello dummy!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Formatters"><a href="#2-3-Formatters" class="headerlink" title="2-3. Formatters"></a>2-3. Formatters</h2><p>Formatter는 최종적으로 출력 될 로그 메시지의 formatting에 관여합니다. Formatter는 다음과 같이 생성할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.Formatter(</span><br><span class="line">  fmt = <span class="literal">None</span>, <span class="comment"># 메시지 출력 형태. None일 경우 raw 메시지를 출력.</span></span><br><span class="line">  datefmt = <span class="literal">None</span>, <span class="comment"># 날짜 출력 형태. None일 경우 &#x27;%Y-%m-%d %H:%M:%S&#x27;.</span></span><br><span class="line">  style = <span class="string">&#x27;%&#x27;</span> <span class="comment"># &#x27;%&#x27;, &#x27;&#123;&#x27;, &#x27;$&#x27; 중 하나. `fmt`의 style을 결정.</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><code>logging.basicConfig</code>와 마찬가지로, <code>fmt</code>에 사용되는 속성들은 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/library/logging.html#logrecord-attributes">document (LogRecord attributes)</a>에서, <code>datefmt</code>에 사용되는 속성들은 <a target="_blank" rel="noopener" href="https://docs.python.org/3.7/library/time.html#time.strftime">document (<code>time.strftime(...)</code>)</a>에서 확인할 수 있습니다.</p>
<h2 id="2-4-Putting-all-together"><a href="#2-4-Putting-all-together" class="headerlink" title="2-4. Putting all together"></a>2-4. Putting all together</h2><p>좋습니다! 앞서 살펴본 내용들을 응용하여 간단한 로깅 시스템을 만들어 보기로 합시다. 시스템의 요구사항은 다음과 같습니다.</p>
<ul>
<li><code>INFO</code> 레벨 이상의 로그를 콘솔에 출력합니다.</li>
<li>모든 레벨의 로그를 <code>debug.log</code>에 저장합니다.</li>
<li><code>ERROR</code> 이상의 로그를 <code>error.log</code>에 저장합니다.</li>
<li>모든 Exception을 suppress하고, stacktrace를 <code>error.log</code>에 저장합니다.</li>
<li>로그가 발생한 시간과 로그레벨, 모듈명이 명시되어야합니다.</li>
</ul>
<p>아래는 해당 로그 시스템을 구현한 예시입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.DEBUG) <span class="comment"># 모든 레벨의 로그를 Handler들에게 전달해야 합니다.</span></span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s:%(module)s:%(levelname)s:%(message)s&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># INFO 레벨 이상의 로그를 콘솔에 출력하는 Handler</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setLevel(logging.INFO)</span><br><span class="line">console_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># DEBUG 레벨 이상의 로그를 `debug.log`에 출력하는 Handler</span></span><br><span class="line">file_debug_handler = logging.FileHandler(<span class="string">&#x27;debug.log&#x27;</span>)</span><br><span class="line">file_debug_handler.setLevel(logging.DEBUG)</span><br><span class="line">file_debug_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_debug_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ERROR 레벨 이상의 로그를 `error.log`에 출력하는 Handler</span></span><br><span class="line">file_error_handler = logging.FileHandler(<span class="string">&#x27;error.log&#x27;</span>)</span><br><span class="line">file_error_handler.setLevel(logging.ERROR)</span><br><span class="line">file_error_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_error_handler)</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="Step-3-실제로-사용해보기"><a href="#Step-3-실제로-사용해보기" class="headerlink" title="Step 3 : 실제로 사용해보기"></a>Step 3 : 실제로 사용해보기</h1><h2 id="3-1-Logging-Configuration-File-in-JSON-or-YAML"><a href="#3-1-Logging-Configuration-File-in-JSON-or-YAML" class="headerlink" title="3-1. Logging Configuration File in JSON or YAML"></a>3-1. Logging Configuration File in JSON or YAML</h2><p>한번 사용된 Logger 설정을 다른 모듈에서 재사용하고 싶은 경우 어떻게 할까요? <strong>Logger 설정을 <code>dict</code> 형태를 통해 로드할 수 있습니다.</strong> 따라서, <strong>JSON 혹은 YAML 형태로 Logger 설정을 저장&#x2F;관리하고, 필요시에 <code>dict</code>로 로드하여 설정을 적용할 수 있습니다.</strong> 한 예시로, (2-4)의 로깅 시스템을 구축하는 JSON 파일을 아래와 같이 나타낼 수 있습니다.</p>
<figure class="highlight json"><figcaption><span>logger.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;disable_existing_loggers&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;formatters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;basic&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%(asctime)s:%(module)s:%(levelname)s:%(message)s&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;datefmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;handlers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.StreamHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_debug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.FileHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debug.log&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.FileHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error.log&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;loggers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__main__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;handlers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;console&quot;</span><span class="punctuation">,</span> <span class="string">&quot;file_debug&quot;</span><span class="punctuation">,</span> <span class="string">&quot;file_error&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;propagate&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>위의 JSON 파일을 다음과 같이 Logger 설정에 사용할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">config = json.load(<span class="built_in">open</span>(<span class="string">&#x27;./logger.json&#x27;</span>))</span><br><span class="line">logging.config.dictConfig(config)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>

<p>설정 파일에 특별한 점은 없습니다… 만, <code>disable_existing_loggers</code> 옵션은 뭘까요? <strong><code>logging.fileConfig()</code> 혹은 <code>logging.dictConfig()</code>를 호출할 경우, 기존에 존재하는 logger들이 전부 비활성화됩니다.</strong> 이를 방지하기 위하여, 해당 함수 호출 시에 <strong><code>disable_existing_loggers</code>을 <code>False</code>로 설정</strong>하는 것입니다.</p>
<h2 id="3-2-Slack-Bot으로-로그-전송하기"><a href="#3-2-Slack-Bot으로-로그-전송하기" class="headerlink" title="3-2. Slack Bot으로 로그 전송하기"></a>3-2. Slack Bot으로 로그 전송하기</h2><p>Slack의 Web API를 사용하면 bot을 제어할 수 있습니다. Bot 생성 후 발급받은 토큰만 있으면, <a target="_blank" rel="noopener" href="https://api.slack.com/methods/chat.postMessage">다음</a>과 같이 <code>x-www-form-urlencoded</code> 형태나 <code>json</code> 형태의 HTTP 요청을 통해 메시지를 게시할 수 있습니다.</p>
<p>Python logging 모듈에서 기본적으로 <a target="_blank" rel="noopener" href="https://docs.python.org/ko/3/library/logging.handlers.html#httphandler"><code>HTTPHandler</code>를 제공합니다</a>. Logger에 의해 생성된 <code>LogRecord</code>가 <code>HTTPHandler</code>에게 전달되면, <code>mapLogRecord</code> 함수를 통해 메시지가 <code>dict</code> 형태로 전처리됩니다. 특별히 override 하지 않은 경우, <code>record.__dict__</code>을 반환합니다. 이렇게 전처리 된 <code>dict</code>의 key-value pair를 <code>emit</code> 함수가 URL encoding하여 전송합니다.</p>
<p><code>HTTPHandler</code>의 <code>mapLogRecord</code>를 적절히 overriding하면, slack bot으로 로그를 전달할 수 있는 <code>SlackHandler</code>를 아래와 같이 구현할 수 있습니다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line">SLACK_TOKEN = <span class="string">&#x27;xoxb-YOUR_BOT_TOKEN-COMES_HERE&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SlackHandler</span>(logging.handlers.HTTPHandler):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, token, channel=<span class="string">&#x27;#general&#x27;</span>, emoji=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__(host=<span class="string">&#x27;slack.com&#x27;</span>, url=<span class="string">&#x27;/api/chat.postMessage&#x27;</span>, secure=<span class="literal">True</span>)</span><br><span class="line">    self.token = token</span><br><span class="line">    self.channel = channel</span><br><span class="line">    self.emoji = emoji</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">mapLogRecord</span>(<span class="params">self, record</span>):</span><br><span class="line">    <span class="keyword">if</span> self.formatter <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># Formatter가 설정되지 않은 경우</span></span><br><span class="line">      text = record.msg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      text = self.formatter.<span class="built_in">format</span>(record)</span><br><span class="line">    </span><br><span class="line">    emoji = (</span><br><span class="line">      <span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> self.emoji == <span class="literal">False</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:bug:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;DEBUG&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:pencil2:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;INFO&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:warning:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;WARNING&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:no_entry:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:rotating_light:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;CRITICAL&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&#x27;token&#x27;</span>: self.token,</span><br><span class="line">      <span class="string">&#x27;channel&#x27;</span>: self.channel,</span><br><span class="line">      <span class="string">&#x27;text&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;emoji&#125;</span> <span class="subst">&#123;text&#125;</span>&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;as_user&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">  fmt=<span class="string">&#x27;%(asctime)s *%(module)s* : %(message)s&#x27;</span>,</span><br><span class="line">  datefmt=<span class="string">&#x27;%H:%M:%S&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">slack_handler = SlackHandler(SLACK_TOKEN)</span><br><span class="line">slack_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(slack_handler)</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&#x27;디버깅 로그입니다.&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;일반 로그입니다.&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;경고 로그입니다.&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;에러 로그입니다.&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="number">1</span>/<span class="number">0</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  logger.exception(<span class="string">&#x27;예외처리 로그입니다.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>TOKEN</code>에 slack에서 발급받은 bot의 토큰을 입력한 뒤 위의 코드를 실행하면, slack에서 bot이 로그를 출력하는 모습을 볼 수 있습니다.</p>
<p><img src="/images/2019-03-python-logging-slack.png" alt="실행 결과"></p>
<p>이모지와 <a target="_blank" rel="noopener" href="https://api.slack.com/reference/surfaces/formatting"><code>mrkdwn</code> 포맷</a>을 사용하여, 제 취향이 듬뿍 담긴 로거를 만들었습니다. <code>mapLogRecord</code> method를 다듬어서, slack에 출력되는 메시지의 스타일을 커스터마이징 할 수 있겠습니다.</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>포스트 작성자:  </strong>Hwanghee Kim
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://hwangheek.github.io/2019/python-logging/" title="조금 더 체계적인 Python Logging">https://hwangheek.github.io/2019/python-logging/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/asynchronous-python/" rel="prev" title="비동기적으로 Python 다루기">
                  <i class="fa fa-chevron-left"></i> 비동기적으로 Python 다루기
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/pandas-tick-data/" rel="next" title="Pandas를 이용하여 틱데이터 가공하기">
                  Pandas를 이용하여 틱데이터 가공하기 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hwanghee Kim</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"blog-w5rrs5lidd","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
