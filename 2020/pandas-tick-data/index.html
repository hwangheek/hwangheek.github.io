<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CNanum+Gothic+Coding:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hwangheek.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="0. Introduction체결 데이터(틱데이터)를 사용할 때, 데이터가 지나치게 raw해서 생기는 난감한 부분들이 많습니다. 이를 해결하기 위해 “분봉”이나 “일봉”처럼, 일정한 시간을 기준으로 체결내역을 grouping하는 전처리 방법이 가장 많이 사용되는 것 같습니다. 이러한 방법의 장단점은 무엇일까요? 혹시 다른 방법은 없을까요? 어떻게 구현을 해야">
<meta property="og:type" content="article">
<meta property="og:title" content="Pandas를 이용하여 틱데이터 가공하기">
<meta property="og:url" content="https://hwangheek.github.io/2020/pandas-tick-data/index.html">
<meta property="og:site_name" content="ㅎㅎㅋ">
<meta property="og:description" content="0. Introduction체결 데이터(틱데이터)를 사용할 때, 데이터가 지나치게 raw해서 생기는 난감한 부분들이 많습니다. 이를 해결하기 위해 “분봉”이나 “일봉”처럼, 일정한 시간을 기준으로 체결내역을 grouping하는 전처리 방법이 가장 많이 사용되는 것 같습니다. 이러한 방법의 장단점은 무엇일까요? 혹시 다른 방법은 없을까요? 어떻게 구현을 해야">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://hwangheek.github.io/images/2019-04-pandas-tick-data-snpf.png">
<meta property="article:published_time" content="2020-04-20T04:34:30.000Z">
<meta property="article:modified_time" content="2022-07-23T14:39:52.359Z">
<meta property="article:author" content="Hwanghee Kim">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Pandas">
<meta property="article:tag" content="System Trading">
<meta property="article:tag" content="Advances in Financial Machine Learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hwangheek.github.io/images/2019-04-pandas-tick-data-snpf.png">


<link rel="canonical" href="https://hwangheek.github.io/2020/pandas-tick-data/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://hwangheek.github.io/2020/pandas-tick-data/","path":"2020/pandas-tick-data/","title":"Pandas를 이용하여 틱데이터 가공하기"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Pandas를 이용하여 틱데이터 가공하기 | ㅎㅎㅋ</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132879183-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-132879183-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="ㅎㅎㅋ" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ㅎㅎㅋ</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ㅎㅎㅋ의 개인 연구실</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-홈"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li><li class="menu-item menu-item-아카이브"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-Introduction"><span class="nav-text">0. Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Standard-Bars"><span class="nav-text">1. Standard Bars</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Time-bars"><span class="nav-text">1.1. Time bars</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Tick-bars"><span class="nav-text">1.2. Tick bars</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-1"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-1"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Volume-bars"><span class="nav-text">1.3. Volume bars</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-2"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Naive-Implementation"><span class="nav-text">(Naive) Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Dollar-bars"><span class="nav-text">1.4. Dollar bars</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-3"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Naive-Implementation-1"><span class="nav-text">(Naive) Implementation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Information-Driven-Bars"><span class="nav-text">2. Information-Driven Bars</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-0-The-tick-rule"><span class="nav-text">2.0. The tick rule</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-4"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pitfall"><span class="nav-text">Pitfall</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-2"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Tick-imbalance-bars-TIBs"><span class="nav-text">2.1. Tick imbalance bars (TIBs)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-5"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-3"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Volume-x2F-Dollar-imbalance-bars-VIBs-x2F-DIBs"><span class="nav-text">2.2. Volume&#x2F;Dollar imbalance bars (VIBs&#x2F;DIBs)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-6"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-4"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Tick-runs-bars-TRBs"><span class="nav-text">2.3. Tick runs bars (TRBs)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-7"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-5"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Volume-x2F-Dollar-runs-bars-VRBs-x2F-DRBs"><span class="nav-text">2.4 Volume&#x2F;Dollar runs bars (VRBs&#x2F;DRBs)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definition-8"><span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-6"><span class="nav-text">Implementation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-Appendix"><span class="nav-text">3. Appendix</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Timebar-%E2%86%92-Timebar"><span class="nav-text">3.1. Timebar → Timebar</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hwanghee Kim</p>
  <div class="site-description" itemprop="description">ㅎㅎㅋ의 개인 연구실</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">카테고리</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">태그</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/hwanghee-kim-66a628154/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;hwanghee-kim-66a628154&#x2F;" rel="noopener" target="_blank"><i class="linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://hwangheek.github.io/2020/pandas-tick-data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hwanghee Kim">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ㅎㅎㅋ">
      <meta itemprop="description" content="ㅎㅎㅋ의 개인 연구실">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Pandas를 이용하여 틱데이터 가공하기 | ㅎㅎㅋ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Pandas를 이용하여 틱데이터 가공하기
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2020-04-20 13:34:30" itemprop="dateCreated datePublished" datetime="2020-04-20T13:34:30+09:00">2020-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Updated at: 2022-07-23 23:39:52" itemprop="dateModified" datetime="2022-07-23T23:39:52+09:00">2022-07-23</time>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/pandas-tick-data/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/pandas-tick-data/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0. Introduction"></a>0. Introduction</h1><p>체결 데이터(틱데이터)를 사용할 때, 데이터가 지나치게 raw해서 생기는 난감한 부분들이 많습니다. 이를 해결하기 위해 “분봉”이나 “일봉”처럼, 일정한 시간을 기준으로 체결내역을 grouping하는 전처리 방법이 가장 많이 사용되는 것 같습니다. 이러한 방법의 장단점은 무엇일까요? 혹시 다른 방법은 없을까요? 어떻게 구현을 해야 할까요?</p>
<p><strong>Marcos Lopez de Prado의 저서 <em>Advances in Financial Machine Learning</em></strong>에 위 질문들에 대한 답변이 정리가 잘 되어있습니다. <strong>이번 포스팅은 해당 서적의 “2.3 Financial Data Structures: Bars” 챕터를 공부하며 이해한 내용을 정리한 내용입니다.</strong> 워낙 유명한 저서인지라, 책의 내용에 대한 구현을 정리해놓은 <a target="_blank" rel="noopener" href="https://github.com/hudson-and-thames/mlfinlab">github repo</a>도 있습니다. 다만, 모듈화를 위해 로직이 흩어져있어서 이해하기가 쉽지 않아, Python pandas를 사용하여 직접 구현을 해보았습니다.</p>
<p>포스팅의 내용 혹은 코드에 개선이 필요한 경우, 피드백을 주시면 감사하겠습니다. :)</p>
<span id="more"></span>

<hr>
<p>시작하기에 앞서, 체결시각($t$)과 체결가격($p_t$, <code>price</code>), 체결량($v_t$, <code>volume</code>)으로 이루어진 <strong>틱 데이터</strong>가 필요합니다. 특별한 비용 없이도 증권사나 암호화폐 거래소 API를 사용하여 가져올 수 있습니다. 다음은 이베스트증권 API를 통해 받은 2020년 3월 25일 삼성전자(005930)의 틱데이터입니다. 추후 계산 편의를 위하여 거래대금($a_t$, <code>value</code>)을 $p_t\cdot v_t$로 미리 계산하였고, 인덱스로 사용된 체결시각을 오름차순으로 정렬했습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung = get_ticks(<span class="string">&#x27;005930&#x27;</span>, <span class="string">&#x27;20200325&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung[<span class="string">&#x27;value&#x27;</span>] = samsung[<span class="string">&#x27;price&#x27;</span>] * samsung[<span class="string">&#x27;volume&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung</span><br><span class="line">t                    price  volume       value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02  <span class="number">46950</span>      <span class="number">10</span>      <span class="number">469500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:05  <span class="number">46950</span>      <span class="number">66</span>     <span class="number">3098700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">10</span>  <span class="number">46950</span>       <span class="number">3</span>      <span class="number">140850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">12</span>  <span class="number">46950</span>      <span class="number">87</span>     <span class="number">4084650</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">21</span>  <span class="number">46950</span>      <span class="number">43</span>     <span class="number">2018850</span></span><br><span class="line"><span class="meta">... </span>                   ...     ...         ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">20</span>:06  <span class="number">48800</span>   <span class="number">20422</span>   <span class="number">996593600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">30</span>:<span class="number">28</span>  <span class="number">48850</span>   <span class="number">20486</span>  <span class="number">1000741100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">40</span>:<span class="number">28</span>  <span class="number">48850</span>   <span class="number">23020</span>  <span class="number">1124527000</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">50</span>:<span class="number">12</span>  <span class="number">49000</span>   <span class="number">56124</span>  <span class="number">2750076000</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">15</span>  <span class="number">49050</span>   <span class="number">43268</span>  <span class="number">2122295400</span></span><br><span class="line">[<span class="number">226285</span> rows x <span class="number">3</span> columns]</span><br></pre></td></tr></table></figure>

<p>우리의 목표는 위 데이터를 이해하기 쉽고 사용하기 편한 (일종의) 테이블 형태로 변환하는 것입니다. 이러한 테이블의 행(row)을 <strong>“bar”</strong> 라고 부릅니다. 이번 포스팅에서는 bar를 추출하는 다양한 방법들을 소개합니다.</p>
<hr>
<h1 id="1-Standard-Bars"><a href="#1-Standard-Bars" class="headerlink" title="1. Standard Bars"></a>1. Standard Bars</h1><h2 id="1-1-Time-bars"><a href="#1-1-Time-bars" class="headerlink" title="1.1. Time bars"></a>1.1. Time bars</h2><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><p><strong>일정한 시간 간격으로 bar를 추출하는 방법</strong>으로, 흔히 접하는 “분봉”, “일봉” 등이 이에 속합니다. 시간 흐름에 따른 가격과 수급 현황을 확인할 수 있어서 가장 직관적인 데이터 형태이지만, 몇 가지 문제점들이 있습니다.</p>
<ol>
<li>시장이 일정한 시간 단위로 정보를 처리하지 않습니다. 일정한 시간을 기준으로 데이터를 추출할 경우, 거래가 활발하지 않은 시기에는 데이터가 oversample 되고, 거래가 활발한 시기에는 undersample 되는 문제가 생깁니다.</li>
<li>일정한 시간으로 추출된 시계열 데이터의 통계 특성(i.e. serial correlation, heteroscedasticity, non-normality of returns)이 좋지 않은 경우가 많습니다.</li>
</ol>
<p>이러한 문제들은 (앞으로 소개 될) 거래 내역을 기반으로 데이터를 추출하는 방법을 통해 해결할 수 있습니다.</p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p>시계열 DataFrame(DataFrame with datetime-like index)에는 주어진 규칙에 따라 데이터를 정렬 할 수 있는 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html"><code>resample</code></a> method가 있습니다. 이를 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.resample.Resampler.ohlc.html"><code>Resampler.ohlc</code></a>와 같이 사용하면, 틱 데이터를 쉽게 timebar로 변환할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timebar</span>(<span class="params">tick, rule</span>):</span><br><span class="line">    resample = tick.resample(rule)</span><br><span class="line">    </span><br><span class="line">    bars = resample[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 거래가 일어나지 않은 시간의 NaN 처리</span></span><br><span class="line">    bars[<span class="string">&#x27;close&#x27;</span>] = bars[<span class="string">&#x27;close&#x27;</span>].fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line">    bars[<span class="string">&#x27;open&#x27;</span>]  = bars[<span class="string">&#x27;open&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    bars[<span class="string">&#x27;high&#x27;</span>]  = bars[<span class="string">&#x27;high&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    bars[<span class="string">&#x27;low&#x27;</span>]  = bars[<span class="string">&#x27;low&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = resample[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar(samsung, <span class="string">&#x27;30s&#x27;</span>)</span><br><span class="line">t                       <span class="built_in">open</span>     high      low    close  volume       value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>     <span class="number">166</span>     <span class="number">7793700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">30</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">43</span>     <span class="number">2018850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">30</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">31</span>     <span class="number">1455450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">32</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">75</span>     <span class="number">3521250</span></span><br><span class="line"><span class="meta">... </span>                     ...      ...      ...      ...     ...         ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">58</span>:<span class="number">00</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">58</span>:<span class="number">30</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">59</span>:<span class="number">00</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">59</span>:<span class="number">30</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>   <span class="number">43268</span>  <span class="number">2122295400</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1141</span> rows x <span class="number">6</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar(samsung, <span class="string">&#x27;1H&#x27;</span>)</span><br><span class="line">t                     <span class="built_in">open</span>   high    low  close    volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">00</span>:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>       <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48900</span>  <span class="number">49600</span>  <span class="number">47550</span>  <span class="number">48050</span>  <span class="number">19104046</span>  <span class="number">930657231400</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48050</span>  <span class="number">48700</span>  <span class="number">47900</span>  <span class="number">48350</span>   <span class="number">6251831</span>  <span class="number">302241758300</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">11</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48350</span>  <span class="number">48450</span>  <span class="number">47800</span>  <span class="number">48300</span>   <span class="number">4902528</span>  <span class="number">235849172200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48250</span>  <span class="number">48450</span>  <span class="number">48000</span>  <span class="number">48150</span>   <span class="number">2985362</span>  <span class="number">143843200950</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">13</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48100</span>  <span class="number">48200</span>  <span class="number">47150</span>  <span class="number">48100</span>   <span class="number">6703650</span>  <span class="number">320201734850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48100</span>  <span class="number">48900</span>  <span class="number">47550</span>  <span class="number">48800</span>   <span class="number">7213952</span>  <span class="number">347588903150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">48900</span>  <span class="number">48450</span>  <span class="number">48650</span>   <span class="number">5089598</span>  <span class="number">247668090050</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48600</span>  <span class="number">48700</span>  <span class="number">48550</span>  <span class="number">48700</span>     <span class="number">88125</span>    <span class="number">4285782150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">49000</span>  <span class="number">48800</span>  <span class="number">49000</span>    <span class="number">172326</span>    <span class="number">8422908900</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>     <span class="number">43268</span>    <span class="number">2122295400</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-Tick-bars"><a href="#1-2-Tick-bars" class="headerlink" title="1.2. Tick bars"></a>1.2. Tick bars</h2><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><p><strong>일정한 수의 체결이 발생하였을 때마다 bar를 추출하는 방법</strong>입니다. 체결이 많이 일어나는 시점에는 더 많은 bar가 추출되기 때문에, 시장으로 들어오는 정보의 속도를 time bar보다 잘 반영합니다. 또한, tick bar로 계산되는 수익률($r_i$)이 iid 정규분포에 더 가깝다는 연구도 있습니다. (<em>Ane &amp; Geman, 2000</em>)</p>
<p>하지만, 다음과 같은 점들이 문제가 될 수 있습니다.</p>
<ol>
<li>다수의 주문들이 한번에 체결되는 경우 outlier가 발생할 수 있습니다. 예를 들어, 장 마감 전 동시호가 시간(15:20~15:30)에는 주문이 체결되지 않고 누적되다가, 15:30분에 주문들이 한번에 체결되며 하나의 틱으로 처리가 됩니다. 하나의 틱이 수많은 체결을 포함하고 있는 셈입니다.</li>
<li>반대로, 하나의 주문이 여러번에 걸쳐 체결이 되는 경우도 문제가 됩니다. (a.k.a. “order fragmentation”) 정상적인 주문에 의한 다수의 체결인 경우에는 상관 없을 수 있지만, 트레이딩 봇에 의한 경우나 (운용&#x2F;개발 편의를 위해) 체결 엔진에 의한 경우에는 데이터에 왜곡이 생길 우려가 있습니다.</li>
</ol>
<h3 id="Implementation-1"><a href="#Implementation-1" class="headerlink" title="Implementation"></a>Implementation</h3><p>Tick bar는 time bar와 비슷한 방법으로 구현이 가능합니다. 이전과는 다르게, 체결 시각을 기준으로 데이터를 resampling 하는 것이 아니므로, 새로운 인덱스(<code>window_number</code>)를 추가한 뒤 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code>groupby()</code></a> method를 통해 데이터를 묶어주었습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tickbar</span>(<span class="params">tick, window_size</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = np.arange(<span class="built_in">len</span>(tick)) // window_size</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tickbar(samsung, <span class="number">10</span>)</span><br><span class="line">t                     <span class="built_in">open</span>   high    low  close  volume        value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">315</span>     <span class="number">14789250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">32</span>:<span class="number">37</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">338</span>     <span class="number">15869100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">35</span>:<span class="number">51</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">255</span>     <span class="number">11972250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>  <span class="number">48900</span>  <span class="number">48950</span>  <span class="number">48900</span>  <span class="number">48900</span>    <span class="number">3150</span>    <span class="number">154048850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>  <span class="number">48900</span>  <span class="number">48950</span>  <span class="number">48900</span>  <span class="number">48950</span>    <span class="number">9649</span>    <span class="number">471903050</span></span><br><span class="line"><span class="meta">... </span>                   ...    ...    ...    ...     ...          ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">11</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>     <span class="number">630</span>     <span class="number">30649500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">26</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>    <span class="number">2275</span>    <span class="number">110678750</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">40</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48600</span>  <span class="number">48600</span>   <span class="number">15808</span>    <span class="number">768327150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">23</span>  <span class="number">48600</span>  <span class="number">49000</span>  <span class="number">48550</span>  <span class="number">49000</span>  <span class="number">245810</span>  <span class="number">11997138450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">15</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>   <span class="number">43268</span>   <span class="number">2122295400</span></span><br><span class="line"></span><br><span class="line">[<span class="number">22709</span> rows x <span class="number">6</span> columns]</span><br></pre></td></tr></table></figure>

<h2 id="1-3-Volume-bars"><a href="#1-3-Volume-bars" class="headerlink" title="1.3. Volume bars"></a>1.3. Volume bars</h2><h3 id="Definition-2"><a href="#Definition-2" class="headerlink" title="Definition"></a>Definition</h3><p><strong>일정한 수준의 거래량이 발생할 때마다 bar를 추출하는 방법입니다.</strong> 거래량을 기준으로 데이터를 추출하기 때문에, order fragmentation에 의해 데이터가 왜곡되는 tick bar의 문제점을 어느정도 해결할 수 있습니다. Tick bar로 계산되는 수익률보다 volume bar로 계산되는 수익률이 iid 정규분포에 더 가깝다는 연구도 있습니다. (<em>Clark, 1973</em>) 이뿐만 아니라, 가격과 거래량의 상호작용에 대한 시장 미시구조 이론들을 적용하기에도 용이합니다.</p>
<p>다만, “거래량 하나”의 가치가 시장의 여러 요인들에 의해 지속적으로 변한다는 점을 감안해야 합니다. 따라서 가격 변동이 큰 데이터(ex. 암호화폐)를 사용하여 volume bar를 추출 할 경우, 각 bar의 “가치” 차이가 클 수 있습니다. 가격의 변동 뿐만 아니라, 유통 주식수에 영향을 주는 이벤트(주식발행, 액면 병합&#x2F;분할, 자사주 매입 등)도 단위 거래량의 가치를 변동시킬 수 있다는 점을 조심해야 합니다.</p>
<h3 id="Naive-Implementation"><a href="#Naive-Implementation" class="headerlink" title="(Naive) Implementation"></a>(Naive) Implementation</h3><p>모든 bar가 (정확하게) 동일한 단위 거래량을 가지도록 volume bar를 추출하기 위해서는 iteration이 필요해 보입니다. (누적 거래량이 단위 거래량을 넘어가는 순간, 하나의 틱을 여러개로 나눠야 하는 로직이 필요할 것 같습니다.) 이 경우, numpy의 효율적인 퍼포먼스를 충분히 활용하기가 어렵습니다.</p>
<p>Tick bar를 계산하는 방법을 응용하면, volume bar를 approximate 할 수 있는 bar를 아래와 같이 계산할 수 있습니다. 단위 거래량이 커질수록, 아래의 방법으로 계산 된 bar는 volume bar와 유사해집니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">naive_volumebar</span>(<span class="params">tick, unit_volume</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = tick[<span class="string">&#x27;volume&#x27;</span>].cumsum() // unit_volume</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>naive_volumebar(samsung, <span class="number">500_000</span>).head(<span class="number">10</span>)</span><br><span class="line">t                           <span class="built_in">open</span>   high    low  close   volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02+09:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>      <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>  <span class="number">48950</span>  <span class="number">48500</span>  <span class="number">48750</span>  <span class="number">2999031</span>  <span class="number">146769006600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">36</span>+09:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48500</span>   <span class="number">499415</span>   <span class="number">24269779250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:07+09:<span class="number">00</span>  <span class="number">48450</span>  <span class="number">48800</span>  <span class="number">48450</span>  <span class="number">48750</span>   <span class="number">500462</span>   <span class="number">24323620400</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:<span class="number">47</span>+09:<span class="number">00</span>  <span class="number">48750</span>  <span class="number">49000</span>  <span class="number">48700</span>  <span class="number">49000</span>   <span class="number">480488</span>   <span class="number">23495366100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:02:<span class="number">32</span>+09:<span class="number">00</span>  <span class="number">49000</span>  <span class="number">49250</span>  <span class="number">49000</span>  <span class="number">49250</span>   <span class="number">517832</span>   <span class="number">25422146200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:08+09:<span class="number">00</span>  <span class="number">49250</span>  <span class="number">49500</span>  <span class="number">49200</span>  <span class="number">49500</span>   <span class="number">501844</span>   <span class="number">24769576200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:<span class="number">55</span>+09:<span class="number">00</span>  <span class="number">49500</span>  <span class="number">49600</span>  <span class="number">49450</span>  <span class="number">49500</span>   <span class="number">498855</span>   <span class="number">24702622450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:04:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">49500</span>  <span class="number">49600</span>  <span class="number">49250</span>  <span class="number">49400</span>   <span class="number">501011</span>   <span class="number">24745938700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:05:<span class="number">46</span>+09:<span class="number">00</span>  <span class="number">49400</span>  <span class="number">49500</span>  <span class="number">49300</span>  <span class="number">49350</span>   <span class="number">500149</span>   <span class="number">24708946850</span></span><br></pre></td></tr></table></figure>

<p>거래가 상대적으로 적게 일어나는 종가매매 시간(08:30)과 시가단일가 주문이 한번에 체결되는 장 개시 시점(09:00)을 제외하면, 거래량이 50만주에 가깝게 bar들이 추출되었습니다. 참고로 <code>500_000</code>에서 underscore(<code>_</code>)는 가독성을 위하여 자릿수를 나누어 주는 역할을 하고, 실제 값은 <code>500000</code>과 동일합니다. (<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0515/">PEP-515</a>)</p>
<h2 id="1-4-Dollar-bars"><a href="#1-4-Dollar-bars" class="headerlink" title="1.4. Dollar bars"></a>1.4. Dollar bars</h2><h3 id="Definition-3"><a href="#Definition-3" class="headerlink" title="Definition"></a>Definition</h3><p><strong>일정한 수준의 거래대금이 누적 될 때마다 bar를 추출하는 방법</strong>입니다. 실제 거래되는 현금의 양을 기준으로 데이터를 처리하기 때문에, volume bar에 비해 가격변동, 주식발행, 액면 병합&#x2F;분할, 자사주 매입 등의 이벤트에 대해 robust하고, 단위 거래량의 가치 변화에 조금 더 consistent 합니다.</p>
<p><img src="/images/2019-04-pandas-tick-data-snpf.png"></p>
<p>위 그림은 E-mini S&amp;P 500 선물 틱 데이터를 tick bar, volume bar, dollar bar로 계산한 뒤, 하루에 발생하는 bar의 개수를 나타낸 그래프입니다.(<em>Lopez de Prado, 2018</em>) 다른 데이터에 비해서 dollar bar가 더 consistent하게 추출되는 경향을 볼 수 있습니다. 더 나아가서, 각 bar를 추출하는 단위 거래대금의 크기를 유동적으로 조절하여(ex. 유동시가총액에 비례하는 단위), 보다 더 consistent한 데이터를 얻을 수 있겠습니다.</p>
<h3 id="Naive-Implementation-1"><a href="#Naive-Implementation-1" class="headerlink" title="(Naive) Implementation"></a>(Naive) Implementation</h3><p>거래량 또는 거래대금을 기준으로 bar를 추출한다는 점만 제외하면, dollar bar는 volume bar와 같은 로직을 가지고 있습니다. Volume bar의 구현을 참고하여 다음과 같이 구현할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">naive_dollarbar</span>(<span class="params">tick, unit_value</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = tick[<span class="string">&#x27;value&#x27;</span>].cumsum() // unit_value</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>naive_dollarbar(samsung, <span class="number">50_000_000_000</span>).head(<span class="number">10</span>)</span><br><span class="line">t                           <span class="built_in">open</span>   high    low  close   volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02+09:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>      <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>  <span class="number">48950</span>  <span class="number">48500</span>  <span class="number">48800</span>  <span class="number">3058052</span>  <span class="number">149640289350</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">40</span>+09:<span class="number">00</span>  <span class="number">48500</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48850</span>  <span class="number">1025849</span>   <span class="number">49868417850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:<span class="number">58</span>+09:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">49350</span>  <span class="number">48800</span>  <span class="number">49300</span>  <span class="number">1028290</span>   <span class="number">50435367200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:<span class="number">21</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49600</span>  <span class="number">49250</span>  <span class="number">49300</span>  <span class="number">1010431</span>   <span class="number">49977830750</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:04:<span class="number">58</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49500</span>  <span class="number">49250</span>  <span class="number">49350</span>   <span class="number">972074</span>   <span class="number">48001468250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:06:<span class="number">53</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49350</span>  <span class="number">48750</span>  <span class="number">48800</span>  <span class="number">1060961</span>   <span class="number">52033926150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:08:<span class="number">27</span>+09:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">49150</span>  <span class="number">48650</span>  <span class="number">49100</span>  <span class="number">1023033</span>   <span class="number">49984091500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">11</span>:<span class="number">17</span>+09:<span class="number">00</span>  <span class="number">49100</span>  <span class="number">49250</span>  <span class="number">48800</span>  <span class="number">48850</span>  <span class="number">1020253</span>   <span class="number">50014684300</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">14</span>:<span class="number">15</span>+09:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48400</span>  <span class="number">1028829</span>   <span class="number">49976391950</span></span><br></pre></td></tr></table></figure>
<p>Volume bar와 비슷한 이유로, 장 시작 직전과 직후를 제외하면, 각 bar의 거래대금이 50BnKRW에 가깝게 데이터가 처리되었습니다.</p>
<hr>
<h1 id="2-Information-Driven-Bars"><a href="#2-Information-Driven-Bars" class="headerlink" title="2. Information-Driven Bars"></a>2. Information-Driven Bars</h1><h2 id="2-0-The-tick-rule"><a href="#2-0-The-tick-rule" class="headerlink" title="2.0. The tick rule"></a>2.0. The tick rule</h2><h3 id="Definition-4"><a href="#Definition-4" class="headerlink" title="Definition"></a>Definition</h3><p><strong>Information-driven bar는 시장에 새로운 정보가 유입되었을 때, 더 많은 bar를 추출하는 접근방법</strong>입니다. 시장에 새로운 정보가 유입이 되었다는 사실은 어떻게 알 수 있을까요?</p>
<p>시장미시구조론에서는 다음과 같은 흐름으로 논리가 전개됩니다. 시장에 새로운 정보가 유입이 되었을 경우, 해당 정보를 참고하여 시장에 참여하는 “informed trader”들이 생깁니다. 이로 인해 가격은 새로운 균형점으로 이동하려고 하고, 그 과정에서 매도&#x2F;매수 세력이 불균형해집니다. 역으로 생각해보면, 이러한 불균형이 관찰이 된다면 시장에 새로운 정보가 반영되었다고 유추를 할 수 있습니다. 즉, 시장 외부 이벤트들을 (NLP 등을 이용하여) 직접 포착하는 것이 아니라, <strong>이벤트가 시장에 녹아들 때 발생하는 시장의 현상을 포착하는 것</strong>입니다.</p>
<p>이를 위해서는, “매도&#x2F;매수 세력의 불균형”을 수치화하여 활용해야 합니다. 한 가지 방법으로, 틱 데이터에 <strong>tick rule</strong>을 적용하여 <strong>signed tick (<escape>$b_t \in {-1, 1}$</escape>)</strong> 을 정의할 수 있습니다.</p>
<escape>
\begin{equation*}
    b_t=
    \begin{cases}
      b_{t-1} & \text{if } \Delta p_t=0 \\
      \frac{\left|\Delta p_t\right|}{\Delta p_t} & \text{if } \Delta p_t\neq0
    \end{cases}
    \quad \text{or}\ \ 
    b_t=
    \begin{cases}
      1       & \text{if } \Delta p_t &gt; 0 \\
      -1      & \text{if } \Delta p_t &lt; 0 \\
      b_{t-1} & \text{if } \Delta p_t=0
    \end{cases}
\end{equation*}
</escape>

<p>복잡해 보이는 식이지만, 의미는 간단합니다. 거래가 직전 거래보다 높은 가격에 체결됐을 경우 1, 낮은 가격에 체결됐을 경우 -1, 같은 가격에 체결됐을 경우 $b_{t-1}$ 값을 그대로 사용하는 방법입니다.</p>
<p>Signed tick은 <strong><a target="_blank" rel="noopener" href="https://www.investopedia.com/terms/a/aggressor.asp">trade’s agressor side</a>를 수치화하기 위한 알고리즘</strong>입니다. 거래가 체결되는 형태는 크게 “지정가 매도주문 + 시장가 매수주문”이 매칭이 되는 경우와 “시장가 매도주문 + 지정가 매수주문”이 매칭이 되는 경우가 있습니다. 매도호가가 매수호가보다 크기 때문에, 전자의 체결가가 더 높습니다. 즉, 직전 거래와 비교하였을 때 체결가가 높다면, 이번 거래는 시장가 매수주문에 의해 체결되었을 가능성이 높은 셈입니다. (아래 <em>Pitfall</em> 항목에서 언급하겠지만, 항상 그렇지는 않습니다.) 이를 반영하여 signed tick을 다르게 설명하면, <strong>시장가 매수주문에 의해 거래가 발생한 경우 $b_t&#x3D;1$, 시장가 매도주문에 의해 거래가 거래가 발생한 경우에는 $b_t&#x3D;-1$으로 정의하는 방법</strong>이라고 할 수 있습니다.</p>
<p>자산(혹은 계약)의 가격이 상승압력을 받게 되면 시장가 매수주문이 많이 발생하게 되고, $b_t&#x3D;1$인 경우가 상대적으로 많이 관찰이 될 것입니다. 따라서, $b_t&#x3D;1$인 경우가 어느 수준 이상 관찰될 때마다 bar를 추출하면, 시장에 유입되는 정보를 기준으로 bar를 추출할 수 있습니다. 반대의 경우($b_t&#x3D;-1$)도 마찬가지 입니다.</p>
<h3 id="Pitfall"><a href="#Pitfall" class="headerlink" title="Pitfall"></a>Pitfall</h3><p>호가가 변하는 경우, agressor side를 제대로 파악하지 못하는 문제가 생깁니다. 아래의 예시를 보겠습니다.</p>
<ol>
<li>매도호가 11,000원, 매수호가 10,000원인 주식, 이전 체결가 10,000원 ($p_0&#x3D;10000$)</li>
<li>$t&#x3D;1$ 시점에서 시장가 매수주문 접수, 체결 ($p_1&#x3D;11000$, $b_1&#x3D;1$)</li>
<li>지정가 매도주문 10,900원으로 접수. 현재 매도호가 10,900원, 매수호가 10,000원</li>
<li>$t&#x3D;2$ 시점에서 시장가 매수주문 접수, 체결 ($p_2&#x3D;10900$, $b_2&#x3D;-1 \because \Delta p_2&lt;0$)</li>
</ol>
<p>시장가 매수주문이 체결되었음에도, $b_2&#x3D;-1$이 되는 문제가 발생합니다. 매수주문과 매도주문이 균형있게 체결되는 시장에서 위의 문제는 시간이 지나면서 해소가 될 수 있습니다. 하지만 유동성이 부족하거나 변동이 큰 종목의 경우에는 문제가 될 소지가 있으므로, 이에 대해 인지를 하고 있어야 합니다.</p>
<p>사용하는 API에 따라, signed tick 정보를 제공하는 경우도 있습니다. 예를 들어 <a target="_blank" rel="noopener" href="https://doc.coinone.co.kr/#operation/public_api_trades">코인원 API에서 제공하는 최근 체결 내역</a>의 경우, 체결 시각과 체결가, 체결량과 함께 agressor side를 명시한 <code>is_ask</code>라는 데이터를 함께 제공합니다. 이 경우, 해당 데이터를 signed tick으로 활용하는 방법도 고려해볼 수 있겠습니다.</p>
<h3 id="Implementation-2"><a href="#Implementation-2" class="headerlink" title="Implementation"></a>Implementation</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">signed_tick</span>(<span class="params">tick, initial_value=<span class="number">1.0</span></span>):</span><br><span class="line">    diff = tick[<span class="string">&#x27;price&#x27;</span>] - tick[<span class="string">&#x27;price&#x27;</span>].shift(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">abs</span>(diff) / diff).ffill().fillna(initial_value)</span><br></pre></td></tr></table></figure>

<p>Signed tick을 계산하기 위해서 필요한 직전 거래의 체결가를 구하기 위해, pandas의 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html"><code>shift()</code></a> method를 사용합니다. 체결가에 변동이 없는 경우, <code>diff</code>가 0이 되어 <code>abs(diff)/diff</code> 값이 <code>np.nan</code>으로 계산되도록 한 뒤, <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.ffill.html?highlight=ffill"><code>ffill()</code></a> (forward fill)을 통해 이전 값을 사용하도록 합니다. 틱 데이터의 앞 부분에서는 <code>signed_tick</code>이 정의될 수 없으므로, 임의의 값 (<code>initial_value=1.0</code>)을 넣어줍니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung[<span class="string">&#x27;signed_tick&#x27;</span>] = signed_tick(samsung)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung.iloc[<span class="number">50</span>:<span class="number">60</span>]</span><br><span class="line">t                          price  volume      value  signed_tick</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">10</span>     <span class="number">489000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">20</span>     <span class="number">978000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">50</span>    <span class="number">2445000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>      <span class="number">69</span>    <span class="number">3377550</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>    <span class="number">2250</span>  <span class="number">110025000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>     <span class="number">148</span>    <span class="number">7237200</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>       <span class="number">5</span>     <span class="number">244750</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>       <span class="number">3</span>     <span class="number">146850</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>      <span class="number">10</span>     <span class="number">489500</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>     <span class="number">300</span>   <span class="number">14685000</span>          <span class="number">1.0</span></span><br></pre></td></tr></table></figure>

<h2 id="2-1-Tick-imbalance-bars-TIBs"><a href="#2-1-Tick-imbalance-bars-TIBs" class="headerlink" title="2.1. Tick imbalance bars (TIBs)"></a>2.1. Tick imbalance bars (TIBs)</h2><h3 id="Definition-5"><a href="#Definition-5" class="headerlink" title="Definition"></a>Definition</h3><p>Signed tick이 편향되었다는 판단은 다양한 방법으로 내릴 수 있습니다. 그 중 한 방법으로, signed tick을 누적하여 <strong>tick imbalance ($\theta_T$)</strong> 를 정의할 수 있습니다. $T$ 시점에서의 tick imbalance는 다음과 같이 정의됩니다.</p>
<escape>
\begin{align*}
\theta_T = \sum^{T}_{t=1}{b_t}
\end{align*}
</escape>

<p>그 다음으로, 현 시점에서 예상되는 다음 tick imbalance bar의 tick imbalance 값, $E_0[\theta_T]$를 구해줍니다.</p>
<escape>
\begin{align*}
E_0[\theta_T] = E_0[T](P[b_t=1] - P[b_t=-1]) = E_0[T] \cdot E_0[b_t]
\end{align*}
</escape>

<p>여기서 $E_0[T]$는 현 시점에서 예상되는 다음 bar의 크기 (틱의 개수), $E_0[b_t]$은 $b_t$의 기대값입니다. $E_0[T]$와 $E_0[b_t]$ 값을 구하는 방법 중 하나는, 이전에 추출된 tick imbalance bar들의 $T$값과 $b_t$값에 exponentially weighted moving average를 적용하여 사용하는 방법이 있습니다.</p>
<p>마지막으로, tick imbalance의 크기가 예상 tick imbalance를 넘어가는 순간에 bar를 정의합니다.</p>
<escape>
\begin{align*}
T^* = \underset{T}{\operatorname{argmin}}\left\{ |\theta_T|\ge \left| E_0[\theta_T] \right| \right\}
\end{align*}
</escape>

<p>Bar를 정의하는데 사용된 데이터($t \in [1,T^*]$)를 제외하고 위의 과정을 반복해주면, 전체 데이터에 대한 tick imbalance bar를 정의할 수 있습니다.</p>
<p>틱 데이터가 예상한 것 이상으로 불균형 할 때 $\theta_T$ 값은 커지고, 더 작은 $T$ 값으로도 $T^*$를 정의할 수 있습니다. 다르게 이야기하면, 정보의 비대칭으로 인하여 방향성이 있는 informed trading이 시장에 많이 존재 할 수록, TIB는 더 많이 생성됩니다. 따라서, TIB는 일종의 <strong>“동일한 양의 정보를 포함하는 데이터들의 묶음”</strong> 으로 생각할 수도 있겠습니다.</p>
<h3 id="Implementation-3"><a href="#Implementation-3" class="headerlink" title="Implementation"></a>Implementation</h3><p>이전의 구현들은 numpy의 퍼포먼스를 끌어올리기 위해서 최대한 vectorized 연산을 활용하였습니다. TIB의 경우, bar를 나누는 기준이 되는 $E_0[\theta_T]$의 값이 bar를 추출하는 과정 중에 지속적으로 업데이트 됩니다. Iterative한 알고리즘으로 구현을 해야 할 것으로 보입니다.</p>
<p>아래의 코드는, 데이터 iterate를 하는 동안 연산의 횟수를 줄이는 데 초점을 맞춘 구현입니다. pandas DataFrame의 <code>loc</code>, <code>iloc</code>은 역할이 다양하여 약간의 overhead가 있습니다. (<em><a target="_blank" rel="noopener" href="https://pandas.pydata.org/docs/user_guide/indexing.html#fast-scalar-value-getting-and-setting">Pandas doc</a></em>) 따라서, dataframe 외부에서 tick numbering을 해준 뒤, 한번에 column을 새로 만들어주는 방법을 사용했습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tick_imbalance_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size=<span class="number">10</span>,</span></span><br><span class="line"><span class="params">    initial_expected_signed_tick=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_signed_tick=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 1. Tick imbalance 값을 기반으로, bar numbering(`tick_imbalance_group`)</span></span><br><span class="line">    tick_imbalance = signed_tick(tick).cumsum().values</span><br><span class="line">    tick_imbalance_group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    expected_signed_tick = initial_expected_signed_tick</span><br><span class="line">    expected_tick_imbalance = expected_bar_size * expected_signed_tick</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        tick_imbalance_group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(tick_imbalance[i]) &gt;= <span class="built_in">abs</span>(expected_tick_imbalance):</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            expected_signed_tick = (</span><br><span class="line">                lambda_signed_tick * tick_imbalance[i] / (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_signed_tick) * expected_signed_tick</span><br><span class="line">            )</span><br><span class="line">            expected_tick_imbalance = expected_bar_size * expected_signed_tick</span><br><span class="line">            </span><br><span class="line">            tick_imbalance -= tick_imbalance[i]</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 2. Bar numbering 기반으로, OHLCV bar 생성</span></span><br><span class="line">    tick[<span class="string">&#x27;tick_imbalance_group&#x27;</span>] = tick_imbalance_group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;tick_imbalance_group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<h2 id="2-2-Volume-x2F-Dollar-imbalance-bars-VIBs-x2F-DIBs"><a href="#2-2-Volume-x2F-Dollar-imbalance-bars-VIBs-x2F-DIBs" class="headerlink" title="2.2. Volume&#x2F;Dollar imbalance bars (VIBs&#x2F;DIBs)"></a>2.2. Volume&#x2F;Dollar imbalance bars (VIBs&#x2F;DIBs)</h2><h3 id="Definition-6"><a href="#Definition-6" class="headerlink" title="Definition"></a>Definition</h3><p>Tick bars의 문제점을 해결하기 위하여 volume bar와 dollar bar로 개념을 확장한 것과 같이, tick imbalance bar의 개념을 volume imbalance bar와 dollar imbalance bar로 확장할 수 있습니다. <strong>거래량 혹은 거래대금의 비대칭이 예상 수준을 넘어설 때 bar를 추출하는 방법입니다.</strong> 그 과정은 TIB와 동일합니다.</p>
<p>참고한 서적에서는 $b_t&#x3D;1$인 경우와 $b_t&#x3D;-1$인 경우를 따로 구분하여 계산하지만, 저는 약간 다른 방식으로 내용을 이해했습니다. 가장 먼저, 앞서서 정의했던 signed tick을 활용하여 <strong>signed volume 혹은 signed value ($c_t$)</strong> 를 정의합니다. 여기서 $v_t$는 추출하려는 bar의 종류에 따라 거래량(VIB) 혹은 거래대금(DIB) 값을 사용합니다.</p>
<escape>
\begin{align*}
c_t = b_t v_t
\end{align*}
</escape>

<p>다음으로, $T$ 시점에서의 imbalance, $\theta_T$를 아래와 같이 정의합니다. </p>
<escape>
\begin{align*}
\theta_T = \sum^{T}_{t=1}{c_t} = \sum^{T}_{t=1}{b_t v_t}
\end{align*}
</escape>

<p>그 다음으로, 현 시점에서 예상되는 다음 bar의 imbalance 값, $E_0[\theta_T]$를 구해줍니다.</p>
<escape>
\begin{align*}
E_0[\theta_T] &= E_0[T](P[b_t=1]E_0[c_t|b_t=1] + P[b_t=-1]E_0[c_t|b_t=-1]) \\
              &= E_0[T]\cdot E_0[c_t]
\end{align*}
</escape>

<p>Tick imbalance bar를 계산할 때와 마찬가지로, $E_0[T]$ 값과 $E_0[c_t]$ 값은 이전 bar들의 $T$값과 $c_t$ 값에 exponential weighted moving average를 취해 근사할 수 있습니다.</p>
<p>마지막으로, imbalance의 크기가 예상 수치($E_0[\theta_T]$)를 넘어가는 순간에 bar를 추출합니다.</p>
<escape>
\begin{align*}
T^* = \underset{T}{\operatorname{argmin}}\left\{ |\theta_T|\ge \left| E_0[\theta_T] \right| \right\}
\end{align*}
</escape>

<p>Bar를 정의하는데 사용된 데이터($t \in [1,T^*]$)를 제외하고 위의 과정을 반복해주면, 전체 데이터에 대한 volume imbalance bar (혹은 dollar imbalance bar)를 정의할 수 있습니다.</p>
<h3 id="Implementation-4"><a href="#Implementation-4" class="headerlink" title="Implementation"></a>Implementation</h3><p>Imbalance를 정의한 뒤, 해당 imbalance가 예상 수치를 벗어나는 경우 bar를 추출한다는 점에서 TIB와 VIB, DIB의 로직은 동일합니다. 따라서, TIB의 구현에서 <code>imbalance</code>의 값을 조절하여 DIB와 VIB를 추출할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">imbalance_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="built_in">type</span>,  <span class="comment"># &#x27;tick&#x27;, &#x27;volume&#x27;, &#x27;dollar&#x27;</span></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_expected_signed,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_signed=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 1. Imbalance 값을 기반으로, bar numbering(`imbalance_group`)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;tick&#x27;</span>:</span><br><span class="line">        imbalance = signed_tick(tick).cumsum().values</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="string">&#x27;volume&#x27;</span>:</span><br><span class="line">        imbalance = (signed_tick(tick) * tick[<span class="string">&#x27;volume&#x27;</span>]).cumsum().values</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="string">&#x27;dollar&#x27;</span>:</span><br><span class="line">        imbalance = (signed_tick(tick) * tick[<span class="string">&#x27;value&#x27;</span>]).cumsum().values</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;`type`은 [&quot;tick&quot;, &quot;volume&quot;, &quot;dollar&quot;] 중 한 가지 값을 가져야 합니다.&#x27;</span>)</span><br><span class="line">    imbalance_group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    expected_signed = initial_expected_signed</span><br><span class="line">    expected_imbalance = expected_bar_size * expected_signed</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        imbalance_group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(imbalance[i]) &gt;= <span class="built_in">abs</span>(expected_imbalance):</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            expected_signed = (</span><br><span class="line">                lambda_signed * imbalance[i] / (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_signed) * expected_signed</span><br><span class="line">            )</span><br><span class="line">            expected_imbalance = expected_bar_size * expected_signed</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance -= imbalance[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 2. Bar numbering 기반으로, OHLCV bar 생성</span></span><br><span class="line">    tick[<span class="string">&#x27;imbalance_group&#x27;</span>] = imbalance_group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;imbalance_group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Tick-runs-bars-TRBs"><a href="#2-3-Tick-runs-bars-TRBs" class="headerlink" title="2.3. Tick runs bars (TRBs)"></a>2.3. Tick runs bars (TRBs)</h2><h3 id="Definition-7"><a href="#Definition-7" class="headerlink" title="Definition"></a>Definition</h3><p>앞서 살펴본 tick imbalance bar는 signed tick의 누적값을 기준으로 bar를 추출합니다. Tick runs bar는 signed tick을 하나의 값으로 누적하는 것에서 더 나아가, <strong>$b_t&#x3D;1$인 경우와 $b_t&#x3D;-1$인 경우를 따로 누적하여, 두 수치 사이의 비대칭을 기준으로 bar를 추출하는 방법</strong>입니다. 하나의 큰 거래가 호가를 밀면서 체결되거나 여러개의 작은 거래로 나뉘어져서 체결되는 경우 $b_{t&#x3D;1,…,T}$에 <strong>run</strong>(연속된 데이터 흔적)을 남기게 되는데, 이를 포착하는 방법입니다.</p>
<p>가장 먼저, 현재 run의 길이, $\theta_T$를 다음과 같이 정의합니다.</p>
<escape>
\begin{align*}
\theta_T = \text{max}\left\{\sum^{T}_{t|b_t=1}{b_t}, -\sum^{T}_{t|b_t=-1}{b_t} \right\}
\end{align*}
</escape>

<p>통계학에서 말하는 run은 동일한 관측값이 (끊김없이) 연속적으로 이어진 것을 의미합니다. (<em><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wald%E2%80%93Wolfowitz_runs_test#Definition">Wikipedia</a></em>) 이와는 약간 다르게, 서적에서 정의한 run은 데이터의 끊김(sequence break)을 허용합니다. 즉, 여기서 말하는 “run의 길이”는 연속된 데이터의 실질적인 길이를 의미하는 것이 아니라, 일정 기간 동안 관찰된 최빈값의 빈도수를 의미합니다.</p>
<p>다음으로, 현 시점에서 예상되는 다음 run의 길이, $E[\theta_T]$를 구해줍니다.</p>
<escape>
\begin{align*}
E_0[\theta_T] &= E_0[T]\cdot \text{max}\left\{ P[b_t=1], P[b_t=-1] \right\} \\
              &= E_0[T]\cdot \text{max}\left\{ P[b_t=1], 1-P[b_t=1] \right\}
\end{align*}
</escape>

<p>Imbalance bar와 마찬가지로, $E_0[T]$와 $P[b_t&#x3D;1]$ 값은 추정치를 사용하고, 이전 bar의 $T$, $P[b_t&#x3D;1]$(proportion of buy ticks)의 EWMA 값을 사용하는 것이 하나의 방법입니다.</p>
<p>이후, run의 길이가 예상되는 run의 길이를 넘어가는 순간 bar를 추출합니다.</p>
<escape>
\begin{align*}
T^* = \underset{T}{\operatorname{argmin}}\left\{ \theta_T \ge E_0[\theta_T] \right\}
\end{align*}
</escape>

<p>Bar를 정의하는데 사용된 데이터($t \in [1,T^*]$)를 제외하고 위의 과정을 반복해주면, 전체 데이터에 대한 tick run bar를 정의할 수 있습니다.</p>
<h3 id="Implementation-5"><a href="#Implementation-5" class="headerlink" title="Implementation"></a>Implementation</h3><p>로직은 TIB, VIB, DIB의 구현과 동일하고, bar를 추출하는 기준(라인 33)만 다릅니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tick_runs_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_buy_prob,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_prob=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    _signed_tick = signed_tick(tick)</span><br><span class="line">    imbalance_tick_buy = _signed_tick.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_tick_sell = _signed_tick.apply(<span class="keyword">lambda</span> v: -v <span class="keyword">if</span> v&lt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    </span><br><span class="line">    group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    buy_prob = initial_buy_prob</span><br><span class="line">    expected_runs = expected_bar_size * <span class="built_in">max</span>(buy_prob, <span class="number">1</span>-buy_prob)</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(imbalance_tick_buy[i], imbalance_tick_sell[i]) &gt;= expected_runs:</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_prob = (</span><br><span class="line">                lambda_buy_prob * imbalance_tick_buy[i]/(i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_prob) * buy_prob</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance_tick_buy -= imbalance_tick_buy[i]</span><br><span class="line">            imbalance_tick_sell -= imbalance_tick_sell[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;group&#x27;</span>] = group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<h2 id="2-4-Volume-x2F-Dollar-runs-bars-VRBs-x2F-DRBs"><a href="#2-4-Volume-x2F-Dollar-runs-bars-VRBs-x2F-DRBs" class="headerlink" title="2.4 Volume&#x2F;Dollar runs bars (VRBs&#x2F;DRBs)"></a>2.4 Volume&#x2F;Dollar runs bars (VRBs&#x2F;DRBs)</h2><h3 id="Definition-8"><a href="#Definition-8" class="headerlink" title="Definition"></a>Definition</h3><p>Tick runs bars의 개념을 확장하여, 거래량 혹은 거래대금으로 runs bars를 추출하는 방법입니다. 먼저, 거래량&#x2F;거래대금 run($\theta_T$)를 다음과 같이 정의합니다. 위와 마찬가지로, $v_t$는 추출하려는 bar의 종류에 따라 거래량(VRB) 혹은 거래대금(DRB) 값을 사용합니다.</p>
<escape>
\begin{align*}
\theta_T = \operatorname{max}\left\{ \sum^{T}_{t|b_t=1}{b_tv_t}, -\sum^{T}_{t|b_t=-1}{b_tv_t} \right\}
\end{align*}
</escape>

<p>다음으로, 현 시점에서 예상되는 다음 bar의 run 값, $E_0[\theta_T]$를 계산합니다.</p>
<escape>
\begin{align*}
E_0[\theta_t] = E_0[T]\operatorname{max}\left\{ P[b_t=1]E_0[v_t|b_t=1], (1-P[b_t=1])E_0[v_t|b_t=-1] \right\}
\end{align*}
</escape>

<p>위 수식에서 필요한 몇 가지 값들은 아래와 같습니다. (TIB, VIB, DIB, TRB에 비해 estimate 해야 하는 값들이 더 많습니다.)</p>
<ul>
<li>$E_0[T]$는 (이전 bar들의) $T$ 값의 EWMA를 사용합니다.</li>
<li>$P[b_t&#x3D;1]$은 (이전 bar들의) $P[b_t&#x3D;1]$(proportion of buy ticks)값들의 EWMA를 사용합니다.</li>
<li>$E_0[v_t|b_t&#x3D;1]$은 (이전 bar들의) 시장가 매도수량값들의 EWMA를 사용합니다.</li>
<li>$E_0[v_t|b_t&#x3D;-1]$은 (이전 bar들의) 시장가 매수수량값들의 EWMA를 사용합니다.</li>
</ul>
<p>마지막으로, run의 길이가 예상되는 run의 길이를 넘어가는 순간 bar를 추출합니다.</p>
<escape>
\begin{align*}
T^* = \underset{T}{\operatorname{argmin}}\left\{ \theta_T \ge E_0[\theta_T] \right\}
\end{align*}
</escape>

<p>Bar를 정의하는데 사용된 데이터($t \in [1,T^*]$)를 제외하고 위의 과정을 반복해주면, 전체 데이터에 대한 volume&#x2F;dollar run bar를 정의할 수 있습니다.</p>
<h3 id="Implementation-6"><a href="#Implementation-6" class="headerlink" title="Implementation"></a>Implementation</h3><p>TIB를 VIB&#x2F;DIB로 구현을 확장한 것과 같이, TRB의 구현을 응용하여 VRB&#x2F;DRB를 아래와 같이 추출할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">volume_runs_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_buy_prob,</span></span><br><span class="line"><span class="params">    initial_buy_volume,</span></span><br><span class="line"><span class="params">    initial_sell_volume,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_prob=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_volume=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_sell_volume=<span class="number">.1</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    _signed_tick = signed_tick(tick)</span><br><span class="line">    _signed_volume = _signed_tick * tick[<span class="string">&#x27;volume&#x27;</span>]</span><br><span class="line">    imbalance_tick_buy = _signed_tick.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_volume_buy = _signed_volume.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_volume_sell = _signed_volume.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> -v&lt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    </span><br><span class="line">    group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    buy_prob = initial_buy_prob</span><br><span class="line">    buy_volume = initial_buy_volume</span><br><span class="line">    sell_volume = initial_sell_volume</span><br><span class="line">    expected_runs = expected_bar_size * <span class="built_in">max</span>(buy_prob * buy_volume, (<span class="number">1</span>-buy_prob) * sell_volume)</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(imbalance_volume_buy[i], imbalance_volume_sell[i]) &gt;= expected_runs:</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_prob = (</span><br><span class="line">                lambda_buy_prob * imbalance_tick_buy[i]/(i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_prob) * buy_prob</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_volume = (</span><br><span class="line">                lambda_buy_volume * imbalance_volume_buy[i] +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_volume) * buy_volume</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            sell_volume = (</span><br><span class="line">                lambda_sell_volume * imbalance_volume_sell[i] +</span><br><span class="line">                (<span class="number">1</span>-lambda_sell_volume) * sell_volume</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance_tick_buy -= imbalance_tick_buy[i]</span><br><span class="line">            imbalance_volume_buy -= imbalance_volume_buy[i]</span><br><span class="line">            imbalance_volume_sell -= imbalance_volume_sell[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;group&#x27;</span>] = group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="3-Appendix"><a href="#3-Appendix" class="headerlink" title="3. Appendix"></a>3. Appendix</h1><h2 id="3-1-Timebar-→-Timebar"><a href="#3-1-Timebar-→-Timebar" class="headerlink" title="3.1. Timebar → Timebar"></a>3.1. Timebar → Timebar</h2><p>간혹, 하나의 timebar를 다른 단위의 timebar로 변환을 해야 할 때가 있습니다. 이 경우, <code>pandas.DataFrame.resample</code>을 통해 시계열 index를 재정렬 할 수 있습니다.</p>
<p>아래의 <code>timebar_1min</code> 데이터는 2021년 2월 11일 00:00부터 15일 08:40까지의 비트코인 1분봉 데이터입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min</span><br><span class="line">                           <span class="built_in">open</span>        high  ...     volume         value</span><br><span class="line">t                                            ...                         </span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48384000.0</span>  <span class="number">48391000.0</span>  ...  <span class="number">20.124271</span>  <span class="number">9.732357e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:01:<span class="number">00</span>  <span class="number">48377000.0</span>  <span class="number">48587000.0</span>  ...  <span class="number">16.129580</span>  <span class="number">7.815445e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:02:<span class="number">00</span>  <span class="number">48446000.0</span>  <span class="number">48446000.0</span>  ...  <span class="number">14.955761</span>  <span class="number">7.228841e+08</span></span><br><span class="line">                         ...         ...  ...        ...           ...</span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">38</span>:<span class="number">00</span>  <span class="number">52470000.0</span>  <span class="number">52620000.0</span>  ...  <span class="number">10.435710</span>  <span class="number">5.480798e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">39</span>:<span class="number">00</span>  <span class="number">52592000.0</span>  <span class="number">52626000.0</span>  ...   <span class="number">2.021345</span>  <span class="number">1.063235e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">40</span>:<span class="number">00</span>  <span class="number">52625000.0</span>  <span class="number">52627000.0</span>  ...   <span class="number">1.383658</span>  <span class="number">7.281528e+07</span></span><br><span class="line">[<span class="number">6281</span> rows x <span class="number">6</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.index</span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2021-02-11 00:00:00&#x27;</span>, <span class="string">&#x27;2021-02-11 00:01:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2021-02-11 00:02:00&#x27;</span>, <span class="string">&#x27;2021-02-11 00:03:00&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2021-02-15 08:37:00&#x27;</span>, <span class="string">&#x27;2021-02-15 08:38:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2021-02-15 08:39:00&#x27;</span>, <span class="string">&#x27;2021-02-15 08:40:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, name=<span class="string">&#x27;t&#x27;</span>, length=<span class="number">6281</span>, freq=<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.columns</span><br><span class="line">Index([<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>], dtype=<span class="string">&#x27;object&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>1분봉 데이터를 60분봉 데이터로 변환하려면, 다음과 같이 resampling을 해주면 됩니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.resample(<span class="string">&#x27;60min&#x27;</span>).agg(&#123;  <span class="comment"># 기존의 데이터를 60분 단위로 모아서,</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;open&#x27;</span>: <span class="string">&#x27;first&#x27;</span>,  <span class="comment"># 그룹 중 가장 첫 번째 open 값을 해당 그룹의 open 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;high&#x27;</span>: <span class="string">&#x27;max&#x27;</span>,    <span class="comment"># 그룹 중 가장 큰 high 값을 해당 그룹의 high 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;low&#x27;</span>: <span class="string">&#x27;min&#x27;</span>,     <span class="comment"># 그룹 중 가장 작은 low 값을 해당 그룹의 low 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;close&#x27;</span>: <span class="string">&#x27;last&#x27;</span>,  <span class="comment"># 그룹 중 가장 마지막 close 값을 해당 그룹의 close 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;volume&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>,  <span class="comment"># 그룹 내 volume 값을 모두 더한 값을 해당 그룹의 volume 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>    <span class="comment"># 그룹 내 value 값을 모두 더한 값을 해당 그룹의 value 값으로 사용</span></span><br><span class="line"><span class="meta">... </span>&#125;)</span><br><span class="line">                           <span class="built_in">open</span>        high  ...       volume         value</span><br><span class="line">t                                            ...                           </span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48384000.0</span>  <span class="number">48840000.0</span>  ...  <span class="number">1288.234569</span>  <span class="number">6.193043e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> 01:<span class="number">00</span>:<span class="number">00</span>  <span class="number">47910000.0</span>  <span class="number">48266000.0</span>  ...   <span class="number">506.462391</span>  <span class="number">2.428122e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> 02:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48104000.0</span>  <span class="number">48376000.0</span>  ...   <span class="number">223.599107</span>  <span class="number">1.075957e+10</span></span><br><span class="line">                         ...         ...  ...          ...           ...</span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 06:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52422000.0</span>  <span class="number">52670000.0</span>  ...   <span class="number">117.880850</span>  <span class="number">6.193310e+09</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 07:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52653000.0</span>  <span class="number">52975000.0</span>  ...   <span class="number">223.672317</span>  <span class="number">1.180129e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52823000.0</span>  <span class="number">52847000.0</span>  ...   <span class="number">187.066944</span>  <span class="number">9.853452e+09</span></span><br><span class="line">[<span class="number">105</span> rows x <span class="number">6</span> columns]</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>포스트 작성자:  </strong>Hwanghee Kim
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://hwangheek.github.io/2020/pandas-tick-data/" title="Pandas를 이용하여 틱데이터 가공하기">https://hwangheek.github.io/2020/pandas-tick-data/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/Pandas/" rel="tag"># Pandas</a>
              <a href="/tags/System-Trading/" rel="tag"># System Trading</a>
              <a href="/tags/Advances-in-Financial-Machine-Learning/" rel="tag"># Advances in Financial Machine Learning</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/python-logging/" rel="prev" title="조금 더 체계적인 Python Logging">
                  <i class="fa fa-chevron-left"></i> 조금 더 체계적인 Python Logging
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/pandas-custom-businessday-from-krx/" rel="next" title="KRX의 휴장일 데이터를 기반으로 Python pandas의 AbstractHolidayCalendar와 CustomBusinessDay 사용하기">
                  KRX의 휴장일 데이터를 기반으로 Python pandas의 AbstractHolidayCalendar와 CustomBusinessDay 사용하기 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hwanghee Kim</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"blog-w5rrs5lidd","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
