<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ã…ã…ã…‹</title>
  
  <subtitle>ã…ã…ã…‹ì˜ ê°œì¸ ì—°êµ¬ì‹¤</subtitle>
  <link href="https://hwangheek.github.io/atom.xml" rel="self"/>
  
  <link href="https://hwangheek.github.io/"/>
  <updated>2022-07-23T14:39:52.366Z</updated>
  <id>https://hwangheek.github.io/</id>
  
  <author>
    <name>Hwanghee Kim</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pythonìœ¼ë¡œ ë¸”ë™ë¦¬í„°ë§Œ (Black-Litterman) ëª¨ë¸ êµ¬í˜„í•˜ê¸°</title>
    <link href="https://hwangheek.github.io/2021/black-litterman/"/>
    <id>https://hwangheek.github.io/2021/black-litterman/</id>
    <published>2021-02-16T09:09:22.000Z</published>
    <updated>2022-07-23T14:39:52.366Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0. Introduction"></a>0. Introduction</h1><p>ê¸ˆìœµ ë°ì´í„°ë¥¼ ì´ëŸ°ì €ëŸ° ë°©ì‹ìœ¼ë¡œ ë¶„ì„í•´ì„œ ê²°ê³¼ë¥¼ íŒ€ì›ë“¤ì—ê²Œ ê³µìœ í•˜ë©´, ë°˜ë“œì‹œ ë‚˜ì˜¤ëŠ” ì¤‘ìš”í•œ ì§ˆë¬¸ì´ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ ì „ëµí™” í•  ìˆ˜ ìˆëƒëŠ” ê²ë‹ˆë‹¤. ë¶„ì„ ê·¸ ìì²´ë¡œì¨ ì˜ë¯¸ìˆëŠ” ê²½ìš°ë„ ìˆì§€ë§Œ, ê²°ê³¼ì ìœ¼ë¡œ (ëª¨ë¸ì´ ë˜ì—ˆë“  ë§¤ë‹ˆì €ê°€ ë˜ì—ˆë“ ) ëˆ„êµ°ê°€ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ë° ìš´ìš© ë°©ì‹, ì¦‰, ì–´ë–¤ ìì‚°($X$)ì„ ì–¸ì œ($t$), ì–¼ë§ˆë§Œí¼($w$) ê°€ì§€ê³  ìˆì–´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ íŒë‹¨ì„ ë‚´ë ¤ì•¼ í•©ë‹ˆë‹¤.</p><p>í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±ê³¼ ê´€ë ¨ëœ ëª¨ë¸ ì¤‘ ê°€ì¥ ì˜ ì•Œë ¤ì§„ ì´ë¡ ì€ <a href="https://www.investopedia.com/terms/m/meanvariance-analysis.asp">Mean-Variance Optimization Portfolio</a>ì¼ ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ ëª¨ë¸ì˜ ë¡œì§ì€ ë…¼ë¦¬ì ì´ê³  ì§ê´€ì ì´ì§€ë§Œ, ëª‡ ê°€ì§€ ë¬¸ì œì ë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ì…ë ¥ ë°ì´í„°ì˜ ì‘ì€ ë³€í™”ì—ë„ ë„ì¶œë˜ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±ë¹„ì¤‘ì´ í¬ê²Œ ë³€í•©ë‹ˆë‹¤.</li><li>ëª‡ ê°œì˜ ìì‚°ì— ë¹„ì¤‘ì´ ì ë¦¬ëŠ” ì½”ë„ˆ ì†”ë£¨ì…˜ì´ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.</li><li>íˆ¬ììê°€ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ë¥¼ ë…¹ì—¬ë‚¼ ìˆ˜ ìˆëŠ” ë°©ë²• ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì‹œì¥ì— ëŒ€í•œ ê²¬í•´ê°€ ë‹¤ë¥¸ ë§¤ë‹ˆì €ì¼ì§€ë¼ë„ (ê°™ì€ hyperparameterë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°) ê°™ì€ MVO í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì–»ê²Œ ë©ë‹ˆë‹¤.</li></ol><p>ìœ„ ë¬¸ì œì ë“¤ì€ ì‹¤ì œ ìš´ìš©ì„ í•  ë•Œ ê±¸ë¦¼ëŒì´ ë©ë‹ˆë‹¤. (ex. ë†’ì€ turnover ratio, ê·œì œìœ„ë°˜, ëª¨ë¸ì— ë“¤ì–´ê°€ì§€ ì•Šì€ ì¶”ê°€ì ì¸ ì •ë³´ ë°˜ì˜ ë¶ˆê°€ ë“±) ì´ëŸ¬í•œ ë¬¸ì œì ë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´, ê³¨ë“œë§Œì‚­ìŠ¤ì˜ Fischer Blackê³¼ Robert Littermanì´ 1990ë…„ì— ê°œë°œí•˜ê³  1992ë…„ì— ë°œí‘œí•œ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë°©ë²•ë¡ ì´ Black-Litterman Modelì…ë‹ˆë‹¤.</p><p>ë³¸ í¬ìŠ¤íŒ…ì€ Black-Litterman Portfolio Modelì˜ ì „ì²´ì ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì´í•´í•˜ê³ , Pythonìœ¼ë¡œ ì´ë¥¼ êµ¬í˜„í•´ë³´ëŠ” ê³¼ì •ì„ ì •ë¦¬í•´ ë†“ì€ ê¸€ì…ë‹ˆë‹¤. ë‚´ìš©ì— ë¬¸ì œë‚˜ ê°œì„ ì ì´ ìˆëŠ” ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜€</p><span id="more"></span><h2 id="0-References"><a href="#0-References" class="headerlink" title="0. References"></a>0. References</h2><ul><li>Idzorek, T. â€œA step-by-step guide to the Black-Litterman model: Incorporating user-specified confidence levels.â€, 2007<ul><li>ëª¨ë¸ì„ ì´í•´í•˜ëŠ”ë° ê°€ì¥ ë§ì´ ì°¸ì¡°í•œ ìë£Œë¡œ, í¬ìŠ¤íŒ…ì˜ notationë“¤ì€ í•´ë‹¹ ìë£Œë¥¼ ë”°ë¼ê°”ìŠµë‹ˆë‹¤.</li></ul></li><li>Stuart, J. â€œ<a href="https://pythonforfinance.net/2020/11/27/black-litterman-portfolio-allocation-model-in-python/#more-17887">Black-Litterman Portfolio Allocation Model in Python</a>â€œ, 2020<ul><li>Reverse Optimization Processë¥¼ ì´í•´í•˜ëŠ”ë° í° ë„ì›€ì´ ëœ í¬ìŠ¤íŒ…ì…ë‹ˆë‹¤.</li></ul></li><li>Tim Wilding. â€œ<a href="https://quant.stackexchange.com/a/40943">Struggling with tau in Black-Litterman</a>â€œ, 2018</li><li>Walters, Jay. â€œThe Factor Tau in the Black-Litterman Modelâ€, 2010<ul><li>$\tau$ ê°’ì„ ì´í•´í•˜ëŠ”ë° ë„ì›€ì´ ëì—ˆë˜ í¬ìŠ¤íŒ…ê³¼ ìë£Œì…ë‹ˆë‹¤.</li></ul></li><li>Satchell, S. and Scowcroft, A. â€œA Demystification of the Black-Litterman model: Managing Quantitative and Traditional Construction.â€, 2000</li><li>Blamont, D. and Firoozy, N. â€œAsset Allocation Model.â€, 2003</li><li>Olsson, Sebastian &amp; Trollsten, Viktor. â€œThe Black-Litterman Asset Allocation Modelâ€, 2018</li></ul><!-- - https://ko.wikipedia.org/wiki/ë¸”ë™-ë¦¬í„°ë§Œ_ëª¨í˜• (Intro)- [Python PyPortfolioOpt ëª¨ë“ˆ](https://pyportfolioopt.readthedocs.io/en/latest/BlackLitterman.html)- http://egloos.zum.com/timebird/v/7469432 (Shortcoming)- https://junyoru.tistory.com/102 (Shortcoming)- https://hudsonthames.org/portfolio-optimisation-with-portfoliolab-mean-variance-optimisation/ (MVO)--><hr><h1 id="1-Top-down"><a href="#1-Top-down" class="headerlink" title="1. Top-down"></a>1. Top-down</h1><p>ëª¨ë¸ì„ ìì„¸íˆ ì‚´í´ë³´ê¸°ì— ì•ì„œì„œ, ëª¨ë¸ì— ì‚¬ìš©ë˜ëŠ” ìˆ˜ì‹ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><escape>\begin{align}  E[R]    &= [(\tau\Sigma)^{-1}+P^T\Omega^{-1}P]^{-1}[(\tau\Sigma)^{-1}\Pi+P^T\Omega^{-1}Q] \\  \hat{w} &= (\Sigma^{-1}E[R])/(1^T\Sigma^{-1}E[R])\end{align}</escape><escape>\begin{align*}  N       &\qquad\text{is the number of assets} \\  K       &\qquad\text{is the number of views} \\  E[R]    &\qquad\text{is the new (posterior) Combined Return Vector (N x 1 column vector)} \\  \tau    &\qquad\text{is a scalar} \\  \Sigma  &\qquad\text{is the covariance matrix of excess returns (N x N matrix)} \\  P       &\qquad\text{is a matrix that identifies the assets involved in the views} \\          &\qquad\text{(K x N matrix or 1 x N row vector in the special case of 1 view)} \\  \Omega  &\qquad\text{is a diagonal covariance matrix of error terms from the expressed views} \\          &\qquad\text{representing the uncertainty in each view (K x K matrix)} \\  \Pi     &\qquad\text{is the Implied Equilibrium Return Vector (N x 1 column vector)} \\  Q       &\qquad\text{is the View Vector (K x 1 column vector)} \\  \hat{w} &\qquad\text{is the new portfolio weight (N x 1 column vector) derived by the model} \\  \lambda &\qquad\text{is the risk aversion coefficient}\end{align*}</escape><p>ìˆ˜ì‹ì´ ì—„ì²­ ë³µì¡í•´ ë³´ì´ì§€ë§Œ, ê°„ë‹¨í•˜ê²Œ ìš”ì•½í•˜ìë©´ ìˆ˜ì‹(1)ì€ ì‹œì¥ ë°ì´í„°ë¥¼ í†µí•´ ë„ì¶œëœ â€œì ë‹¹í•œâ€ ìˆ˜ìµë¥ ($\Pi$)ê³¼ íˆ¬ììì˜ ì „ë§($Q$)ì„ â€œì˜â€ ì¡°í•©í•˜ì—¬ ìƒˆë¡œìš´ ê¸°ëŒ€ìˆ˜ìµë¥ ($E[R]$)ì„ ë§Œë“œëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ë„ì¶œëœ ê¸°ëŒ€ìˆ˜ìµë¥ ì„ ìˆ˜ì‹(2, unconstrained mean-variance maximization)ì™€ ê°™ì´ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘($\hat{w}$)ì„ êµ¬í•˜ëŠ” ê²ƒì´, ëª¨ë¸ì˜ ìµœì¢… ëª©í‘œì…ë‹ˆë‹¤.</p><p>ì´ì œ ê°ê°ì˜ inputë“¤ì´ ì–´ë–¤ ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ì–´ë–»ê²Œ ì„¤ì •í•´ì•¼ í•˜ëŠ”ì§€, ì†ŒìŠ¤ì½”ë“œê°€ ì§„í–‰ë˜ëŠ” ìˆœì„œë¥¼ ë”°ë¼ ì˜ˆì‹œì™€ í•¨ê»˜ ì‚´í´ë´…ì‹œë‹¤.</p><hr><h1 id="2-Bottom-up-with-an-example"><a href="#2-Bottom-up-with-an-example" class="headerlink" title="2. Bottom-up (with an example)"></a>2. Bottom-up (with an example)</h1><h2 id="2-1-N-The-Number-of-Assets"><a href="#2-1-N-The-Number-of-Assets" class="headerlink" title="2.1. $N$ : The Number of Assets"></a>2.1. $N$ : The Number of Assets</h2><p>ëª¨ë¸ì— ì‚¬ìš©ë˜ëŠ” ìì‚°ì˜ ê°œìˆ˜ì…ë‹ˆë‹¤.</p><p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ”, êµ­ë‚´ ì£¼ì‹ 10ê°œ ì„¹í„° ìˆ˜ìµë¥  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤. ì„¹í„°ë³„ ìˆ˜ìµë¥  ë°ì´í„°(<code>monthly_excess_returns</code>)ì™€ ê° ì„¹í„°ë³„ ë¹„ì¤‘(<code>w_mkt</code>) ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> inv</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monthly_excess_returns</span><br><span class="line">ì¼ì          ì—ë„ˆì§€      ì†Œì¬    ì‚°ì—…ì¬  ...        IT  í†µì‹ ì„œë¹„ìŠ¤  ìœ í‹¸ë¦¬í‹°</span><br><span class="line"><span class="number">2000</span>-02-<span class="number">29</span>  <span class="number">0.064542</span> -<span class="number">0.101358</span> -<span class="number">0.084858</span>  ...  <span class="number">0.079742</span>   -<span class="number">0.044158</span> -<span class="number">0.160058</span></span><br><span class="line"><span class="number">2000</span>-03-<span class="number">31</span>  <span class="number">0.169433</span>  <span class="number">0.027033</span>  <span class="number">0.054333</span>  ...  <span class="number">0.044533</span>   -<span class="number">0.091467</span>  <span class="number">0.103133</span></span><br><span class="line"><span class="number">2000</span>-04-<span class="number">30</span> -<span class="number">0.190800</span> -<span class="number">0.175200</span> -<span class="number">0.187300</span>  ... -<span class="number">0.247900</span>   -<span class="number">0.275900</span>  <span class="number">0.035600</span></span><br><span class="line"><span class="number">2000</span>-05-<span class="number">31</span> -<span class="number">0.072333</span> -<span class="number">0.098433</span> -<span class="number">0.122233</span>  ... -<span class="number">0.050033</span>    <span class="number">0.138067</span> -<span class="number">0.072133</span></span><br><span class="line"><span class="number">2000</span>-06-<span class="number">30</span>  <span class="number">0.112958</span>  <span class="number">0.061258</span>  <span class="number">0.065258</span>  ...  <span class="number">0.143958</span>    <span class="number">0.045258</span>  <span class="number">0.124458</span></span><br><span class="line">              ...       ...       ...  ...       ...         ...       ...</span><br><span class="line"><span class="number">2020</span>-08-<span class="number">31</span>  <span class="number">0.043058</span>  <span class="number">0.144558</span>  <span class="number">0.016958</span>  ... -<span class="number">0.024642</span>    <span class="number">0.083358</span>  <span class="number">0.040158</span></span><br><span class="line"><span class="number">2020</span>-09-<span class="number">30</span> -<span class="number">0.072250</span> -<span class="number">0.049650</span> -<span class="number">0.002950</span>  ...  <span class="number">0.018750</span>   -<span class="number">0.025350</span> -<span class="number">0.001750</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">31</span> -<span class="number">0.036650</span> -<span class="number">0.001250</span> -<span class="number">0.004250</span>  ... -<span class="number">0.041450</span>   -<span class="number">0.077950</span> -<span class="number">0.000150</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">11</span>-<span class="number">30</span>  <span class="number">0.224950</span>  <span class="number">0.186950</span>  <span class="number">0.125250</span>  ...  <span class="number">0.147450</span>    <span class="number">0.104550</span>  <span class="number">0.067050</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">29</span>  <span class="number">0.034150</span>  <span class="number">0.036150</span>  <span class="number">0.031150</span>  ...  <span class="number">0.117950</span>   -<span class="number">0.002550</span>  <span class="number">0.149450</span></span><br><span class="line">[<span class="number">251</span> rows x <span class="number">10</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monthly_excess_returns.columns</span><br><span class="line">Index([<span class="string">&#x27;ì—ë„ˆì§€&#x27;</span>, <span class="string">&#x27;ì†Œì¬&#x27;</span>, <span class="string">&#x27;ì‚°ì—…ì¬&#x27;</span>, <span class="string">&#x27;ê²½ê¸°ì†Œë¹„ì¬&#x27;</span>, <span class="string">&#x27;í•„ìˆ˜ì†Œë¹„ì¬&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;ì˜ë£Œ&#x27;</span>, <span class="string">&#x27;ê¸ˆìœµ&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>, <span class="string">&#x27;í†µì‹ ì„œë¹„ìŠ¤&#x27;</span>, <span class="string">&#x27;ìœ í‹¸ë¦¬í‹°&#x27;</span>],</span><br><span class="line">      dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_mkt</span><br><span class="line">ì—ë„ˆì§€        <span class="number">0.0338</span></span><br><span class="line">ì†Œì¬          <span class="number">0.0912</span></span><br><span class="line">ì‚°ì—…ì¬        <span class="number">0.0924</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬    <span class="number">0.1315</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬    <span class="number">0.0452</span></span><br><span class="line">ì˜ë£Œ          <span class="number">0.1120</span></span><br><span class="line">ê¸ˆìœµ          <span class="number">0.0609</span></span><br><span class="line">IT            <span class="number">0.4103</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤    <span class="number">0.0134</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°      <span class="number">0.0094</span></span><br><span class="line">Name: weights, dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>N = monthly_excess_returns.columns.size</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>N</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><h2 id="2-2-Sigma-Covariance-Matrix-of-Asset-Excess-Returns"><a href="#2-2-Sigma-Covariance-Matrix-of-Asset-Excess-Returns" class="headerlink" title="2.2. $\Sigma$ : Covariance Matrix of Asset Excess Returns"></a>2.2. $\Sigma$ : Covariance Matrix of Asset Excess Returns</h2><p>ê° ìì‚°ë³„ ì´ˆê³¼ìˆ˜ìµë¥ ì˜ ê³µë¶„ì‚°í–‰ë ¬ì…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Sigma = monthly_excess_returns.cov()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Sigma</span><br><span class="line">            ì—ë„ˆì§€    ì†Œì¬      ì‚°ì—…ì¬    ...  IT        í†µì‹ ì„œë¹„ìŠ¤  ìœ í‹¸ë¦¬í‹°</span><br><span class="line">ì—ë„ˆì§€      <span class="number">0.008452</span>  <span class="number">0.004698</span>  <span class="number">0.005392</span>  ...  <span class="number">0.003733</span>  <span class="number">0.002320</span>    <span class="number">0.002559</span></span><br><span class="line">ì†Œì¬        <span class="number">0.004698</span>  <span class="number">0.005819</span>  <span class="number">0.005411</span>  ...  <span class="number">0.003941</span>  <span class="number">0.002314</span>    <span class="number">0.002564</span></span><br><span class="line">ì‚°ì—…ì¬      <span class="number">0.005392</span>  <span class="number">0.005411</span>  <span class="number">0.007203</span>  ...  <span class="number">0.004600</span>  <span class="number">0.002450</span>    <span class="number">0.002828</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬  <span class="number">0.003492</span>  <span class="number">0.004154</span>  <span class="number">0.004939</span>  ...  <span class="number">0.004753</span>  <span class="number">0.002500</span>    <span class="number">0.002234</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬  <span class="number">0.002434</span>  <span class="number">0.002301</span>  <span class="number">0.002803</span>  ...  <span class="number">0.001972</span>  <span class="number">0.001537</span>    <span class="number">0.001942</span></span><br><span class="line">ì˜ë£Œ        <span class="number">0.003892</span>  <span class="number">0.003948</span>  <span class="number">0.004827</span>  ...  <span class="number">0.004101</span>  <span class="number">0.002414</span>    <span class="number">0.001920</span></span><br><span class="line">ê¸ˆìœµ        <span class="number">0.004257</span>  <span class="number">0.004220</span>  <span class="number">0.004727</span>  ...  <span class="number">0.004055</span>  <span class="number">0.002356</span>    <span class="number">0.002712</span></span><br><span class="line">IT          <span class="number">0.003733</span>  <span class="number">0.003941</span>  <span class="number">0.004600</span>  ...  <span class="number">0.007571</span>  <span class="number">0.002820</span>    <span class="number">0.001931</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤  <span class="number">0.002320</span>  <span class="number">0.002314</span>  <span class="number">0.002450</span>  ...  <span class="number">0.002820</span>  <span class="number">0.004575</span>    <span class="number">0.002056</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°    <span class="number">0.002559</span>  <span class="number">0.002564</span>  <span class="number">0.002828</span>  ...  <span class="number">0.001931</span>  <span class="number">0.002056</span>    <span class="number">0.004902</span></span><br></pre></td></tr></table></figure><h2 id="2-3-Reverse-Optimization-Process"><a href="#2-3-Reverse-Optimization-Process" class="headerlink" title="2.3. Reverse Optimization Process"></a>2.3. Reverse Optimization Process</h2><p>Mean-variance optimization processë¥¼ ì¶”ìƒì ìœ¼ë¡œ ìš”ì•½í•˜ìë©´, ìì‚°ì˜ ìˆ˜ìµë¥ ê³¼ ê³µë¶„ì‚° ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ â€œìµœëŒ€ ìˆ˜ìµë¥ , ìµœì € ë³€ë™ì„±â€ì„ ê°€ì§€ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì„ êµ¬í•˜ëŠ” ê³¼ì •ì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ($f: (\mu, \Sigma) \rightarrow w$) ì´ë¥¼ ìˆ˜ì‹ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì´ <em>quadratic risk utility function</em>ì´ê³ , ìµœì í™” ë¬¸ì œë¥¼ ì•„ë˜ì™€ ê°™ì´ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><escape>\begin{align}& \underset{w}{\operatorname{max}}\left(w^T\mu - \frac{1}{2}\lambda w^T\Sigma w\right) \\& \rightarrow \mu - \lambda\Sigma w = 0 \\& \rightarrow w = (\lambda\Sigma)^{-1}\mu\end{align}</escape><p>í˜„ì¬ ì‹œì¥ì—ì„œ ê´€ì°°í•  ìˆ˜ ìˆëŠ” ì‹œê°€ì´ì•¡ë¹„ì¤‘(market capitalization weight)ì´ ìœ„ì˜ ìµœì í™” ê³¼ì •ì—ì„œ ë„ì¶œ ëœ ì´ìƒì ì¸ ë¹„ì¤‘ì´ë¼ê³  ê°€ì • í•´ë´…ì‹œë‹¤. ìì‚° ê°„ ê³µë¶„ì‚°í–‰ë ¬ì´ ìˆëŠ” ê²½ìš°, ì‹ (5)ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë³€í˜•í•˜ì—¬, ê° ìì‚°ì˜ â€œimplied returnsâ€ë¥¼ ì—­ìœ¼ë¡œ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ($g:(w_{mkt}, \Sigma) \rightarrow \mu_{implied}$).</p><escape>\begin{align}\mu_{implied} = \lambda \Sigma w_{mkt}\end{align}</escape><p>ìœ„ì™€ ê°™ì´, ì‹œì¥ì—ì„œ ê´€ì¸¡ë˜ëŠ” ìì‚°ë¹„ì¤‘ì„ ê¸°ë°˜ìœ¼ë¡œ ê· í˜• ìˆ˜ìµë¥ ì„ ì°¾ì•„ë‚´ëŠ” ê³¼ì •ì„ â€œReverse Optimization Processâ€ì´ë¼ í•˜ê³ , ì´ë ‡ê²Œ êµ¬í•´ì§„ $\mu_{implied}$ë¥¼ $\Pi$ë¡œ í‘œê¸°í•©ë‹ˆë‹¤.</p><h2 id="2-4-lambda-Risk-Aversion-Coefficient"><a href="#2-4-lambda-Risk-Aversion-Coefficient" class="headerlink" title="2.4. $\lambda$ : Risk Aversion Coefficient"></a>2.4. $\lambda$ : Risk Aversion Coefficient</h2><p>Reverse optimization processì—ì„œ, íˆ¬ììê°€ ë‚®ì€ ë³€ë™ì„±ì„ ìœ„í•˜ì—¬ trade-off í•  ìˆ˜ ìˆëŠ” ìˆ˜ìµë¥  ìˆ˜ì¤€ì„ ë‚˜íƒ€ë‚´ëŠ” ìƒìˆ˜ë¡œì¨, ì¼ì¢…ì˜ scaling factor ì—­í• ì„ í•©ë‹ˆë‹¤. ì¦‰, $\lambda$ê°€ í´ìˆ˜ë¡, implied returns ($\Pi$) ê°’ì´ ì»¤ì§€ê²Œ ë©ë‹ˆë‹¤. ê°’ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ ìë£Œì— ë”°ë¼ ìƒì´í•˜ì§€ë§Œ, ì–¼ì¶” ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li><strong>ë°©ë²• 1</strong> : <code>2.15</code> ~ <code>2.65</code> ì‚¬ì´ì˜ ê°’ (BLM ê´€ë ¨ ì—°êµ¬ìë£Œë“¤ì˜ ì¶”ì²œ ê²°ê³¼ ê°’)</li><li><strong>ë°©ë²• 2</strong> : $\frac{E(R_m)-R_f}{\sigma^2_m}$ (ì‹œê°€ì´ì•¡ê°€ì¤‘ í¬íŠ¸í´ë¦¬ì˜¤ì˜ í‰ê·  ì´ˆê³¼ìˆ˜ìµë¥  &#x2F; ë¶„ì‚°)</li></ul><p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë‘ ë²ˆì§¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>expected_portfolio_excess_return = monthly_excess_returns.mean().multiply(w_mkt).<span class="built_in">sum</span>()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>portfolio_variance = w_mkt.dot(Sigma).dot(w_mkt)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lambd = expected_portfolio_excess_return / portfolio_variance</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lambd</span><br><span class="line"><span class="number">1.4956952957871978</span></span><br></pre></td></tr></table></figure><h2 id="2-5-Pi-Implied-Excess-Equilibrium-Return-Vector"><a href="#2-5-Pi-Implied-Excess-Equilibrium-Return-Vector" class="headerlink" title="2.5. $\Pi$ : Implied Excess Equilibrium Return Vector"></a>2.5. $\Pi$ : Implied Excess Equilibrium Return Vector</h2><p>ìœ„ì—ì„œ ê³„ì‚°í•œ $\lambda$, $\Sigma$, $w_{mkt}$ë¥¼ ì‚¬ìš©í•˜ì—¬, í˜„ ì‹œì¥ì—ì„œ ê´€ì¸¡ë˜ëŠ” ì‹œê°€ì´ì•¡ë¹„ì¤‘ ê¸°ë°˜ equilibrium return vectorë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°í•©ë‹ˆë‹¤.</p><escape>\begin{equation}  \Pi = \lambda \Sigma w_{mkt}\end{equation}</escape><escape>\begin{align*}  \lambda &\qquad\text{is the risk aversion coefficient} \\  \Sigma  &\qquad\text{is the covariance matrix of excess returns (N x N matrix)} \\  w_{mkt} &\qquad\text{is the market capitalization weight (N x 1 column vector) of the assets}\end{align*}</escape><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Pi = lambd * Sigma.dot(w_mkt)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Pi</span><br><span class="line">ì—ë„ˆì§€        <span class="number">0.006078</span></span><br><span class="line">ì†Œì¬          <span class="number">0.006298</span></span><br><span class="line">ì‚°ì—…ì¬        <span class="number">0.007318</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬    <span class="number">0.006756</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬    <span class="number">0.003517</span></span><br><span class="line">ì˜ë£Œ          <span class="number">0.006820</span></span><br><span class="line">ê¸ˆìœµ          <span class="number">0.006116</span></span><br><span class="line">IT            <span class="number">0.008216</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤    <span class="number">0.003837</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°      <span class="number">0.003304</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><h2 id="2-6-K-The-Number-of-Views"><a href="#2-6-K-The-Number-of-Views" class="headerlink" title="2.6. $K$ : The Number of Views"></a>2.6. $K$ : The Number of Views</h2><p>Black-Litterman Modelì—ì„œëŠ” íˆ¬ììê°€ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ë¥¼ â€œViewâ€ë¼ê³  ì •ì˜í•©ë‹ˆë‹¤. (í•œê¸€ë¡œ í•´ì„í•˜ë©´ â€˜ì „ë§â€™ ì •ë„ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.)</p><p>ì´ë²ˆ ì˜ˆì‹œì—ì„œëŠ”, íˆ¬ììì—ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ì„¸ ê°€ì§€ì˜ viewê°€ ìˆë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤.</p><ul><li><strong>View 1</strong> : IT ì„¹í„°ì˜ ì´ˆê³¼ ìˆ˜ìµë¥ ì´ 2%ê°€ ë  ê²ƒì´ë‹¤. (Confidence level &#x3D; 75%)</li><li><strong>View 2</strong> : í†µì‹ ì„œë¹„ìŠ¤ ì„¹í„°ì˜ ìˆ˜ìµë¥ ì´ ìœ í‹¸ë¦¬í‹° ì„¹í„°ì˜ ìˆ˜ìµë¥ ë³´ë‹¤ 3% ë†’ì„ ê²ƒì´ë‹¤. (Confidence level &#x3D; 25%)</li><li><strong>View 3</strong> : ì—ë„ˆì§€ ì„¹í„°ì˜ ìˆ˜ìµë¥ ì´ ê²½ê¸°ì†Œë¹„ì¬, í•„ìˆ˜ì†Œë¹„ì¬ ì„¹í„° ìˆ˜ìµë¥ ë³´ë‹¤ 1% ë†’ì„ ê²ƒì´ë‹¤. (Confidence level &#x3D; 50%)</li></ul><p>ì—¬ê¸°ì„œ view 1ì€ â€œabsolute viewâ€, view 2~3ì€ â€œrelative viewâ€ë¼ê³  í•©ë‹ˆë‹¤. Relative viewëŠ” outperforming í•˜ëŠ” ìì‚°(í†µì‹ ì„œë¹„ìŠ¤, ì—ë„ˆì§€)ê³¼ underperforming í•˜ëŠ” ìì‚°(ìœ í‹¸ë¦¬í‹°, ê²½ê¸°ì†Œë¹„ì¬, í•„ìˆ˜ì†Œë¹„ì¬)ì„ í¬í•¨í•©ë‹ˆë‹¤. ì˜ˆì‹œì˜ view 3ì—ì„œì™€ ê°™ì´, outperforming í•˜ëŠ” ìì‚°ì˜ ìˆ˜ì™€ underperformingí•˜ëŠ” ìì‚°ì˜ ìˆ˜ê°€ ë°˜ë“œì‹œ ë™ì¼í•´ì•¼ í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>K = <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="2-7-Q-View-Vector"><a href="#2-7-Q-View-Vector" class="headerlink" title="2.7. $Q$ : View Vector"></a>2.7. $Q$ : View Vector</h2><p>ê° viewë“¤ì˜ ì˜ˆìƒ ìˆ˜ì¹˜(ì˜ˆìƒ ì ˆëŒ€&#x2F;ìƒëŒ€ìˆ˜ìµë¥ )ë¥¼ í¬í•¨í•˜ëŠ”, $K$x$1$ column matrix ì…ë‹ˆë‹¤. ì´ë²ˆ ì˜ˆì‹œì—ì„œì˜ view vectorëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><escape>\begin{equation*}  K =  \begin{bmatrix}    0.02 \\    0.03 \\    0.01 \\  \end{bmatrix}\end{equation*}</escape><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Q = np.array([<span class="number">0.02</span>, <span class="number">0.03</span>, <span class="number">0.01</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">assert</span> Q.shape == (K,)</span><br></pre></td></tr></table></figure><h2 id="2-8-P-Picking-Matrix"><a href="#2-8-P-Picking-Matrix" class="headerlink" title="2.8. $P$ : Picking Matrix"></a>2.8. $P$ : Picking Matrix</h2><p>Viewì— í¬í•¨ë˜ëŠ” ìì‚°ë“¤ì„ ëª…ì‹œí•´ì£¼ëŠ” í–‰ë ¬ì…ë‹ˆë‹¤. ì´ë²ˆ ì˜ˆì‹œì˜ ê²½ìš°, ì´ 3ê°œì˜ viewì™€ 10ê°œì˜ ìì‚°ì´ ìˆìœ¼ë¯€ë¡œ, $P$ëŠ” ì•„ë˜ì™€ ê°™ì€ 3x10 í–‰ë ¬ì´ ë©ë‹ˆë‹¤.</p><escape>\begin{equation*}  P =  \begin{bmatrix}    0 & 0 & 0 &    0 &    0 & 0 & 0 & 1 & 0 &  0 \\    0 & 0 & 0 &    0 &    0 & 0 & 0 & 0 & 1 & -1 \\    1 & 0 & 0 & -0.5 & -0.5 & 0 & 0 & 0 & 0 &  0 \\  \end{bmatrix}\end{equation*}</escape><p>ì²« ë²ˆì§¸ í–‰ì€ ì²« ë²ˆì§¸ viewë¥¼ ë‚˜íƒ€ë‚¸ í–‰ìœ¼ë¡œ, ë°ì´í„° ìˆœì„œ ìƒ 8ë²ˆ ì§¸ ìì‚°ì¸ ITì„¹í„°ë¥¼ 1ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. Absolute viewì˜ ê²½ìš°ì—ëŠ” ì´ì™€ ê°™ì´ í•˜ë‚˜ì˜ columnë§Œ 1ì´ ë˜ëŠ” rowì˜ í˜•íƒœë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p><p>ë‘ ë²ˆì§¸ì™€ ì„¸ ë²ˆì§¸ í–‰ì€, ê°ê° ë‘ ë²ˆì§¸ì™€ ì„¸ ë²ˆì§¸ viewë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. Outperforming í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ìì‚°ì€ ì–‘ìˆ˜ë¡œ, underperforming í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ìì‚°ì€ ìŒìˆ˜ë¡œ í‘œì‹œí•˜ì—¬, rowì˜ ì´ í•©ì´ 0ì´ ë˜ë„ë¡ ë§ì¶°ì¤ë‹ˆë‹¤.<br>View 3ì™€ ê°™ì´ ë‹¤ìˆ˜ì˜ ìì‚°ì´ ëª…ì‹œê°€ ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°, outperforming í•˜ëŠ” ìì‚°ì˜ í•©ì´ 1, underperforming í•˜ëŠ” ìì‚°ì˜ í•©ì´ -1, rowì˜ ì´ í•©ì´ 0ì´ ë˜ë„ë¡ ê°’ì„ ë¶„ë°°í•©ë‹ˆë‹¤.</p><p>ìœ„ì˜ í–‰ë ¬ $P$ì—ì„œ view 3ëŠ” underperforming í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ë‘ ìì‚°(ê²½ê¸°ì†Œë¹„ì¬, í•„ìˆ˜ì†Œë¹„ì¬)ì— ëŒ€í•´ ë™ì¼í•œ ë¹„ì¤‘ìœ¼ë¡œ ê°’ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ìƒëŒ€ì ìœ¼ë¡œ market capì´ ì‘ì€ ìì‚°ì˜ ìµœì¢… í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì˜ ê°’ì´ ë” ë§ì´ ë³€í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, $P$ í–‰ë ¬ì—ì„œì˜ ë¹„ì¤‘ì„ market capê³¼ ë™ì¼(í˜¹ì€ ìœ ì‚¬)í•˜ê²Œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë²ˆ ì˜ˆì‹œì—ì„œ ê²½ê¸°ì†Œë¹„ì¬ì˜ market cap(0.1315)ì€ í•„ìˆ˜ì†Œë¹„ì¬ì˜ market cap(0.0452)ì˜ ì•½ 3ë°° ì •ë„ ë©ë‹ˆë‹¤. ì´ë¥¼ ê³ ë ¤í•˜ì—¬ $P$ì˜ ê°’ì„ ì•„ë˜ì™€ ê°™ì´ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><escape>\begin{equation*}  P =  \begin{bmatrix}    0 & 0 & 0 &     0 &     0 & 0 & 0 & 1 & 0 &  0 \\    0 & 0 & 0 &     0 &     0 & 0 & 0 & 0 & 1 & -1 \\    1 & 0 & 0 & -0.75 & -0.25 & 0 & 0 & 0 & 0 &  0 \\  \end{bmatrix}\end{equation*}</escape><p>ìœ„ì—ì„œ ì •ì˜ ëœ $P$ì˜ kë²ˆì§¸ í–‰(1xN row vector)ì„ $p_k$ë¡œ í‘œê¸°í•©ì‹œë‹¤. ì´ë¥¼ ì‚¬ìš©í•´ì„œ, ê° viewë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ëœ portfolioì˜ varianceë¥¼ $p_k \Sigma p_k^T$ë¡œ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>P = np.array([</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,  <span class="number">0</span>],</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>],</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -<span class="number">.75</span>, -<span class="number">.25</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">assert</span> P.shape == (K, N)</span><br></pre></td></tr></table></figure><h2 id="2-9-tau-Scalar-â€œTuningâ€-Constant"><a href="#2-9-tau-Scalar-â€œTuningâ€-Constant" class="headerlink" title="2.9. $\tau$ : Scalar â€œTuningâ€ Constant"></a>2.9. $\tau$ : Scalar â€œTuningâ€ Constant</h2><p>Prior estimate of returns($\Pi$)ì— ëŒ€í•œ ë¶ˆí™•ì‹¤ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìˆ˜ì¹˜ì…ë‹ˆë‹¤. $\tau$ ê°’ì´ ì‘ì„ìˆ˜ë¡, ëª¨ë¸ì— ì˜í•´ ê³„ì‚°ë˜ëŠ” combined return vector($E[R]$)ê°€ implied equilibrium return($\Pi$)ì— ê°€ê¹Œì›Œì§€ê²Œ ë©ë‹ˆë‹¤.</p><p>ì•„ì‰½ê²Œë„, $\tau$ ê°’ì„ ì •í•˜ëŠ” ëª…í™•í•œ ê°€ì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” $\tau$ê°’ìœ¼ë¡œ ì œì‹œëœ ë‹¤ì–‘í•œ í›„ë³´ë“¤ì…ë‹ˆë‹¤.</p><ul><li><em>0.01ê³¼ 0.05 ì‚¬ì´ì˜ ê°’</em>ìœ¼ë¡œ ìµœì´ˆ ì„¤ì •í•œ ë’¤, tracking errorë¥¼ ì¤„ì´ëŠ” ë°©í–¥ìœ¼ë¡œ ì¡°ì •</li><li><em>1</em>ë¡œ ì„¤ì • (Satchell and Scowcroft, 2000)</li><li>*1&#x2F;(number of observation)*ìœ¼ë¡œ ì„¤ì • (Blamont and Firoozye, 2003)</li></ul><p>ì¢‹ê²Œ ë³´ë©´ flexibleí•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆì§€ë§Œ, ì¼ê´€ëœ ê¸°ì¤€ì´ ì—†ë‹¤ëŠ” ì ì€ ëª¨ë¸ì„ ì´í•´í•˜ê¸° ì–´ë µê³  ì• ë§¤ëª¨í˜¸í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ ëª¨í˜¸í•¨ì„ ì—†ì• ê¸° ìœ„í•˜ì—¬, ì´í›„ ì†Œê°œë“œë¦´ <strong>$\Omega$ì˜ ê°’ì— $\tau$ë¥¼ factor-out ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ê°’ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•</strong>ì´ ìˆìŠµë‹ˆë‹¤. (Idzorek, 2007) ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” í•´ë‹¹ ë°©ë²•ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, $\tau$ì— 0ì´ ì•„ë‹Œ ì–´ë– í•œ ê°’ì„ ë„£ì–´ë„, ìµœì¢… ê²°ê³¼($E[R]$)ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tau = <span class="number">1</span>  <span class="comment"># 0ì´ ì•„ë‹Œ ì„ì˜ì˜ ê°’</span></span><br></pre></td></tr></table></figure><h2 id="2-10-Omega-Uncertainty-Matrix-of-Views"><a href="#2-10-Omega-Uncertainty-Matrix-of-Views" class="headerlink" title="2.10. $\Omega$ : Uncertainty Matrix of Views"></a>2.10. $\Omega$ : Uncertainty Matrix of Views</h2><p>ê°œë³„ viewë“¤ì˜ ë¶ˆí™•ì‹¤ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ëŒ€ê°í–‰ë ¬ì…ë‹ˆë‹¤. í–‰ë ¬ì˜ ì›ì†Œì¸ $\omega_k$ê°€ 0ì— ê°€ê¹Œìš¸ ìˆ˜ë¡ view kì˜ confidenceê°€ 100%ì— ê°€ê¹ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê³ , $\omega_k$ê°€ í´ìˆ˜ë¡ í•´ë‹¹ viewì˜ ë¶ˆí™•ì‹¤ì„±ì´ ë†’ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p><escape>\begin{equation}  \Omega =  \begin{bmatrix}    \omega_1 & 0 & 0 \\    0 & \ddots & 0 \\    0 & 0 & \omega_k \\  \end{bmatrix}\end{equation}</escape><p>ì‚¬ìš©ìê°€ ê°œë³„ viewì— ëŒ€í•œ confidence ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, $\Omega$ì˜ ê°’ì„ ì§ì ‘ ì…ë ¥í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°œë³„ viewë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ portfolioì˜ varianceë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. <em>(Confidence level of viewsë¥¼ ê¸°ë°˜ìœ¼ë¡œ $\Omega$ë¥¼ ì •í•˜ëŠ” ë°©ë²•ì€ ë³¸ í¬ìŠ¤íŒ…ì˜ ì´í›„ ì±•í„°ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</em></p><escape>\begin{equation*}  \Omega = diag(P(\tau\Sigma)P^T) =  \begin{bmatrix}    (p_1 \Sigma p_1^T)*\tau & 0 & 0 \\    0 & \ddots & 0 \\    0 & 0 & (p_K \Sigma p_K^T)*\tau \\  \end{bmatrix}\end{equation*}</escape><p>ìœ„ì™€ ê°™ì´ $\Omega$ë¥¼ ì„¤ì •í•  ê²½ìš°, $\tau$ ê°’ì´ ë³€í•´ë„ $E[R]$ ê°’ì´ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. $\tau$ì™€ $\Omega$ê°’ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ì´ ë˜ë¯€ë¡œ, ë§¤ë‹ˆì €ëŠ” viewì™€ ê´€ë ¨ëœ inputë§Œ ì‹ ê²½ì„ ì“°ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Omega = tau*P.dot(Sigma).dot(P.T) * np.eye(K)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Omega</span><br><span class="line">array([[ <span class="number">0.0075706</span> ,  <span class="number">0.</span>        , -<span class="number">0.</span>        ],</span><br><span class="line">       [ <span class="number">0.</span>        ,  <span class="number">0.00536469</span>, -<span class="number">0.</span>        ],</span><br><span class="line">       [-<span class="number">0.</span>        , -<span class="number">0.</span>        ,  <span class="number">0.00634097</span>]])</span><br></pre></td></tr></table></figure><p>ë‹¨, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œì™€ ê°™ì´ <strong>ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ $\tau$ì™€ $\Omega$ë¥¼ ì •í•˜ëŠ” ë°©ë²•ì€ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜</strong>ì„ì„ ì¸ì§€í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ, í•´ë‹¹ ê°’ë“¤ì„ ë³€ê²½í•´ê°€ë©° ìµœì ì˜ ëª¨ë¸ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><hr><h1 id="3-Run-It-but-without-confidence-level-of-views"><a href="#3-Run-It-but-without-confidence-level-of-views" class="headerlink" title="3. Run It (but without confidence level of views)"></a>3. Run It (but without confidence level of views)</h1><p>ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„°ë“¤ì´ ì¤€ë¹„ëìŠµë‹ˆë‹¤. ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ $E[R]$ê³¼ $\hat{w}$ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ER = Pi + tau*Sigma.dot(P.T).dot(inv(P.dot(tau*Sigma).dot(P.T) + Omega).dot(Q - P.dot(Pi)))</span><br><span class="line"><span class="meta">... </span><span class="comment"># ìˆ˜ì‹(1)ì„ ë‹¤ë¥´ê²Œ í‘œí˜„í•œ ìˆ˜ì‹ìœ¼ë¡œ, ë™ì¼í•œ ê²°ê³¼ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ER</span><br><span class="line">ì—ë„ˆì§€       <span class="number">0.012334</span></span><br><span class="line">ì†Œì¬         <span class="number">0.009002</span></span><br><span class="line">ì‚°ì—…ì¬       <span class="number">0.010075</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬   <span class="number">0.009281</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬   <span class="number">0.003478</span></span><br><span class="line">ì˜ë£Œ         <span class="number">0.010962</span></span><br><span class="line">ê¸ˆìœµ         <span class="number">0.008156</span></span><br><span class="line">IT           <span class="number">0.015176</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤   <span class="number">0.012539</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°    -<span class="number">0.002864</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat = inv(Sigma).dot(ER)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat = pd.Series(w_hat / w_hat.<span class="built_in">sum</span>(), index=R.columns)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat</span><br><span class="line">ì—ë„ˆì§€       <span class="number">0.430068</span></span><br><span class="line">ì†Œì¬         <span class="number">0.063951</span></span><br><span class="line">ì‚°ì—…ì¬       <span class="number">0.064792</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬  -<span class="number">0.212565</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬  -<span class="number">0.069897</span></span><br><span class="line">ì˜ë£Œ         <span class="number">0.078536</span></span><br><span class="line">ê¸ˆìœµ         <span class="number">0.042704</span></span><br><span class="line">IT           <span class="number">0.586425</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤   <span class="number">1.284972</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°    -<span class="number">1.268985</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat - w_mkt</span><br><span class="line">ì—ë„ˆì§€       <span class="number">0.396268</span></span><br><span class="line">ì†Œì¬        -<span class="number">0.027249</span></span><br><span class="line">ì‚°ì—…ì¬      -<span class="number">0.027608</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬  -<span class="number">0.344065</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬  -<span class="number">0.115097</span></span><br><span class="line">ì˜ë£Œ        -<span class="number">0.033464</span></span><br><span class="line">ê¸ˆìœµ        -<span class="number">0.018196</span></span><br><span class="line">IT           <span class="number">0.176125</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤   <span class="number">1.271572</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°    -<span class="number">1.278385</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>Outperform í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ì„¹í„°ë“¤(IT, í†µì‹ ì„œë¹„ìŠ¤, ì—ë„ˆì§€)ì˜ ë¹„ì¤‘ì€ ìƒí–¥ ì¡°ì •ë˜ì—ˆê³ , underperform í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ì„¹í„°ë“¤(ìœ í‹¸ë¦¬í‹°, ê²½ê¸°ì†Œë¹„ì¬, í•„ìˆ˜ì†Œë¹„ì¬)ì˜ ë¹„ì¤‘ì€ í•˜í–¥ ì¡°ì •ë˜ì—ˆìŠµë‹ˆë‹¤. Viewì— í¬í•¨ëœ ìì‚° ë¿ë§Œ ì•„ë‹ˆë¼, í¬í•¨ë˜ì§€ ì•Šì€ ìì‚°ê¹Œì§€ ë¹„ì¤‘ì´ ì „ì²´ì ìœ¼ë¡œ ì¡°ì •ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì¡°ì •ëœ ë¹„ì¤‘ì„ ì‚´í´ë³´ë©´ ì„¤ëª…ì´ ì• ë§¤í•œ ë¶€ë¶„ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ ì¤‘ í•˜ë‚˜ê°€, ìƒëŒ€ì ìœ¼ë¡œ confidence levelì´ ë†’ì€ view 1(IT &#x3D; 2%)ì— ë¹„í•´ confidence levelì´ ë‚®ì€ view 2(í†µì‹ ì„œë¹„ìŠ¤ - ìœ í‹¸ë¦¬í‹° &#x3D; 3%)ì˜ ë¹„ì¤‘ì´ ê³¼ë„í•˜ê²Œ ì¡°ì •ì´ ëë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì•ì„  í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ ìƒê°í•´ë³´ë©´, <strong>ì•„ì§ ê° viewì˜ confidence levelì„ ëª¨ë¸ì— ë°˜ì˜í•˜ì§€ ì•Šì•˜ê³ </strong>, ì´ë¡œ ì¸í•´ ë¹„ì¤‘ì˜ ì¡°ì •ì´ $Q$ì˜ ê°’ì— ì§€ë‚˜ì¹˜ê²Œ ì˜í–¥ì„ ë§ì´ ë°›ì•˜ì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.</p><hr><h1 id="4-Considering-Confidence-Level-of-Views"><a href="#4-Considering-Confidence-Level-of-Views" class="headerlink" title="4. Considering Confidence Level of Views"></a>4. Considering Confidence Level of Views</h1><p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œ ì‚¬ìš©í•˜ëŠ” viewë“¤ì„ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ë´…ì‹œë‹¤.</p><ul><li><strong>View 1</strong> : IT ì„¹í„°ì˜ ì´ˆê³¼ ìˆ˜ìµë¥ ì´ 2%ê°€ ë  ê²ƒì´ë‹¤. <strong>(Confidence level &#x3D; 75%)</strong></li><li><strong>View 2</strong> : í†µì‹ ì„œë¹„ìŠ¤ ì„¹í„°ì˜ ìˆ˜ìµë¥ ì´ ìœ í‹¸ë¦¬í‹° ì„¹í„°ì˜ ìˆ˜ìµë¥ ë³´ë‹¤ 3% ë†’ì„ ê²ƒì´ë‹¤. <strong>(Confidence level &#x3D; 25%)</strong></li><li><strong>View 3</strong> : ì—ë„ˆì§€ ì„¹í„°ì˜ ìˆ˜ìµë¥ ì´ ê²½ê¸°ì†Œë¹„ì¬, í•„ìˆ˜ì†Œë¹„ì¬ ì„¹í„° ìˆ˜ìµë¥ ë³´ë‹¤ 1% ë†’ì„ ê²ƒì´ë‹¤. <strong>(Confidence level &#x3D; 50%)</strong></li></ul><p>ê° viewì˜ confidence levelì¸ 75%, 25%, 50%ì˜ ê°’ì„ ëª¨ë¸ì— ì–´ë–»ê²Œ ë…¹ì—¬ë‚¼ ìˆ˜ ìˆì„ê¹Œìš”? $\Omega$ (uncertainty matrix of views)ì™€ ì—°ê´€ì´ ìˆëŠ” ê±´ í™•ì‹¤í•´ ë³´ì´ëŠ”ë°, ê·¸ë ‡ë‹¤ê³  ìœ„ì˜ ê°’($0.75$, $0.25$, $0.50$)ì„ ê·¸ëŒ€ë¡œ í–‰ë ¬ì— ë„£ì„ ìˆ˜ëŠ” ì—†ì–´ ë³´ì…ë‹ˆë‹¤. $\Omega$ ê°’ì„ ì¡°ì •í•´ë³´ë©´ì„œ ê²°ê³¼ë¥¼ ì‚´í´ë´ì•¼ í•˜ëŠ”ë°, ì´ëŸ¬í•œ ê³¼ì •ì„ ì²´ê³„í™”í•˜ì—¬ ì •ë¦¬í•œ í•˜ë‚˜ì˜ ë°©ë²•ì„ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. (Idzorek, 2007)</p><ol><li><p>ê³„ì‚° ê³¼ì •ì— í•„ìš”í•œ ëª¨ë“ˆì„ importí•˜ê³  ìƒˆë¡œ ê³„ì‚°ë  $\Omega$ì˜ ê²°ê³¼ë¥¼ ë‹´ì•„ë‘˜ ìˆ˜ ìˆëŠ” í–‰ë ¬ì„ ì„ ì–¸í•©ë‹ˆë‹¤.</p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> scipy <span class="keyword">import</span> optimize</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>implied_Omega = np.zeros((K, K))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>k = <span class="number">0</span>  <span class="comment"># ë³¸ í¬ìŠ¤íŒ…ì„ line-by-line ì‹¤í–‰í•˜ëŠ” ê²½ìš°ë¥¼ ìœ„í•˜ì—¬ ì„ì‹œë¡œ ì„ ì–¸í•˜ëŠ” iteratorë¡œ,</span></span><br><span class="line"><span class="meta">... </span>       <span class="comment"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</span></span><br></pre></td></tr></table></figure></li><li><p>ê° viewì˜ confidence levelë“¤ë¡œ ì´ë£¨ì–´ì§„ í–‰ë ¬ $C$ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p> <escape> \begin{equation}   C =   \begin{bmatrix}     0.75 \\     0.25 \\     0.50 \\   \end{bmatrix} \end{equation} </escape> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>C = np.array([<span class="number">0.75</span>, <span class="number">0.25</span>, <span class="number">0.50</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">assert</span> C.shape == (K,)</span><br></pre></td></tr></table></figure></li></ol><p>ì´ì œ ê° viewë¥¼ iterator <code>k</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ í•˜ë‚˜ì”© iterateí•˜ë©´ì„œ ì•„ë˜ì˜ ê³¼ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p><ol start="3"><li><p><strong>View kê°€ ëª¨ë¸ì˜ ìœ ì¼í•œ viewì´ê³  100% í™•ì‹¤ë‹¤ëŠ” ê°€ì •í•˜ì—</strong>, $E[R]$ ê°’ê³¼ $w$ ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤. (ì´ ë•Œ ê³„ì‚°ë˜ëŠ” ê²°ê³¼ê°’ì„ ê°ê° $E[R_{\text{k,100%}}]$ , $w_{\text{k,100%}}$ ë¼ê³  í‘œê¸°í•©ë‹ˆë‹¤.)</p><p> View kê°€ 100% í™•ì‹¤í•œ ê²½ìš°, (1)~(2)ì˜ ìˆ˜ì‹ì€ ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <escape> \begin{align}   E[R_{\text{k,100%}}]  &= \Pi + \tau\Sigma P_{k}^T (P_k \tau\Sigma P_{k}^T)^{-1}\\   w_{\text{k,100%}}     &= (\Sigma^{-1}E[R_{\text{k,100%}}])/(1^T\Sigma^{-1}E[R_{\text{k,100%}}]) \end{align} </escape> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ê¸°ì¡´ ERì„ êµ¬í•˜ëŠ” ìˆ˜ì‹ì—ì„œ Pë¥¼ P[None, k]ë¡œ, Që¥¼ Q[None, k]ë¡œ ëŒ€ì²´í•˜ê³ ,</span></span><br><span class="line"><span class="comment"># Omegaë¥¼ ìƒëµí•œ ìˆ˜ì‹ì…ë‹ˆë‹¤.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ER_k_100 = Pi + tau*Sigma.dot(P[<span class="literal">None</span>, k].T).dot(inv(P[<span class="literal">None</span>, k].dot(tau * Sigma).dot(P[<span class="literal">None</span>, k].T)).dot(Q[<span class="literal">None</span>, k] - P[<span class="literal">None</span>, k].dot(Pi)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_k_100 = inv(Sigma).dot(ER_k_100)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_k_100 = pd.Series(w_k_100 / w_k_100.<span class="built_in">sum</span>(), index=R.columns)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_k_100</span><br><span class="line">ì—ë„ˆì§€       <span class="number">0.016562</span></span><br><span class="line">ì†Œì¬         <span class="number">0.044689</span></span><br><span class="line">ì‚°ì—…ì¬       <span class="number">0.045277</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬   <span class="number">0.064436</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬   <span class="number">0.022148</span></span><br><span class="line">ì˜ë£Œ         <span class="number">0.054881</span></span><br><span class="line">ê¸ˆìœµ         <span class="number">0.029842</span></span><br><span class="line">IT           <span class="number">0.710993</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤   <span class="number">0.006566</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°     <span class="number">0.004606</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure></li><li><p><strong>View kê°€ ëª¨ë¸ì˜ ìœ ì¼í•œ viewë¼ëŠ” ê°€ì •í•˜ì—</strong>, ì£¼ì–´ì§„ confidence levelì„ ë°˜ì˜ë˜ì—ˆì„ ê²½ìš°ì˜ $w$ë¥¼ ì¶”ë¡ í•©ë‹ˆë‹¤. (ì´ ë•Œ ì¶”ë¡ ë˜ëŠ” ê°’ì„ $w_{\text{k,%}}$ ë¼ê³  í‘œê¸°í•©ë‹ˆë‹¤.)</p><p> View kì˜ confidence levelì´ 100%ì¸ ê²½ìš° í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì´ $w_{\text{k,100%}}$ì´ê³ , confidence levelì´ 0%ì¸ ê²½ìš° í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì´ $w_{mkt}$ì…ë‹ˆë‹¤. ë”°ë¼ì„œ, confidence levelì´ $C_k$ì¸ ê²½ìš° í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <escape> \begin{align}   w_{\text{k,%}} = w_{mkt} + (w_{\text{k,100%}} - w_{mkt}) * C_k \end{align} </escape> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_k_implied = w_mkt + (w_k_100 - w_mkt) * C[k]</span><br></pre></td></tr></table></figure></li><li><p><strong>View kê°€ ëª¨ë¸ì˜ ìœ ì¼í•œ viewë¼ëŠ” ê°€ì •í•˜ì—</strong>, view kì˜ confidence interval $\omega_k$ (<code>omega_k</code>, the k-th diagonal element of $\Omega$) ê°’ì„ ì¡°ì ˆí•´ë³´ë©´ì„œ, confidence intervalì´ ë°˜ì˜ëœ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ê²°ê³¼ê°€ $w_{\text{k,%}}$ì— ê°€ê¹ë„ë¡ í•˜ëŠ” $\omega_k$ ê°’ì„ ì°¾ìŠµë‹ˆë‹¤.</p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">omega_k</span>):</span><br><span class="line">    <span class="comment"># ê¸°ì¡´ ERì„ êµ¬í•˜ëŠ” ìˆ˜ì‹ì—ì„œ Pë¥¼ P[None, k]ë¡œ, Që¥¼ Q[None, k]ë¡œ ëŒ€ì²´í•œ ìˆ˜ì‹ì…ë‹ˆë‹¤.</span></span><br><span class="line">    ER_k = Pi + tau * Sigma.dot(P[<span class="literal">None</span>, k].T).dot(inv(P[<span class="literal">None</span>, k].dot(tau * Sigma).dot(P[<span class="literal">None</span>, k].T) + omega_k).dot(Q[<span class="literal">None</span>, k] - P[<span class="literal">None</span>, k].dot(Pi)))</span><br><span class="line">    </span><br><span class="line">    w_k = inv(Sigma).dot(ER_k)</span><br><span class="line">    w_k = pd.Series(w_k / w_k.<span class="built_in">sum</span>(), index=R.columns)</span><br><span class="line">    </span><br><span class="line">    diff = w_k_implied - w_k</span><br><span class="line">    <span class="keyword">return</span> diff.T.dot(diff)</span><br><span class="line"></span><br><span class="line">implied_Omega[k][k] = optimize.minimize_scalar(</span><br><span class="line">    fun=fun,</span><br><span class="line">    bounds=(<span class="number">1e-8</span>, <span class="number">1e+12</span>),</span><br><span class="line">    method=<span class="string">&#x27;bounded&#x27;</span>,</span><br><span class="line">).x</span><br></pre></td></tr></table></figure></li><li><p>ìœ„ 3~5ë²ˆ ê³¼ì •ì„ ëª¨ë“  kì— ëŒ€í•´ iterateí•˜ì—¬ <code>implied_Omega</code>ë¥¼ êµ¬í•©ë‹ˆë‹¤.</p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>implied_Omega</span><br><span class="line">array([[<span class="number">0.00514838</span>, <span class="number">0.</span>        , <span class="number">0.</span>        ],</span><br><span class="line">       [<span class="number">0.</span>        , <span class="number">0.01609381</span>, <span class="number">0.</span>        ],</span><br><span class="line">       [<span class="number">0.</span>        , <span class="number">0.</span>        , <span class="number">0.006342</span>  ]])</span><br></pre></td></tr></table></figure></li></ol><p>ì´ë ‡ê²Œ ê³„ì‚°ëœ <code>implied_Omega</code> ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì „ì²´ì ì¸ ëª¨ë¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¤ì‹œ ì§„í–‰í•˜ë©´, ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ER_with_CL = Pi + tau * Sigma.dot(P.T).dot(inv(P.dot(tau * Sigma).dot(P.T) + implied_Omega).dot(Q - P.dot(Pi)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat_with_CL = inv(Sigma).dot(ER_with_CL)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat_with_CL = pd.Series(w_hat_with_CL / w_hat_with_CL.<span class="built_in">sum</span>(), index=R.columns)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w_hat_with_CL</span><br><span class="line">ì—ë„ˆì§€       <span class="number">0.377316</span></span><br><span class="line">ì†Œì¬         <span class="number">0.058063</span></span><br><span class="line">ì‚°ì—…ì¬       <span class="number">0.058827</span></span><br><span class="line">ê²½ê¸°ì†Œë¹„ì¬  -<span class="number">0.183128</span></span><br><span class="line">í•„ìˆ˜ì†Œë¹„ì¬  -<span class="number">0.060173</span></span><br><span class="line">ì˜ë£Œ         <span class="number">0.071305</span></span><br><span class="line">ê¸ˆìœµ         <span class="number">0.038772</span></span><br><span class="line">IT           <span class="number">0.624501</span></span><br><span class="line">í†µì‹ ì„œë¹„ìŠ¤   <span class="number">0.583587</span></span><br><span class="line">ìœ í‹¸ë¦¬í‹°    -<span class="number">0.569071</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><img src="/images/2021-02-black-litterman-result.png" class="Async Everywhere" title="BLMResult"><p>Confidence levelì´ ê³ ë ¤ë˜ì§€ ì•Šì€ ê²°ê³¼ë³´ë‹¤, ì¡°ê¸ˆ ë” ì„¤ë“ë ¥ ìˆëŠ” í˜•íƒœì˜ í¬íŠ¸í´ë¦¬ì˜¤ê°€ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p><hr><h1 id="5-Dealing-with-Constraints"><a href="#5-Dealing-with-Constraints" class="headerlink" title="5. Dealing with Constraints"></a>5. Dealing with Constraints</h1><p>ëª¨ë¸ì˜ ì „ì²´ì ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§„í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ, í¬íŠ¸í´ë¦¬ì˜¤ì˜ ë¹„ì¤‘ì„ êµ¬í•˜ê¸° ìœ„í•˜ì—¬ í¬ê²Œ ë‹¤ìŒì˜ ë‘ ê°€ì§€ ìŠ¤í…ì„ ë°Ÿì•˜ìŠµë‹ˆë‹¤.</p><ul><li>Black-Litterman ëª¨ë¸ì„ í†µí•´ ìì‚°ë³„ ê¸°ëŒ€ìˆ˜ìµë¥ ($E[R]$)ì„ ê³„ì‚°í•˜ê³ ,</li><li>í•´ë‹¹ ê¸°ëŒ€ìˆ˜ìµë¥ ì„ ê¸°ë°˜ìœ¼ë¡œ mean-variance optimizationì„ ì ìš©í•˜ì—¬ ìƒˆë¡œìš´ ë¹„ì¤‘($\hat{w}$)ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.</li></ul><p>ë³¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì œì•½ì¡°ê±´ì´ ì—†ëŠ” mean-variance optimization(unconstrained maximization optimization process)ì„ ê°€ì •í•˜ì˜€ìŠµë‹ˆë‹¤. ($\hat{w} &#x3D; (\Sigma^{-1}E[R])&#x2F;(1^T\Sigma^{-1}E[R])$) ë§Œì•½ í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ì‹œ ì œì•½ì¡°ê±´(ë³´ìœ ë¹„ì¤‘, ë¦¬ìŠ¤í¬, ë² íƒ€, long-only portfolio ë“±)ì´ ìˆëŠ” ê²½ìš°, ìœ„ì˜ (2)ë²ˆ í”„ë¡œì„¸ìŠ¤ì— ì œì•½ì¡°ê±´ì„ ë”í•´ mean-variance optimizationì„ ì§„í–‰í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤. (ì´ ê²½ìš° closed-form solutionì„ êµ¬í•˜ëŠ” ë°©ë²•ë³´ë‹¤ëŠ”, confidence levelì„ ë°˜ì˜í•˜ëŠ” ê³¼ì •ì—ì„œ <code>scipy.optimize</code>ë¥¼ ì‚¬ìš©í•œ ê²ƒê³¼ ë¹„ìŠ·í•˜ê²Œ numerical solutionì„ ì°¾ëŠ”ê²Œ íš¨ê³¼ì ì¼ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.)</p><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0-Introduction&quot;&gt;&lt;a href=&quot;#0-Introduction&quot; class=&quot;headerlink&quot; title=&quot;0. Introduction&quot;&gt;&lt;/a&gt;0. Introduction&lt;/h1&gt;&lt;p&gt;ê¸ˆìœµ ë°ì´í„°ë¥¼ ì´ëŸ°ì €ëŸ° ë°©ì‹ìœ¼ë¡œ ë¶„ì„í•´ì„œ ê²°ê³¼ë¥¼ íŒ€ì›ë“¤ì—ê²Œ ê³µìœ í•˜ë©´, ë°˜ë“œì‹œ ë‚˜ì˜¤ëŠ” ì¤‘ìš”í•œ ì§ˆë¬¸ì´ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ ì „ëµí™” í•  ìˆ˜ ìˆëƒëŠ” ê²ë‹ˆë‹¤. ë¶„ì„ ê·¸ ìì²´ë¡œì¨ ì˜ë¯¸ìˆëŠ” ê²½ìš°ë„ ìˆì§€ë§Œ, ê²°ê³¼ì ìœ¼ë¡œ (ëª¨ë¸ì´ ë˜ì—ˆë“  ë§¤ë‹ˆì €ê°€ ë˜ì—ˆë“ ) ëˆ„êµ°ê°€ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ë° ìš´ìš© ë°©ì‹, ì¦‰, ì–´ë–¤ ìì‚°($X$)ì„ ì–¸ì œ($t$), ì–¼ë§ˆë§Œí¼($w$) ê°€ì§€ê³  ìˆì–´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ íŒë‹¨ì„ ë‚´ë ¤ì•¼ í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;p&gt;í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±ê³¼ ê´€ë ¨ëœ ëª¨ë¸ ì¤‘ ê°€ì¥ ì˜ ì•Œë ¤ì§„ ì´ë¡ ì€ &lt;a href=&quot;https://www.investopedia.com/terms/m/meanvariance-analysis.asp&quot;&gt;Mean-Variance Optimization Portfolio&lt;/a&gt;ì¼ ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ ëª¨ë¸ì˜ ë¡œì§ì€ ë…¼ë¦¬ì ì´ê³  ì§ê´€ì ì´ì§€ë§Œ, ëª‡ ê°€ì§€ ë¬¸ì œì ë“¤ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ì…ë ¥ ë°ì´í„°ì˜ ì‘ì€ ë³€í™”ì—ë„ ë„ì¶œë˜ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±ë¹„ì¤‘ì´ í¬ê²Œ ë³€í•©ë‹ˆë‹¤.&lt;/li&gt;
&lt;li&gt;ëª‡ ê°œì˜ ìì‚°ì— ë¹„ì¤‘ì´ ì ë¦¬ëŠ” ì½”ë„ˆ ì†”ë£¨ì…˜ì´ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
&lt;li&gt;íˆ¬ììê°€ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ë¥¼ ë…¹ì—¬ë‚¼ ìˆ˜ ìˆëŠ” ë°©ë²• ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì‹œì¥ì— ëŒ€í•œ ê²¬í•´ê°€ ë‹¤ë¥¸ ë§¤ë‹ˆì €ì¼ì§€ë¼ë„ (ê°™ì€ hyperparameterë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°) ê°™ì€ MVO í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì–»ê²Œ ë©ë‹ˆë‹¤.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ìœ„ ë¬¸ì œì ë“¤ì€ ì‹¤ì œ ìš´ìš©ì„ í•  ë•Œ ê±¸ë¦¼ëŒì´ ë©ë‹ˆë‹¤. (ex. ë†’ì€ turnover ratio, ê·œì œìœ„ë°˜, ëª¨ë¸ì— ë“¤ì–´ê°€ì§€ ì•Šì€ ì¶”ê°€ì ì¸ ì •ë³´ ë°˜ì˜ ë¶ˆê°€ ë“±) ì´ëŸ¬í•œ ë¬¸ì œì ë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´, ê³¨ë“œë§Œì‚­ìŠ¤ì˜ Fischer Blackê³¼ Robert Littermanì´ 1990ë…„ì— ê°œë°œí•˜ê³  1992ë…„ì— ë°œí‘œí•œ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë°©ë²•ë¡ ì´ Black-Litterman Modelì…ë‹ˆë‹¤.&lt;/p&gt;
&lt;p&gt;ë³¸ í¬ìŠ¤íŒ…ì€ Black-Litterman Portfolio Modelì˜ ì „ì²´ì ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì´í•´í•˜ê³ , Pythonìœ¼ë¡œ ì´ë¥¼ êµ¬í˜„í•´ë³´ëŠ” ê³¼ì •ì„ ì •ë¦¬í•´ ë†“ì€ ê¸€ì…ë‹ˆë‹¤. ë‚´ìš©ì— ë¬¸ì œë‚˜ ê°œì„ ì ì´ ìˆëŠ” ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜€&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
    <category term="Portfolio Theory" scheme="https://hwangheek.github.io/tags/Portfolio-Theory/"/>
    
    <category term="Black-Litterman" scheme="https://hwangheek.github.io/tags/Black-Litterman/"/>
    
  </entry>
  
  <entry>
    <title>Pythonìœ¼ë¡œ ì´ë² ìŠ¤íŠ¸ì¦ê¶Œ xingAPI ê¹”ë”í•˜ê²Œ ì‚¬ìš©í•˜ê¸° (w/ pandas)</title>
    <link href="https://hwangheek.github.io/2021/neat-xingapi-with-python/"/>
    <id>https://hwangheek.github.io/2021/neat-xingapi-with-python/</id>
    <published>2021-01-04T09:38:14.000Z</published>
    <updated>2022-07-23T14:39:52.364Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0. Introduction"></a>0. Introduction</h1><p>ì´ë² ìŠ¤íŠ¸ì¦ê¶Œì€ COM í˜•íƒœì™€ dll í˜•íƒœë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” xingAPIë¥¼ ì œê³µí•©ë‹ˆë‹¤. Pythonì—ì„œ COM objectë¥¼ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ xingAPIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì‚¬ìš©ë²•ì´ ê¹”ë”í•˜ì§€ ëª»í•©ë‹ˆë‹¤.</p><img src="/images/2021-01-syntactic-sugar.jpg" class="Put some sugar on that" width="500" title="Sugar"><p>ê°œì¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•˜ì—¬ ì„¤íƒ•ì„ íŒíŒì³ì„œ ëª¨ë“ˆì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´, ì½”ë“œê°€ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬ê°€ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> ebest</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ebest.login()</span><br><span class="line">[*] ì ‘ì† ì„œë²„ ((r)eal / (D)emo / (a)ce) : <span class="comment"># r</span></span><br><span class="line">[*] ì•„ì´ë”” : <span class="comment"># username</span></span><br><span class="line">[*] íŒ¨ìŠ¤ì›Œë“œ : <span class="comment"># password</span></span><br><span class="line">[*] ê³µì¸ì¸ì¦ì„œ ì•”í˜¸ : <span class="comment"># cert_password</span></span><br><span class="line">[*] ë¡œê·¸ì¸ ì„±ê³µ</span><br><span class="line"></span><br><span class="line"><span class="comment"># XAQuery ìš”ì²­</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ebest.query(<span class="string">&#x27;t1101&#x27;</span>, <span class="built_in">dict</span>(shcode=<span class="string">&#x27;000020&#x27;</span>))</span><br><span class="line">&#123;<span class="string">&#x27;t1101OutBlock&#x27;</span>: &#123;<span class="string">&#x27;hname&#x27;</span>: <span class="string">&#x27;ë™í™”ì•½í’ˆ&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;price&#x27;</span>: <span class="number">19100</span>,</span><br><span class="line">  <span class="string">&#x27;sign&#x27;</span>: <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;change&#x27;</span>: <span class="number">550</span>,</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="string">&#x27;open&#x27;</span>: <span class="number">19750</span>,</span><br><span class="line">  <span class="string">&#x27;high&#x27;</span>: <span class="number">19900</span>,</span><br><span class="line">  <span class="string">&#x27;low&#x27;</span>: <span class="number">18850</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># XAQuery ìš”ì²­ í›„ DataFrame í˜•íƒœë¡œ ë³€í™˜</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = query(<span class="string">&#x27;t8413&#x27;</span>, <span class="built_in">dict</span>(</span><br><span class="line"><span class="meta">... </span>  shcode=<span class="string">&#x27;000020&#x27;</span>, sdate=<span class="string">&#x27;20200101&#x27;</span>, edate=<span class="string">&#x27;20210101&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>  gubun=<span class="string">&#x27;2&#x27;</span>, qrycnt=<span class="number">2000</span>, cts_date=<span class="string">&#x27; &#x27;</span>, comp_yn=<span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="meta">... </span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pd.DataFrame(res.get(<span class="string">&#x27;t8413OutBlock1&#x27;</span>)).set_index(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">           <span class="built_in">open</span>   high    low  close  ...  rate  pricechk  ratevalue  sign</span><br><span class="line">date                                  ...                                 </span><br><span class="line"><span class="number">20200102</span>   <span class="number">8340</span>   <span class="number">8400</span>   <span class="number">8290</span>   <span class="number">8400</span>  ...   <span class="number">0.0</span>         <span class="number">0</span>          <span class="number">0</span>     <span class="number">2</span></span><br><span class="line"><span class="number">20200103</span>   <span class="number">8400</span>   <span class="number">8450</span>   <span class="number">8290</span>   <span class="number">8360</span>  ...   <span class="number">0.0</span>         <span class="number">0</span>          <span class="number">0</span>     <span class="number">5</span></span><br><span class="line">         ...    ...    ...    ...  ...   ...       ...        ...   ...</span><br><span class="line"><span class="number">20201229</span>  <span class="number">18750</span>  <span class="number">19400</span>  <span class="number">18750</span>  <span class="number">19150</span>  ...   <span class="number">0.0</span>         <span class="number">0</span>          <span class="number">0</span>     <span class="number">2</span></span><br><span class="line"><span class="number">20201230</span>  <span class="number">19100</span>  <span class="number">19800</span>  <span class="number">18800</span>  <span class="number">19650</span>  ...   <span class="number">0.0</span>         <span class="number">0</span>          <span class="number">0</span>     <span class="number">2</span></span><br><span class="line">[<span class="number">248</span> rows x <span class="number">11</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="comment"># XAReal ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë… í›„ callback functionìœ¼ë¡œ ì²˜ë¦¬</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nws = Realtime(<span class="string">&#x27;NWS&#x27;</span>, callback=<span class="built_in">print</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nws.subscribe(<span class="string">&#x27;NWS001&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Realtime.listen()</span><br><span class="line">NWS &#123;<span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;20210104&#x27;</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;154734&#x27;</span>, <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;[í¬í† ] ì½”ë¡œë‚˜19 ì§ë¬´ êµìœ¡í˜„ì¥ ì°¸ê´€&#x27;</span>&#125;</span><br><span class="line">NWS &#123;<span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;20210104&#x27;</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;154752&#x27;</span>, <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;ì „ì„±ë°° ì‹ ì„ì›ì¥, &quot;êµ­ê°€ ë””ì§€í„¸ì „í™˜ ì„ ë„&quot;&#x27;</span>&#125;</span><br><span class="line">NWS &#123;<span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;20210104&#x27;</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;154750&#x27;</span>, <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;[í¬í† ] ì •ì´ë¦¬, ì½”ë¡œë‚˜19 êµìœ¡í˜„ì¥ ì°¸ê´€&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p><a href="/assets/ebest.py">ì—¬ê¸°ë¥¼ í´ë¦­</a>í•˜ì‹œë©´ ì†ŒìŠ¤ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆê³ , ìœ„ ì˜ˆì‹œì²˜ëŸ¼ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>ëª¨ë“ˆì„ ì–´ë–»ê²Œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€ ê¶ê¸ˆí•˜ì‹  ê²½ìš°</strong>, ëª¨ë“ˆì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì‹¤í–‰ ìˆœì„œë³„ë¡œ ì„¤ëª…ì„ í•´ ë†“ì€ <strong>ë³¸ í¬ìŠ¤íŒ…ì˜ ë³¸ë¬¸ì„ í™•ì¸í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.</strong></p><p>ê°œì¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ êµ¬í˜„í•œ ì½”ë“œì¸ ê´€ê³„ë¡œ, ì´ëŸ°ì €ëŸ° ë¬¸ì œì ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ğŸ˜… í¬ìŠ¤íŒ…ì˜ ë‚´ìš©ì´ë‚˜ ì†ŒìŠ¤ì— ê°œì„ ì´ í•„ìš”í•œ ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!</p><span id="more"></span><hr><h1 id="1-Requirements"><a href="#1-Requirements" class="headerlink" title="1. Requirements"></a>1. Requirements</h1><ul><li><p><strong>Python 3 (32-bit)</strong><br>xingAPIëŠ” 32bit COMì„ ì œê³µí•˜ë¯€ë¡œ, 64bit pythonì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 64bit í™˜ê²½ì—ì„œ 32bit COMì„ ì‘ë™í•˜ê²Œ í•˜ëŠ” <a href="https://techtalk.gfi.com/32bit-object-64bit-environment/">hackyí•œ ë°©ë²•</a>ì´ ìˆê¸´ í•˜ì§€ë§Œ ë ˆì§€ìŠ¤í„°ê°’ì„ ì¼ì¼íˆ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ê³¼ì •ì´ ë²ˆê±°ë¡œìš°ë¯€ë¡œ, 32bit íŒŒì´ì¬ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ í¸ë¦¬í•©ë‹ˆë‹¤.<br>32bit pythonì„ ë”°ë¡œ ì„¤ì¹˜í•˜ëŠ” ê²ƒë„ ë°©ë²•ì´ì§€ë§Œ, anacondaë¥¼ ì‚¬ìš©ì¤‘ì´ë¼ë©´ ì•„ë˜ì™€ ê°™ì´ virtual environmentë¥¼ ì´ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ í™˜ê²½ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">set</span> CONDA_FORCE_32BIT=1</span><br><span class="line">$ conda create -n py37_32 python=3.7</span><br><span class="line">$ activate py37_32</span><br></pre></td></tr></table></figure></li><li><p><strong>xingAPI</strong><br>ì´ë² ìŠ¤íŠ¸ì¦ê¶Œì‚¬ì˜ xingAPI ì„¤ì¹˜íŒŒì¼ì„ í†µí•´ APIë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì´í›„, ë‹¤ìŒ ë‘ ê°€ì§€ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.</p></li></ul><ol><li><code>C:\eBEST\xingAPI\reg.bat</code> (í˜¹ì€ <code>(xingAPI ì„¤ì¹˜ê²½ë¡œ)\reg.bat</code>)ì„ ì‹¤í–‰ì‹œì¼œ dll ë“±ë¡</li><li>DevCenterì˜ â€˜Res íŒŒì¼ì„ ëª¨ë‘ ë‹¤ìš´ë¡œë“œâ€™ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ resíŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ</li></ol><ul><li><p><strong>pypiwin32</strong><br>Pythonì—ì„œ COMì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ <code>pypiwin32</code>ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pip install pypiwin32</span><br></pre></td></tr></table></figure></li><li><p><strong>â€¦ and other libraries</strong><br>ëª¨ë“ˆì—ì„œ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, re, sys, time, pytz</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.platform == <span class="string">&#x27;win32&#x27;</span>:</span><br><span class="line">    <span class="keyword">from</span> win32com.client <span class="keyword">import</span> DispatchWithEvents</span><br><span class="line">    <span class="keyword">from</span> pythoncom <span class="keyword">import</span> PumpWaitingMessages</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;xingAPIëŠ” ìœˆë„ìš° í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h1 id="2-ì‚¬ìš©-ê°€ëŠ¥í•œ-res-íŒŒì¼-ì •ë³´-ì½ì–´ì˜¤ê¸°"><a href="#2-ì‚¬ìš©-ê°€ëŠ¥í•œ-res-íŒŒì¼-ì •ë³´-ì½ì–´ì˜¤ê¸°" class="headerlink" title="2. ì‚¬ìš© ê°€ëŠ¥í•œ res íŒŒì¼ ì •ë³´ ì½ì–´ì˜¤ê¸°"></a>2. ì‚¬ìš© ê°€ëŠ¥í•œ res íŒŒì¼ ì •ë³´ ì½ì–´ì˜¤ê¸°</h1><p>xingAPIê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ê²½ë¡œë¥¼ ì•„ë˜ì™€ ê°™ì´ ëª…ì‹œí•´ì¤ë‹ˆë‹¤. íŠ¹ë³„íˆ ì„¤ì¹˜ ê²½ë¡œë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•˜ë‹¤ë©´, <code>C:\eBEST\xingAPI\</code> í´ë”ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">XINGAPI_PATH = <span class="string">&#x27;/eBEST/xingAPI/&#x27;</span></span><br></pre></td></tr></table></figure><p>ëª¨ë“ˆì´ ë¡œë”©ë˜ëŠ” ì‹œì ì—, ì•„ë˜ì™€ ê°™ì´ xingAPIì—ì„œ ì œê³µí•˜ëŠ” res íŒŒì¼ë“¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì½ê³  ë³€ìˆ˜ <code>meta_res</code>ì— ì €ì¥í•´ë‘¡ë‹ˆë‹¤. ì„œë²„ë¡œë¶€í„° ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ìˆ˜ì‹ í•  ë•Œ ì œê³µë˜ëŠ” res ì •ë³´ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ dictionary í˜•íƒœë¡œ formatting í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´, ì½”ë“œì˜ ê°€ë…ì„±ì„ ë†’ì—¬ì£¼ê³ , íƒ€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (i.e. pandas)ì™€ì˜ í˜¸í™˜ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_meta_res</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; res íŒŒì¼ë“¤ì˜ meta data</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Example</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; build_meta_res()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &#x27;t8413&#x27;: &#123;</span></span><br><span class="line"><span class="string">                &#x27;desc&#x27;: &#x27;ì£¼ì‹ì± íŠ¸(ì¼ì£¼ì›”)&#x27;,</span></span><br><span class="line"><span class="string">                &#x27;input&#x27;: &#123;</span></span><br><span class="line"><span class="string">                    &#x27;t8413InBlock&#x27;: &#123;</span></span><br><span class="line"><span class="string">                        &#x27;occurs&#x27;: False,</span></span><br><span class="line"><span class="string">                        &#x27;fields&#x27;: [</span></span><br><span class="line"><span class="string">                            &#123;</span></span><br><span class="line"><span class="string">                                &#x27;name&#x27;: &#x27;shcode&#x27;,</span></span><br><span class="line"><span class="string">                                &#x27;desc&#x27;: &#x27;ë‹¨ì¶•ì½”ë“œ&#x27;,</span></span><br><span class="line"><span class="string">                                &#x27;type&#x27;: &#x27;char&#x27;,</span></span><br><span class="line"><span class="string">                                &#x27;size&#x27;: 6</span></span><br><span class="line"><span class="string">                            &#125;,</span></span><br><span class="line"><span class="string">                            &#123; ... &#125;,</span></span><br><span class="line"><span class="string">                            ...</span></span><br><span class="line"><span class="string">                        ]</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#x27;output&#x27;: &#123;</span></span><br><span class="line"><span class="string">                    &#x27;t8413OutBlock1&#x27;: &#123;</span></span><br><span class="line"><span class="string">                        &#x27;occurs&#x27;: True,</span></span><br><span class="line"><span class="string">                        &#x27;fields&#x27;: [ &#x27;price&#x27;, ... ]</span></span><br><span class="line"><span class="string">                    &#125;,</span></span><br><span class="line"><span class="string">                    ...</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            ...</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    meta = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    fnames = <span class="built_in">filter</span>(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="keyword">not</span> re.match(<span class="string">r&#x27;.*\_\d+\.res$&#x27;</span>, x),</span><br><span class="line">        os.listdir(os.path.join(XINGAPI_PATH, <span class="string">&#x27;res&#x27;</span>))</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_field</span>(<span class="params">line</span>):</span><br><span class="line">        cols = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: cols[<span class="number">1</span>].strip(),</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: cols[<span class="number">0</span>].strip(),</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: cols[<span class="number">3</span>].strip(),</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>: cols[<span class="number">4</span>].strip()</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_file</span>(<span class="params">lines</span>):</span><br><span class="line">        parsed = &#123;&#125;</span><br><span class="line">        lines = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.replace(<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).strip(), lines))</span><br><span class="line">        lines = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x, lines))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lines)):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;.Func&#x27;</span> <span class="keyword">in</span> lines[i] <span class="keyword">or</span> <span class="string">&#x27;.Feed&#x27;</span> <span class="keyword">in</span> lines[i]:</span><br><span class="line">                parsed[<span class="string">&#x27;desc&#x27;</span>] = lines[i].split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>].strip()</span><br><span class="line">            <span class="keyword">elif</span> lines[i] == <span class="string">&#x27;begin&#x27;</span>:</span><br><span class="line">                latest_begin = i</span><br><span class="line">            <span class="keyword">elif</span> lines[i] == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">                block_info = lines[latest_begin-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> block_info[<span class="number">2</span>] <span class="keyword">in</span> parsed:</span><br><span class="line">                    parsed[block_info[<span class="number">2</span>]] = &#123;&#125;</span><br><span class="line">                </span><br><span class="line">                parsed[block_info[<span class="number">2</span>]][block_info[<span class="number">0</span>]] = &#123;</span><br><span class="line">                    <span class="string">&#x27;occurs&#x27;</span>: <span class="string">&#x27;occurs&#x27;</span> <span class="keyword">in</span> block_info,</span><br><span class="line">                    <span class="string">&#x27;fields&#x27;</span>: <span class="built_in">list</span>(<span class="built_in">map</span>(parse_field, lines[latest_begin+<span class="number">1</span>:i]))</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">return</span> parsed</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">        meta[fname.replace(<span class="string">&#x27;.res&#x27;</span>,<span class="string">&#x27;&#x27;</span>)] = parse_file(</span><br><span class="line">            <span class="built_in">open</span>(os.path.join(XINGAPI_PATH, <span class="string">&#x27;res/&#x27;</span>, fname)).readlines()</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> meta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meta_res = build_meta_res()</span><br></pre></td></tr></table></figure><h1 id="3-ì„œë²„ì—-ì ‘ì†í•˜ê¸°-XASession"><a href="#3-ì„œë²„ì—-ì ‘ì†í•˜ê¸°-XASession" class="headerlink" title="3. ì„œë²„ì— ì ‘ì†í•˜ê¸° : XASession"></a>3. ì„œë²„ì— ì ‘ì†í•˜ê¸° : XASession</h1><p>Synchronousí•œ ë””ìì¸ì—ì„œ ì„œë²„ë¡œ requestë¥¼ í•˜ê³  responseë¥¼ ë°›ëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ì„œë²„ ì‘ë‹µ ë“±ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” â€˜Event Listener Classâ€™ë¥¼ ì •ì˜</li><li>ìœ„ì˜ classë¥¼ ì‚¬ìš©í•˜ì—¬, xingAPIì˜ COM objectë¥¼ ìƒì„±</li><li>í•´ë‹¹ objectì˜ <code>waiting</code> propertyë¥¼ <code>True</code>ë¡œ ì„¤ì •</li><li>COM objectë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ë¡œ ë°ì´í„° ìš”ì²­</li><li>í•´ë‹¹ objectì˜ <code>waiting</code> propertyê°€ <code>True</code>ì¸ ê²½ìš°, ë°˜ë³µì ìœ¼ë¡œ <code>PumpWaitingMessages</code>ë¥¼ í˜¸ì¶œ<br>  5-1. ì´ë²¤íŠ¸ ë°œìƒ ì‹œ, ì´ë²¤íŠ¸ ì²˜ë¦¬ classê°€ ìì‹ ì˜ <code>waiting</code> propertyë¥¼ <code>False</code>ë¡œ ì„¤ì •<br>  5-2. ìˆ˜ì‹ ëœ ë°ì´í„°ê°€ ìˆì„ ê²½ìš°, ìì‹ ì˜ <code>response</code> propertyì— ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ ì €ì¥</li><li>í•´ë‹¹ objectì˜ <code>response</code> propertyë¥¼ ì°¸ì¡°í•˜ì—¬, ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ í™•ì¸</li></ol><p>ì„œë²„ì— ì ‘ì†í•˜ê³  ë¡œê·¸ì¸í•˜ëŠ” ê¸°ëŠ¥ì€ <code>XASession</code> COMì— ëª…ì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤. COM objectë¥¼ ìƒì„±í•˜ê¸°ì— ì•ì„œì„œ, ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë¥¼ ì²˜ë¦¬í•  Listener Classë¥¼ ì•„ë˜ì™€ ê°™ì´ ì„ ì–¸í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_SessionHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">OnLogin</span>(<span class="params">self, code, msg</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; ì„œë²„ì™€ì˜ ë¡œê·¸ì¸ì´ ëë‚˜ë©´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            @arg code[str] ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ ì½”ë“œ</span></span><br><span class="line"><span class="string">            @arg msg[str] ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ ì •ë³´</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.waiting = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> code == <span class="string">&#x27;0000&#x27;</span>:</span><br><span class="line">            logger.info(<span class="string">&#x27;[*] ë¡œê·¸ì¸ ì„±ê³µ&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logger.warning(<span class="string">&#x27;[*] ë¡œê·¸ì¸ ì‹¤íŒ¨ : &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(msg))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">OnDisconnect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡Œì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.waiting = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&#x27;[*] ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ìœ„ì˜ classë¥¼ ì‚¬ìš©í•˜ì—¬, <code>XASession</code> COM objectë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">_session = DispatchWithEvents(<span class="string">&#x27;XA_Session.XASession&#x27;</span>, _SessionHandler)</span><br></pre></td></tr></table></figure><p>ì´ì œ, <code>_session</code> objectë¥¼ ì´ìš©í•˜ì—¬ xingAPIì— ëª…ì‹œëœ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´, <code>ConnectServer</code>ë¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_session.ConnectServer(<span class="string">&#x27;hts.ebestsec.co.kr&#x27;</span>, <span class="number">20001</span>)</span><br></pre></td></tr></table></figure><p>ì´ë¥¼ ì‚¬ìš©í•˜ì—¬, ì„œë²„ë¡œ ë¡œê·¸ì¸ì„ í•˜ëŠ” í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params"></span></span><br><span class="line"><span class="params">    server=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    username=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    password=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; ë¡œê·¸ì¸</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ê¸°ì¡´ì— ì—°ê²°ë˜ì–´ ìˆëŠ” ì„œë²„ê°€ ìˆìœ¼ë©´, ì—°ê²°ì„ ëŠëŠ”ë‹¤</span></span><br><span class="line">    <span class="keyword">if</span> _session.IsConnected():</span><br><span class="line">        _session.DisconnectServer()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ë¡œê·¸ì¸ ì‹œ í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥ë°›ëŠ”ë‹¤</span></span><br><span class="line">    login_server = (server <span class="keyword">or</span> <span class="built_in">input</span>(<span class="string">&#x27;[*] ì ‘ì† ì„œë²„ ((r)eal / (D)emo / (a)ce) : &#x27;</span>)).lower()[:<span class="number">1</span>]</span><br><span class="line">    login_server = &#123;</span><br><span class="line">        <span class="string">&#x27;r&#x27;</span>: <span class="string">&#x27;hts.ebestsec.co.kr&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;demo.ebestsec.co.kr&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    &#125;.get(login_server, <span class="string">&#x27;demo.ebestsec.co.kr&#x27;</span>)</span><br><span class="line">    login_port = <span class="number">20001</span></span><br><span class="line">    login_id = username <span class="keyword">or</span> <span class="built_in">input</span>(<span class="string">&#x27;[*] ì•„ì´ë”” : &#x27;</span>)</span><br><span class="line">    login_pw = password <span class="keyword">or</span> getpass(<span class="string">&#x27;[*] íŒ¨ìŠ¤ì›Œë“œ : &#x27;</span>)</span><br><span class="line">    login_cert = <span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> login_server == <span class="string">&#x27;demo.ebestsec.co.kr&#x27;</span> <span class="keyword">else</span> getpass(<span class="string">&#x27;[*] ê³µì¸ì¸ì¦ì„œ ì•”í˜¸ : &#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚¸ë‹¤</span></span><br><span class="line">    _session.waiting = <span class="literal">True</span></span><br><span class="line">    _session.ConnectServer(login_server, login_port)</span><br><span class="line">    _session.Login(login_id, login_pw, login_cert, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> _session.waiting:</span><br><span class="line">        PumpWaitingMessages()</span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br></pre></td></tr></table></figure><h1 id="4-ë°ì´í„°-ìš”ì²­í•˜ê¸°-XAQuery"><a href="#4-ë°ì´í„°-ìš”ì²­í•˜ê¸°-XAQuery" class="headerlink" title="4. ë°ì´í„° ìš”ì²­í•˜ê¸° : XAQuery"></a>4. ë°ì´í„° ìš”ì²­í•˜ê¸° : XAQuery</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">res, send, cont=<span class="literal">False</span>, timeout=<span class="number">10</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Query ìš”ì²­</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @arg res[str]`t1102` ì‚¬ìš©í•  res íŒŒì¼ëª…</span></span><br><span class="line"><span class="string">        @arg send[dict] ì „ì†¡í•  ë°ì´í„°</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &#x27;Block1&#x27;: [&#123;&#x27;Field1&#x27;: &#x27;Value1&#x27;, &#x27;Field2&#x27;: &#x27;Value2&#x27;&#125;, &#123;...&#125;, &#123;...&#125;],</span></span><br><span class="line"><span class="string">                &#x27;Block2&#x27;: &#123;&#x27;Field3&#x27;: &#x27;Value3&#x27;, &#x27;Field4&#x27;: &#x27;Value4&#x27;&#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">            ë‹¨ì¼ InBlockì˜ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•œ í˜•ì‹ë„ ì…ë ¥ë°›ìŒ</span></span><br><span class="line"><span class="string">            &#123;&#x27;Field1&#x27;: &#x27;Value1&#x27;, &#x27;Field2&#x27;: &#x27;Value2&#x27;&#125;</span></span><br><span class="line"><span class="string">        @arg cont[*bool=False] ì—°ì†ì¡°íšŒ ì—¬ë¶€</span></span><br><span class="line"><span class="string">        @arg timeout[*int=10] ì„œë²„ ì‘ë‹µ ìµœëŒ€ ëŒ€ê¸° ì‹œê°„, -1ì¸ ê²½ìš° infinite time</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>ê²°ê³¼ì ìœ¼ë¡œ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ëª¨ìŠµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">query(<span class="string">&#x27;t1101&#x27;</span>, &#123;<span class="string">&#x27;shcode&#x27;</span>: <span class="string">&#x27;000020&#x27;</span>&#125;)</span><br><span class="line">query(<span class="string">&#x27;t1104&#x27;</span>, &#123;</span><br><span class="line">  <span class="string">&#x27;t1104InBlock&#x27;</span>: &#123;<span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;000020&#x27;</span>, <span class="string">&#x27;nrec&#x27;</span>: <span class="number">2</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;t1104InBlock1&#x27;</span>: [</span><br><span class="line">    &#123;<span class="string">&#x27;dat1&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;dat2&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;gubn&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;indx&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;dat1&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;dat2&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;gubn&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;indx&#x27;</span>: <span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Queryë¥¼ ìš”ì²­í•˜ê³  ê²°ê³¼ë¥¼ ìˆ˜ì‹ í•˜ëŠ” ìˆœì„œëŠ” <code>XASession</code>ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ì°¨ì´ì ì€, <code>XAQuery</code> COMì„ í†µí•´ Query ìš”ì²­ì„ í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.<br>ì´ë²¤íŠ¸ classì¸ <code>_QueryHandler</code>ê°€ êµ¬í˜„ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•˜ê³ , <code>query</code> í•¨ìˆ˜ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">_query_status = &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">res, send, cont=<span class="literal">False</span>, timeout=<span class="number">10</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Query ìš”ì²­</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @arg res[str]`t1102` ì‚¬ìš©í•  res íŒŒì¼ëª…</span></span><br><span class="line"><span class="string">        @arg send[dict] ì „ì†¡í•  ë°ì´í„°</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &#x27;Block1&#x27;: [&#123;&#x27;Field1&#x27;: &#x27;Value1&#x27;, &#x27;Field2&#x27;: &#x27;Value2&#x27;&#125;, &#123;...&#125;, &#123;...&#125;],</span></span><br><span class="line"><span class="string">                &#x27;Block2&#x27;: &#123;&#x27;Field3&#x27;: &#x27;Value3&#x27;, &#x27;Field4&#x27;: &#x27;Value4&#x27;&#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">            ë‹¨ì¼ InBlockì˜ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•œ í˜•ì‹ë„ ì…ë ¥ë°›ìŒ</span></span><br><span class="line"><span class="string">            &#123;&#x27;Field1&#x27;: &#x27;Value1&#x27;, &#x27;Field2&#x27;: &#x27;Value2&#x27;&#125;</span></span><br><span class="line"><span class="string">        @arg cont[*bool=False] ì—°ì†ì¡°íšŒ ì—¬ë¶€</span></span><br><span class="line"><span class="string">        @arg timeout[*int=10] ì„œë²„ ì‘ë‹µ ìµœëŒ€ ëŒ€ê¸° ì‹œê°„, -1ì¸ ê²½ìš° infinite time</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res íŒŒì¼ ë¡œë“œ</span></span><br><span class="line">    _query = DispatchWithEvents(<span class="string">&#x27;XA_DataSet.XAQuery&#x27;</span>, _QueryHandler)</span><br><span class="line">    _query.init(res)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cont:</span><br><span class="line">        <span class="comment"># ì „ì†¡ í˜„í™© ì—…ë°ì´íŠ¸</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">in</span> _query_status:</span><br><span class="line">            _query_status[res] = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> _query_status[res] <span class="keyword">and</span> _query_status[res][-<span class="number">1</span>] + <span class="number">1</span> &lt; time.time():</span><br><span class="line">            _query_status[res].pop()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ì´ˆë‹¹ ì „ì†¡ íšŸìˆ˜ë¥¼ ê³ ë ¤</span></span><br><span class="line">        tr_count_per_sec = _query.GetTRCountPerSec(res)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(_query_status[res]) &gt;= tr_count_per_sec:</span><br><span class="line">            delay = <span class="built_in">max</span>(_query_status[res][-<span class="number">1</span>] + <span class="number">1.05</span> - time.time(), <span class="number">0</span>)</span><br><span class="line">            time.sleep(delay)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ê¸°ê°„(10ë¶„)ë‹¹ ì „ì†¡ íšŸìˆ˜ë¥¼ ê³ ë ¤</span></span><br><span class="line">        <span class="comment"># TODO : 10ë¶„ ì œí•œì´ ê±¸ë¦¬ë©´ blocking state ì§„ì…</span></span><br><span class="line">        tr_count_limit = _query.GetTRCountLimit(res)</span><br><span class="line">        <span class="keyword">while</span> tr_count_limit <span class="keyword">and</span> _query.GetTRCountRequest(res) &gt;= tr_count_limit:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            _query = DispatchWithEvents(<span class="string">&#x27;XA_DataSet.XAQuery&#x27;</span>, _QueryHandler)</span><br><span class="line">            _query.init(res)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># simplified ëœ inputë¥¼ ë°›ì•˜ì„ ê²½ìš°</span></span><br><span class="line">    send_first_value = <span class="built_in">list</span>(send.values())[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (</span><br><span class="line">        <span class="built_in">isinstance</span> (send_first_value, <span class="built_in">list</span>) <span class="keyword">or</span></span><br><span class="line">        <span class="built_in">isinstance</span> (send_first_value, <span class="built_in">dict</span>)</span><br><span class="line">    ):</span><br><span class="line">        send = &#123; <span class="string">&#x27;&#123;&#125;InBlock&#x27;</span>.<span class="built_in">format</span>(res): send &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ì „ì†¡í•  ë°ì´í„°ë¥¼ ì„¤ì •</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> send.keys():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(send[block], <span class="built_in">dict</span>):</span><br><span class="line">            <span class="keyword">for</span> (k, v) <span class="keyword">in</span> send[block].items():</span><br><span class="line">                _query.set_data(block, k, v)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(send[block], <span class="built_in">list</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(send[block])):</span><br><span class="line">                <span class="keyword">for</span> (k, v) <span class="keyword">in</span> send[block][i].items():</span><br><span class="line">                    _query.set_data(block, k, v, i)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;ì•Œ ìˆ˜ ì—†ëŠ” í˜•íƒœì˜ ë°ì´í„°ì…ë‹ˆë‹¤&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ë°ì´í„° ìš”ì²­</span></span><br><span class="line">    _query.Request(cont)</span><br><span class="line">    </span><br><span class="line">    now = time.time()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cont:</span><br><span class="line">        _query_status[res].insert(<span class="number">0</span>, now)</span><br><span class="line">    _query.waiting = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> _query.waiting:</span><br><span class="line">        <span class="keyword">if</span> timeout &gt;= <span class="number">0</span> <span class="keyword">and</span> now + timeout &lt; time.time():</span><br><span class="line">            _query.waiting = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">raise</span> TimeoutError(<span class="string">&#x27;Query Timeout&#x27;</span>)</span><br><span class="line">        PumpWaitingMessages()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _query.response</span><br></pre></td></tr></table></figure><p><code>_QueryHandler</code>ë¥¼ ì´ˆê¸°í™”(<code>init</code>)í•˜ê³  ìš”ì²­ì„ ìœ„í•´ ë©”ì‹œì§€ë¥¼ ì¤€ë¹„(<code>set_data</code>)í•˜ëŠ” methodë“¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_QueryHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.response = &#123;&#125;</span><br><span class="line">        self.decomp = <span class="literal">False</span></span><br><span class="line">        self.qrycnt = <span class="literal">None</span></span><br><span class="line">        self.waiting = <span class="literal">False</span></span><br><span class="line">        self.res = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self, res</span>):</span><br><span class="line">        self.LoadFromResFile(<span class="string">&#x27;/Res/&#123;&#125;.res&#x27;</span>.<span class="built_in">format</span>(res))</span><br><span class="line">        self.res = res</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_data</span>(<span class="params">self, block, k, v, index=<span class="number">0</span></span>):</span><br><span class="line">        <span class="keyword">if</span> k == <span class="string">&#x27;comp_yn&#x27;</span> <span class="keyword">and</span> v.lower() == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            self.decomp = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> k == <span class="string">&#x27;qrycnt&#x27;</span>:</span><br><span class="line">            self.qrycnt = <span class="built_in">int</span>(v)</span><br><span class="line">        </span><br><span class="line">        self.SetFieldData(block, k, index, v)</span><br></pre></td></tr></table></figure><p>ì´ì–´ì„œ, ì„œë²„ë¡œë¶€í„° ë°ì´í„° ìˆ˜ì‹  ì‹œ ë¶ˆë¦¬ëŠ” ì´ë²¤íŠ¸ í•¨ìˆ˜(<code>OnReceiveData</code>)ì™€ ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° ì“°ì´ëŠ” helper function(<code>get_block_data</code>)ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ, <strong>2. ì‚¬ìš© ê°€ëŠ¥í•œ res íŒŒì¼ ì •ë³´ ì½ì–´ì˜¤ê¸°</strong>ì—ì„œ ì„ ì–¸í•œ <code>meta_res</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ formatting í•´ì¤ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_QueryHandler</span>:</span><br><span class="line">  <span class="comment"># (... continued)</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_block_data</span>(<span class="params">self, block, index=<span class="number">0</span></span>):</span><br><span class="line">        block_data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> meta_res[self.res][<span class="string">&#x27;output&#x27;</span>][block][<span class="string">&#x27;fields&#x27;</span>]:</span><br><span class="line">            data = self.GetFieldData(block, field[<span class="string">&#x27;name&#x27;</span>], index)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> field[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;long&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> data == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                    data = <span class="number">0</span></span><br><span class="line">                data = <span class="built_in">int</span>(data <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">elif</span> field[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;double&#x27;</span> <span class="keyword">or</span> field[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;float&#x27;</span>:</span><br><span class="line">                data = <span class="built_in">float</span>(data <span class="keyword">or</span> <span class="number">0.0</span>)</span><br><span class="line">            </span><br><span class="line">            block_data[field[<span class="string">&#x27;name&#x27;</span>]] = data</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> block_data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">OnReceiveData</span>(<span class="params">self, res</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; ìš”ì²­ ë°ì´í„° ë„ì°© Listener</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            self.GetFieldData(...)ë¥¼ í†µí•´ ì „ì†¡ë°›ì€ ë°ì´í„° í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            @arg res[str] ìš”ì²­ res íŒŒì¼ëª…</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># decompressê°€ í•„ìš”í•œ ê²½ìš° ì••ì¶•í•´ì œ</span></span><br><span class="line">        <span class="comment"># TODO : OutBlock1 ë§ê³  ë‹¤ë¥¸ occursê°€ ìˆëŠ” ì¼€ì´ìŠ¤ (ex. FOCCQ33600)</span></span><br><span class="line">        <span class="keyword">if</span> self.decomp:</span><br><span class="line">            self.Decompress(res + <span class="string">&#x27;OutBlock1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> meta_res[res][<span class="string">&#x27;output&#x27;</span>].keys():</span><br><span class="line">            <span class="comment"># í•´ë‹¹ ë¸”ëŸ­ì´ occursì¸ ê²½ìš°,</span></span><br><span class="line">            <span class="keyword">if</span> meta_res[res][<span class="string">&#x27;output&#x27;</span>][block][<span class="string">&#x27;occurs&#x27;</span>]:</span><br><span class="line">                row_res = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.GetBlockCount(block)):</span><br><span class="line">                    row_res.append(self.get_block_data(block, i))</span><br><span class="line">            <span class="comment"># í•´ë‹¹ ë¸”ëŸ­ì´ ë‹¨ì¼ ë°ì´í„°ì¸ ê²½ìš°,</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                row_res = self.get_block_data(block)</span><br><span class="line">        </span><br><span class="line">            self.response[block] = row_res</span><br><span class="line">        </span><br><span class="line">        self.waiting = <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>ê²°ê³¼ì ìœ¼ë¡œ, <code>query</code>ë¥¼ í˜¸ì¶œí•  ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>query(<span class="string">&#x27;t1101&#x27;</span>, &#123;<span class="string">&#x27;shcode&#x27;</span>: <span class="string">&#x27;000020&#x27;</span>&#125;)</span><br><span class="line">&#123;<span class="string">&#x27;t1101OutBlock&#x27;</span>: &#123;<span class="string">&#x27;bid&#x27;</span>: <span class="number">6780</span>,</span><br><span class="line">                   <span class="string">&#x27;bidho1&#x27;</span>: <span class="number">9700</span>,</span><br><span class="line">                   <span class="string">&#x27;bidho10&#x27;</span>: <span class="number">9600</span>,</span><br><span class="line">                   <span class="string">&#x27;bidho2&#x27;</span>: <span class="number">9690</span>,</span><br><span class="line">                   (...)</span><br><span class="line">                   <span class="string">&#x27;dnlmtprice&#x27;</span>: <span class="number">6750</span>,</span><br><span class="line">                   <span class="string">&#x27;high&#x27;</span>: <span class="number">9820</span>,</span><br><span class="line">                   <span class="string">&#x27;hname&#x27;</span>: <span class="string">&#x27;ë™í™”ì•½í’ˆ&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;ho_status&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">                   (...)</span><br><span class="line">                   <span class="string">&#x27;yeprice&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">                   <span class="string">&#x27;yesign&#x27;</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;yevolume&#x27;</span>: <span class="number">0</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="5-Wrapper-Functions"><a href="#5-Wrapper-Functions" class="headerlink" title="5. Wrapper Functions"></a>5. Wrapper Functions</h1><p>ìœ„ì˜ <code>query</code> í•¨ìˆ˜ë¥¼ í•œë²ˆ ë” wrappingí•´ì„œ, ì¡°ê¸ˆ ë” ì§ê´€ì ì¸ í•¨ìˆ˜ë“¤ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, xingAPIì—ì„œëŠ” <code>t8412</code>ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ì‹ì°¨íŠ¸ë¥¼ ë¶„ ë‹¨ìœ„ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œë²ˆì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìµœëŒ€ ë°ì´í„°ì˜ ì–‘ì¸ 2,000ê°œê°€ ë„˜ëŠ” ë°ì´í„°ì— ëŒ€í•´ì„œëŠ” ì—°ì†ì¡°íšŒë„ ì§€ì›í•©ë‹ˆë‹¤. í•´ë‹¹ resë¥¼ í˜¸ì¶œí•˜ëŠ” <code>query</code> í•¨ìˆ˜ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ wrapping í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">transactions_min</span>(<span class="params">shcode, interval=<span class="number">1</span>, sdate=<span class="literal">None</span>, edate=<span class="literal">None</span></span>):</span><br><span class="line">  edate = edate <span class="keyword">or</span> datetime.now().strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>)</span><br><span class="line">  sdate = sdate <span class="keyword">or</span> edate</span><br><span class="line">  </span><br><span class="line">  data = []</span><br><span class="line">  cts_date = <span class="string">&#x27; &#x27;</span></span><br><span class="line">  cts_time = <span class="string">&#x27; &#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    response = query(<span class="string">&#x27;t8412&#x27;</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;shcode&#x27;</span>: shcode,</span><br><span class="line">      <span class="string">&#x27;ncnt&#x27;</span>: interval,</span><br><span class="line">      <span class="string">&#x27;qrycnt&#x27;</span>: <span class="number">2000</span>,</span><br><span class="line">      <span class="string">&#x27;nday&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;sdate&#x27;</span>: sdate,</span><br><span class="line">      <span class="string">&#x27;edate&#x27;</span>: edate,</span><br><span class="line">      <span class="string">&#x27;cts_date&#x27;</span>: cts_date,</span><br><span class="line">      <span class="string">&#x27;cts_time&#x27;</span>: cts_time,</span><br><span class="line">      <span class="string">&#x27;comp_yn&#x27;</span>: <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">    &#125;, <span class="built_in">len</span>(data) &gt; <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    data = response[<span class="string">&#x27;t8412OutBlock1&#x27;</span>] + data</span><br><span class="line">    cts_date = response[<span class="string">&#x27;t8412OutBlock&#x27;</span>][<span class="string">&#x27;cts_date&#x27;</span>]</span><br><span class="line">    cts_time = response[<span class="string">&#x27;t8412OutBlock&#x27;</span>][<span class="string">&#x27;cts_time&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (cts_date <span class="keyword">or</span> cts_time):</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  </span><br><span class="line">  data = pd.DataFrame(data)</span><br><span class="line">  data.index = (data[<span class="string">&#x27;date&#x27;</span>] + data[<span class="string">&#x27;time&#x27;</span>]).apply(<span class="keyword">lambda</span> t: datetime.strptime(t, <span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>).astimezone(pytz.timezone(<span class="string">&#x27;Asia/Seoul&#x27;</span>)))</span><br><span class="line">  </span><br><span class="line">  data = data.rename(columns=&#123;<span class="string">&#x27;jdiff_vol&#x27;</span>: <span class="string">&#x27;volumn&#x27;</span>&#125;)</span><br><span class="line">  data = data[[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;volumn&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;jongchk&#x27;</span>, <span class="string">&#x27;rate&#x27;</span>]]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p><code>query</code> í•¨ìˆ˜ì—ì„œ ê²°ê³¼ë¬¼ì„ list of dictí˜•íƒœë¡œ ë³€í™˜í•˜ë¯€ë¡œ, DataFrame í˜•íƒœë¡œ ê²°ê³¼ë¬¼ì„ ë°”ê¾¸ëŠ” ì‘ì—…ì´ ê°„ë‹¨í•´ì§‘ë‹ˆë‹¤. (<code>data = pd.DataFrame(data)</code>)</p><p>ìœ„ì˜ <code>transactions_min</code> í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>transactions_min(<span class="string">&#x27;000020&#x27;</span>, interval=<span class="number">3</span>, sdate=<span class="string">&#x27;20201228&#x27;</span>)</span><br><span class="line">                            <span class="built_in">open</span>   high    low  ...  value  jongchk  rate</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">28</span> 09:03:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">20000</span>  <span class="number">20050</span>  <span class="number">19800</span>  ...    <span class="number">748</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">28</span> 09:06:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">19800</span>  <span class="number">19850</span>  <span class="number">19650</span>  ...    <span class="number">461</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">28</span> 09:09:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">19700</span>  <span class="number">19700</span>  <span class="number">19550</span>  ...    <span class="number">584</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line">                          ...    ...    ...  ...    ...      ...   ...</span><br><span class="line"><span class="number">2021</span>-01-04 <span class="number">15</span>:<span class="number">18</span>:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">19100</span>  <span class="number">19100</span>  <span class="number">19000</span>  ...    <span class="number">265</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line"><span class="number">2021</span>-01-04 <span class="number">15</span>:<span class="number">20</span>:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">19000</span>  <span class="number">19100</span>  <span class="number">18950</span>  ...    <span class="number">138</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line"><span class="number">2021</span>-01-04 <span class="number">15</span>:<span class="number">30</span>:<span class="number">00</span>+09:<span class="number">00</span>  <span class="number">19100</span>  <span class="number">19100</span>  <span class="number">19100</span>  ...    <span class="number">391</span>        <span class="number">0</span>   <span class="number">0.0</span></span><br><span class="line">[<span class="number">489</span> rows x <span class="number">8</span> columns]</span><br></pre></td></tr></table></figure><h1 id="6-ì‹¤ì‹œê°„-ë°ì´í„°-êµ¬ë…í•˜ê¸°-XAReal"><a href="#6-ì‹¤ì‹œê°„-ë°ì´í„°-êµ¬ë…í•˜ê¸°-XAReal" class="headerlink" title="6. ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë…í•˜ê¸° : XAReal"></a>6. ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë…í•˜ê¸° : XAReal</h1><p>ì‹¤ì‹œê°„ ë°ì´í„°ì˜ ê²½ìš°, XASessionê³¼ XAQueryì™€ëŠ” ì•½ê°„ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.</p><ol><li>ë°ì´í„° ìˆ˜ì‹  ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” Event Listener Classë¥¼ ì •ì˜</li><li>ìœ„ì˜ classë¥¼ ì‚¬ìš©í•˜ì—¬, xingAPIì˜ COM objectë¥¼ ìƒì„±</li><li>í•´ë‹¹ objectì˜ <code>callback</code> propertyë¥¼ ë°ì´í„° ìˆ˜ì‹  ì‹œ ì‹¤í–‰ í•  í•¨ìˆ˜ë¡œ ì„¤ì •</li><li>COM objectë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ë¡œ ë°ì´í„° êµ¬ë…</li><li><code>PumpWaitingMessages</code>ë¥¼ ë°˜ë³µì ìœ¼ë¡œ í˜¸ì¶œ<br>  5-1. ë°ì´í„° ìˆ˜ì‹  ì´ë²¤íŠ¸ ë°œìƒ ì‹œ, ì´ë²¤íŠ¸ ì²˜ë¦¬ classê°€ ì„œë²„ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì¸ìë¡œ í•˜ì—¬ <code>callback</code> property í•¨ìˆ˜ë¥¼ ì‹¤í–‰</li><li>(êµ¬ë…í•œ ë°ì´í„°ê°€ ë” ì´ìƒ í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°) COM objectë¥¼ ì´ìš©í•˜ì—¬ êµ¬ë… ì·¨ì†Œ</li></ol><p>ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í´ë˜ìŠ¤ (<code>_RealtimeHandler</code>)ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ê³ , ì‹¤ì‹œê°„ ë°ì´í„° í•¸ë“¤ë§ì„ ìœ„í•œ í´ë˜ìŠ¤ <code>Realtime</code>ì„ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. xingAPIì˜ ì‹¤ì‹œê°„ ë°ì´í„°ì˜ ê²½ìš° ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•  ì‹œì— ìµœëŒ€ í•˜ë‚˜ì˜ fieldë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ, <code>meta_res</code>ì—ì„œ í•´ë‹¹ í‚¤ ê°’ì˜ ì´ë¦„ì„ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¼ì¸ 357)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Realtime</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, res, callback</span>):</span><br><span class="line">        self._res = res</span><br><span class="line">        self._instance = DispatchWithEvents(<span class="string">&#x27;XA_DataSet.XAReal&#x27;</span>, _RealtimeHandler)</span><br><span class="line">        self._instance.LoadFromResFile(<span class="string">f&#x27;/Res/<span class="subst">&#123;res&#125;</span>.res&#x27;</span>)</span><br><span class="line">        self._instance.callback = callback</span><br><span class="line">        </span><br><span class="line">        self.subscribed_keys = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subscribe</span>(<span class="params">self, key=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.subscribed_keys:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;self._res&#125;</span>ëŠ” ì´ë¯¸ <span class="subst">&#123;key&#125;</span> ë°ì´í„°ë¥¼ ìˆ˜ì‹  ì¤‘ì…ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> key:</span><br><span class="line">            self._instance.SetFieldData(<span class="string">&#x27;InBlock&#x27;</span>, meta_res[self._res][<span class="string">&#x27;input&#x27;</span>][<span class="string">&#x27;InBlock&#x27;</span>][<span class="string">&#x27;fields&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>], key)</span><br><span class="line">        self._instance.AdviseRealData()</span><br><span class="line">        </span><br><span class="line">        self.subscribed_keys.append(key)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unsubscribe</span>(<span class="params">self, key=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self._instance.UnadviseRealData()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.subscribed_keys:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&#x27;<span class="subst">&#123;self._res&#125;</span>ëŠ” <span class="subst">&#123;key&#125;</span> ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">            self._instnace.UnadviseRealDataWithKey(key)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">listen</span>(<span class="params">delay=<span class="number">.01</span></span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            PumpWaitingMessages()</span><br><span class="line">            time.sleep(delay)</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” <code>OnReceiveRealData</code>ë¥¼ ì •ì˜í•´ì¤ë‹ˆë‹¤. ìœ„ì—ì„œ ì„¤ì •í•œ <code>callback</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_RealtimeHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">OnReceiveRealData</span>(<span class="params">self, res</span>):</span><br><span class="line">        response = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> meta_res[res][<span class="string">&#x27;output&#x27;</span>][<span class="string">&#x27;OutBlock&#x27;</span>][<span class="string">&#x27;fields&#x27;</span>]:</span><br><span class="line">            response[field[<span class="string">&#x27;name&#x27;</span>]] = self.GetFieldData(<span class="string">&#x27;OutBlock&#x27;</span>, field[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        self.callback(res, response)</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ì ìœ¼ë¡œ, ìœ„ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰ì´ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">res, response</span>):</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">if</span> res == <span class="string">&#x27;NWS&#x27;</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">f&#x27;í˜„ì¬ì‹œê°„ : <span class="subst">&#123;response[<span class="string">&quot;time&quot;</span>]&#125;</span> / ê¸°ì‚¬ì œëª© : <span class="subst">&#123;response[<span class="string">&quot;title&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nws = Realtime(<span class="string">&#x27;NWS&#x27;</span>, callback=callback)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nws.subscribe(<span class="string">&#x27;NWS001&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Realtime.listen()</span><br><span class="line">í˜„ì¬ì‹œê°„ <span class="number">154734</span> / ê¸°ì‚¬ì œëª© [í¬í† ] ì½”ë¡œë‚˜<span class="number">19</span> ì§ë¬´ êµìœ¡í˜„ì¥ ì°¸ê´€</span><br><span class="line">í˜„ì¬ì‹œê°„ <span class="number">154752</span> / ê¸°ì‚¬ì œëª© ì „ì„±ë°° ì‹ ì„ì›ì¥, <span class="string">&quot;êµ­ê°€ ë””ì§€í„¸ì „í™˜ ì„ ë„&quot;</span></span><br><span class="line">í˜„ì¬ì‹œê°„ <span class="number">154750</span> / ê¸°ì‚¬ì œëª© [í¬í† ] ì •ì´ë¦¬, ì½”ë¡œë‚˜<span class="number">19</span> êµìœ¡í˜„ì¥ ì°¸ê´€</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p><code>_RealtimeHandler</code>ê°€ ì¸ìë¡œ <code>res</code>ë¥¼ ì „ë‹¬í•´ì£¼ë¯€ë¡œ, <code>callback</code> í•¨ìˆ˜ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–¤ ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ë“¤ì–´ì™”ëŠ”ì§€ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0-Introduction&quot;&gt;&lt;a href=&quot;#0-Introduction&quot; class=&quot;headerlink&quot; title=&quot;0. Introduction&quot;&gt;&lt;/a&gt;0. Introduction&lt;/h1&gt;&lt;p&gt;ì´ë² ìŠ¤íŠ¸ì¦ê¶Œì€ COM í˜•íƒœì™€ dll í˜•íƒœë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” xingAPIë¥¼ ì œê³µí•©ë‹ˆë‹¤. Pythonì—ì„œ COM objectë¥¼ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ xingAPIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì‚¬ìš©ë²•ì´ ê¹”ë”í•˜ì§€ ëª»í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;img src=&quot;/images/2021-01-syntactic-sugar.jpg&quot; class=&quot;Put some sugar on that&quot; width=&quot;500&quot; title=&quot;Sugar&quot;&gt;

&lt;p&gt;ê°œì¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•˜ì—¬ ì„¤íƒ•ì„ íŒíŒì³ì„œ ëª¨ë“ˆì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´, ì½”ë“œê°€ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬ê°€ ë©ë‹ˆë‹¤.&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; ebest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;ebest.login()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[*] ì ‘ì† ì„œë²„ ((r)eal / (D)emo / (a)ce) : &lt;span class=&quot;comment&quot;&gt;# r&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[*] ì•„ì´ë”” : &lt;span class=&quot;comment&quot;&gt;# username&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[*] íŒ¨ìŠ¤ì›Œë“œ : &lt;span class=&quot;comment&quot;&gt;# password&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[*] ê³µì¸ì¸ì¦ì„œ ì•”í˜¸ : &lt;span class=&quot;comment&quot;&gt;# cert_password&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[*] ë¡œê·¸ì¸ ì„±ê³µ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# XAQuery ìš”ì²­&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;ebest.query(&lt;span class=&quot;string&quot;&gt;&amp;#x27;t1101&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;dict&lt;/span&gt;(shcode=&lt;span class=&quot;string&quot;&gt;&amp;#x27;000020&amp;#x27;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;t1101OutBlock&amp;#x27;&lt;/span&gt;: &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;hname&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;ë™í™”ì•½í’ˆ&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;price&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;19100&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;sign&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;5&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;change&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;550&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;# ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;open&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;19750&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;high&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;19900&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;low&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;18850&lt;/span&gt;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# XAQuery ìš”ì²­ í›„ DataFrame í˜•íƒœë¡œ ë³€í™˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;res = query(&lt;span class=&quot;string&quot;&gt;&amp;#x27;t8413&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;dict&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;... &lt;/span&gt;  shcode=&lt;span class=&quot;string&quot;&gt;&amp;#x27;000020&amp;#x27;&lt;/span&gt;, sdate=&lt;span class=&quot;string&quot;&gt;&amp;#x27;20200101&amp;#x27;&lt;/span&gt;, edate=&lt;span class=&quot;string&quot;&gt;&amp;#x27;20210101&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;... &lt;/span&gt;  gubun=&lt;span class=&quot;string&quot;&gt;&amp;#x27;2&amp;#x27;&lt;/span&gt;, qrycnt=&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;, cts_date=&lt;span class=&quot;string&quot;&gt;&amp;#x27; &amp;#x27;&lt;/span&gt;, comp_yn=&lt;span class=&quot;string&quot;&gt;&amp;#x27;Y&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;... &lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;pd.DataFrame(res.get(&lt;span class=&quot;string&quot;&gt;&amp;#x27;t8413OutBlock1&amp;#x27;&lt;/span&gt;)).set_index(&lt;span class=&quot;string&quot;&gt;&amp;#x27;date&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;built_in&quot;&gt;open&lt;/span&gt;   high    low  close  ...  rate  pricechk  ratevalue  sign&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;date                                  ...                                 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;20200102&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8340&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8400&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8290&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8400&lt;/span&gt;  ...   &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;         &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;20200103&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8400&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8450&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8290&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;8360&lt;/span&gt;  ...   &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;         &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         ...    ...    ...    ...  ...   ...       ...        ...   ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;20201229&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;18750&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;19400&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;18750&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;19150&lt;/span&gt;  ...   &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;         &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;20201230&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;19100&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;19800&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;18800&lt;/span&gt;  &lt;span class=&quot;number&quot;&gt;19650&lt;/span&gt;  ...   &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;         &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;248&lt;/span&gt; rows x &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt; columns]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# XAReal ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë… í›„ callback functionìœ¼ë¡œ ì²˜ë¦¬&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;nws = Realtime(&lt;span class=&quot;string&quot;&gt;&amp;#x27;NWS&amp;#x27;&lt;/span&gt;, callback=&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;nws.subscribe(&lt;span class=&quot;string&quot;&gt;&amp;#x27;NWS001&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;Realtime.listen()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NWS &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;date&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;20210104&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;time&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;154734&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;[í¬í† ] ì½”ë¡œë‚˜19 ì§ë¬´ êµìœ¡í˜„ì¥ ì°¸ê´€&amp;#x27;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NWS &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;date&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;20210104&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;time&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;154752&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;ì „ì„±ë°° ì‹ ì„ì›ì¥, &amp;quot;êµ­ê°€ ë””ì§€í„¸ì „í™˜ ì„ ë„&amp;quot;&amp;#x27;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NWS &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;date&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;20210104&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;time&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;154750&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;[í¬í† ] ì •ì´ë¦¬, ì½”ë¡œë‚˜19 êµìœ¡í˜„ì¥ ì°¸ê´€&amp;#x27;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/ebest.py&quot;&gt;ì—¬ê¸°ë¥¼ í´ë¦­&lt;/a&gt;í•˜ì‹œë©´ ì†ŒìŠ¤ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆê³ , ìœ„ ì˜ˆì‹œì²˜ëŸ¼ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. &lt;strong&gt;ëª¨ë“ˆì„ ì–´ë–»ê²Œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€ ê¶ê¸ˆí•˜ì‹  ê²½ìš°&lt;/strong&gt;, ëª¨ë“ˆì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì‹¤í–‰ ìˆœì„œë³„ë¡œ ì„¤ëª…ì„ í•´ ë†“ì€ &lt;strong&gt;ë³¸ í¬ìŠ¤íŒ…ì˜ ë³¸ë¬¸ì„ í™•ì¸í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ê°œì¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ êµ¬í˜„í•œ ì½”ë“œì¸ ê´€ê³„ë¡œ, ì´ëŸ°ì €ëŸ° ë¬¸ì œì ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ğŸ˜… í¬ìŠ¤íŒ…ì˜ ë‚´ìš©ì´ë‚˜ ì†ŒìŠ¤ì— ê°œì„ ì´ í•„ìš”í•œ ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
    <category term="System Trading" scheme="https://hwangheek.github.io/tags/System-Trading/"/>
    
    <category term="ebest" scheme="https://hwangheek.github.io/tags/ebest/"/>
    
  </entry>
  
  <entry>
    <title>KRXì˜ íœ´ì¥ì¼ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Python pandasì˜ AbstractHolidayCalendarì™€ CustomBusinessDay ì‚¬ìš©í•˜ê¸°</title>
    <link href="https://hwangheek.github.io/2020/pandas-custom-businessday-from-krx/"/>
    <id>https://hwangheek.github.io/2020/pandas-custom-businessday-from-krx/</id>
    <published>2020-10-28T03:13:26.000Z</published>
    <updated>2022-07-23T14:39:52.361Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0. Introduction"></a>0. Introduction</h1><p>Pythonì„ ì‚¬ìš©í•´ì„œ ê¸ˆìœµ ì‹œê³„ì—´ ë¶„ì„ì„ í•˜ë‹¤ë³´ë©´, datetimeê³¼ ê´€ë ¨í•œ ì²˜ë¦¬ê°€ ê¹Œë‹¤ë¡œìš´ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ, íœ´ì¼ ë° ê³µíœ´ì¼ ë“±ì„ ê³„ì‚°í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. Python pandas ë¼ì´ë¸ŒëŸ¬ë¦¬ì— business day ê°œë…ì´ ìˆê¸°ëŠ” í•˜ì§€ë§Œ (ê¸°ë³¸ì ìœ¼ë¡œëŠ”) ì£¼ë§ì„ ì œì™¸í•œ ê³µíœ´ì¼ì„ ì œëŒ€ë¡œ ê³ ë ¤í•˜ì§€ ëª»í•©ë‹ˆë‹¤.</p><img src="/images/2020-10-say-datetime-one-more-time.jpg" class="datetime anger" width="500" title="datetime anger"><p>ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ, pandasì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ë³¸ í¬ìŠ¤íŒ…ì€ í•´ë‹¹ ë‚´ìš©ì„ ê³µë¶€í•˜ë©° ì •ë¦¬í•œ ê¸€ ì…ë‹ˆë‹¤. ê¸€ì˜ ë‚´ìš© ì¤‘ ì˜ëª» ëœ ë¶€ë¶„ì´ ìˆëŠ” ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. :)</p><span id="more"></span><hr><h1 id="1-pandasì˜-AbstractHolidayCalendar"><a href="#1-pandasì˜-AbstractHolidayCalendar" class="headerlink" title="1. pandasì˜ AbstractHolidayCalendar"></a>1. pandasì˜ <code>AbstractHolidayCalendar</code></h1><h2 id="1-1-pandasì˜-Holidayë¥¼-ì‚¬ìš©í•˜ì—¬-ì •ì˜í•˜ê¸°"><a href="#1-1-pandasì˜-Holidayë¥¼-ì‚¬ìš©í•˜ì—¬-ì •ì˜í•˜ê¸°" class="headerlink" title="1.1. pandasì˜ Holidayë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ê¸°"></a>1.1. pandasì˜ <code>Holiday</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ê¸°</h2><p>pandasì˜ <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html?highlight=abstractholidaycalendar#holidays-holiday-calendars"><em><code>AbstractHolidayCalendar</code></em></a>ë¥¼ ì‚¬ìš©í•˜ì—¬, ì‚¬ìš©ìê°€ ê³µíœ´ì¼ì„ ì§ì ‘ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ê³ , ê³µíœ´ì¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” í´ë˜ìŠ¤ ë³€ìˆ˜ <code>rules</code>ë¥¼ override í•˜ë©´ ë©ë‹ˆë‹¤. ê° ê³µíœ´ì¼ì€ pandasì˜ <code>Holiday</code> í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•´ì¤ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> AbstractHolidayCalendar, Holiday</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleCalendar</span>(<span class="title class_ inherited__">AbstractHolidayCalendar</span>):</span><br><span class="line">    rules = [</span><br><span class="line">      Holiday(<span class="string">&#x27;Example Holiday&#x27;</span>, month=<span class="number">3</span>, day=<span class="number">21</span>),</span><br><span class="line">      Holiday(<span class="string">&#x27;Another Example Holiday&#x27;</span>, year=<span class="number">2018</span>, month=<span class="number">8</span>, day=<span class="number">14</span>),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p><code>Holiday</code> í´ë˜ìŠ¤ì˜ ê²½ìš° <code>offset</code> í˜¹ì€ <code>observance</code> ì¸ìë¥¼ í†µí•´ ì¡°ê¸ˆ ë” ìƒì„¸í•œ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><code>offset</code>ì€ ëª…ì‹œëœ ì¼ìì™€ ì‹¤ì œ ê³µíœ´ì¼ ê°„ì˜ ì¼ì ì°¨ì´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì£¼ë¡œ <code>pandas.DateOffset</code>ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ â€œì…‹ì§¸ ì£¼ ì›”ìš”ì¼â€ê³¼ ê°™ì€ ì‹ì˜ ê³µíœ´ì¼ì„ ì§€ì •í•˜ëŠ”ë° ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p><code>observance</code>ëŠ” ë‚ ì§œë¡œ ì£¼ì–´ì§„ ê³µíœ´ì¼ì— ëŒ€í•œ ì¼ì¢…ì˜ í›„ì²˜ë¦¬ ë¡œì§ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë‚ ì§œê°€ ì£¼ë§ì¼ ê²½ìš° ê³µíœ´ì¼ì„ ë‹¤ìŒì£¼ ì›”ìš”ì¼ë¡œ ë¯¸ë£°ì§€(<code>next_monday</code>), ì£¼ë§ ì§ì „ ê¸ˆìš”ì¼ë¡œ ë‹¹ê¸¸ì§€(<code>previous_friday</code>) ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. pandasì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ì§ì ‘ ì •ì˜í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œë¥¼ í™•ì¸í•˜ì‹œë©´ ì´í•´ê°€ ì‰½ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” pandasì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” ë¯¸êµ­ ê³µíœ´ì¼ ìº˜ë¦°ë” í´ë˜ìŠ¤(<code>USFederalHolidayCalendar</code>)ì…ë‹ˆë‹¤. (pandas 1.1 ê¸°ì¤€ìœ¼ë¡œ, <a href="https://github.com/pandas-dev/pandas/blob/1.1.x/pandas/tseries/holiday.py"><em><code>pandas.tseries.holiday</code></em></a> ëª¨ë“ˆì—ì„œ êµ¬í˜„ì„ ì°¾ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> DateOffset</span><br><span class="line"><span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> AbstractHolidayCalendar, Holiday, nearest_workday</span><br><span class="line"><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> MO, TU, WE, TH, FR, SA, SU</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">USFederalHolidayCalendar</span>(<span class="title class_ inherited__">AbstractHolidayCalendar</span>):</span><br><span class="line">    rules = [</span><br><span class="line">        Holiday(</span><br><span class="line">          <span class="string">&quot;New Years Day&quot;</span>, month=<span class="number">1</span>, day=<span class="number">1</span>,</span><br><span class="line">          observance=nearest_workday  <span class="comment"># 1ì›” 1ì¼ì´ í† ìš”ì¼ì¸ ê²½ìš° ì§ì „ ê¸ˆìš”ì¼ì„,</span></span><br><span class="line">                                      <span class="comment"># ì¼ìš”ì¼ì¸ ê²½ìš° ì´í›„ ì›”ìš”ì¼ì„ ê³µíœ´ì¼ë¡œ ì‚¬ìš©</span></span><br><span class="line">        ),</span><br><span class="line">        Holiday(</span><br><span class="line">          <span class="string">&quot;Martin Luther King Jr. Day&quot;</span>,</span><br><span class="line">          start_date=datetime(<span class="number">1986</span>, <span class="number">1</span>, <span class="number">1</span>), month=<span class="number">1</span>, day=<span class="number">1</span>,</span><br><span class="line">          offset=DateOffset(weekday=MO(<span class="number">3</span>))  <span class="comment"># 1986ë…„ ì´í›„ 1ì›”ì˜ ì…‹ì§¸ ì£¼ ì›”ìš”ì¼ì„ ê³µíœ´ì¼ë¡œ ì‚¬ìš©</span></span><br><span class="line">        ),</span><br><span class="line">        Holiday(</span><br><span class="line">          <span class="string">&quot;Presidents Day&quot;</span>,</span><br><span class="line">          month=<span class="number">2</span>, day=<span class="number">1</span>,</span><br><span class="line">          offset=DateOffset(weekday=MO(<span class="number">3</span>))  <span class="comment"># 2ì›” ì…‹ì§¸ ì£¼ ì›”ìš”ì¼ì„ ê³µíœ´ì¼ë¡œ ì‚¬ìš©</span></span><br><span class="line">        ),</span><br><span class="line">        Holiday(</span><br><span class="line">          <span class="string">&quot;Memorial Day&quot;</span>,</span><br><span class="line">          month=<span class="number">5</span>, day=<span class="number">31</span>,</span><br><span class="line">          offset=DateOffset(weekday=MO(-<span class="number">1</span>))  <span class="comment"># 5ì›” ë§ˆì§€ë§‰ ì›”ìš”ì¼ì„ ê³µíœ´ì¼ë¡œ ì‚¬ìš©</span></span><br><span class="line">        ),</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ì´í•˜ ë™ì¼</span></span><br><span class="line">        Holiday(<span class="string">&quot;July 4th&quot;</span>, month=<span class="number">7</span>, day=<span class="number">4</span>, observance=nearest_workday),</span><br><span class="line">        Holiday(<span class="string">&quot;Labor Day&quot;</span>, month=<span class="number">9</span>, day=<span class="number">1</span>, offset=DateOffset(weekday=MO(<span class="number">1</span>))),</span><br><span class="line">        Holiday(<span class="string">&quot;Columbus Day&quot;</span>, month=<span class="number">10</span>, day=<span class="number">1</span>, offset=DateOffset(weekday=MO(<span class="number">2</span>))),</span><br><span class="line">        Holiday(<span class="string">&quot;Veterans Day&quot;</span>, month=<span class="number">11</span>, day=<span class="number">11</span>, observance=nearest_workday),</span><br><span class="line">        Holiday(<span class="string">&quot;Thanksgiving&quot;</span>, month=<span class="number">11</span>, day=<span class="number">1</span>, offset=DateOffset(weekday=TH(<span class="number">4</span>))),</span><br><span class="line">        Holiday(<span class="string">&quot;Christmas&quot;</span>, month=<span class="number">12</span>, day=<span class="number">25</span>, observance=nearest_workday),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><h2 id="1-2-DB-ì •ë³´ë¥¼-ì‚¬ìš©í•˜ì—¬-ì •ì˜í•˜ê¸°"><a href="#1-2-DB-ì •ë³´ë¥¼-ì‚¬ìš©í•˜ì—¬-ì •ì˜í•˜ê¸°" class="headerlink" title="1.2. DB ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ê¸°"></a>1.2. DB ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ê¸°</h2><p>ìœ„ì™€ ê°™ì€ ë°©ë²•ì˜ ê²½ìš°, ë¹„ì£¼ê¸°ì ì¸ ê³µíœ´ì¼ì´ ë°œìƒí–ˆì„ ë•Œ ì†ŒìŠ¤ì½”ë“œë¥¼ ìˆ˜ì •í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼ ìŒë ¥ìœ¼ë¡œ ê³µíœ´ì¼ì„ ì„¸ëŠ” ê²½ìš°ê°€ ë§ì€ í•œêµ­ì˜ ê²½ìš° ìœ„ì˜ ë°©ë²•ì„ ì‚¬ìš©í•˜ê¸°ê°€ ì• ë§¤í•©ë‹ˆë‹¤. ë§Œì•½ ê³µíœ´ì¼ í˜¹ì€ íœ´ì¥ì¼ íŒŒì¼ í˜¹ì€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•´ ë†“ì€ ê²½ìš°, ìœ„ì˜ ì½”ë“œë¥¼ ì‘ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìµœì‹  ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ìº˜ë¦°ë”ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•„ë˜ëŠ” DBì—ì„œ ê°€ì ¸ì˜¨ ê³µìœ ì¼ ë°ì´í„° <code>holidays</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µíœ´ì¼ ìº˜ë¦°ë”ë¥¼ ì •ì˜í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> AbstractHolidayCalendar, Holiday</span><br><span class="line"></span><br><span class="line">holidays = get_holidays_from_your_db()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">  ...</span></span><br><span class="line"><span class="string">  (&#x27;ì–´ë¦°ì´ë‚ &#x27;, 2020, 5, 5),</span></span><br><span class="line"><span class="string">  (&#x27;ì¶”ì„ì—°íœ´&#x27;, 2020, 9, 30),</span></span><br><span class="line"><span class="string">  (&#x27;ì¶”ì„ì—°íœ´&#x27;, 2020, 10, 1),</span></span><br><span class="line"><span class="string">  (&#x27;ì¶”ì„ì—°íœ´&#x27;, 2020, 10, 2),</span></span><br><span class="line"><span class="string">  (&#x27;í•œê¸€ë‚ &#x27;, 2020, 10, 9),</span></span><br><span class="line"><span class="string">  ...</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleCalendar</span>(<span class="title class_ inherited__">AbstractHolidayCalendar</span>):</span><br><span class="line">    rules = [</span><br><span class="line">        Holiday(holiday[<span class="number">0</span>], year=holiday[<span class="number">1</span>], month=holiday[<span class="number">2</span>], day=holiday[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">for</span> holiday <span class="keyword">in</span> holidays</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><h2 id="1-3-Deprecated-í•œêµ­ê±°ë˜ì†Œ-íœ´ì¥ì¼-ì •ë³´ë¥¼-í¬ë¡¤ë§í•˜ì—¬-ì •ì˜í•˜ê¸°"><a href="#1-3-Deprecated-í•œêµ­ê±°ë˜ì†Œ-íœ´ì¥ì¼-ì •ë³´ë¥¼-í¬ë¡¤ë§í•˜ì—¬-ì •ì˜í•˜ê¸°" class="headerlink" title="1.3. (Deprecated) í•œêµ­ê±°ë˜ì†Œ íœ´ì¥ì¼ ì •ë³´ë¥¼ í¬ë¡¤ë§í•˜ì—¬ ì •ì˜í•˜ê¸°"></a>1.3. (Deprecated) í•œêµ­ê±°ë˜ì†Œ íœ´ì¥ì¼ ì •ë³´ë¥¼ í¬ë¡¤ë§í•˜ì—¬ ì •ì˜í•˜ê¸°</h2><blockquote><p>í˜„ì¬ í•œêµ­ê±°ë˜ì†Œ í™ˆí˜ì´ì§€ì˜ ë ˆì´ì•„ì›ƒì´ í¬ìŠ¤íŒ…ì„ ì—…ë¡œë“œ í•  ë‹¹ì‹œì˜ êµ¬ì¡°ì—ì„œ ë§ì´ ê°œì„ &#x2F;ë³€ê²½ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜‚<br>ì´ì— ë”°ë¼, (1.3.) ì„¹ì…˜ì€ í˜„ì¬ ì •ìƒì ìœ¼ë¡œ êµ¬ë™ì´ ë˜ì§€ ì•Šì§€ë§Œ, ì°¸ê³ í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ê¸°ë¡ì„ ë‚¨ê²¨ë‘ì—ˆìŠµë‹ˆë‹¤.</p></blockquote><p>í•œêµ­ê±°ë˜ì†Œ í™ˆí˜ì´ì§€ë¥¼ ì°¾ì•„ë³´ë©´ <a href="http://marketdata.krx.co.kr/mdi#document=01100305">íœ´ì¥ì¼ ë°ì´í„°</a>ê°€ ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ DBë¥¼ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì´ìƒ, ê°€ì¥ ì •í™•í•œ í•œêµ­ê±°ë˜ì†Œ ê°œì¥ì¼ ì •ë³´ê°€ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” KRX í™ˆí˜ì´ì§€ì—ì„œ íœ´ì¥ì¼ ì •ë³´ë¥¼ í¬ë¡¤ë§í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•œ ë’¤, ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìº˜ë¦°ë”ë¥¼ ì •ì˜í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> AbstractHolidayCalendar, Holiday</span><br><span class="line"></span><br><span class="line">results = &#123;&#125;  <span class="comment"># &#123;year: holidays_of_the_year_in_csv_format&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> year <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2009</span>, <span class="number">2024</span>+<span class="number">1</span>):</span><br><span class="line">    res_otp = requests.get(</span><br><span class="line">        <span class="string">&#x27;http://marketdata.krx.co.kr/contents/COM/GenerateOTP.jspx&#x27;</span>,</span><br><span class="line">        params=&#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;fileDown&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;filetype&#x27;</span>: <span class="string">&#x27;csv&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;MKD/01/0110/01100305/mkd01100305_01&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;search_bas_yy&#x27;</span>: year,</span><br><span class="line">        &#125;,</span><br><span class="line">        headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0&#x27;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    otp = res_otp.text</span><br><span class="line">    </span><br><span class="line">    res_csv = requests.post(</span><br><span class="line">        <span class="string">&#x27;http://file.krx.co.kr/download.jspx&#x27;</span>,</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://marketdata.krx.co.kr/mdi&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        data=urllib.parse.urlencode(&#123;<span class="string">&#x27;code&#x27;</span>:otp&#125;)</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    results[year] = res_csv.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holidays = []</span><br><span class="line"><span class="keyword">for</span> year <span class="keyword">in</span> results:</span><br><span class="line">    holidays.extend(</span><br><span class="line">        re.findall(</span><br><span class="line">            <span class="string">r&#x27;.*?\,(\d+)-(\d+)-(\d+)(?:\s\(.*?\))?\,(.*?)\s*\,(.*)&#x27;</span>,</span><br><span class="line">            results[year]</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">holidays = [</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    (&#x27;2020&#x27;, &#x27;01&#x27;, &#x27;27&#x27;, &#x27;ì›”ìš”ì¼&#x27;, &#x27;ì„¤ë‚ (ëŒ€ì²´íœ´ì¼)&#x27;),</span></span><br><span class="line"><span class="string">    (&#x27;2020&#x27;, &#x27;04&#x27;, &#x27;15&#x27;, &#x27;ìˆ˜ìš”ì¼&#x27;, &#x27;21ëŒ€ êµ­íšŒì˜ì›ì„ ê±°&#x27;),</span></span><br><span class="line"><span class="string">    (&#x27;2020&#x27;, &#x27;04&#x27;, &#x27;30&#x27;, &#x27;ëª©ìš”ì¼&#x27;, &#x27;ì„ê°€íƒ„ì‹ ì¼&#x27;),</span></span><br><span class="line"><span class="string">    (&#x27;2020&#x27;, &#x27;05&#x27;, &#x27;01&#x27;, &#x27;ê¸ˆìš”ì¼&#x27;, &#x27;ê·¼ë¡œìì˜ë‚ &#x27;),</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KRTradingCalendar</span>(<span class="title class_ inherited__">AbstractHolidayCalendar</span>):</span><br><span class="line">    rules = [</span><br><span class="line">        Holiday(holiday[<span class="number">4</span>], year=<span class="built_in">int</span>(holiday[<span class="number">0</span>]), month=<span class="built_in">int</span>(holiday[<span class="number">1</span>]), day=<span class="built_in">int</span>(holiday[<span class="number">2</span>]))</span><br><span class="line">        <span class="keyword">for</span> holiday <span class="keyword">in</span> holidays</span><br><span class="line">    ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>íŠ¹ë³„í•œ ì ì€ ì—†ì§€ë§Œ, csv í˜•íƒœì˜ ë°ì´í„°ê°€ 2014ë…„ ì „í›„ë¡œ í¬ë§·ì´ ì•½ê°„ ë‹¤ë¦…ë‹ˆë‹¤. ì´ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆë„ë¡ ì •ê·œí‘œí˜„ì‹ì„ ì˜ íŠœë‹í•´ ì£¼ì–´ì•¼ í•˜ê² ìŠµë‹ˆë‹¤.</p><hr><h1 id="2-pandasì˜-CustomBusinessDay"><a href="#2-pandasì˜-CustomBusinessDay" class="headerlink" title="2. pandasì˜ CustomBusinessDay"></a>2. pandasì˜ <code>CustomBusinessDay</code></h1><p>ìœ„ì˜ ë°©ë²•ë“¤ë¡œ ì •ì˜í•œ ê³µíœ´ì¼ ìº˜ë¦°ë”ëŠ” <code>CustomBusinessDay</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì¸ìë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> CustomBusinessDay</span><br><span class="line"></span><br><span class="line">TDay = TradingDay = CustomBusinessDay(calendar=KRTradingCalendar())</span><br></pre></td></tr></table></figure><p>ì´ë ‡ê²Œ ìƒì„±ëœ <code>TDay</code>ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">TDay.holidays[<span class="number">155</span>:<span class="number">165</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot; ê³µíœ´ì¼ ë¦¬ìŠ¤íŠ¸</span></span><br><span class="line"><span class="string">(numpy.datetime64(&#x27;2020-05-01&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-05-05&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-08-17&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-09-30&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-10-01&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-10-02&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-10-09&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-12-25&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2020-12-31&#x27;),</span></span><br><span class="line"><span class="string"> numpy.datetime64(&#x27;2021-01-01&#x27;))</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) + TDay    <span class="comment"># Timestamp(&#x27;2020-10-07 00:00:00&#x27;)</span></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) + TDay*<span class="number">2</span>  <span class="comment"># Timestamp(&#x27;2020-10-08 00:00:00&#x27;)</span></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) + TDay*<span class="number">3</span>  <span class="comment"># Timestamp(&#x27;2020-10-12 00:00:00&#x27;)</span></span><br><span class="line">                                     <span class="comment"># ê³µíœ´ì¼(9ì¼)ê³¼ ì£¼ë§(10~11ì¼)ì„ ìŠ¤í‚µ</span></span><br><span class="line"></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) - TDay    <span class="comment"># Timestamp(&#x27;2020-10-05 00:00:00&#x27;)</span></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) - TDay*<span class="number">2</span>  <span class="comment"># Timestamp(&#x27;2020-09-29 00:00:00&#x27;)</span></span><br><span class="line">                                     <span class="comment"># ì£¼ë§(3~4ì¼)ê³¼ ê³µíœ´ì¼(9ì›” 30ì¼~10ì›” 2ì¼)ì„ ìŠ¤í‚µ</span></span><br><span class="line"></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">6</span>) + TDay - TDay <span class="comment"># Timestamp(&#x27;2020-10-06 00:00:00&#x27;)</span></span><br><span class="line">                                         <span class="comment"># ì£¼ì–´ì§„ ì¼ìê°€ ì˜ì—…ì¼ì¸ ê²½ìš°, í•´ë‹¹ ì¼ì ë°˜í™˜</span></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">1</span>) + TDay - TDay <span class="comment"># Timestamp(&#x27;2020-09-29 00:00:00&#x27;)</span></span><br><span class="line">                                         <span class="comment"># ì£¼ì–´ì§„ ì¼ìê°€ ì˜ì—…ì¼ì´ ì•„ë‹ ê²½ìš°,</span></span><br><span class="line">                                         <span class="comment"># í•´ë‹¹ ì¼ìì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ *ì´ì „* ì˜ì—…ì¼</span></span><br><span class="line">datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">1</span>) - TDay + TDay <span class="comment"># Timestamp(&#x27;2020-10-05 00:00:00&#x27;)</span></span><br><span class="line">                                         <span class="comment"># ì£¼ì–´ì§„ ì¼ìê°€ ì˜ì—…ì¼ì´ ì•„ë‹ ê²½ìš°,</span></span><br><span class="line">                                         <span class="comment"># í•´ë‹¹ ì¼ìì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ *ì´í›„* ì˜ì—…ì¼</span></span><br><span class="line"></span><br><span class="line">pd.date_range(<span class="string">&#x27;2020-10-01&#x27;</span>, <span class="string">&#x27;2020-10-31&#x27;</span>, freq=TDay)</span><br><span class="line">pd.bdate_range(<span class="string">&#x27;2020-10-01&#x27;</span>, <span class="string">&#x27;2020-10-31&#x27;</span>, freq=TDay)</span><br><span class="line"><span class="string">&quot;&quot;&quot; ê³µíœ´ì¼ì„ ì œì™¸í•œ ê¸°ê°„ ë‚´ ì˜ì—…ì¼</span></span><br><span class="line"><span class="string">DatetimeIndex([&#x27;2020-10-05&#x27;, &#x27;2020-10-06&#x27;, &#x27;2020-10-07&#x27;, &#x27;2020-10-08&#x27;,</span></span><br><span class="line"><span class="string">               &#x27;2020-10-12&#x27;, &#x27;2020-10-13&#x27;, &#x27;2020-10-14&#x27;, &#x27;2020-10-15&#x27;,</span></span><br><span class="line"><span class="string">               &#x27;2020-10-16&#x27;, &#x27;2020-10-19&#x27;, &#x27;2020-10-20&#x27;, &#x27;2020-10-21&#x27;,</span></span><br><span class="line"><span class="string">               &#x27;2020-10-22&#x27;, &#x27;2020-10-23&#x27;, &#x27;2020-10-26&#x27;, &#x27;2020-10-27&#x27;,</span></span><br><span class="line"><span class="string">               &#x27;2020-10-28&#x27;, &#x27;2020-10-29&#x27;, &#x27;2020-10-30&#x27;],</span></span><br><span class="line"><span class="string">              dtype=&#x27;datetime64[ns]&#x27;, freq=&#x27;C&#x27;)  # freq=&#x27;C&#x27;ëŠ” &#x27;CustomBusinessDay&#x27;ë¥¼ ì˜ë¯¸</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">np.busday_count(</span><br><span class="line">  <span class="string">&#x27;2020-10-01&#x27;</span>, <span class="string">&#x27;2020-10-31&#x27;</span>,</span><br><span class="line">  weekmask=TDay.weekmask,</span><br><span class="line">  holidays=TDay.holidays</span><br><span class="line">)</span><br><span class="line"><span class="string">&quot;&quot;&quot; ê³µíœ´ì¼ì„ ì œì™¸í•œ ë‘ ì¼ì ê°„ ì˜ì—…ì¼ìˆ˜</span></span><br><span class="line"><span class="string">19</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><code>TDay</code>ì— ì˜í•´ ë³€ê²½ëœ ê²°ê³¼ê°’ì˜ íƒ€ì…ì´ <code>pandas._libs.tslibs.timestamps.Timestamp</code>ì¸ ì ì„ ì¸ì§€í•˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. <code>datetime.date</code> ì¸ìŠ¤í„´ìŠ¤ê°€ ë“¤ì–´ê°€ì•¼ í•˜ëŠ” ìœ„ì¹˜ì— <code>Timestamp</code> ì¸ìŠ¤í„´ìŠ¤ê°€ ë“¤ì–´ê°€ëŠ” ê²½ìš°, ê°€ë”ì”© type mismatchì— ì˜í•œ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆë¥¼ ë“¤ë©´, <code>&#39;Timestamp&#39; object has no attribute &#39;...&#39;</code>) ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ”, <code>Timestamp</code>ì˜ <code>to_pydatetime()</code> methodë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">5</span>))  <span class="comment"># datetime.date</span></span><br><span class="line"><span class="built_in">type</span>(datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">5</span>) + TDay)  <span class="comment"># pandas._libs.tslibs.timestamps.Timestamp</span></span><br><span class="line"><span class="built_in">type</span>((datetime.date(<span class="number">2020</span>, <span class="number">10</span>, <span class="number">5</span>) + TDay).to_pydatetime())  <span class="comment"># datetime.datetime</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0-Introduction&quot;&gt;&lt;a href=&quot;#0-Introduction&quot; class=&quot;headerlink&quot; title=&quot;0. Introduction&quot;&gt;&lt;/a&gt;0. Introduction&lt;/h1&gt;&lt;p&gt;Pythonì„ ì‚¬ìš©í•´ì„œ ê¸ˆìœµ ì‹œê³„ì—´ ë¶„ì„ì„ í•˜ë‹¤ë³´ë©´, datetimeê³¼ ê´€ë ¨í•œ ì²˜ë¦¬ê°€ ê¹Œë‹¤ë¡œìš´ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ, íœ´ì¼ ë° ê³µíœ´ì¼ ë“±ì„ ê³„ì‚°í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. Python pandas ë¼ì´ë¸ŒëŸ¬ë¦¬ì— business day ê°œë…ì´ ìˆê¸°ëŠ” í•˜ì§€ë§Œ (ê¸°ë³¸ì ìœ¼ë¡œëŠ”) ì£¼ë§ì„ ì œì™¸í•œ ê³µíœ´ì¼ì„ ì œëŒ€ë¡œ ê³ ë ¤í•˜ì§€ ëª»í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;img src=&quot;/images/2020-10-say-datetime-one-more-time.jpg&quot; class=&quot;datetime anger&quot; width=&quot;500&quot; title=&quot;datetime anger&quot;&gt;

&lt;p&gt;ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ, pandasì—ì„œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ë³¸ í¬ìŠ¤íŒ…ì€ í•´ë‹¹ ë‚´ìš©ì„ ê³µë¶€í•˜ë©° ì •ë¦¬í•œ ê¸€ ì…ë‹ˆë‹¤. ê¸€ì˜ ë‚´ìš© ì¤‘ ì˜ëª» ëœ ë¶€ë¶„ì´ ìˆëŠ” ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. :)&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
    <category term="Pandas" scheme="https://hwangheek.github.io/tags/Pandas/"/>
    
    <category term="System Trading" scheme="https://hwangheek.github.io/tags/System-Trading/"/>
    
  </entry>
  
  <entry>
    <title>Pandasë¥¼ ì´ìš©í•˜ì—¬ í‹±ë°ì´í„° ê°€ê³µí•˜ê¸°</title>
    <link href="https://hwangheek.github.io/2020/pandas-tick-data/"/>
    <id>https://hwangheek.github.io/2020/pandas-tick-data/</id>
    <published>2020-04-20T04:34:30.000Z</published>
    <updated>2022-07-23T14:39:52.359Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-Introduction"><a href="#0-Introduction" class="headerlink" title="0. Introduction"></a>0. Introduction</h1><p>ì²´ê²° ë°ì´í„°(í‹±ë°ì´í„°)ë¥¼ ì‚¬ìš©í•  ë•Œ, ë°ì´í„°ê°€ ì§€ë‚˜ì¹˜ê²Œ rawí•´ì„œ ìƒê¸°ëŠ” ë‚œê°í•œ ë¶€ë¶„ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ â€œë¶„ë´‰â€ì´ë‚˜ â€œì¼ë´‰â€ì²˜ëŸ¼, ì¼ì •í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì²´ê²°ë‚´ì—­ì„ groupingí•˜ëŠ” ì „ì²˜ë¦¬ ë°©ë²•ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²•ì˜ ì¥ë‹¨ì ì€ ë¬´ì—‡ì¼ê¹Œìš”? í˜¹ì‹œ ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œìš”? ì–´ë–»ê²Œ êµ¬í˜„ì„ í•´ì•¼ í• ê¹Œìš”?</p><p><strong>Marcos Lopez de Pradoì˜ ì €ì„œ <em>Advances in Financial Machine Learning</em></strong>ì— ìœ„ ì§ˆë¬¸ë“¤ì— ëŒ€í•œ ë‹µë³€ì´ ì •ë¦¬ê°€ ì˜ ë˜ì–´ìˆìŠµë‹ˆë‹¤. <strong>ì´ë²ˆ í¬ìŠ¤íŒ…ì€ í•´ë‹¹ ì„œì ì˜ â€œ2.3 Financial Data Structures: Barsâ€ ì±•í„°ë¥¼ ê³µë¶€í•˜ë©° ì´í•´í•œ ë‚´ìš©ì„ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</strong> ì›Œë‚™ ìœ ëª…í•œ ì €ì„œì¸ì§€ë¼, ì±…ì˜ ë‚´ìš©ì— ëŒ€í•œ êµ¬í˜„ì„ ì •ë¦¬í•´ë†“ì€ <a href="https://github.com/hudson-and-thames/mlfinlab">github repo</a>ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ëª¨ë“ˆí™”ë¥¼ ìœ„í•´ ë¡œì§ì´ í©ì–´ì ¸ìˆì–´ì„œ ì´í•´í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì•„, Python pandasë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ êµ¬í˜„ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p>í¬ìŠ¤íŒ…ì˜ ë‚´ìš© í˜¹ì€ ì½”ë“œì— ê°œì„ ì´ í•„ìš”í•œ ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. :)</p><span id="more"></span><hr><p>ì‹œì‘í•˜ê¸°ì— ì•ì„œ, ì²´ê²°ì‹œê°($t$)ê³¼ ì²´ê²°ê°€ê²©($p_t$, <code>price</code>), ì²´ê²°ëŸ‰($v_t$, <code>volume</code>)ìœ¼ë¡œ ì´ë£¨ì–´ì§„ <strong>í‹± ë°ì´í„°</strong>ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŠ¹ë³„í•œ ë¹„ìš© ì—†ì´ë„ ì¦ê¶Œì‚¬ë‚˜ ì•”í˜¸í™”í ê±°ë˜ì†Œ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì´ë² ìŠ¤íŠ¸ì¦ê¶Œ APIë¥¼ í†µí•´ ë°›ì€ 2020ë…„ 3ì›” 25ì¼ ì‚¼ì„±ì „ì(005930)ì˜ í‹±ë°ì´í„°ì…ë‹ˆë‹¤. ì¶”í›„ ê³„ì‚° í¸ì˜ë¥¼ ìœ„í•˜ì—¬ ê±°ë˜ëŒ€ê¸ˆ($a_t$, <code>value</code>)ì„ $p_t\cdot v_t$ë¡œ ë¯¸ë¦¬ ê³„ì‚°í•˜ì˜€ê³ , ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©ëœ ì²´ê²°ì‹œê°ì„ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í–ˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung = get_ticks(<span class="string">&#x27;005930&#x27;</span>, <span class="string">&#x27;20200325&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung[<span class="string">&#x27;value&#x27;</span>] = samsung[<span class="string">&#x27;price&#x27;</span>] * samsung[<span class="string">&#x27;volume&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung</span><br><span class="line">t                    price  volume       value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02  <span class="number">46950</span>      <span class="number">10</span>      <span class="number">469500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:05  <span class="number">46950</span>      <span class="number">66</span>     <span class="number">3098700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">10</span>  <span class="number">46950</span>       <span class="number">3</span>      <span class="number">140850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">12</span>  <span class="number">46950</span>      <span class="number">87</span>     <span class="number">4084650</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">21</span>  <span class="number">46950</span>      <span class="number">43</span>     <span class="number">2018850</span></span><br><span class="line"><span class="meta">... </span>                   ...     ...         ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">20</span>:06  <span class="number">48800</span>   <span class="number">20422</span>   <span class="number">996593600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">30</span>:<span class="number">28</span>  <span class="number">48850</span>   <span class="number">20486</span>  <span class="number">1000741100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">40</span>:<span class="number">28</span>  <span class="number">48850</span>   <span class="number">23020</span>  <span class="number">1124527000</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">50</span>:<span class="number">12</span>  <span class="number">49000</span>   <span class="number">56124</span>  <span class="number">2750076000</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">15</span>  <span class="number">49050</span>   <span class="number">43268</span>  <span class="number">2122295400</span></span><br><span class="line">[<span class="number">226285</span> rows x <span class="number">3</span> columns]</span><br></pre></td></tr></table></figure><p>ìš°ë¦¬ì˜ ëª©í‘œëŠ” ìœ„ ë°ì´í„°ë¥¼ ì´í•´í•˜ê¸° ì‰½ê³  ì‚¬ìš©í•˜ê¸° í¸í•œ (ì¼ì¢…ì˜) í…Œì´ë¸” í˜•íƒœë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í…Œì´ë¸”ì˜ í–‰(row)ì„ <strong>â€œbarâ€</strong> ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” barë¥¼ ì¶”ì¶œí•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p><hr><h1 id="1-Standard-Bars"><a href="#1-Standard-Bars" class="headerlink" title="1. Standard Bars"></a>1. Standard Bars</h1><h2 id="1-1-Time-bars"><a href="#1-1-Time-bars" class="headerlink" title="1.1. Time bars"></a>1.1. Time bars</h2><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><p><strong>ì¼ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•</strong>ìœ¼ë¡œ, í”íˆ ì ‘í•˜ëŠ” â€œë¶„ë´‰â€, â€œì¼ë´‰â€ ë“±ì´ ì´ì— ì†í•©ë‹ˆë‹¤. ì‹œê°„ íë¦„ì— ë”°ë¥¸ ê°€ê²©ê³¼ ìˆ˜ê¸‰ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ì„œ ê°€ì¥ ì§ê´€ì ì¸ ë°ì´í„° í˜•íƒœì´ì§€ë§Œ, ëª‡ ê°€ì§€ ë¬¸ì œì ë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ì‹œì¥ì´ ì¼ì •í•œ ì‹œê°„ ë‹¨ìœ„ë¡œ ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¼ì •í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•  ê²½ìš°, ê±°ë˜ê°€ í™œë°œí•˜ì§€ ì•Šì€ ì‹œê¸°ì—ëŠ” ë°ì´í„°ê°€ oversample ë˜ê³ , ê±°ë˜ê°€ í™œë°œí•œ ì‹œê¸°ì—ëŠ” undersample ë˜ëŠ” ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤.</li><li>ì¼ì •í•œ ì‹œê°„ìœ¼ë¡œ ì¶”ì¶œëœ ì‹œê³„ì—´ ë°ì´í„°ì˜ í†µê³„ íŠ¹ì„±(i.e. serial correlation, heteroscedasticity, non-normality of returns)ì´ ì¢‹ì§€ ì•Šì€ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</li></ol><p>ì´ëŸ¬í•œ ë¬¸ì œë“¤ì€ (ì•ìœ¼ë¡œ ì†Œê°œ ë ) ê±°ë˜ ë‚´ì—­ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì„ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p>ì‹œê³„ì—´ DataFrame(DataFrame with datetime-like index)ì—ëŠ” ì£¼ì–´ì§„ ê·œì¹™ì— ë”°ë¼ ë°ì´í„°ë¥¼ ì •ë ¬ í•  ìˆ˜ ìˆëŠ” <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.resample.html"><code>resample</code></a> methodê°€ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.resample.Resampler.ohlc.html"><code>Resampler.ohlc</code></a>ì™€ ê°™ì´ ì‚¬ìš©í•˜ë©´, í‹± ë°ì´í„°ë¥¼ ì‰½ê²Œ timebarë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timebar</span>(<span class="params">tick, rule</span>):</span><br><span class="line">    resample = tick.resample(rule)</span><br><span class="line">    </span><br><span class="line">    bars = resample[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ê±°ë˜ê°€ ì¼ì–´ë‚˜ì§€ ì•Šì€ ì‹œê°„ì˜ NaN ì²˜ë¦¬</span></span><br><span class="line">    bars[<span class="string">&#x27;close&#x27;</span>] = bars[<span class="string">&#x27;close&#x27;</span>].fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line">    bars[<span class="string">&#x27;open&#x27;</span>]  = bars[<span class="string">&#x27;open&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    bars[<span class="string">&#x27;high&#x27;</span>]  = bars[<span class="string">&#x27;high&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    bars[<span class="string">&#x27;low&#x27;</span>]  = bars[<span class="string">&#x27;low&#x27;</span>].fillna(bars[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = resample[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar(samsung, <span class="string">&#x27;30s&#x27;</span>)</span><br><span class="line">t                       <span class="built_in">open</span>     high      low    close  volume       value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>     <span class="number">166</span>     <span class="number">7793700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:<span class="number">30</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">43</span>     <span class="number">2018850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">31</span>:<span class="number">30</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">31</span>     <span class="number">1455450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">32</span>:<span class="number">00</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>  <span class="number">46950.0</span>      <span class="number">75</span>     <span class="number">3521250</span></span><br><span class="line"><span class="meta">... </span>                     ...      ...      ...      ...     ...         ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">58</span>:<span class="number">00</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">58</span>:<span class="number">30</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">59</span>:<span class="number">00</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">59</span>:<span class="number">30</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>  <span class="number">49000.0</span>       <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>  <span class="number">49050.0</span>   <span class="number">43268</span>  <span class="number">2122295400</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1141</span> rows x <span class="number">6</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar(samsung, <span class="string">&#x27;1H&#x27;</span>)</span><br><span class="line">t                     <span class="built_in">open</span>   high    low  close    volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">00</span>:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>       <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48900</span>  <span class="number">49600</span>  <span class="number">47550</span>  <span class="number">48050</span>  <span class="number">19104046</span>  <span class="number">930657231400</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48050</span>  <span class="number">48700</span>  <span class="number">47900</span>  <span class="number">48350</span>   <span class="number">6251831</span>  <span class="number">302241758300</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">11</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48350</span>  <span class="number">48450</span>  <span class="number">47800</span>  <span class="number">48300</span>   <span class="number">4902528</span>  <span class="number">235849172200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48250</span>  <span class="number">48450</span>  <span class="number">48000</span>  <span class="number">48150</span>   <span class="number">2985362</span>  <span class="number">143843200950</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">13</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48100</span>  <span class="number">48200</span>  <span class="number">47150</span>  <span class="number">48100</span>   <span class="number">6703650</span>  <span class="number">320201734850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48100</span>  <span class="number">48900</span>  <span class="number">47550</span>  <span class="number">48800</span>   <span class="number">7213952</span>  <span class="number">347588903150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">48900</span>  <span class="number">48450</span>  <span class="number">48650</span>   <span class="number">5089598</span>  <span class="number">247668090050</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48600</span>  <span class="number">48700</span>  <span class="number">48550</span>  <span class="number">48700</span>     <span class="number">88125</span>    <span class="number">4285782150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">49000</span>  <span class="number">48800</span>  <span class="number">49000</span>    <span class="number">172326</span>    <span class="number">8422908900</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>     <span class="number">43268</span>    <span class="number">2122295400</span></span><br></pre></td></tr></table></figure><h2 id="1-2-Tick-bars"><a href="#1-2-Tick-bars" class="headerlink" title="1.2. Tick bars"></a>1.2. Tick bars</h2><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><p><strong>ì¼ì •í•œ ìˆ˜ì˜ ì²´ê²°ì´ ë°œìƒí•˜ì˜€ì„ ë•Œë§ˆë‹¤ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•</strong>ì…ë‹ˆë‹¤. ì²´ê²°ì´ ë§ì´ ì¼ì–´ë‚˜ëŠ” ì‹œì ì—ëŠ” ë” ë§ì€ barê°€ ì¶”ì¶œë˜ê¸° ë•Œë¬¸ì—, ì‹œì¥ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì •ë³´ì˜ ì†ë„ë¥¼ time barë³´ë‹¤ ì˜ ë°˜ì˜í•©ë‹ˆë‹¤. ë˜í•œ, tick barë¡œ ê³„ì‚°ë˜ëŠ” ìˆ˜ìµë¥ ($r_i$)ì´ iid ì •ê·œë¶„í¬ì— ë” ê°€ê¹ë‹¤ëŠ” ì—°êµ¬ë„ ìˆìŠµë‹ˆë‹¤. (<em>Ane &amp; Geman, 2000</em>)</p><p>í•˜ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ì ë“¤ì´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>ë‹¤ìˆ˜ì˜ ì£¼ë¬¸ë“¤ì´ í•œë²ˆì— ì²´ê²°ë˜ëŠ” ê²½ìš° outlierê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¥ ë§ˆê° ì „ ë™ì‹œí˜¸ê°€ ì‹œê°„(15:20~15:30)ì—ëŠ” ì£¼ë¬¸ì´ ì²´ê²°ë˜ì§€ ì•Šê³  ëˆ„ì ë˜ë‹¤ê°€, 15:30ë¶„ì— ì£¼ë¬¸ë“¤ì´ í•œë²ˆì— ì²´ê²°ë˜ë©° í•˜ë‚˜ì˜ í‹±ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë©ë‹ˆë‹¤. í•˜ë‚˜ì˜ í‹±ì´ ìˆ˜ë§ì€ ì²´ê²°ì„ í¬í•¨í•˜ê³  ìˆëŠ” ì…ˆì…ë‹ˆë‹¤.</li><li>ë°˜ëŒ€ë¡œ, í•˜ë‚˜ì˜ ì£¼ë¬¸ì´ ì—¬ëŸ¬ë²ˆì— ê±¸ì³ ì²´ê²°ì´ ë˜ëŠ” ê²½ìš°ë„ ë¬¸ì œê°€ ë©ë‹ˆë‹¤. (a.k.a. â€œorder fragmentationâ€) ì •ìƒì ì¸ ì£¼ë¬¸ì— ì˜í•œ ë‹¤ìˆ˜ì˜ ì²´ê²°ì¸ ê²½ìš°ì—ëŠ” ìƒê´€ ì—†ì„ ìˆ˜ ìˆì§€ë§Œ, íŠ¸ë ˆì´ë”© ë´‡ì— ì˜í•œ ê²½ìš°ë‚˜ (ìš´ìš©&#x2F;ê°œë°œ í¸ì˜ë¥¼ ìœ„í•´) ì²´ê²° ì—”ì§„ì— ì˜í•œ ê²½ìš°ì—ëŠ” ë°ì´í„°ì— ì™œê³¡ì´ ìƒê¸¸ ìš°ë ¤ê°€ ìˆìŠµë‹ˆë‹¤.</li></ol><h3 id="Implementation-1"><a href="#Implementation-1" class="headerlink" title="Implementation"></a>Implementation</h3><p>Tick barëŠ” time barì™€ ë¹„ìŠ·í•œ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ì „ê³¼ëŠ” ë‹¤ë¥´ê²Œ, ì²´ê²° ì‹œê°ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ resampling í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ, ìƒˆë¡œìš´ ì¸ë±ìŠ¤(<code>window_number</code>)ë¥¼ ì¶”ê°€í•œ ë’¤ <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code>groupby()</code></a> methodë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë¬¶ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tickbar</span>(<span class="params">tick, window_size</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = np.arange(<span class="built_in">len</span>(tick)) // window_size</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tickbar(samsung, <span class="number">10</span>)</span><br><span class="line">t                     <span class="built_in">open</span>   high    low  close  volume        value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">315</span>     <span class="number">14789250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">32</span>:<span class="number">37</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">338</span>     <span class="number">15869100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">35</span>:<span class="number">51</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>     <span class="number">255</span>     <span class="number">11972250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>  <span class="number">48900</span>  <span class="number">48950</span>  <span class="number">48900</span>  <span class="number">48900</span>    <span class="number">3150</span>    <span class="number">154048850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>  <span class="number">48900</span>  <span class="number">48950</span>  <span class="number">48900</span>  <span class="number">48950</span>    <span class="number">9649</span>    <span class="number">471903050</span></span><br><span class="line"><span class="meta">... </span>                   ...    ...    ...    ...     ...          ...</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">11</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>     <span class="number">630</span>     <span class="number">30649500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">26</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48650</span>    <span class="number">2275</span>    <span class="number">110678750</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">15</span>:<span class="number">59</span>:<span class="number">40</span>  <span class="number">48650</span>  <span class="number">48650</span>  <span class="number">48600</span>  <span class="number">48600</span>   <span class="number">15808</span>    <span class="number">768327150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">23</span>  <span class="number">48600</span>  <span class="number">49000</span>  <span class="number">48550</span>  <span class="number">49000</span>  <span class="number">245810</span>  <span class="number">11997138450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">15</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>  <span class="number">49050</span>   <span class="number">43268</span>   <span class="number">2122295400</span></span><br><span class="line"></span><br><span class="line">[<span class="number">22709</span> rows x <span class="number">6</span> columns]</span><br></pre></td></tr></table></figure><h2 id="1-3-Volume-bars"><a href="#1-3-Volume-bars" class="headerlink" title="1.3. Volume bars"></a>1.3. Volume bars</h2><h3 id="Definition-2"><a href="#Definition-2" class="headerlink" title="Definition"></a>Definition</h3><p><strong>ì¼ì •í•œ ìˆ˜ì¤€ì˜ ê±°ë˜ëŸ‰ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</strong> ê±°ë˜ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê¸° ë•Œë¬¸ì—, order fragmentationì— ì˜í•´ ë°ì´í„°ê°€ ì™œê³¡ë˜ëŠ” tick barì˜ ë¬¸ì œì ì„ ì–´ëŠì •ë„ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Tick barë¡œ ê³„ì‚°ë˜ëŠ” ìˆ˜ìµë¥ ë³´ë‹¤ volume barë¡œ ê³„ì‚°ë˜ëŠ” ìˆ˜ìµë¥ ì´ iid ì •ê·œë¶„í¬ì— ë” ê°€ê¹ë‹¤ëŠ” ì—°êµ¬ë„ ìˆìŠµë‹ˆë‹¤. (<em>Clark, 1973</em>) ì´ë¿ë§Œ ì•„ë‹ˆë¼, ê°€ê²©ê³¼ ê±°ë˜ëŸ‰ì˜ ìƒí˜¸ì‘ìš©ì— ëŒ€í•œ ì‹œì¥ ë¯¸ì‹œêµ¬ì¡° ì´ë¡ ë“¤ì„ ì ìš©í•˜ê¸°ì—ë„ ìš©ì´í•©ë‹ˆë‹¤.</p><p>ë‹¤ë§Œ, â€œê±°ë˜ëŸ‰ í•˜ë‚˜â€ì˜ ê°€ì¹˜ê°€ ì‹œì¥ì˜ ì—¬ëŸ¬ ìš”ì¸ë“¤ì— ì˜í•´ ì§€ì†ì ìœ¼ë¡œ ë³€í•œë‹¤ëŠ” ì ì„ ê°ì•ˆí•´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê°€ê²© ë³€ë™ì´ í° ë°ì´í„°(ex. ì•”í˜¸í™”í)ë¥¼ ì‚¬ìš©í•˜ì—¬ volume barë¥¼ ì¶”ì¶œ í•  ê²½ìš°, ê° barì˜ â€œê°€ì¹˜â€ ì°¨ì´ê°€ í´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ê²©ì˜ ë³€ë™ ë¿ë§Œ ì•„ë‹ˆë¼, ìœ í†µ ì£¼ì‹ìˆ˜ì— ì˜í–¥ì„ ì£¼ëŠ” ì´ë²¤íŠ¸(ì£¼ì‹ë°œí–‰, ì•¡ë©´ ë³‘í•©&#x2F;ë¶„í• , ìì‚¬ì£¼ ë§¤ì… ë“±)ë„ ë‹¨ìœ„ ê±°ë˜ëŸ‰ì˜ ê°€ì¹˜ë¥¼ ë³€ë™ì‹œí‚¬ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.</p><h3 id="Naive-Implementation"><a href="#Naive-Implementation" class="headerlink" title="(Naive) Implementation"></a>(Naive) Implementation</h3><p>ëª¨ë“  barê°€ (ì •í™•í•˜ê²Œ) ë™ì¼í•œ ë‹¨ìœ„ ê±°ë˜ëŸ‰ì„ ê°€ì§€ë„ë¡ volume barë¥¼ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” iterationì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤. (ëˆ„ì  ê±°ë˜ëŸ‰ì´ ë‹¨ìœ„ ê±°ë˜ëŸ‰ì„ ë„˜ì–´ê°€ëŠ” ìˆœê°„, í•˜ë‚˜ì˜ í‹±ì„ ì—¬ëŸ¬ê°œë¡œ ë‚˜ëˆ ì•¼ í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.) ì´ ê²½ìš°, numpyì˜ íš¨ìœ¨ì ì¸ í¼í¬ë¨¼ìŠ¤ë¥¼ ì¶©ë¶„íˆ í™œìš©í•˜ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤.</p><p>Tick barë¥¼ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì„ ì‘ìš©í•˜ë©´, volume barë¥¼ approximate í•  ìˆ˜ ìˆëŠ” barë¥¼ ì•„ë˜ì™€ ê°™ì´ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ìœ„ ê±°ë˜ëŸ‰ì´ ì»¤ì§ˆìˆ˜ë¡, ì•„ë˜ì˜ ë°©ë²•ìœ¼ë¡œ ê³„ì‚° ëœ barëŠ” volume barì™€ ìœ ì‚¬í•´ì§‘ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">naive_volumebar</span>(<span class="params">tick, unit_volume</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = tick[<span class="string">&#x27;volume&#x27;</span>].cumsum() // unit_volume</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>naive_volumebar(samsung, <span class="number">500_000</span>).head(<span class="number">10</span>)</span><br><span class="line">t                           <span class="built_in">open</span>   high    low  close   volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02+09:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>      <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>  <span class="number">48950</span>  <span class="number">48500</span>  <span class="number">48750</span>  <span class="number">2999031</span>  <span class="number">146769006600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">36</span>+09:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48500</span>   <span class="number">499415</span>   <span class="number">24269779250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:07+09:<span class="number">00</span>  <span class="number">48450</span>  <span class="number">48800</span>  <span class="number">48450</span>  <span class="number">48750</span>   <span class="number">500462</span>   <span class="number">24323620400</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:<span class="number">47</span>+09:<span class="number">00</span>  <span class="number">48750</span>  <span class="number">49000</span>  <span class="number">48700</span>  <span class="number">49000</span>   <span class="number">480488</span>   <span class="number">23495366100</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:02:<span class="number">32</span>+09:<span class="number">00</span>  <span class="number">49000</span>  <span class="number">49250</span>  <span class="number">49000</span>  <span class="number">49250</span>   <span class="number">517832</span>   <span class="number">25422146200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:08+09:<span class="number">00</span>  <span class="number">49250</span>  <span class="number">49500</span>  <span class="number">49200</span>  <span class="number">49500</span>   <span class="number">501844</span>   <span class="number">24769576200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:<span class="number">55</span>+09:<span class="number">00</span>  <span class="number">49500</span>  <span class="number">49600</span>  <span class="number">49450</span>  <span class="number">49500</span>   <span class="number">498855</span>   <span class="number">24702622450</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:04:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">49500</span>  <span class="number">49600</span>  <span class="number">49250</span>  <span class="number">49400</span>   <span class="number">501011</span>   <span class="number">24745938700</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:05:<span class="number">46</span>+09:<span class="number">00</span>  <span class="number">49400</span>  <span class="number">49500</span>  <span class="number">49300</span>  <span class="number">49350</span>   <span class="number">500149</span>   <span class="number">24708946850</span></span><br></pre></td></tr></table></figure><p>ê±°ë˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì ê²Œ ì¼ì–´ë‚˜ëŠ” ì¢…ê°€ë§¤ë§¤ ì‹œê°„(08:30)ê³¼ ì‹œê°€ë‹¨ì¼ê°€ ì£¼ë¬¸ì´ í•œë²ˆì— ì²´ê²°ë˜ëŠ” ì¥ ê°œì‹œ ì‹œì (09:00)ì„ ì œì™¸í•˜ë©´, ê±°ë˜ëŸ‰ì´ 50ë§Œì£¼ì— ê°€ê¹ê²Œ barë“¤ì´ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì°¸ê³ ë¡œ <code>500_000</code>ì—ì„œ underscore(<code>_</code>)ëŠ” ê°€ë…ì„±ì„ ìœ„í•˜ì—¬ ìë¦¿ìˆ˜ë¥¼ ë‚˜ëˆ„ì–´ ì£¼ëŠ” ì—­í• ì„ í•˜ê³ , ì‹¤ì œ ê°’ì€ <code>500000</code>ê³¼ ë™ì¼í•©ë‹ˆë‹¤. (<a href="https://www.python.org/dev/peps/pep-0515/">PEP-515</a>)</p><h2 id="1-4-Dollar-bars"><a href="#1-4-Dollar-bars" class="headerlink" title="1.4. Dollar bars"></a>1.4. Dollar bars</h2><h3 id="Definition-3"><a href="#Definition-3" class="headerlink" title="Definition"></a>Definition</h3><p><strong>ì¼ì •í•œ ìˆ˜ì¤€ì˜ ê±°ë˜ëŒ€ê¸ˆì´ ëˆ„ì  ë  ë•Œë§ˆë‹¤ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•</strong>ì…ë‹ˆë‹¤. ì‹¤ì œ ê±°ë˜ë˜ëŠ” í˜„ê¸ˆì˜ ì–‘ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì—, volume barì— ë¹„í•´ ê°€ê²©ë³€ë™, ì£¼ì‹ë°œí–‰, ì•¡ë©´ ë³‘í•©&#x2F;ë¶„í• , ìì‚¬ì£¼ ë§¤ì… ë“±ì˜ ì´ë²¤íŠ¸ì— ëŒ€í•´ robustí•˜ê³ , ë‹¨ìœ„ ê±°ë˜ëŸ‰ì˜ ê°€ì¹˜ ë³€í™”ì— ì¡°ê¸ˆ ë” consistent í•©ë‹ˆë‹¤.</p><p><img src="/images/2019-04-pandas-tick-data-snpf.png"></p><p>ìœ„ ê·¸ë¦¼ì€ E-mini S&amp;P 500 ì„ ë¬¼ í‹± ë°ì´í„°ë¥¼ tick bar, volume bar, dollar barë¡œ ê³„ì‚°í•œ ë’¤, í•˜ë£¨ì— ë°œìƒí•˜ëŠ” barì˜ ê°œìˆ˜ë¥¼ ë‚˜íƒ€ë‚¸ ê·¸ë˜í”„ì…ë‹ˆë‹¤.(<em>Lopez de Prado, 2018</em>) ë‹¤ë¥¸ ë°ì´í„°ì— ë¹„í•´ì„œ dollar barê°€ ë” consistentí•˜ê²Œ ì¶”ì¶œë˜ëŠ” ê²½í–¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ë‚˜ì•„ê°€ì„œ, ê° barë¥¼ ì¶”ì¶œí•˜ëŠ” ë‹¨ìœ„ ê±°ë˜ëŒ€ê¸ˆì˜ í¬ê¸°ë¥¼ ìœ ë™ì ìœ¼ë¡œ ì¡°ì ˆí•˜ì—¬(ex. ìœ ë™ì‹œê°€ì´ì•¡ì— ë¹„ë¡€í•˜ëŠ” ë‹¨ìœ„), ë³´ë‹¤ ë” consistentí•œ ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p><h3 id="Naive-Implementation-1"><a href="#Naive-Implementation-1" class="headerlink" title="(Naive) Implementation"></a>(Naive) Implementation</h3><p>ê±°ë˜ëŸ‰ ë˜ëŠ” ê±°ë˜ëŒ€ê¸ˆì„ ê¸°ì¤€ìœ¼ë¡œ barë¥¼ ì¶”ì¶œí•œë‹¤ëŠ” ì ë§Œ ì œì™¸í•˜ë©´, dollar barëŠ” volume barì™€ ê°™ì€ ë¡œì§ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. Volume barì˜ êµ¬í˜„ì„ ì°¸ê³ í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">naive_dollarbar</span>(<span class="params">tick, unit_value</span>):</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;window_number&#x27;</span>] = tick[<span class="string">&#x27;value&#x27;</span>].cumsum() // unit_value</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;window_number&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">    </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>naive_dollarbar(samsung, <span class="number">50_000_000_000</span>).head(<span class="number">10</span>)</span><br><span class="line">t                           <span class="built_in">open</span>   high    low  close   volume         value</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 08:<span class="number">30</span>:02+09:<span class="number">00</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>  <span class="number">46950</span>      <span class="number">908</span>      <span class="number">42630600</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>  <span class="number">48950</span>  <span class="number">48500</span>  <span class="number">48800</span>  <span class="number">3058052</span>  <span class="number">149640289350</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">40</span>+09:<span class="number">00</span>  <span class="number">48500</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48850</span>  <span class="number">1025849</span>   <span class="number">49868417850</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:01:<span class="number">58</span>+09:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">49350</span>  <span class="number">48800</span>  <span class="number">49300</span>  <span class="number">1028290</span>   <span class="number">50435367200</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:03:<span class="number">21</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49600</span>  <span class="number">49250</span>  <span class="number">49300</span>  <span class="number">1010431</span>   <span class="number">49977830750</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:04:<span class="number">58</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49500</span>  <span class="number">49250</span>  <span class="number">49350</span>   <span class="number">972074</span>   <span class="number">48001468250</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:06:<span class="number">53</span>+09:<span class="number">00</span>  <span class="number">49300</span>  <span class="number">49350</span>  <span class="number">48750</span>  <span class="number">48800</span>  <span class="number">1060961</span>   <span class="number">52033926150</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:08:<span class="number">27</span>+09:<span class="number">00</span>  <span class="number">48800</span>  <span class="number">49150</span>  <span class="number">48650</span>  <span class="number">49100</span>  <span class="number">1023033</span>   <span class="number">49984091500</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">11</span>:<span class="number">17</span>+09:<span class="number">00</span>  <span class="number">49100</span>  <span class="number">49250</span>  <span class="number">48800</span>  <span class="number">48850</span>  <span class="number">1020253</span>   <span class="number">50014684300</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">14</span>:<span class="number">15</span>+09:<span class="number">00</span>  <span class="number">48850</span>  <span class="number">48850</span>  <span class="number">48350</span>  <span class="number">48400</span>  <span class="number">1028829</span>   <span class="number">49976391950</span></span><br></pre></td></tr></table></figure><p>Volume barì™€ ë¹„ìŠ·í•œ ì´ìœ ë¡œ, ì¥ ì‹œì‘ ì§ì „ê³¼ ì§í›„ë¥¼ ì œì™¸í•˜ë©´, ê° barì˜ ê±°ë˜ëŒ€ê¸ˆì´ 50BnKRWì— ê°€ê¹ê²Œ ë°ì´í„°ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><hr><h1 id="2-Information-Driven-Bars"><a href="#2-Information-Driven-Bars" class="headerlink" title="2. Information-Driven Bars"></a>2. Information-Driven Bars</h1><h2 id="2-0-The-tick-rule"><a href="#2-0-The-tick-rule" class="headerlink" title="2.0. The tick rule"></a>2.0. The tick rule</h2><h3 id="Definition-4"><a href="#Definition-4" class="headerlink" title="Definition"></a>Definition</h3><p><strong>Information-driven barëŠ” ì‹œì¥ì— ìƒˆë¡œìš´ ì •ë³´ê°€ ìœ ì…ë˜ì—ˆì„ ë•Œ, ë” ë§ì€ barë¥¼ ì¶”ì¶œí•˜ëŠ” ì ‘ê·¼ë°©ë²•</strong>ì…ë‹ˆë‹¤. ì‹œì¥ì— ìƒˆë¡œìš´ ì •ë³´ê°€ ìœ ì…ì´ ë˜ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œìš”?</p><p>ì‹œì¥ë¯¸ì‹œêµ¬ì¡°ë¡ ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ íë¦„ìœ¼ë¡œ ë…¼ë¦¬ê°€ ì „ê°œë©ë‹ˆë‹¤. ì‹œì¥ì— ìƒˆë¡œìš´ ì •ë³´ê°€ ìœ ì…ì´ ë˜ì—ˆì„ ê²½ìš°, í•´ë‹¹ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ ì‹œì¥ì— ì°¸ì—¬í•˜ëŠ” â€œinformed traderâ€ë“¤ì´ ìƒê¹ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ê°€ê²©ì€ ìƒˆë¡œìš´ ê· í˜•ì ìœ¼ë¡œ ì´ë™í•˜ë ¤ê³  í•˜ê³ , ê·¸ ê³¼ì •ì—ì„œ ë§¤ë„&#x2F;ë§¤ìˆ˜ ì„¸ë ¥ì´ ë¶ˆê· í˜•í•´ì§‘ë‹ˆë‹¤. ì—­ìœ¼ë¡œ ìƒê°í•´ë³´ë©´, ì´ëŸ¬í•œ ë¶ˆê· í˜•ì´ ê´€ì°°ì´ ëœë‹¤ë©´ ì‹œì¥ì— ìƒˆë¡œìš´ ì •ë³´ê°€ ë°˜ì˜ë˜ì—ˆë‹¤ê³  ìœ ì¶”ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, ì‹œì¥ ì™¸ë¶€ ì´ë²¤íŠ¸ë“¤ì„ (NLP ë“±ì„ ì´ìš©í•˜ì—¬) ì§ì ‘ í¬ì°©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, <strong>ì´ë²¤íŠ¸ê°€ ì‹œì¥ì— ë…¹ì•„ë“¤ ë•Œ ë°œìƒí•˜ëŠ” ì‹œì¥ì˜ í˜„ìƒì„ í¬ì°©í•˜ëŠ” ê²ƒ</strong>ì…ë‹ˆë‹¤.</p><p>ì´ë¥¼ ìœ„í•´ì„œëŠ”, â€œë§¤ë„&#x2F;ë§¤ìˆ˜ ì„¸ë ¥ì˜ ë¶ˆê· í˜•â€ì„ ìˆ˜ì¹˜í™”í•˜ì—¬ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤. í•œ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ, í‹± ë°ì´í„°ì— <strong>tick rule</strong>ì„ ì ìš©í•˜ì—¬ <strong>signed tick (<escape>$b_t \in {-1, 1}$</escape>)</strong> ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><escape>\begin{equation*}    b_t=    \begin{cases}      b_{t-1} & \text{if } \Delta p_t=0 \\      \frac{\left|\Delta p_t\right|}{\Delta p_t} & \text{if } \Delta p_t\neq0    \end{cases}    \quad \text{or}\ \     b_t=    \begin{cases}      1       & \text{if } \Delta p_t &gt; 0 \\      -1      & \text{if } \Delta p_t &lt; 0 \\      b_{t-1} & \text{if } \Delta p_t=0    \end{cases}\end{equation*}</escape><p>ë³µì¡í•´ ë³´ì´ëŠ” ì‹ì´ì§€ë§Œ, ì˜ë¯¸ëŠ” ê°„ë‹¨í•©ë‹ˆë‹¤. ê±°ë˜ê°€ ì§ì „ ê±°ë˜ë³´ë‹¤ ë†’ì€ ê°€ê²©ì— ì²´ê²°ëì„ ê²½ìš° 1, ë‚®ì€ ê°€ê²©ì— ì²´ê²°ëì„ ê²½ìš° -1, ê°™ì€ ê°€ê²©ì— ì²´ê²°ëì„ ê²½ìš° $b_{t-1}$ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p><p>Signed tickì€ <strong><a href="https://www.investopedia.com/terms/a/aggressor.asp">tradeâ€™s agressor side</a>ë¥¼ ìˆ˜ì¹˜í™”í•˜ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜</strong>ì…ë‹ˆë‹¤. ê±°ë˜ê°€ ì²´ê²°ë˜ëŠ” í˜•íƒœëŠ” í¬ê²Œ â€œì§€ì •ê°€ ë§¤ë„ì£¼ë¬¸ + ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸â€ì´ ë§¤ì¹­ì´ ë˜ëŠ” ê²½ìš°ì™€ â€œì‹œì¥ê°€ ë§¤ë„ì£¼ë¬¸ + ì§€ì •ê°€ ë§¤ìˆ˜ì£¼ë¬¸â€ì´ ë§¤ì¹­ì´ ë˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ë§¤ë„í˜¸ê°€ê°€ ë§¤ìˆ˜í˜¸ê°€ë³´ë‹¤ í¬ê¸° ë•Œë¬¸ì—, ì „ìì˜ ì²´ê²°ê°€ê°€ ë” ë†’ìŠµë‹ˆë‹¤. ì¦‰, ì§ì „ ê±°ë˜ì™€ ë¹„êµí•˜ì˜€ì„ ë•Œ ì²´ê²°ê°€ê°€ ë†’ë‹¤ë©´, ì´ë²ˆ ê±°ë˜ëŠ” ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ì— ì˜í•´ ì²´ê²°ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì…ˆì…ë‹ˆë‹¤. (ì•„ë˜ <em>Pitfall</em> í•­ëª©ì—ì„œ ì–¸ê¸‰í•˜ê² ì§€ë§Œ, í•­ìƒ ê·¸ë ‡ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.) ì´ë¥¼ ë°˜ì˜í•˜ì—¬ signed tickì„ ë‹¤ë¥´ê²Œ ì„¤ëª…í•˜ë©´, <strong>ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ì— ì˜í•´ ê±°ë˜ê°€ ë°œìƒí•œ ê²½ìš° $b_t&#x3D;1$, ì‹œì¥ê°€ ë§¤ë„ì£¼ë¬¸ì— ì˜í•´ ê±°ë˜ê°€ ê±°ë˜ê°€ ë°œìƒí•œ ê²½ìš°ì—ëŠ” $b_t&#x3D;-1$ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ë°©ë²•</strong>ì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìì‚°(í˜¹ì€ ê³„ì•½)ì˜ ê°€ê²©ì´ ìƒìŠ¹ì••ë ¥ì„ ë°›ê²Œ ë˜ë©´ ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ì´ ë§ì´ ë°œìƒí•˜ê²Œ ë˜ê³ , $b_t&#x3D;1$ì¸ ê²½ìš°ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë§ì´ ê´€ì°°ì´ ë  ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ, $b_t&#x3D;1$ì¸ ê²½ìš°ê°€ ì–´ëŠ ìˆ˜ì¤€ ì´ìƒ ê´€ì°°ë  ë•Œë§ˆë‹¤ barë¥¼ ì¶”ì¶œí•˜ë©´, ì‹œì¥ì— ìœ ì…ë˜ëŠ” ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ barë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ëŒ€ì˜ ê²½ìš°($b_t&#x3D;-1$)ë„ ë§ˆì°¬ê°€ì§€ ì…ë‹ˆë‹¤.</p><h3 id="Pitfall"><a href="#Pitfall" class="headerlink" title="Pitfall"></a>Pitfall</h3><p>í˜¸ê°€ê°€ ë³€í•˜ëŠ” ê²½ìš°, agressor sideë¥¼ ì œëŒ€ë¡œ íŒŒì•…í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p><ol><li>ë§¤ë„í˜¸ê°€ 11,000ì›, ë§¤ìˆ˜í˜¸ê°€ 10,000ì›ì¸ ì£¼ì‹, ì´ì „ ì²´ê²°ê°€ 10,000ì› ($p_0&#x3D;10000$)</li><li>$t&#x3D;1$ ì‹œì ì—ì„œ ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ ì ‘ìˆ˜, ì²´ê²° ($p_1&#x3D;11000$, $b_1&#x3D;1$)</li><li>ì§€ì •ê°€ ë§¤ë„ì£¼ë¬¸ 10,900ì›ìœ¼ë¡œ ì ‘ìˆ˜. í˜„ì¬ ë§¤ë„í˜¸ê°€ 10,900ì›, ë§¤ìˆ˜í˜¸ê°€ 10,000ì›</li><li>$t&#x3D;2$ ì‹œì ì—ì„œ ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ ì ‘ìˆ˜, ì²´ê²° ($p_2&#x3D;10900$, $b_2&#x3D;-1 \because \Delta p_2&lt;0$)</li></ol><p>ì‹œì¥ê°€ ë§¤ìˆ˜ì£¼ë¬¸ì´ ì²´ê²°ë˜ì—ˆìŒì—ë„, $b_2&#x3D;-1$ì´ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. ë§¤ìˆ˜ì£¼ë¬¸ê³¼ ë§¤ë„ì£¼ë¬¸ì´ ê· í˜•ìˆê²Œ ì²´ê²°ë˜ëŠ” ì‹œì¥ì—ì„œ ìœ„ì˜ ë¬¸ì œëŠ” ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ í•´ì†Œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìœ ë™ì„±ì´ ë¶€ì¡±í•˜ê±°ë‚˜ ë³€ë™ì´ í° ì¢…ëª©ì˜ ê²½ìš°ì—ëŠ” ë¬¸ì œê°€ ë  ì†Œì§€ê°€ ìˆìœ¼ë¯€ë¡œ, ì´ì— ëŒ€í•´ ì¸ì§€ë¥¼ í•˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p><p>ì‚¬ìš©í•˜ëŠ” APIì— ë”°ë¼, signed tick ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ <a href="https://doc.coinone.co.kr/#operation/public_api_trades">ì½”ì¸ì› APIì—ì„œ ì œê³µí•˜ëŠ” ìµœê·¼ ì²´ê²° ë‚´ì—­</a>ì˜ ê²½ìš°, ì²´ê²° ì‹œê°ê³¼ ì²´ê²°ê°€, ì²´ê²°ëŸ‰ê³¼ í•¨ê»˜ agressor sideë¥¼ ëª…ì‹œí•œ <code>is_ask</code>ë¼ëŠ” ë°ì´í„°ë¥¼ í•¨ê»˜ ì œê³µí•©ë‹ˆë‹¤. ì´ ê²½ìš°, í•´ë‹¹ ë°ì´í„°ë¥¼ signed tickìœ¼ë¡œ í™œìš©í•˜ëŠ” ë°©ë²•ë„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p><h3 id="Implementation-2"><a href="#Implementation-2" class="headerlink" title="Implementation"></a>Implementation</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">signed_tick</span>(<span class="params">tick, initial_value=<span class="number">1.0</span></span>):</span><br><span class="line">    diff = tick[<span class="string">&#x27;price&#x27;</span>] - tick[<span class="string">&#x27;price&#x27;</span>].shift(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">abs</span>(diff) / diff).ffill().fillna(initial_value)</span><br></pre></td></tr></table></figure><p>Signed tickì„ ê³„ì‚°í•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•œ ì§ì „ ê±°ë˜ì˜ ì²´ê²°ê°€ë¥¼ êµ¬í•˜ê¸° ìœ„í•´, pandasì˜ <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html"><code>shift()</code></a> methodë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì²´ê²°ê°€ì— ë³€ë™ì´ ì—†ëŠ” ê²½ìš°, <code>diff</code>ê°€ 0ì´ ë˜ì–´ <code>abs(diff)/diff</code> ê°’ì´ <code>np.nan</code>ìœ¼ë¡œ ê³„ì‚°ë˜ë„ë¡ í•œ ë’¤, <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.ffill.html?highlight=ffill"><code>ffill()</code></a> (forward fill)ì„ í†µí•´ ì´ì „ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. í‹± ë°ì´í„°ì˜ ì• ë¶€ë¶„ì—ì„œëŠ” <code>signed_tick</code>ì´ ì •ì˜ë  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì„ì˜ì˜ ê°’ (<code>initial_value=1.0</code>)ì„ ë„£ì–´ì¤ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung[<span class="string">&#x27;signed_tick&#x27;</span>] = signed_tick(samsung)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>samsung.iloc[<span class="number">50</span>:<span class="number">60</span>]</span><br><span class="line">t                          price  volume      value  signed_tick</span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">10</span>     <span class="number">489000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">20</span>     <span class="number">978000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>      <span class="number">50</span>    <span class="number">2445000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>      <span class="number">69</span>    <span class="number">3377550</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>    <span class="number">2250</span>  <span class="number">110025000</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48900</span>     <span class="number">148</span>    <span class="number">7237200</span>         -<span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>       <span class="number">5</span>     <span class="number">244750</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>       <span class="number">3</span>     <span class="number">146850</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>      <span class="number">10</span>     <span class="number">489500</span>          <span class="number">1.0</span></span><br><span class="line"><span class="number">2020</span>-03-<span class="number">25</span> 09:<span class="number">00</span>:<span class="number">26</span>+09:<span class="number">00</span>  <span class="number">48950</span>     <span class="number">300</span>   <span class="number">14685000</span>          <span class="number">1.0</span></span><br></pre></td></tr></table></figure><h2 id="2-1-Tick-imbalance-bars-TIBs"><a href="#2-1-Tick-imbalance-bars-TIBs" class="headerlink" title="2.1. Tick imbalance bars (TIBs)"></a>2.1. Tick imbalance bars (TIBs)</h2><h3 id="Definition-5"><a href="#Definition-5" class="headerlink" title="Definition"></a>Definition</h3><p>Signed tickì´ í¸í–¥ë˜ì—ˆë‹¤ëŠ” íŒë‹¨ì€ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ì¤‘ í•œ ë°©ë²•ìœ¼ë¡œ, signed tickì„ ëˆ„ì í•˜ì—¬ <strong>tick imbalance ($\theta_T$)</strong> ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. $T$ ì‹œì ì—ì„œì˜ tick imbalanceëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë©ë‹ˆë‹¤.</p><escape>\begin{align*}\theta_T = \sum^{T}_{t=1}{b_t}\end{align*}</escape><p>ê·¸ ë‹¤ìŒìœ¼ë¡œ, í˜„ ì‹œì ì—ì„œ ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ tick imbalance barì˜ tick imbalance ê°’, $E_0[\theta_T]$ë¥¼ êµ¬í•´ì¤ë‹ˆë‹¤.</p><escape>\begin{align*}E_0[\theta_T] = E_0[T](P[b_t=1] - P[b_t=-1]) = E_0[T] \cdot E_0[b_t]\end{align*}</escape><p>ì—¬ê¸°ì„œ $E_0[T]$ëŠ” í˜„ ì‹œì ì—ì„œ ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ barì˜ í¬ê¸° (í‹±ì˜ ê°œìˆ˜), $E_0[b_t]$ì€ $b_t$ì˜ ê¸°ëŒ€ê°’ì…ë‹ˆë‹¤. $E_0[T]$ì™€ $E_0[b_t]$ ê°’ì„ êµ¬í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ”, ì´ì „ì— ì¶”ì¶œëœ tick imbalance barë“¤ì˜ $T$ê°’ê³¼ $b_t$ê°’ì— exponentially weighted moving averageë¥¼ ì ìš©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, tick imbalanceì˜ í¬ê¸°ê°€ ì˜ˆìƒ tick imbalanceë¥¼ ë„˜ì–´ê°€ëŠ” ìˆœê°„ì— barë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p><escape>\begin{align*}T^* = \underset{T}{\operatorname{argmin}}\left\{ |\theta_T|\ge \left| E_0[\theta_T] \right| \right\}\end{align*}</escape><p>Barë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ëœ ë°ì´í„°($t \in [1,T^*]$)ë¥¼ ì œì™¸í•˜ê³  ìœ„ì˜ ê³¼ì •ì„ ë°˜ë³µí•´ì£¼ë©´, ì „ì²´ ë°ì´í„°ì— ëŒ€í•œ tick imbalance barë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í‹± ë°ì´í„°ê°€ ì˜ˆìƒí•œ ê²ƒ ì´ìƒìœ¼ë¡œ ë¶ˆê· í˜• í•  ë•Œ $\theta_T$ ê°’ì€ ì»¤ì§€ê³ , ë” ì‘ì€ $T$ ê°’ìœ¼ë¡œë„ $T^*$ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥´ê²Œ ì´ì•¼ê¸°í•˜ë©´, ì •ë³´ì˜ ë¹„ëŒ€ì¹­ìœ¼ë¡œ ì¸í•˜ì—¬ ë°©í–¥ì„±ì´ ìˆëŠ” informed tradingì´ ì‹œì¥ì— ë§ì´ ì¡´ì¬ í•  ìˆ˜ë¡, TIBëŠ” ë” ë§ì´ ìƒì„±ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, TIBëŠ” ì¼ì¢…ì˜ <strong>â€œë™ì¼í•œ ì–‘ì˜ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ë°ì´í„°ë“¤ì˜ ë¬¶ìŒâ€</strong> ìœ¼ë¡œ ìƒê°í•  ìˆ˜ë„ ìˆê² ìŠµë‹ˆë‹¤.</p><h3 id="Implementation-3"><a href="#Implementation-3" class="headerlink" title="Implementation"></a>Implementation</h3><p>ì´ì „ì˜ êµ¬í˜„ë“¤ì€ numpyì˜ í¼í¬ë¨¼ìŠ¤ë¥¼ ëŒì–´ì˜¬ë¦¬ê¸° ìœ„í•´ì„œ ìµœëŒ€í•œ vectorized ì—°ì‚°ì„ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤. TIBì˜ ê²½ìš°, barë¥¼ ë‚˜ëˆ„ëŠ” ê¸°ì¤€ì´ ë˜ëŠ” $E_0[\theta_T]$ì˜ ê°’ì´ barë¥¼ ì¶”ì¶œí•˜ëŠ” ê³¼ì • ì¤‘ì— ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤. Iterativeí•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ êµ¬í˜„ì„ í•´ì•¼ í•  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.</p><p>ì•„ë˜ì˜ ì½”ë“œëŠ”, ë°ì´í„° iterateë¥¼ í•˜ëŠ” ë™ì•ˆ ì—°ì‚°ì˜ íšŸìˆ˜ë¥¼ ì¤„ì´ëŠ” ë° ì´ˆì ì„ ë§ì¶˜ êµ¬í˜„ì…ë‹ˆë‹¤. pandas DataFrameì˜ <code>loc</code>, <code>iloc</code>ì€ ì—­í• ì´ ë‹¤ì–‘í•˜ì—¬ ì•½ê°„ì˜ overheadê°€ ìˆìŠµë‹ˆë‹¤. (<em><a href="https://pandas.pydata.org/docs/user_guide/indexing.html#fast-scalar-value-getting-and-setting">Pandas doc</a></em>) ë”°ë¼ì„œ, dataframe ì™¸ë¶€ì—ì„œ tick numberingì„ í•´ì¤€ ë’¤, í•œë²ˆì— columnì„ ìƒˆë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ë°©ë²•ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tick_imbalance_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size=<span class="number">10</span>,</span></span><br><span class="line"><span class="params">    initial_expected_signed_tick=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_signed_tick=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 1. Tick imbalance ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ, bar numbering(`tick_imbalance_group`)</span></span><br><span class="line">    tick_imbalance = signed_tick(tick).cumsum().values</span><br><span class="line">    tick_imbalance_group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    expected_signed_tick = initial_expected_signed_tick</span><br><span class="line">    expected_tick_imbalance = expected_bar_size * expected_signed_tick</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        tick_imbalance_group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(tick_imbalance[i]) &gt;= <span class="built_in">abs</span>(expected_tick_imbalance):</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            expected_signed_tick = (</span><br><span class="line">                lambda_signed_tick * tick_imbalance[i] / (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_signed_tick) * expected_signed_tick</span><br><span class="line">            )</span><br><span class="line">            expected_tick_imbalance = expected_bar_size * expected_signed_tick</span><br><span class="line">            </span><br><span class="line">            tick_imbalance -= tick_imbalance[i]</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 2. Bar numbering ê¸°ë°˜ìœ¼ë¡œ, OHLCV bar ìƒì„±</span></span><br><span class="line">    tick[<span class="string">&#x27;tick_imbalance_group&#x27;</span>] = tick_imbalance_group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;tick_imbalance_group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><h2 id="2-2-Volume-x2F-Dollar-imbalance-bars-VIBs-x2F-DIBs"><a href="#2-2-Volume-x2F-Dollar-imbalance-bars-VIBs-x2F-DIBs" class="headerlink" title="2.2. Volume&#x2F;Dollar imbalance bars (VIBs&#x2F;DIBs)"></a>2.2. Volume&#x2F;Dollar imbalance bars (VIBs&#x2F;DIBs)</h2><h3 id="Definition-6"><a href="#Definition-6" class="headerlink" title="Definition"></a>Definition</h3><p>Tick barsì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ volume barì™€ dollar barë¡œ ê°œë…ì„ í™•ì¥í•œ ê²ƒê³¼ ê°™ì´, tick imbalance barì˜ ê°œë…ì„ volume imbalance barì™€ dollar imbalance barë¡œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>ê±°ë˜ëŸ‰ í˜¹ì€ ê±°ë˜ëŒ€ê¸ˆì˜ ë¹„ëŒ€ì¹­ì´ ì˜ˆìƒ ìˆ˜ì¤€ì„ ë„˜ì–´ì„¤ ë•Œ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</strong> ê·¸ ê³¼ì •ì€ TIBì™€ ë™ì¼í•©ë‹ˆë‹¤.</p><p>ì°¸ê³ í•œ ì„œì ì—ì„œëŠ” $b_t&#x3D;1$ì¸ ê²½ìš°ì™€ $b_t&#x3D;-1$ì¸ ê²½ìš°ë¥¼ ë”°ë¡œ êµ¬ë¶„í•˜ì—¬ ê³„ì‚°í•˜ì§€ë§Œ, ì €ëŠ” ì•½ê°„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë‚´ìš©ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤. ê°€ì¥ ë¨¼ì €, ì•ì„œì„œ ì •ì˜í–ˆë˜ signed tickì„ í™œìš©í•˜ì—¬ <strong>signed volume í˜¹ì€ signed value ($c_t$)</strong> ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ $v_t$ëŠ” ì¶”ì¶œí•˜ë ¤ëŠ” barì˜ ì¢…ë¥˜ì— ë”°ë¼ ê±°ë˜ëŸ‰(VIB) í˜¹ì€ ê±°ë˜ëŒ€ê¸ˆ(DIB) ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><escape>\begin{align*}c_t = b_t v_t\end{align*}</escape><p>ë‹¤ìŒìœ¼ë¡œ, $T$ ì‹œì ì—ì„œì˜ imbalance, $\theta_T$ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤. </p><escape>\begin{align*}\theta_T = \sum^{T}_{t=1}{c_t} = \sum^{T}_{t=1}{b_t v_t}\end{align*}</escape><p>ê·¸ ë‹¤ìŒìœ¼ë¡œ, í˜„ ì‹œì ì—ì„œ ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ barì˜ imbalance ê°’, $E_0[\theta_T]$ë¥¼ êµ¬í•´ì¤ë‹ˆë‹¤.</p><escape>\begin{align*}E_0[\theta_T] &= E_0[T](P[b_t=1]E_0[c_t|b_t=1] + P[b_t=-1]E_0[c_t|b_t=-1]) \\              &= E_0[T]\cdot E_0[c_t]\end{align*}</escape><p>Tick imbalance barë¥¼ ê³„ì‚°í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ, $E_0[T]$ ê°’ê³¼ $E_0[c_t]$ ê°’ì€ ì´ì „ barë“¤ì˜ $T$ê°’ê³¼ $c_t$ ê°’ì— exponential weighted moving averageë¥¼ ì·¨í•´ ê·¼ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, imbalanceì˜ í¬ê¸°ê°€ ì˜ˆìƒ ìˆ˜ì¹˜($E_0[\theta_T]$)ë¥¼ ë„˜ì–´ê°€ëŠ” ìˆœê°„ì— barë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p><escape>\begin{align*}T^* = \underset{T}{\operatorname{argmin}}\left\{ |\theta_T|\ge \left| E_0[\theta_T] \right| \right\}\end{align*}</escape><p>Barë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ëœ ë°ì´í„°($t \in [1,T^*]$)ë¥¼ ì œì™¸í•˜ê³  ìœ„ì˜ ê³¼ì •ì„ ë°˜ë³µí•´ì£¼ë©´, ì „ì²´ ë°ì´í„°ì— ëŒ€í•œ volume imbalance bar (í˜¹ì€ dollar imbalance bar)ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="Implementation-4"><a href="#Implementation-4" class="headerlink" title="Implementation"></a>Implementation</h3><p>Imbalanceë¥¼ ì •ì˜í•œ ë’¤, í•´ë‹¹ imbalanceê°€ ì˜ˆìƒ ìˆ˜ì¹˜ë¥¼ ë²—ì–´ë‚˜ëŠ” ê²½ìš° barë¥¼ ì¶”ì¶œí•œë‹¤ëŠ” ì ì—ì„œ TIBì™€ VIB, DIBì˜ ë¡œì§ì€ ë™ì¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ, TIBì˜ êµ¬í˜„ì—ì„œ <code>imbalance</code>ì˜ ê°’ì„ ì¡°ì ˆí•˜ì—¬ DIBì™€ VIBë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">imbalance_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="built_in">type</span>,  <span class="comment"># &#x27;tick&#x27;, &#x27;volume&#x27;, &#x27;dollar&#x27;</span></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_expected_signed,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_signed=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 1. Imbalance ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ, bar numbering(`imbalance_group`)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;tick&#x27;</span>:</span><br><span class="line">        imbalance = signed_tick(tick).cumsum().values</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="string">&#x27;volume&#x27;</span>:</span><br><span class="line">        imbalance = (signed_tick(tick) * tick[<span class="string">&#x27;volume&#x27;</span>]).cumsum().values</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="string">&#x27;dollar&#x27;</span>:</span><br><span class="line">        imbalance = (signed_tick(tick) * tick[<span class="string">&#x27;value&#x27;</span>]).cumsum().values</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;`type`ì€ [&quot;tick&quot;, &quot;volume&quot;, &quot;dollar&quot;] ì¤‘ í•œ ê°€ì§€ ê°’ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">    imbalance_group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    expected_signed = initial_expected_signed</span><br><span class="line">    expected_imbalance = expected_bar_size * expected_signed</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        imbalance_group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(imbalance[i]) &gt;= <span class="built_in">abs</span>(expected_imbalance):</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            expected_signed = (</span><br><span class="line">                lambda_signed * imbalance[i] / (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_signed) * expected_signed</span><br><span class="line">            )</span><br><span class="line">            expected_imbalance = expected_bar_size * expected_signed</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance -= imbalance[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Part 2. Bar numbering ê¸°ë°˜ìœ¼ë¡œ, OHLCV bar ìƒì„±</span></span><br><span class="line">    tick[<span class="string">&#x27;imbalance_group&#x27;</span>] = imbalance_group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;imbalance_group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><h2 id="2-3-Tick-runs-bars-TRBs"><a href="#2-3-Tick-runs-bars-TRBs" class="headerlink" title="2.3. Tick runs bars (TRBs)"></a>2.3. Tick runs bars (TRBs)</h2><h3 id="Definition-7"><a href="#Definition-7" class="headerlink" title="Definition"></a>Definition</h3><p>ì•ì„œ ì‚´í´ë³¸ tick imbalance barëŠ” signed tickì˜ ëˆ„ì ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ barë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤. Tick runs barëŠ” signed tickì„ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ëˆ„ì í•˜ëŠ” ê²ƒì—ì„œ ë” ë‚˜ì•„ê°€, <strong>$b_t&#x3D;1$ì¸ ê²½ìš°ì™€ $b_t&#x3D;-1$ì¸ ê²½ìš°ë¥¼ ë”°ë¡œ ëˆ„ì í•˜ì—¬, ë‘ ìˆ˜ì¹˜ ì‚¬ì´ì˜ ë¹„ëŒ€ì¹­ì„ ê¸°ì¤€ìœ¼ë¡œ barë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•</strong>ì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ í° ê±°ë˜ê°€ í˜¸ê°€ë¥¼ ë°€ë©´ì„œ ì²´ê²°ë˜ê±°ë‚˜ ì—¬ëŸ¬ê°œì˜ ì‘ì€ ê±°ë˜ë¡œ ë‚˜ë‰˜ì–´ì ¸ì„œ ì²´ê²°ë˜ëŠ” ê²½ìš° $b_{t&#x3D;1,â€¦,T}$ì— <strong>run</strong>(ì—°ì†ëœ ë°ì´í„° í”ì )ì„ ë‚¨ê¸°ê²Œ ë˜ëŠ”ë°, ì´ë¥¼ í¬ì°©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p><p>ê°€ì¥ ë¨¼ì €, í˜„ì¬ runì˜ ê¸¸ì´, $\theta_T$ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤.</p><escape>\begin{align*}\theta_T = \text{max}\left\{\sum^{T}_{t|b_t=1}{b_t}, -\sum^{T}_{t|b_t=-1}{b_t} \right\}\end{align*}</escape><p>í†µê³„í•™ì—ì„œ ë§í•˜ëŠ” runì€ ë™ì¼í•œ ê´€ì¸¡ê°’ì´ (ëŠê¹€ì—†ì´) ì—°ì†ì ìœ¼ë¡œ ì´ì–´ì§„ ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (<em><a href="https://en.wikipedia.org/wiki/Wald%E2%80%93Wolfowitz_runs_test#Definition">Wikipedia</a></em>) ì´ì™€ëŠ” ì•½ê°„ ë‹¤ë¥´ê²Œ, ì„œì ì—ì„œ ì •ì˜í•œ runì€ ë°ì´í„°ì˜ ëŠê¹€(sequence break)ì„ í—ˆìš©í•©ë‹ˆë‹¤. ì¦‰, ì—¬ê¸°ì„œ ë§í•˜ëŠ” â€œrunì˜ ê¸¸ì´â€ëŠ” ì—°ì†ëœ ë°ì´í„°ì˜ ì‹¤ì§ˆì ì¸ ê¸¸ì´ë¥¼ ì˜ë¯¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì¼ì • ê¸°ê°„ ë™ì•ˆ ê´€ì°°ëœ ìµœë¹ˆê°’ì˜ ë¹ˆë„ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p><p>ë‹¤ìŒìœ¼ë¡œ, í˜„ ì‹œì ì—ì„œ ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ runì˜ ê¸¸ì´, $E[\theta_T]$ë¥¼ êµ¬í•´ì¤ë‹ˆë‹¤.</p><escape>\begin{align*}E_0[\theta_T] &= E_0[T]\cdot \text{max}\left\{ P[b_t=1], P[b_t=-1] \right\} \\              &= E_0[T]\cdot \text{max}\left\{ P[b_t=1], 1-P[b_t=1] \right\}\end{align*}</escape><p>Imbalance barì™€ ë§ˆì°¬ê°€ì§€ë¡œ, $E_0[T]$ì™€ $P[b_t&#x3D;1]$ ê°’ì€ ì¶”ì •ì¹˜ë¥¼ ì‚¬ìš©í•˜ê³ , ì´ì „ barì˜ $T$, $P[b_t&#x3D;1]$(proportion of buy ticks)ì˜ EWMA ê°’ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í•˜ë‚˜ì˜ ë°©ë²•ì…ë‹ˆë‹¤.</p><p>ì´í›„, runì˜ ê¸¸ì´ê°€ ì˜ˆìƒë˜ëŠ” runì˜ ê¸¸ì´ë¥¼ ë„˜ì–´ê°€ëŠ” ìˆœê°„ barë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p><escape>\begin{align*}T^* = \underset{T}{\operatorname{argmin}}\left\{ \theta_T \ge E_0[\theta_T] \right\}\end{align*}</escape><p>Barë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ëœ ë°ì´í„°($t \in [1,T^*]$)ë¥¼ ì œì™¸í•˜ê³  ìœ„ì˜ ê³¼ì •ì„ ë°˜ë³µí•´ì£¼ë©´, ì „ì²´ ë°ì´í„°ì— ëŒ€í•œ tick run barë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="Implementation-5"><a href="#Implementation-5" class="headerlink" title="Implementation"></a>Implementation</h3><p>ë¡œì§ì€ TIB, VIB, DIBì˜ êµ¬í˜„ê³¼ ë™ì¼í•˜ê³ , barë¥¼ ì¶”ì¶œí•˜ëŠ” ê¸°ì¤€(ë¼ì¸ 33)ë§Œ ë‹¤ë¦…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tick_runs_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_buy_prob,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_prob=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    _signed_tick = signed_tick(tick)</span><br><span class="line">    imbalance_tick_buy = _signed_tick.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_tick_sell = _signed_tick.apply(<span class="keyword">lambda</span> v: -v <span class="keyword">if</span> v&lt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    </span><br><span class="line">    group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    buy_prob = initial_buy_prob</span><br><span class="line">    expected_runs = expected_bar_size * <span class="built_in">max</span>(buy_prob, <span class="number">1</span>-buy_prob)</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(imbalance_tick_buy[i], imbalance_tick_sell[i]) &gt;= expected_runs:</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_prob = (</span><br><span class="line">                lambda_buy_prob * imbalance_tick_buy[i]/(i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_prob) * buy_prob</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance_tick_buy -= imbalance_tick_buy[i]</span><br><span class="line">            imbalance_tick_sell -= imbalance_tick_sell[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;group&#x27;</span>] = group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><h2 id="2-4-Volume-x2F-Dollar-runs-bars-VRBs-x2F-DRBs"><a href="#2-4-Volume-x2F-Dollar-runs-bars-VRBs-x2F-DRBs" class="headerlink" title="2.4 Volume&#x2F;Dollar runs bars (VRBs&#x2F;DRBs)"></a>2.4 Volume&#x2F;Dollar runs bars (VRBs&#x2F;DRBs)</h2><h3 id="Definition-8"><a href="#Definition-8" class="headerlink" title="Definition"></a>Definition</h3><p>Tick runs barsì˜ ê°œë…ì„ í™•ì¥í•˜ì—¬, ê±°ë˜ëŸ‰ í˜¹ì€ ê±°ë˜ëŒ€ê¸ˆìœ¼ë¡œ runs barsë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ë¨¼ì €, ê±°ë˜ëŸ‰&#x2F;ê±°ë˜ëŒ€ê¸ˆ run($\theta_T$)ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤. ìœ„ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, $v_t$ëŠ” ì¶”ì¶œí•˜ë ¤ëŠ” barì˜ ì¢…ë¥˜ì— ë”°ë¼ ê±°ë˜ëŸ‰(VRB) í˜¹ì€ ê±°ë˜ëŒ€ê¸ˆ(DRB) ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><escape>\begin{align*}\theta_T = \operatorname{max}\left\{ \sum^{T}_{t|b_t=1}{b_tv_t}, -\sum^{T}_{t|b_t=-1}{b_tv_t} \right\}\end{align*}</escape><p>ë‹¤ìŒìœ¼ë¡œ, í˜„ ì‹œì ì—ì„œ ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ barì˜ run ê°’, $E_0[\theta_T]$ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p><escape>\begin{align*}E_0[\theta_t] = E_0[T]\operatorname{max}\left\{ P[b_t=1]E_0[v_t|b_t=1], (1-P[b_t=1])E_0[v_t|b_t=-1] \right\}\end{align*}</escape><p>ìœ„ ìˆ˜ì‹ì—ì„œ í•„ìš”í•œ ëª‡ ê°€ì§€ ê°’ë“¤ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. (TIB, VIB, DIB, TRBì— ë¹„í•´ estimate í•´ì•¼ í•˜ëŠ” ê°’ë“¤ì´ ë” ë§ìŠµë‹ˆë‹¤.)</p><ul><li>$E_0[T]$ëŠ” (ì´ì „ barë“¤ì˜) $T$ ê°’ì˜ EWMAë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li><li>$P[b_t&#x3D;1]$ì€ (ì´ì „ barë“¤ì˜) $P[b_t&#x3D;1]$(proportion of buy ticks)ê°’ë“¤ì˜ EWMAë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li><li>$E_0[v_t|b_t&#x3D;1]$ì€ (ì´ì „ barë“¤ì˜) ì‹œì¥ê°€ ë§¤ë„ìˆ˜ëŸ‰ê°’ë“¤ì˜ EWMAë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li><li>$E_0[v_t|b_t&#x3D;-1]$ì€ (ì´ì „ barë“¤ì˜) ì‹œì¥ê°€ ë§¤ìˆ˜ìˆ˜ëŸ‰ê°’ë“¤ì˜ EWMAë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li></ul><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, runì˜ ê¸¸ì´ê°€ ì˜ˆìƒë˜ëŠ” runì˜ ê¸¸ì´ë¥¼ ë„˜ì–´ê°€ëŠ” ìˆœê°„ barë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p><escape>\begin{align*}T^* = \underset{T}{\operatorname{argmin}}\left\{ \theta_T \ge E_0[\theta_T] \right\}\end{align*}</escape><p>Barë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ëœ ë°ì´í„°($t \in [1,T^*]$)ë¥¼ ì œì™¸í•˜ê³  ìœ„ì˜ ê³¼ì •ì„ ë°˜ë³µí•´ì£¼ë©´, ì „ì²´ ë°ì´í„°ì— ëŒ€í•œ volume&#x2F;dollar run barë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="Implementation-6"><a href="#Implementation-6" class="headerlink" title="Implementation"></a>Implementation</h3><p>TIBë¥¼ VIB&#x2F;DIBë¡œ êµ¬í˜„ì„ í™•ì¥í•œ ê²ƒê³¼ ê°™ì´, TRBì˜ êµ¬í˜„ì„ ì‘ìš©í•˜ì—¬ VRB&#x2F;DRBë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">volume_runs_bar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tick,</span></span><br><span class="line"><span class="params">    initial_expected_bar_size,</span></span><br><span class="line"><span class="params">    initial_buy_prob,</span></span><br><span class="line"><span class="params">    initial_buy_volume,</span></span><br><span class="line"><span class="params">    initial_sell_volume,</span></span><br><span class="line"><span class="params">    lambda_bar_size=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_prob=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_buy_volume=<span class="number">.1</span>,</span></span><br><span class="line"><span class="params">    lambda_sell_volume=<span class="number">.1</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    tick = tick.sort_index(ascending=<span class="literal">True</span>)</span><br><span class="line">    tick = tick.reset_index()</span><br><span class="line">    </span><br><span class="line">    _signed_tick = signed_tick(tick)</span><br><span class="line">    _signed_volume = _signed_tick * tick[<span class="string">&#x27;volume&#x27;</span>]</span><br><span class="line">    imbalance_tick_buy = _signed_tick.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_volume_buy = _signed_volume.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> v&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    imbalance_volume_sell = _signed_volume.apply(<span class="keyword">lambda</span> v: v <span class="keyword">if</span> -v&lt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>).cumsum()</span><br><span class="line">    </span><br><span class="line">    group = []</span><br><span class="line">    </span><br><span class="line">    expected_bar_size = initial_expected_bar_size</span><br><span class="line">    buy_prob = initial_buy_prob</span><br><span class="line">    buy_volume = initial_buy_volume</span><br><span class="line">    sell_volume = initial_sell_volume</span><br><span class="line">    expected_runs = expected_bar_size * <span class="built_in">max</span>(buy_prob * buy_volume, (<span class="number">1</span>-buy_prob) * sell_volume)</span><br><span class="line">    </span><br><span class="line">    current_group = <span class="number">1</span></span><br><span class="line">    previous_i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tick)):</span><br><span class="line">        group.append(current_group)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(imbalance_volume_buy[i], imbalance_volume_sell[i]) &gt;= expected_runs:</span><br><span class="line">            expected_bar_size = (</span><br><span class="line">                lambda_bar_size * (i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_bar_size) * expected_bar_size</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_prob = (</span><br><span class="line">                lambda_buy_prob * imbalance_tick_buy[i]/(i-previous_i+<span class="number">1</span>) +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_prob) * buy_prob</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            buy_volume = (</span><br><span class="line">                lambda_buy_volume * imbalance_volume_buy[i] +</span><br><span class="line">                (<span class="number">1</span>-lambda_buy_volume) * buy_volume</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            sell_volume = (</span><br><span class="line">                lambda_sell_volume * imbalance_volume_sell[i] +</span><br><span class="line">                (<span class="number">1</span>-lambda_sell_volume) * sell_volume</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            previous_i = i</span><br><span class="line">            imbalance_tick_buy -= imbalance_tick_buy[i]</span><br><span class="line">            imbalance_volume_buy -= imbalance_volume_buy[i]</span><br><span class="line">            imbalance_volume_sell -= imbalance_volume_sell[i]</span><br><span class="line">            current_group += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    tick[<span class="string">&#x27;group&#x27;</span>] = group</span><br><span class="line">    groupby = tick.groupby(<span class="string">&#x27;group&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    bars = groupby[<span class="string">&#x27;price&#x27;</span>].ohlc()</span><br><span class="line">    bars[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]] = groupby[[<span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    bars[<span class="string">&#x27;t&#x27;</span>] = groupby[<span class="string">&#x27;t&#x27;</span>].first()</span><br><span class="line">        </span><br><span class="line">    bars.set_index(<span class="string">&#x27;t&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bars</span><br></pre></td></tr></table></figure><hr><h1 id="3-Appendix"><a href="#3-Appendix" class="headerlink" title="3. Appendix"></a>3. Appendix</h1><h2 id="3-1-Timebar-â†’-Timebar"><a href="#3-1-Timebar-â†’-Timebar" class="headerlink" title="3.1. Timebar â†’ Timebar"></a>3.1. Timebar â†’ Timebar</h2><p>ê°„í˜¹, í•˜ë‚˜ì˜ timebarë¥¼ ë‹¤ë¥¸ ë‹¨ìœ„ì˜ timebarë¡œ ë³€í™˜ì„ í•´ì•¼ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, <code>pandas.DataFrame.resample</code>ì„ í†µí•´ ì‹œê³„ì—´ indexë¥¼ ì¬ì •ë ¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•„ë˜ì˜ <code>timebar_1min</code> ë°ì´í„°ëŠ” 2021ë…„ 2ì›” 11ì¼ 00:00ë¶€í„° 15ì¼ 08:40ê¹Œì§€ì˜ ë¹„íŠ¸ì½”ì¸ 1ë¶„ë´‰ ë°ì´í„°ì…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min</span><br><span class="line">                           <span class="built_in">open</span>        high  ...     volume         value</span><br><span class="line">t                                            ...                         </span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48384000.0</span>  <span class="number">48391000.0</span>  ...  <span class="number">20.124271</span>  <span class="number">9.732357e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:01:<span class="number">00</span>  <span class="number">48377000.0</span>  <span class="number">48587000.0</span>  ...  <span class="number">16.129580</span>  <span class="number">7.815445e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:02:<span class="number">00</span>  <span class="number">48446000.0</span>  <span class="number">48446000.0</span>  ...  <span class="number">14.955761</span>  <span class="number">7.228841e+08</span></span><br><span class="line">                         ...         ...  ...        ...           ...</span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">38</span>:<span class="number">00</span>  <span class="number">52470000.0</span>  <span class="number">52620000.0</span>  ...  <span class="number">10.435710</span>  <span class="number">5.480798e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">39</span>:<span class="number">00</span>  <span class="number">52592000.0</span>  <span class="number">52626000.0</span>  ...   <span class="number">2.021345</span>  <span class="number">1.063235e+08</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">40</span>:<span class="number">00</span>  <span class="number">52625000.0</span>  <span class="number">52627000.0</span>  ...   <span class="number">1.383658</span>  <span class="number">7.281528e+07</span></span><br><span class="line">[<span class="number">6281</span> rows x <span class="number">6</span> columns]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.index</span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2021-02-11 00:00:00&#x27;</span>, <span class="string">&#x27;2021-02-11 00:01:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2021-02-11 00:02:00&#x27;</span>, <span class="string">&#x27;2021-02-11 00:03:00&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2021-02-15 08:37:00&#x27;</span>, <span class="string">&#x27;2021-02-15 08:38:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2021-02-15 08:39:00&#x27;</span>, <span class="string">&#x27;2021-02-15 08:40:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, name=<span class="string">&#x27;t&#x27;</span>, length=<span class="number">6281</span>, freq=<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.columns</span><br><span class="line">Index([<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;volume&#x27;</span>, <span class="string">&#x27;value&#x27;</span>], dtype=<span class="string">&#x27;object&#x27;</span>)</span><br></pre></td></tr></table></figure><p>1ë¶„ë´‰ ë°ì´í„°ë¥¼ 60ë¶„ë´‰ ë°ì´í„°ë¡œ ë³€í™˜í•˜ë ¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ resamplingì„ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timebar_1min.resample(<span class="string">&#x27;60min&#x27;</span>).agg(&#123;  <span class="comment"># ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ 60ë¶„ ë‹¨ìœ„ë¡œ ëª¨ì•„ì„œ,</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;open&#x27;</span>: <span class="string">&#x27;first&#x27;</span>,  <span class="comment"># ê·¸ë£¹ ì¤‘ ê°€ì¥ ì²« ë²ˆì§¸ open ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ open ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;high&#x27;</span>: <span class="string">&#x27;max&#x27;</span>,    <span class="comment"># ê·¸ë£¹ ì¤‘ ê°€ì¥ í° high ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ high ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;low&#x27;</span>: <span class="string">&#x27;min&#x27;</span>,     <span class="comment"># ê·¸ë£¹ ì¤‘ ê°€ì¥ ì‘ì€ low ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ low ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;close&#x27;</span>: <span class="string">&#x27;last&#x27;</span>,  <span class="comment"># ê·¸ë£¹ ì¤‘ ê°€ì¥ ë§ˆì§€ë§‰ close ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ close ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;volume&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>,  <span class="comment"># ê·¸ë£¹ ë‚´ volume ê°’ì„ ëª¨ë‘ ë”í•œ ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ volume ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>    <span class="comment"># ê·¸ë£¹ ë‚´ value ê°’ì„ ëª¨ë‘ ë”í•œ ê°’ì„ í•´ë‹¹ ê·¸ë£¹ì˜ value ê°’ìœ¼ë¡œ ì‚¬ìš©</span></span><br><span class="line"><span class="meta">... </span>&#125;)</span><br><span class="line">                           <span class="built_in">open</span>        high  ...       volume         value</span><br><span class="line">t                                            ...                           </span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48384000.0</span>  <span class="number">48840000.0</span>  ...  <span class="number">1288.234569</span>  <span class="number">6.193043e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> 01:<span class="number">00</span>:<span class="number">00</span>  <span class="number">47910000.0</span>  <span class="number">48266000.0</span>  ...   <span class="number">506.462391</span>  <span class="number">2.428122e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">11</span> 02:<span class="number">00</span>:<span class="number">00</span>  <span class="number">48104000.0</span>  <span class="number">48376000.0</span>  ...   <span class="number">223.599107</span>  <span class="number">1.075957e+10</span></span><br><span class="line">                         ...         ...  ...          ...           ...</span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 06:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52422000.0</span>  <span class="number">52670000.0</span>  ...   <span class="number">117.880850</span>  <span class="number">6.193310e+09</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 07:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52653000.0</span>  <span class="number">52975000.0</span>  ...   <span class="number">223.672317</span>  <span class="number">1.180129e+10</span></span><br><span class="line"><span class="number">2021</span>-02-<span class="number">15</span> 08:<span class="number">00</span>:<span class="number">00</span>  <span class="number">52823000.0</span>  <span class="number">52847000.0</span>  ...   <span class="number">187.066944</span>  <span class="number">9.853452e+09</span></span><br><span class="line">[<span class="number">105</span> rows x <span class="number">6</span> columns]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0-Introduction&quot;&gt;&lt;a href=&quot;#0-Introduction&quot; class=&quot;headerlink&quot; title=&quot;0. Introduction&quot;&gt;&lt;/a&gt;0. Introduction&lt;/h1&gt;&lt;p&gt;ì²´ê²° ë°ì´í„°(í‹±ë°ì´í„°)ë¥¼ ì‚¬ìš©í•  ë•Œ, ë°ì´í„°ê°€ ì§€ë‚˜ì¹˜ê²Œ rawí•´ì„œ ìƒê¸°ëŠ” ë‚œê°í•œ ë¶€ë¶„ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ â€œë¶„ë´‰â€ì´ë‚˜ â€œì¼ë´‰â€ì²˜ëŸ¼, ì¼ì •í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì²´ê²°ë‚´ì—­ì„ groupingí•˜ëŠ” ì „ì²˜ë¦¬ ë°©ë²•ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²•ì˜ ì¥ë‹¨ì ì€ ë¬´ì—‡ì¼ê¹Œìš”? í˜¹ì‹œ ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œìš”? ì–´ë–»ê²Œ êµ¬í˜„ì„ í•´ì•¼ í• ê¹Œìš”?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Marcos Lopez de Pradoì˜ ì €ì„œ &lt;em&gt;Advances in Financial Machine Learning&lt;/em&gt;&lt;/strong&gt;ì— ìœ„ ì§ˆë¬¸ë“¤ì— ëŒ€í•œ ë‹µë³€ì´ ì •ë¦¬ê°€ ì˜ ë˜ì–´ìˆìŠµë‹ˆë‹¤. &lt;strong&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì€ í•´ë‹¹ ì„œì ì˜ â€œ2.3 Financial Data Structures: Barsâ€ ì±•í„°ë¥¼ ê³µë¶€í•˜ë©° ì´í•´í•œ ë‚´ìš©ì„ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.&lt;/strong&gt; ì›Œë‚™ ìœ ëª…í•œ ì €ì„œì¸ì§€ë¼, ì±…ì˜ ë‚´ìš©ì— ëŒ€í•œ êµ¬í˜„ì„ ì •ë¦¬í•´ë†“ì€ &lt;a href=&quot;https://github.com/hudson-and-thames/mlfinlab&quot;&gt;github repo&lt;/a&gt;ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ëª¨ë“ˆí™”ë¥¼ ìœ„í•´ ë¡œì§ì´ í©ì–´ì ¸ìˆì–´ì„œ ì´í•´í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì•„, Python pandasë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ êµ¬í˜„ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;p&gt;í¬ìŠ¤íŒ…ì˜ ë‚´ìš© í˜¹ì€ ì½”ë“œì— ê°œì„ ì´ í•„ìš”í•œ ê²½ìš°, í”¼ë“œë°±ì„ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. :)&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
    <category term="Pandas" scheme="https://hwangheek.github.io/tags/Pandas/"/>
    
    <category term="System Trading" scheme="https://hwangheek.github.io/tags/System-Trading/"/>
    
    <category term="Advances in Financial Machine Learning" scheme="https://hwangheek.github.io/tags/Advances-in-Financial-Machine-Learning/"/>
    
  </entry>
  
  <entry>
    <title>ì¡°ê¸ˆ ë” ì²´ê³„ì ì¸ Python Logging</title>
    <link href="https://hwangheek.github.io/2019/python-logging/"/>
    <id>https://hwangheek.github.io/2019/python-logging/</id>
    <published>2019-03-12T13:12:28.000Z</published>
    <updated>2022-07-23T14:39:52.357Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Pythonìœ¼ë¡œ ì½”ë“œë¥¼ ì§¤ ë•Œ, ë¡œê·¸ë¥¼ ë„ìš°ëŠ” ë°©ë²•ìœ¼ë¡œ <code>print(&#39;[*] Message&#39;)</code>ë¥¼ ì •ë§ ë§ì´ ì¨ ì™”ìŠµë‹ˆë‹¤. êµ°ë”ë”ê¸° ì—†ê³ , ìœ ì—°í•˜ê³ , dependency ì—†ì´ ì•„ë¬´ ìœ„ì¹˜ì—ë‚˜ ë„£ì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¢‹ì•˜ìŠµë‹ˆë‹¤. â€˜ì¢‹ì•˜ë‹¤â€™ ë³´ë‹¤ëŠ” â€˜í¸í–ˆë‹¤â€™ í˜¹ì€ â€˜ê·€ì°®ì•˜ë‹¤â€™ê°€ ë” ì ì ˆí•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í˜¼ìì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì§¤ ë•ŒëŠ” exception ì²˜ë¦¬ë‚˜ ë¡œê·¸ ì²˜ë¦¬ì— ì‹ ê²½ì„ ì“°ì§€ ì•Šì•„ë„ ë¬¸ì œê°€ ì—†ì—ˆê¸° ë•Œë¬¸ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ ë°©ë²•ì€ ë¬¸ì œê°€ ë§ì´ ìˆìŠµë‹ˆë‹¤. ì¤‘ìš”ë„ì— ë”°ë¼ì„œ ë¡œê·¸ë¥¼ ë¶„ë¥˜í•  ìˆ˜ë„ ì—†ì„ ë¿ë”ëŸ¬, ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” ì´ìƒ ë¡œê·¸ë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤. ì •ë§ë¡œ print ë˜ì–´ì•¼ í•˜ëŠ” ë‚´ìš©ê³¼ ë¡œê·¸ê°€ ë’¤ì„ì—¬ ë²„ë ¤ì„œ í™”ë©´ì´ ì§€ì €ë¶„í•´ì§€ëŠ” ê²ƒë„ ë¬¸ì œì…ë‹ˆë‹¤. <em>(Fangâ€™s coding note)</em> ê°€ë”ì€ ì¡°ìš©íˆ í”„ë¡œê·¸ë¨ì„ ëŒë¦¬ê³  ì‹¶ì„ ë•Œë„ ìˆê³ , ê°€ë”ì€ verbose í•´ì§€ê³  ì‹¶ì–´ì§ˆ ë•Œë„ ìˆì–ì•„ìš”?</p><img src="/images/2019-03-morpheus_logging.jpg" class="" width="500" title="Better Logging"><p><strong>Pythonì—ì„œëŠ” <code>logging</code> ëª¨ë“ˆì„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.</strong> ì´ì œ <code>print(&#39;[*] ...&#39;)</code>ë§Œ ì‚¬ìš©í•˜ì§€ ë§ê³ , <code>logging</code> ëª¨ë“ˆì„ í†µí•´ ë©‹ì§€ê³  ê¹”ë”í•œ ë¡œê¹…ì„ í•´ë´…ì‹œë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ë¥¼ í†µí•´ Pythonì—ì„œ ì œê³µí•˜ëŠ” <code>logging</code> ëª¨ë“ˆì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë˜í•œ, â€˜ì¢‹ì€ ë¡œê·¸ ì²˜ë¦¬ ë°©ë²•â€™ì´ ì–´ë–¤ ì„±ì§ˆì„ ì§€ë‹ˆê³  ìˆì„ ì§€ì— ëŒ€í•œ ê³ ë¯¼ë„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><span id="more"></span><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li>Python Official Document, <a href="https://docs.python.org/3/library/logging.html"><code>logging</code></a>, <a href="https://docs.python.org/3.7/howto/logging.html">Logging HOWTO</a>, <a href="https://docs.python.org/3.7/howto/logging-cookbook.html">Logging Cookbook</a></li><li>Fangâ€™s coding note (2012), <a href="https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/">Good logging practice in Python</a></li><li>ì´ìŠ¹í˜„ (2017), <a href="https://hamait.tistory.com/880">íŒŒì´ì¬ ë¡œê¹…ì˜ ëª¨ë“ ê²ƒ</a></li></ul><!-- https://stackoverflow.com/questions/4577376/should-i-log-before-or-after-an-operation --><hr><h1 id="Step-1-ê°„ë‹¨í•˜ê²Œ-ë¡œê·¸-ìƒì„±í•´ë³´ê¸°"><a href="#Step-1-ê°„ë‹¨í•˜ê²Œ-ë¡œê·¸-ìƒì„±í•´ë³´ê¸°" class="headerlink" title="Step 1 : ê°„ë‹¨í•˜ê²Œ ë¡œê·¸ ìƒì„±í•´ë³´ê¸°"></a>Step 1 : ê°„ë‹¨í•˜ê²Œ ë¡œê·¸ ìƒì„±í•´ë³´ê¸°</h1><h2 id="1-1-Log-Level-ë¡œê·¸ì˜-â€˜ì‹¬ê°í•œ-ì •ë„â€™"><a href="#1-1-Log-Level-ë¡œê·¸ì˜-â€˜ì‹¬ê°í•œ-ì •ë„â€™" class="headerlink" title="1-1. Log Level : ë¡œê·¸ì˜ â€˜ì‹¬ê°í•œ ì •ë„â€™"></a>1-1. Log Level : ë¡œê·¸ì˜ â€˜ì‹¬ê°í•œ ì •ë„â€™</h2><p>ë“¤ì–´ê°€ê¸°ì— ì•ì„œì„œ, <strong>ë¡œê·¸ ë ˆë²¨</strong>ì— ëŒ€í•˜ì—¬ ì§šê³  ë„˜ì–´ê°‘ì‹œë‹¤. ë¡œê·¸ëŠ” <strong>ì¤‘ìš”ë„ì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ ë ˆë²¨ì„ ê°€ì§€ê²Œ ë˜ê³ </strong>, ì´ ì¤‘ìš”ë„ì— ë”°ë¼ ë¡œê·¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” <a href="https://docs.python.org/3.7/howto/logging.html#when-to-use-logging">Logging HOWTO</a>ì— ì†Œê°œëœ ë¡œê·¸ì˜ ê° ë ˆë²¨ê³¼ ì„¤ëª…ì…ë‹ˆë‹¤.</p><table><thead><tr><th align="center">Level</th><th align="center">Value</th><th align="center">When to use</th></tr></thead><tbody><tr><td align="center"><code>DEBUG</code></td><td align="center">10</td><td align="center">(ì£¼ë¡œ ë¬¸ì œ í•´ê²°ì„ í•  ë•Œ í•„ìš”í•œ) ìì„¸í•œ ì •ë³´.</td></tr><tr><td align="center"><code>INFO</code></td><td align="center">20</td><td align="center">ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆë‹¤ëŠ” í™•ì¸ ë©”ì‹œì§€.</td></tr><tr><td align="center"><code>WARNING</code></td><td align="center">30</td><td align="center">ì˜ˆìƒí•˜ì§€ ëª»í•œ ì¼ì´ ë°œìƒí•˜ê±°ë‚˜, ë°œìƒ ê°€ëŠ¥í•œ ë¬¸ì œì ì„ ëª…ì‹œ. (e.g. â€˜disk space lowâ€™) ì‘ì—…ì€ ì •ìƒì ìœ¼ë¡œ ì§„í–‰.</td></tr><tr><td align="center"><code>ERROR</code></td><td align="center">40</td><td align="center">í”„ë¡œê·¸ë¨ì´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì§€ ëª» í•  ì •ë„ì˜ ì‹¬ê°í•œ ë¬¸ì œ.</td></tr><tr><td align="center"><code>CRITICAL</code></td><td align="center">50</td><td align="center">í”„ë¡œê·¸ë¨ì´ ë™ì‘í•  ìˆ˜ ì—†ì„ ì •ë„ì˜ ì‹¬ê°í•œ ë¬¸ì œ.</td></tr></tbody></table><p>Pythonì˜ ê¸°ë³¸ logging ì‹œìŠ¤í…œì˜ ë ˆë²¨ì€ <code>WARNING</code>ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ íŠ¹ë³„í•œ ì„¤ì •ì„ í•˜ì§€ ì•Šì„ ê²½ìš°, <code>WARNING</code> ë ˆë²¨ê³¼ ì´ë³´ë‹¤ ë” ì‹¬ê°í•œ ë ˆë²¨ì˜ ë¡œê·¸ë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ <a href="https://docs.python.org/3.7/howto/logging.html#when-to-use-logging">Logging HOWTO</a>ì— ì†Œê°œëœ ìƒí™©ì— ë”°ë¥¸ ê°€ì¥ ì í•©í•œ ë¡œê¹… ë°©ë²•ì…ë‹ˆë‹¤.</p><table><thead><tr><th align="center">ìƒí™©</th><th align="center">ë°©ë²•</th></tr></thead><tbody><tr><td align="center">ì¼ë°˜ì ì¸ console ì¶œë ¥</td><td align="center"><code>print()</code></td></tr><tr><td align="center">í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ ì¤‘ ë°œìƒí•˜ëŠ” ì •ìƒì ì¸ ì´ë²¤íŠ¸ ì•Œë¦¼</td><td align="center"><code>logging.info()</code><br>(ì§„ë‹¨ ë“±ì„ ìœ„í•œ) ìì„¸í•œ ìˆ˜ì¤€ì˜ ë¡œê·¸ì¸ ê²½ìš°ì—ëŠ” <code>logging.debug()</code></td></tr><tr><td align="center">ëŸ°íƒ€ì„ ì¤‘ ë°œìƒí•œ ì´ë²¤íŠ¸ì™€ ê´€ë ¨í•˜ì—¬ ê²½ê³ </td><td align="center">ì‚¬ìš©ìê°€ í”„ë¡œê·¸ë¨ì„ ìˆ˜ì •í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê²½ìš° <code>warnings.warn()</code><br>ì‚¬ìš©ìê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë¬¸ì œê°€ ì•„ë‹Œ ê²½ìš° <code>logging.warning()</code></td></tr><tr><td align="center">ëŸ°íƒ€ì„ ì¤‘ ë°œìƒí•œ ì´ë²¤íŠ¸ì™€ ê´€ë ¨í•œ ì—ëŸ¬</td><td align="center">ì˜ˆì™¸ ì²˜ë¦¬ (<code>raise Exception</code>)</td></tr><tr><td align="center">ë°œìƒí•œ ì˜ˆì™¸ë¥¼ suppressí•˜ê³  raise í•˜ì§€ ì•Šì€ ê²½ìš° (e.g. long-running ì„œë²„ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì—ëŸ¬ ë°œìƒ ì‹œ)</td><td align="center"><code>logging.error()</code>, <code>logging.exception()</code>, <code>logging.critical()</code></td></tr></tbody></table><p>ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ, ê° ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ ì–´ë–»ê²Œ ìƒì„±í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤.</p><h2 id="1-2-Root-Loggerë¥¼-ì´ìš©í•˜ì—¬-ë¡œê·¸-ìƒì„±í•˜ê¸°"><a href="#1-2-Root-Loggerë¥¼-ì´ìš©í•˜ì—¬-ë¡œê·¸-ìƒì„±í•˜ê¸°" class="headerlink" title="1-2. Root Loggerë¥¼ ì´ìš©í•˜ì—¬ ë¡œê·¸ ìƒì„±í•˜ê¸°"></a>1-2. Root Loggerë¥¼ ì´ìš©í•˜ì—¬ ë¡œê·¸ ìƒì„±í•˜ê¸°</h2><p>ê°€ì¥ ê°„ë‹¨í•˜ê²Œ ë¡œê·¸ë¥¼ ìƒì„±í•˜ëŠ” ë²•ì€, <strong>module-levelë¡œ ì •ì˜ë˜ì–´ ìˆëŠ” root loggerë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</strong>ì…ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ë¡œê·¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.warning(<span class="string">&#x27;This is a warning message&#x27;</span>)</span><br><span class="line"><span class="comment"># ì•„ë˜ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ì½˜ì†”ì— ì¶œë ¥ë©ë‹ˆë‹¤</span></span><br><span class="line"><span class="comment"># WARNING:root:This is a warning message</span></span><br><span class="line"></span><br><span class="line">logging.info(<span class="string">&#x27;This is an info message&#x27;</span>)</span><br><span class="line"><span class="comment"># ì•„ë¬´ ê²ƒë„ í”„ë¦°íŠ¸ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</span></span><br></pre></td></tr></table></figure><p><code>WARNING</code> ë¡œê·¸ëŠ” ì¶œë ¥ì´ ë˜ì—ˆì§€ë§Œ, <code>INFO</code> ë¡œê·¸ëŠ” ì•„ë¬´ê²ƒë„ ì¶œë ¥ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” <strong>root loggerì˜ ê¸°ë³¸ levelì´ <code>WARNING</code> ìˆ˜ì¤€ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ì„œ, í•´ë‹¹ ìˆ˜ì¤€ ì´ìƒì˜ ë¡œê·¸ë§Œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</strong> Loggerê°€ ì²˜ë¦¬í•˜ëŠ” ë¡œê·¸ì˜ ë ˆë²¨ì„ ì¡°ì •í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line">logging.info(<span class="string">&#x27;This is an info message&#x27;</span>)</span><br><span class="line"><span class="comment"># ì•„ë˜ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ì¶œë ¥ë©ë‹ˆë‹¤!</span></span><br><span class="line"><span class="comment"># INFO:root:This is an info message</span></span><br></pre></td></tr></table></figure><p>ì½˜ì†”ë¡œ ì¶œë ¥ì´ ë˜ëŠ” ë¡œê·¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ íŒŒì¼ì— ì €ì¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;dummy.log&#x27;</span>, level=logging.INFO)</span><br><span class="line">logging.debug(<span class="string">&#x27;this is a debug&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;this is an info&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;this is a warning&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ìœ„ë¥¼ ì‹¤í–‰í•  ê²½ìš°, <code>dummy.log</code> íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ë¡œê·¸ê°€ ì €ì¥ë©ë‹ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO:root:this is an info</span><br><span class="line">WARNING:root:this is a warning</span><br></pre></td></tr></table></figure><p>ì´ë ‡ê²Œ ì„¤ì •ì„ í•  ê²½ìš°, ì½˜ì†”ì—ëŠ” ë¡œê·¸ ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. <code>basicConfig</code>ë¥¼ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰í•´ë„ ê°€ì¥ ì²˜ìŒ í˜¸ì¶œëœ ì„¤ì •ë§Œ ìœ íš¨í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. <strong>Root loggerì— ì´ë¯¸ handlerê°€ ì„¤ì • ë˜ì–´ ìˆë‹¤ë©´ <code>basicConfig</code>ëŠ” ì•„ë¬´ëŸ° ì²˜ë¦¬ë„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong> ì—¬ëŸ¬ê°œì˜ handlerë¥¼ ë“±ë¡í•˜ê³  ì‹¶ì€ ê²½ìš° <code>handlers</code> ì¸ìë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì´ ìˆì§€ë§Œ, ê°€ì¥ ì²˜ìŒì˜ ì„¤ì •ë§Œ ìœ íš¨í•˜ë‹¤ëŠ” ì ì€ ë³€í•¨ì´ ì—†ìŠµë‹ˆë‹¤. í•˜ë‚˜ì˜ loggerì—ì„œ ë°œìƒí•œ ë¡œê·¸ë¥¼ ì—¬ëŸ¬ handlerê°€ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒ stepì—ì„œ ì‚´í´ë³´ë„ë¡ í•©ì‹œë‹¤.</p><p>ì¶œë ¥ë˜ëŠ” ë¡œê·¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ formatting í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(</span><br><span class="line">  <span class="built_in">format</span> = <span class="string">&#x27;%(asctime)s:%(levelname)s:%(message)s&#x27;</span>,</span><br><span class="line">  datefmt = <span class="string">&#x27;%m/%d/%Y %I:%M:%S %p&#x27;</span>,</span><br><span class="line">  level = logging.DEBUG</span><br><span class="line">)</span><br><span class="line">logging.debug(<span class="string">&#x27;This is a formatted debug message&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03/12/2019 05:20:12 PM:DE<span class="doctag">BUG:</span>This is a formatted debug message</span></span><br></pre></td></tr></table></figure><p><code>format</code>ì— ì‚¬ìš©ë˜ëŠ” ì†ì„±ë“¤ì€ <a href="https://docs.python.org/3.7/library/logging.html#logrecord-attributes">document (LogRecord attributes)</a>ì—ì„œ, <code>datefmt</code>ì— ì‚¬ìš©ë˜ëŠ” ì†ì„±ë“¤ì€ <a href="https://docs.python.org/3.7/library/time.html#time.strftime">document (<code>time.strftime(...)</code>)</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><hr><h1 id="Step-2-ì—­í• -ë¶„ë‹´í•˜ê¸°"><a href="#Step-2-ì—­í• -ë¶„ë‹´í•˜ê¸°" class="headerlink" title="Step 2 : ì—­í•  ë¶„ë‹´í•˜ê¸°"></a>Step 2 : ì—­í•  ë¶„ë‹´í•˜ê¸°</h1><p>ë¡œê¹… ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ìš”ì†Œë“¤ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.</p><ul><li><strong>Loggers</strong> : ì–´í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œê°€ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li><li><strong>Handlers</strong> : Loggersì— ì˜í•´ ìƒì„±ëœ LogRecordë¥¼ ì²˜ë¦¬í•˜ì—¬ ì ì ˆí•œ ìœ„ì¹˜ë¡œ ë³´ëƒ…ë‹ˆë‹¤.</li><li><strong>Filters</strong> : ì¶œë ¥ë˜ì–´ì•¼ í•˜ëŠ” ë¡œê·¸ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤.</li><li><strong>Formatters</strong> : LogRecordì˜ ì¶œë ¥ í˜•íƒœë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</li></ul><p>ë¡œê·¸ ì´ë²¤íŠ¸ëŠ” <code>LogRecord</code> í˜•íƒœë¡œ Loggersì—ì„œë¶€í„° Handlers, Formatters ìˆœì„œë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ìì„¸í•œ ìˆœì„œëŠ” <a href="https://docs.python.org/3.7/howto/logging.html#logging-flow">document (Logging Flow)</a>ì— í¬í•¨ëœ ì•„ë˜ì˜ flow chartì™€ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/images/2019-03-logging_flow.png" alt="Logging Flowchart"></p><h2 id="2-1-Loggers"><a href="#2-1-Loggers" class="headerlink" title="2-1. Loggers"></a>2-1. Loggers</h2><p>LoggerëŠ” ì„¸ê°€ì§€ ì£¼ìš” ì—­í• ì„ í•©ë‹ˆë‹¤.</p><ol><li>ë¡œê·¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” methodë¥¼ ì œê³µí•´ì¤ë‹ˆë‹¤. (<code>Logger.debug()</code>, <code>Logger.info()</code>, â€¦)</li><li>ë¡œê·¸ ë ˆë²¨ê³¼ Loggerì— ì ìš©ëœ filterë¥¼ ë°”íƒ•ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ë©”ì‹œì§€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.</li><li>ì ì ˆí•œ Handlerë“¤ì—ê²Œ ë¡œê·¸ ë©”ì‹œì§€ì— ë¶€ê°€ì •ë³´ê°€ ë”í•´ì§„ <code>LogRecord</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬í•´ì¤ë‹ˆë‹¤.</li></ol><p>Logger ì˜¤ë¸Œì íŠ¸ëŠ” <code>logging.getLogger(name)</code> methodë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì™€ ê´€ë ¨í•œ ëª‡ ê°€ì§€ íŠ¹ì§•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p><ul><li><code>name</code>ì´ ì£¼ì–´ì§„ ê²½ìš°, í•´ë‹¹ ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” loggerë¥¼, <code>name</code>ì´ ì£¼ì–´ì§€ì§€ ì•Šì€ ê²½ìš° root loggerë¥¼ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤.</li><li><code>name</code>ì€ ë§ˆì¹¨í‘œ(<code>.</code>)ë¡œ êµ¬ë¶„ë˜ëŠ” ê³„ì¸µêµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, <code>getLogger(&#39;foo.bar&#39;)</code>ëŠ” <code>getLogger(&#39;foo&#39;)</code>ì˜ ìì‹ loggerë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</li><li><strong>Loggerì˜ ë ˆë²¨ì´ ì •í•´ì§€ì§€ ì•Šì€ ê²½ìš° (<code>logger.setLevel(...)</code>ì„ ì„¤ì •í•´ì£¼ì§€ ì•Šì€ ê²½ìš°), ìì‹ ì˜ ë¶€ëª¨ loggerì˜ ë ˆë²¨ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</strong> ë¶€ëª¨ì˜ ë¡œê·¸ ë ˆë²¨ì´ ì •í•´ì§€ì§€ ì•Šì€ ê²½ìš°, ê·¸ ë¶€ëª¨ì˜ ë¡œê·¸ ë ˆë²¨ì„ ì°¸ì¡°í•˜ëŠ” ì‹ìœ¼ë¡œ ë°˜ë³µë©ë‹ˆë‹¤. Root loggerëŠ” í•­ìƒ ë¡œê·¸ ë ˆë²¨ì´ ì„¤ì •ë˜ì–´ìˆìŠµë‹ˆë‹¤. (ê¸°ë³¸ê°’ <code>WARNING</code>)</li><li><strong>ìì‹ loggerëŠ” ë©”ì‹œì§€ë¥¼ ìê¸° ë¶€ëª¨ loggerì˜ handlerì—ê²Œ propagateí•©ë‹ˆë‹¤.</strong> ë”°ë¼ì„œ, ë¶€ëª¨ loggerì— handlerê°€ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²½ìš°ë¼ë©´, ìì‹ loggerì—ì„œ handlerë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì•¼ í•˜ëŠ” ì¤‘ë³µ ì—…ë¬´ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (<code>Logger.propagate = False</code>ë¡œ ì„¤ì •í•´ì¤Œìœ¼ë¡œì¨, propagationì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</li></ul><p>ë¡œê¹… ì „ëµì— ë”°ë¼ì„œ ë‹¤ì–‘í•œ ë²”ìœ„ë¥¼ ì»¤ë²„í•˜ëŠ” Loggerë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì´ìŠ¹í˜„ë‹˜ì˜ ê²Œì‹œê¸€ <a href="https://hamait.tistory.com/880">íŒŒì´ì¬ ë¡œê¹…ì˜ ëª¨ë“ ê²ƒ</a>ì—ì„œ ì†Œê°œí•˜ëŠ” â€˜ë¡œê±°ë¥¼ ë§Œë“œëŠ” ëŒ€í‘œì ì¸ ë²”ìœ„â€™ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</p><ul><li><strong>Module-wise</strong> : Pythonì—ì„œëŠ” í•˜ë‚˜ì˜ íŒŒì¼ì´ í•˜ë‚˜ì˜ ëª¨ë“ˆì…ë‹ˆë‹¤. ë”°ë¼ì„œ, íŒŒì¼ì˜ ì œì¼ ìœ„ìª½ì—ì„œ ëª¨ë“ˆëª…(<code>__name__</code>)ìœ¼ë¡œ Loggerë¥¼ ë§Œë“œëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</li><li><strong>Instance-wise</strong> : <code>__init__()</code> method ë‚´ì—ì„œ Loggerë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ê° ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ ê³ ìœ í•œ Loggerë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.</li><li><strong>Class-wise</strong> : <code>__class__.__qualname__</code>ì— í•´ë‹¹í•˜ëŠ” Loggerë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. í´ë˜ìŠ¤ë³„ë¡œ ê³ ìœ í•œ Loggerë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.</li><li><strong>Function-wise</strong> : í•¨ìˆ˜ ë‚´ì—ì„œ Loggerë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. (e.g. <code>main()</code>)</li></ul><p>ìƒì„±ëœ <code>Logger</code>ë¥¼ ì„¤ì •í•˜ëŠ” ì£¼ìš” methodë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><strong><code>Logger.setLevel()</code></strong> : ì²˜ë¦¬í•  ë©”ì‹œì§€ì˜ ìµœì†Œ ë ˆë²¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë§Œì•½, <code>logging.INFO</code> ê°’ì„ ì„¤ì •í•˜ë©´, <code>DEBUG</code> ë ˆë²¨ì˜ ë¡œê·¸ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.</li><li><strong><code>Logger.addHandler()</code></strong>, <strong><code>Logger.removeHandler()</code></strong> : Handler ì˜¤ë¸Œì íŠ¸ë¥¼ ì¶”ê°€í•˜ê³  ì œê±°í•©ë‹ˆë‹¤. Handlerê°€ ì—†ëŠ” ê²½ìš°ë„ ìˆê³ , ì—¬ëŸ¬ê°œì˜ Handlerê°€ í•˜ë‚˜ì˜ Loggerì— ì¶”ê°€ë˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.</li><li><strong><code>Logger.addFilter()</code></strong>, <strong><code>Logger.removeFilter()</code></strong> : Filter ì˜¤ë¸Œì íŠ¸ë¥¼ ì¶”ê°€í•˜ê³  ì œê±°í•©ë‹ˆë‹¤.</li></ul><p>ë¡œê·¸ë¥¼ ìƒì„±í•˜ëŠ” methodë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><strong><code>Logger.debug()</code></strong>, <strong><code>Logger.info()</code></strong>, <strong><code>Logger.warning()</code></strong>, <strong><code>Logger.error()</code></strong>, <strong><code>Logger.critical()</code></strong></li><li><strong><code>Logger.exception()</code></strong> : Stack Trace ì •ë³´ê°€ ë‹´ê¸´ <code>ERROR</code> ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. Exception handler ì•ˆì—ì„œë§Œ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.</li><li><strong><code>Logger.log()</code></strong> : ë¡œê·¸ ë ˆë²¨ì„ ì¸ìë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul><h2 id="2-2-Handlers"><a href="#2-2-Handlers" class="headerlink" title="2-2. Handlers"></a>2-2. Handlers</h2><p>HandlerëŠ” ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. <a href="https://docs.python.org/3.7/howto/logging.html#useful-handlers">Useful Handlers</a>ì—ì„œ Handlerì˜ ì¢…ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Handlerë¥¼ ì„¤ì •í•˜ëŠ” methodëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><strong>Handler.setLevel()</strong> : ì²˜ë¦¬í•  ë©”ì‹œì§€ì˜ ìµœì†Œ ë ˆë²¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. Loggerì˜ ì„¤ì • ë ˆë²¨ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Loggerì—ì„œëŠ” í†µê³¼ê°€ ëœ ë¡œê·¸ ë©”ì‹œì§€ê°€ Handlerì—ì„œ filtering ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li><strong>Handler.setFormatter()</strong> : Handlerê°€ ì‚¬ìš©í•  formatterë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</li><li><strong>Handler.addFilter()</strong>, <strong>Handler.removeFilter()</strong> : Filter ì˜¤ë¸Œì íŠ¸ë¥¼ ì¶”ê°€í•˜ê³  ì œê±°í•©ë‹ˆë‹¤.</li></ul><p>ëª‡ ê°€ì§€ ì˜ˆì‹œë¥¼ ì‚´í´ë´…ì‹œë‹¤. ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” <code>StreamHandler</code>ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;This is an INFO message&#x27;</span>)</span><br><span class="line"><span class="comment"># This is an INFO message</span></span><br></pre></td></tr></table></figure><p>íŒŒì¼ë¡œ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” <code>FileHandler</code>ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;dummy.log&#x27;</span>)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;This is an INFO message. Hello dummy!&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="2-3-Formatters"><a href="#2-3-Formatters" class="headerlink" title="2-3. Formatters"></a>2-3. Formatters</h2><p>FormatterëŠ” ìµœì¢…ì ìœ¼ë¡œ ì¶œë ¥ ë  ë¡œê·¸ ë©”ì‹œì§€ì˜ formattingì— ê´€ì—¬í•©ë‹ˆë‹¤. FormatterëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.Formatter(</span><br><span class="line">  fmt = <span class="literal">None</span>, <span class="comment"># ë©”ì‹œì§€ ì¶œë ¥ í˜•íƒœ. Noneì¼ ê²½ìš° raw ë©”ì‹œì§€ë¥¼ ì¶œë ¥.</span></span><br><span class="line">  datefmt = <span class="literal">None</span>, <span class="comment"># ë‚ ì§œ ì¶œë ¥ í˜•íƒœ. Noneì¼ ê²½ìš° &#x27;%Y-%m-%d %H:%M:%S&#x27;.</span></span><br><span class="line">  style = <span class="string">&#x27;%&#x27;</span> <span class="comment"># &#x27;%&#x27;, &#x27;&#123;&#x27;, &#x27;$&#x27; ì¤‘ í•˜ë‚˜. `fmt`ì˜ styleì„ ê²°ì •.</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>logging.basicConfig</code>ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, <code>fmt</code>ì— ì‚¬ìš©ë˜ëŠ” ì†ì„±ë“¤ì€ <a href="https://docs.python.org/3.7/library/logging.html#logrecord-attributes">document (LogRecord attributes)</a>ì—ì„œ, <code>datefmt</code>ì— ì‚¬ìš©ë˜ëŠ” ì†ì„±ë“¤ì€ <a href="https://docs.python.org/3.7/library/time.html#time.strftime">document (<code>time.strftime(...)</code>)</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="2-4-Putting-all-together"><a href="#2-4-Putting-all-together" class="headerlink" title="2-4. Putting all together"></a>2-4. Putting all together</h2><p>ì¢‹ìŠµë‹ˆë‹¤! ì•ì„œ ì‚´í´ë³¸ ë‚´ìš©ë“¤ì„ ì‘ìš©í•˜ì—¬ ê°„ë‹¨í•œ ë¡œê¹… ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ ë³´ê¸°ë¡œ í•©ì‹œë‹¤. ì‹œìŠ¤í…œì˜ ìš”êµ¬ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li><code>INFO</code> ë ˆë²¨ ì´ìƒì˜ ë¡œê·¸ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.</li><li>ëª¨ë“  ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ <code>debug.log</code>ì— ì €ì¥í•©ë‹ˆë‹¤.</li><li><code>ERROR</code> ì´ìƒì˜ ë¡œê·¸ë¥¼ <code>error.log</code>ì— ì €ì¥í•©ë‹ˆë‹¤.</li><li>ëª¨ë“  Exceptionì„ suppressí•˜ê³ , stacktraceë¥¼ <code>error.log</code>ì— ì €ì¥í•©ë‹ˆë‹¤.</li><li>ë¡œê·¸ê°€ ë°œìƒí•œ ì‹œê°„ê³¼ ë¡œê·¸ë ˆë²¨, ëª¨ë“ˆëª…ì´ ëª…ì‹œë˜ì–´ì•¼í•©ë‹ˆë‹¤.</li></ul><p>ì•„ë˜ëŠ” í•´ë‹¹ ë¡œê·¸ ì‹œìŠ¤í…œì„ êµ¬í˜„í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.DEBUG) <span class="comment"># ëª¨ë“  ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ Handlerë“¤ì—ê²Œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.</span></span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s:%(module)s:%(levelname)s:%(message)s&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># INFO ë ˆë²¨ ì´ìƒì˜ ë¡œê·¸ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” Handler</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setLevel(logging.INFO)</span><br><span class="line">console_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># DEBUG ë ˆë²¨ ì´ìƒì˜ ë¡œê·¸ë¥¼ `debug.log`ì— ì¶œë ¥í•˜ëŠ” Handler</span></span><br><span class="line">file_debug_handler = logging.FileHandler(<span class="string">&#x27;debug.log&#x27;</span>)</span><br><span class="line">file_debug_handler.setLevel(logging.DEBUG)</span><br><span class="line">file_debug_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_debug_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ERROR ë ˆë²¨ ì´ìƒì˜ ë¡œê·¸ë¥¼ `error.log`ì— ì¶œë ¥í•˜ëŠ” Handler</span></span><br><span class="line">file_error_handler = logging.FileHandler(<span class="string">&#x27;error.log&#x27;</span>)</span><br><span class="line">file_error_handler.setLevel(logging.ERROR)</span><br><span class="line">file_error_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_error_handler)</span><br></pre></td></tr></table></figure><hr><h1 id="Step-3-ì‹¤ì œë¡œ-ì‚¬ìš©í•´ë³´ê¸°"><a href="#Step-3-ì‹¤ì œë¡œ-ì‚¬ìš©í•´ë³´ê¸°" class="headerlink" title="Step 3 : ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ê¸°"></a>Step 3 : ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ê¸°</h1><h2 id="3-1-Logging-Configuration-File-in-JSON-or-YAML"><a href="#3-1-Logging-Configuration-File-in-JSON-or-YAML" class="headerlink" title="3-1. Logging Configuration File in JSON or YAML"></a>3-1. Logging Configuration File in JSON or YAML</h2><p>í•œë²ˆ ì‚¬ìš©ëœ Logger ì„¤ì •ì„ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì¬ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš° ì–´ë–»ê²Œ í• ê¹Œìš”? <strong>Logger ì„¤ì •ì„ <code>dict</code> í˜•íƒœë¥¼ í†µí•´ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong> ë”°ë¼ì„œ, <strong>JSON í˜¹ì€ YAML í˜•íƒœë¡œ Logger ì„¤ì •ì„ ì €ì¥&#x2F;ê´€ë¦¬í•˜ê³ , í•„ìš”ì‹œì— <code>dict</code>ë¡œ ë¡œë“œí•˜ì—¬ ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong> í•œ ì˜ˆì‹œë¡œ, (2-4)ì˜ ë¡œê¹… ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ” JSON íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight json"><figcaption><span>logger.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;disable_existing_loggers&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;formatters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;basic&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%(asctime)s:%(module)s:%(levelname)s:%(message)s&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;datefmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;handlers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.StreamHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_debug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.FileHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debug.log&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logging.FileHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;formatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;basic&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error.log&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;loggers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__main__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;handlers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;console&quot;</span><span class="punctuation">,</span> <span class="string">&quot;file_debug&quot;</span><span class="punctuation">,</span> <span class="string">&quot;file_error&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;propagate&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ìœ„ì˜ JSON íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ Logger ì„¤ì •ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">config = json.load(<span class="built_in">open</span>(<span class="string">&#x27;./logger.json&#x27;</span>))</span><br><span class="line">logging.config.dictConfig(config)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure><p>ì„¤ì • íŒŒì¼ì— íŠ¹ë³„í•œ ì ì€ ì—†ìŠµë‹ˆë‹¤â€¦ ë§Œ, <code>disable_existing_loggers</code> ì˜µì…˜ì€ ë­˜ê¹Œìš”? <strong><code>logging.fileConfig()</code> í˜¹ì€ <code>logging.dictConfig()</code>ë¥¼ í˜¸ì¶œí•  ê²½ìš°, ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” loggerë“¤ì´ ì „ë¶€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</strong> ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•˜ì—¬, í•´ë‹¹ í•¨ìˆ˜ í˜¸ì¶œ ì‹œì— <strong><code>disable_existing_loggers</code>ì„ <code>False</code>ë¡œ ì„¤ì •</strong>í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><h2 id="3-2-Slack-Botìœ¼ë¡œ-ë¡œê·¸-ì „ì†¡í•˜ê¸°"><a href="#3-2-Slack-Botìœ¼ë¡œ-ë¡œê·¸-ì „ì†¡í•˜ê¸°" class="headerlink" title="3-2. Slack Botìœ¼ë¡œ ë¡œê·¸ ì „ì†¡í•˜ê¸°"></a>3-2. Slack Botìœ¼ë¡œ ë¡œê·¸ ì „ì†¡í•˜ê¸°</h2><p>Slackì˜ Web APIë¥¼ ì‚¬ìš©í•˜ë©´ botì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Bot ìƒì„± í›„ ë°œê¸‰ë°›ì€ í† í°ë§Œ ìˆìœ¼ë©´, <a href="https://api.slack.com/methods/chat.postMessage">ë‹¤ìŒ</a>ê³¼ ê°™ì´ <code>x-www-form-urlencoded</code> í˜•íƒœë‚˜ <code>json</code> í˜•íƒœì˜ HTTP ìš”ì²­ì„ í†µí•´ ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Python logging ëª¨ë“ˆì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ <a href="https://docs.python.org/ko/3/library/logging.handlers.html#httphandler"><code>HTTPHandler</code>ë¥¼ ì œê³µí•©ë‹ˆë‹¤</a>. Loggerì— ì˜í•´ ìƒì„±ëœ <code>LogRecord</code>ê°€ <code>HTTPHandler</code>ì—ê²Œ ì „ë‹¬ë˜ë©´, <code>mapLogRecord</code> í•¨ìˆ˜ë¥¼ í†µí•´ ë©”ì‹œì§€ê°€ <code>dict</code> í˜•íƒœë¡œ ì „ì²˜ë¦¬ë©ë‹ˆë‹¤. íŠ¹ë³„íˆ override í•˜ì§€ ì•Šì€ ê²½ìš°, <code>record.__dict__</code>ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ì „ì²˜ë¦¬ ëœ <code>dict</code>ì˜ key-value pairë¥¼ <code>emit</code> í•¨ìˆ˜ê°€ URL encodingí•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.</p><p><code>HTTPHandler</code>ì˜ <code>mapLogRecord</code>ë¥¼ ì ì ˆíˆ overridingí•˜ë©´, slack botìœ¼ë¡œ ë¡œê·¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” <code>SlackHandler</code>ë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line">SLACK_TOKEN = <span class="string">&#x27;xoxb-YOUR_BOT_TOKEN-COMES_HERE&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SlackHandler</span>(logging.handlers.HTTPHandler):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, token, channel=<span class="string">&#x27;#general&#x27;</span>, emoji=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__(host=<span class="string">&#x27;slack.com&#x27;</span>, url=<span class="string">&#x27;/api/chat.postMessage&#x27;</span>, secure=<span class="literal">True</span>)</span><br><span class="line">    self.token = token</span><br><span class="line">    self.channel = channel</span><br><span class="line">    self.emoji = emoji</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">mapLogRecord</span>(<span class="params">self, record</span>):</span><br><span class="line">    <span class="keyword">if</span> self.formatter <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># Formatterê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°</span></span><br><span class="line">      text = record.msg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      text = self.formatter.<span class="built_in">format</span>(record)</span><br><span class="line">    </span><br><span class="line">    emoji = (</span><br><span class="line">      <span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> self.emoji == <span class="literal">False</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:bug:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;DEBUG&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:pencil2:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;INFO&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:warning:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;WARNING&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:no_entry:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;:rotating_light:&#x27;</span> <span class="keyword">if</span> record.levelname == <span class="string">&#x27;CRITICAL&#x27;</span> <span class="keyword">else</span></span><br><span class="line">      <span class="string">&#x27;&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&#x27;token&#x27;</span>: self.token,</span><br><span class="line">      <span class="string">&#x27;channel&#x27;</span>: self.channel,</span><br><span class="line">      <span class="string">&#x27;text&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;emoji&#125;</span> <span class="subst">&#123;text&#125;</span>&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;as_user&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">  fmt=<span class="string">&#x27;%(asctime)s *%(module)s* : %(message)s&#x27;</span>,</span><br><span class="line">  datefmt=<span class="string">&#x27;%H:%M:%S&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">slack_handler = SlackHandler(SLACK_TOKEN)</span><br><span class="line">slack_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(slack_handler)</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&#x27;ë””ë²„ê¹… ë¡œê·¸ì…ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;ì¼ë°˜ ë¡œê·¸ì…ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;ê²½ê³  ë¡œê·¸ì…ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;ì—ëŸ¬ ë¡œê·¸ì…ë‹ˆë‹¤.&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="number">1</span>/<span class="number">0</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  logger.exception(<span class="string">&#x27;ì˜ˆì™¸ì²˜ë¦¬ ë¡œê·¸ì…ë‹ˆë‹¤.&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>TOKEN</code>ì— slackì—ì„œ ë°œê¸‰ë°›ì€ botì˜ í† í°ì„ ì…ë ¥í•œ ë’¤ ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´, slackì—ì„œ botì´ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/images/2019-03-python-logging-slack.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><p>ì´ëª¨ì§€ì™€ <a href="https://api.slack.com/reference/surfaces/formatting"><code>mrkdwn</code> í¬ë§·</a>ì„ ì‚¬ìš©í•˜ì—¬, ì œ ì·¨í–¥ì´ ë“¬ë¿ ë‹´ê¸´ ë¡œê±°ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. <code>mapLogRecord</code> methodë¥¼ ë‹¤ë“¬ì–´ì„œ, slackì— ì¶œë ¥ë˜ëŠ” ë©”ì‹œì§€ì˜ ìŠ¤íƒ€ì¼ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;Pythonìœ¼ë¡œ ì½”ë“œë¥¼ ì§¤ ë•Œ, ë¡œê·¸ë¥¼ ë„ìš°ëŠ” ë°©ë²•ìœ¼ë¡œ &lt;code&gt;print(&amp;#39;[*] Message&amp;#39;)&lt;/code&gt;ë¥¼ ì •ë§ ë§ì´ ì¨ ì™”ìŠµë‹ˆë‹¤. êµ°ë”ë”ê¸° ì—†ê³ , ìœ ì—°í•˜ê³ , dependency ì—†ì´ ì•„ë¬´ ìœ„ì¹˜ì—ë‚˜ ë„£ì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¢‹ì•˜ìŠµë‹ˆë‹¤. â€˜ì¢‹ì•˜ë‹¤â€™ ë³´ë‹¤ëŠ” â€˜í¸í–ˆë‹¤â€™ í˜¹ì€ â€˜ê·€ì°®ì•˜ë‹¤â€™ê°€ ë” ì ì ˆí•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í˜¼ìì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì§¤ ë•ŒëŠ” exception ì²˜ë¦¬ë‚˜ ë¡œê·¸ ì²˜ë¦¬ì— ì‹ ê²½ì„ ì“°ì§€ ì•Šì•„ë„ ë¬¸ì œê°€ ì—†ì—ˆê¸° ë•Œë¬¸ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;p&gt;ì´ëŸ¬í•œ ë°©ë²•ì€ ë¬¸ì œê°€ ë§ì´ ìˆìŠµë‹ˆë‹¤. ì¤‘ìš”ë„ì— ë”°ë¼ì„œ ë¡œê·¸ë¥¼ ë¶„ë¥˜í•  ìˆ˜ë„ ì—†ì„ ë¿ë”ëŸ¬, ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” ì´ìƒ ë¡œê·¸ë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤. ì •ë§ë¡œ print ë˜ì–´ì•¼ í•˜ëŠ” ë‚´ìš©ê³¼ ë¡œê·¸ê°€ ë’¤ì„ì—¬ ë²„ë ¤ì„œ í™”ë©´ì´ ì§€ì €ë¶„í•´ì§€ëŠ” ê²ƒë„ ë¬¸ì œì…ë‹ˆë‹¤. &lt;em&gt;(Fangâ€™s coding note)&lt;/em&gt; ê°€ë”ì€ ì¡°ìš©íˆ í”„ë¡œê·¸ë¨ì„ ëŒë¦¬ê³  ì‹¶ì„ ë•Œë„ ìˆê³ , ê°€ë”ì€ verbose í•´ì§€ê³  ì‹¶ì–´ì§ˆ ë•Œë„ ìˆì–ì•„ìš”?&lt;/p&gt;
&lt;img src=&quot;/images/2019-03-morpheus_logging.jpg&quot; class=&quot;&quot; width=&quot;500&quot; title=&quot;Better Logging&quot;&gt;

&lt;p&gt;&lt;strong&gt;Pythonì—ì„œëŠ” &lt;code&gt;logging&lt;/code&gt; ëª¨ë“ˆì„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.&lt;/strong&gt; ì´ì œ &lt;code&gt;print(&amp;#39;[*] ...&amp;#39;)&lt;/code&gt;ë§Œ ì‚¬ìš©í•˜ì§€ ë§ê³ , &lt;code&gt;logging&lt;/code&gt; ëª¨ë“ˆì„ í†µí•´ ë©‹ì§€ê³  ê¹”ë”í•œ ë¡œê¹…ì„ í•´ë´…ì‹œë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ë¥¼ í†µí•´ Pythonì—ì„œ ì œê³µí•˜ëŠ” &lt;code&gt;logging&lt;/code&gt; ëª¨ë“ˆì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë˜í•œ, â€˜ì¢‹ì€ ë¡œê·¸ ì²˜ë¦¬ ë°©ë²•â€™ì´ ì–´ë–¤ ì„±ì§ˆì„ ì§€ë‹ˆê³  ìˆì„ ì§€ì— ëŒ€í•œ ê³ ë¯¼ë„ í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;</summary>
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/categories/Python/"/>
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ë¹„ë™ê¸°ì ìœ¼ë¡œ Python ë‹¤ë£¨ê¸°</title>
    <link href="https://hwangheek.github.io/2019/asynchronous-python/"/>
    <id>https://hwangheek.github.io/2019/asynchronous-python/</id>
    <published>2019-02-04T21:05:38.000Z</published>
    <updated>2022-08-08T05:56:40.861Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-ì•ˆë…•-ë¹„ë™ê¸°"><a href="#0-ì•ˆë…•-ë¹„ë™ê¸°" class="headerlink" title="0. ì•ˆë…•, ë¹„ë™ê¸°!"></a>0. ì•ˆë…•, ë¹„ë™ê¸°!</h1><p>Pythonìœ¼ë¡œ ë™ì‹œë‹¤ë°œì  HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‘ì—…ì„ í•´ì•¼í•  í•„ìš”ê°€ ìƒê²¼ìŠµë‹ˆë‹¤. Python 3ì—ì„œ asynchronousí•œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸°ê°€ ìˆ˜ì›”í•´ì¡Œë‹¤ëŠ” ì´ì•¼ê¸°ë¥¼ ì–´ë””ì„œ ë“¤ì€ ê²ƒ ê°™ì•„ì„œ êµ¬ê¸€ë§ì„ ê°„ë‹¨íˆ í•´ë´¤ìŠµë‹ˆë‹¤â€¦ë§Œ ë‚´ìš©ë“¤ì´ ì´í•´í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ì™€ ê´€ë ¨ëœ ìˆ˜ ë§ì€ ìš©ì–´ë“¤ì˜ ì •ì˜ì™€ ê·¸ ë²”ìœ„ê°€ ì‚¬ëŒë“¤ë§ˆë‹¤ ë¯¸ë¬˜í•˜ê²Œ ë‹¬ëê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼, â€˜asynchronousâ€™ë¼ëŠ” ìš©ì–´ ìì²´ë¥¼ ë“£ê¸°ë§Œ í•´ë„ ë­”ê°€ ì–´ë µê³  ë³µì¡í•˜ê³  ë§‰ì—°í•˜ê²Œ ë‘ë ¤ìš´ ëŠë‚Œë„ ë“­ë‹ˆë‹¤.</p><img src="/images/2019-02-why_so_async.png" class="" width="500" title="Async Everywhere"><p>í•˜ë£¨ ë‚ ì„ ì¡ê³  asynchronous pythonê³¼ ê´€ë ¨ëœ ìë£Œë“¤ì„ ì™•ì°½ ì½ì–´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ ê¸€ì€ í‚¤ì›Œë“œ <strong>generator, coroutine, asyncio</strong>ì™€ ì‹ íƒìŠ¤ <strong><code>yield</code>, <code>yield from</code>, <code>async</code>, <code>await</code></strong> ì— ëŒ€í•œ ì´í•´ê°€ ì—†ë˜ ì œê°€, ë‚˜ë¦„ëŒ€ë¡œ ì´í•´ë¥¼ í•˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•œ ê²ƒì…ë‹ˆë‹¤. <strong>í˜¹ì‹œë‚˜ ì œê°€ ì˜ëª» ì´í•´í•˜ê³  ìˆëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤</strong>.</p><span id="more"></span><h1 id="1-ì„ ì§€ìë“¤ì˜-ê¸°ë¡"><a href="#1-ì„ ì§€ìë“¤ì˜-ê¸°ë¡" class="headerlink" title="1. ì„ ì§€ìë“¤ì˜ ê¸°ë¡"></a>1. ì„ ì§€ìë“¤ì˜ ê¸°ë¡</h1><p>ê° ë‹¨ê³„ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ìë£Œë“¤ì„ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.</p><ul><li><strong>ì „ë°˜ì ì¸ ë‚´ìš©ê³¼ íë¦„</strong><ul><li>Masnun (2015) <em><a href="http://masnun.com/2015/11/13/python-generators-coroutines-native-coroutines-and-async-await.html" title="" target="">Python: Generators, Coroutines, Native coroutines and async&#x2F;await</a></em></li></ul></li><li><strong>Generator</strong><ul><li>Syed Komail Abbas (2017) <em><a href="https://hackernoon.com/the-magic-behind-python-generator-functions-bc8eeea54220" title="" target="">The Magic Behind Python Generator Functions</a></em></li></ul></li><li><strong>Coroutine</strong><ul><li>Bharel, Brad Solomon (2018) <em><a href="https://stackoverflow.com/a/51116910" title="" target="">How does asyncio actually work?</a></em></li><li>Moura, A. L. D., &amp; Ierusalimschy, R. (2004) <em><a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.58.4017&rep=rep1&type=pdf" title="" target="">Revisiting coroutines</a></em></li><li>MisterMiyagi (2018) <em><a href="https://stackoverflow.com/a/51177895" title="" target="">Talking about async&#x2F;await and asyncio is not the same thing</a></em></li><li>Brett Cannon (2016) <em><a href="https://snarky.ca/how-the-heck-does-async-await-work-in-python-3-5/" title="" target="">How the heck does async&#x2F;await work in Python 3.5?</a></em></li></ul></li><li><strong>Concurrencyì™€ Parallelism</strong><ul><li>ThomasWouters (2017) <em><a href="https://wiki.python.org/moin/GlobalInterpreterLock" title="" target="">GlobalInterpreterLock</a></em></li><li>Skrew Everything (2018) <em><a href="https://medium.com/from-the-scratch/dont-be-confused-between-concurrency-and-parallelism-eac8e703943a" title="" target="">Don&#39;t be confused between Concurrency and Parallelism</a></em></li></ul></li><li><strong>More about <code>async</code>, <code>await</code> and <code>asyncio</code></strong><ul><li><a href="https://docs.python.org/3/library/asyncio-task.html">Python Docs â€˜Coroutines and Tasksâ€™</a></li><li>Jinsu Kim (2017) <em><a href="https://item4.github.io/2017-11-26/Asynchronous-HTTP-Request-with-aiohttp/" title="" target="">aiohttpë¡œ í•˜ëŠ” ë¹„ë™ê¸° HTTP ìš”ì²­</a></em></li></ul></li><li><strong>Other References</strong><ul><li>YongSung Lee (2018) <em><a href="https://blog.humminglab.io/python-coroutine-programming-1/" title="" target="">Python ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° ì œëŒ€ë¡œ ì´í•´í•˜ê¸°</a></em></li><li>Nick Humrich (2016) <em><a href="https://hackernoon.com/asynchronous-python-45df84b82434" title="" target="">Asynchronous Python - Await the Future</a></em></li><li>Scott Robinson (2015) <em><a href="https://stackabuse.com/python-async-await-tutorial/" title="" target="">Python async&#x2F;await Tutorial</a></em></li><li>ë¶ˆê³° (2017) <em><a href="https://brownbears.tistory.com/237" title="" target="">ë§ì€ í•¨ìˆ˜ë¥¼ ë™ì‹œì— ì‹¤í–‰í•˜ë ¤ë©´ ì½”ë£¨í‹´ì„ ê³ ë ¤</a></em></li><li>Brad Solomon (2019) <em><a href="https://realpython.com/async-io-python/" title="" target="">Async IO in Python: A Complete Walkthrough</a></em></li><li>Miguel Grinberg (2017) <em><a href="https://www.youtube.com/watch?v=iG6fr81xHKA" title="" target="">Asynchronous Python for the Complete Beginner (PyCon 2017)</a></em></li></ul></li></ul><hr><h1 id="2-Generator"><a href="#2-Generator" class="headerlink" title="2. Generator"></a>2. Generator</h1><p>ìš°ë¦¬ê°€ í”íˆ ì•Œê³ ìˆëŠ” Pythonì˜ í•¨ìˆ˜, ì¦‰ <code>def sth_familiar_with(): ...</code>ê³¼ ê°™ì´ ì •ì˜ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ê²½ìš°, í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹œì‘ë¶€í„° ë(í˜¹ì€ <code>return</code>ì„ ë§Œë‚ ë•Œ)ê¹Œì§€ ì§„í–‰ì´ ë©ë‹ˆë‹¤. ê·¸ ë’¤ì— stack frameì€ ì†Œë©¸ë˜ë¯€ë¡œ, ì´ í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•  ê²½ìš° í•¨ìˆ˜ëŠ” ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹¤í–‰ì´ ë©ë‹ˆë‹¤.</p><p>GeneratorëŠ” ì•½ê°„ ë‹¤ë¦…ë‹ˆë‹¤. ê²°ê³¼ë¬¼ì„ ê·¸ë•Œê·¸ë•Œ ìƒì„±í•´ë‚´ëŠ”, <strong>ì¼ì¢…ì˜ on-demand function</strong> ì •ë„ë¡œ ìƒê°í•´ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤. ë‹¤ìŒì˜ ì˜ˆì‹œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">hello_twice</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span> (<span class="string">&#x27;Gonna say hello&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span> (<span class="string">&#x27;Gonna say hello again&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;Hello again!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen = hello_twice()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line">Gonna say hello</span><br><span class="line">Hello</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line">Gonna say hello again</span><br><span class="line">Hello again!</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ í•¨ìˆ˜ë¥¼ ì •ì˜í•  ê²½ìš°, CPython ì»´íŒŒì¼ëŸ¬ê°€ í•¨ìˆ˜ ë‚´ <code>yield</code> í‚¤ì›Œë“œë¥¼ ë°œê²¬í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³ , í•´ë‹¹ í•¨ìˆ˜ë¥¼ generator functionìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p><p>ìœ„ì˜ 7ë²ˆ ë¼ì¸ê³¼ ê°™ì´, generator í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ <strong>generator object</strong>ê°€ ìƒì„±ë©ë‹ˆë‹¤. 8ë²ˆ ë¼ì¸ì—ì„œ <code>next(gen)</code>ì„ ì‹¤í–‰í•˜ë©´, <code>hello_twice</code>ì˜ 3ë²ˆ ë¼ì¸ê¹Œì§€ ì‹¤í–‰ì´ ë©ë‹ˆë‹¤. ì‹¤í–‰ ë„ì¤‘ <code>yield</code> í‚¤ì›Œë“œë¥¼ ë§Œë‚¬ì„ ê²½ìš°, í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¤í–‰ì€ ì¼ì‹œì ìœ¼ë¡œ ë³´ë¥˜ëœ í›„ ê°’ì„ return í•©ë‹ˆë‹¤. ë‹¤ì‹œ <code>next(gen)</code>ì„ ì‹¤í–‰í•  ê²½ìš° (ë¼ì¸ 12), ì¼ì‹œ ë³´ë¥˜ë˜ì—ˆë˜ í•¨ìˆ˜ì˜ ì§„í–‰ì´, ë‹¤ìŒ <code>yield</code>ë¬¸ì„ ë§Œë‚ ë•Œê¹Œì§€ ê³„ì†ë©ë‹ˆë‹¤. (ë¼ì¸ 4~5) ì´ ê³¼ì •ì´ í•¨ìˆ˜ì˜ ëì— ë„ë‹¬í•  ë•Œ ê¹Œì§€ ë°˜ë³µë©ë‹ˆë‹¤.</p><p><strong>Pythonì˜ stack frameì€ (ì´ë¦„ê³¼ ë‹¤ë¥´ê²Œ) ë©”ëª¨ë¦¬ì˜ stack ì˜ì—­ì— ì˜¬ë¼ê°€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, heap ì˜ì—­ì— í• ë‹¹ë©ë‹ˆë‹¤.</strong> ì´ëŸ¬í•œ Pythonì˜ íŠ¹ì§• ë•ë¶„ì—, generatorê°€ ì‹¤í–‰ì„ ì¼ì‹œì •ì§€í•˜ê³  ê°’ì„ returní•  ë•Œì— stack frameì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ê°€ <code>yield</code>ë¥¼ ë§Œë‚˜ëŠ” ìˆœê°„, í•´ë‹¹ stack frameê³¼ ì½”ë“œë¥¼ ì–´ë””ì„œë¶€í„° ì¬ê°œí• ì§€ì— ëŒ€í•œ ì •ë³´(last instruction pointer)ë¥¼ ë³´ê´€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. <em>(Syed Komail Abbas)</em></p><h1 id="3-Coroutine"><a href="#3-Coroutine" class="headerlink" title="3. Coroutine"></a>3. Coroutine</h1><p>ì¼ë‹¨, â€˜Coroutineâ€™ì´ë¼ëŠ” ìš©ì–´ê°€ Python-specific keywordê°€ ì•„ë‹ˆë¼ëŠ” ì‚¬ì‹¤ì„ ì¸ì§€í•  í•„ìš”ê°€ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><blockquote><p><strong>Coroutines</strong> are computer-program components that generalize subroutines for <strong>non-preemptive multitasking</strong>, by allowing <strong>multiple entry points for suspending and resuming execution</strong> at certain locations.</p><footer><strong>wikipedia</strong><cite><a href="https://en.wikipedia.org/wiki/Coroutine">Coroutine</a></cite></footer></blockquote><p>ë”°ë¼ì„œ, ì§ˆë¬¸ì„ â€œPythonì˜ coroutineì€ ë¬´ì—‡ì¸ê°€?â€ë¡œ ì¡ëŠ” ê²ƒ ë³´ë‹¤ëŠ”, <strong>â€œPythonì—ì„œëŠ” coroutineì„ ì–´ë–»ê²Œ êµ¬í˜„í•˜ì˜€ë‚˜?â€</strong> ë¡œ ìƒê°í•˜ëŠ” ìª½ì´ í˜¼ì„ ì„ ì¤„ì´ëŠ” ë°©í–¥ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.</p><h2 id="3-1-Generator-based-â€˜Coroutineâ€™"><a href="#3-1-Generator-based-â€˜Coroutineâ€™" class="headerlink" title="3-1. Generator based â€˜Coroutineâ€™"></a>3-1. Generator based â€˜Coroutineâ€™</h2><p>Pythonì´ ê°€ì§€ê³  ìˆëŠ” generatorë¥¼ ì´ìš©í•œë‹¤ë©´, coroutineì„ êµ¬í˜„í•  ìˆ˜ ìˆì–´ ë³´ì…ë‹ˆë‹¤. í•¨ìˆ˜ ì‹¤í–‰ì„ ì¼ì‹œì •ì§€í•˜ê±°ë‚˜ ì¬ê°œí•  ìˆ˜ ìˆëŠ” entry pointë“¤ì´ ì¡´ì¬í•œë‹¤ëŠ” ì ê³¼, ê·¸ ë•Œë§ˆë‹¤ ê°’ì„ yield í•  ìˆ˜ ìˆëŠ” generatorì˜ ì„±ì§ˆì„ ì˜ ì´ìš©í•˜ëŠ” ê²ƒì´ì§€ìš”.</p><p>Python generatorì™€ ê´€ë ¨í•œ ë‘ê°€ì§€ ê¸°ëŠ¥ì„ ë” ì‚´í´ë´…ì‹œë‹¤. í•˜ë‚˜ëŠ” <strong>yieldë˜ì–´ ì‹¤í–‰ì´ ì¼ì‹œì •ì§€ ë˜ì–´ìˆëŠ” generatorì—ê²Œ ê°’ì„ ì „ë‹¬í•˜ëŠ” ê¸°ëŠ¥</strong>ì…ë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">echo_me</span>():</span><br><span class="line"><span class="meta">... </span>  msg_first = <span class="keyword">yield</span> <span class="string">&#x27;Ready to echo&#x27;</span></span><br><span class="line"><span class="meta">... </span>  msg_second = <span class="keyword">yield</span> msg_first</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> msg_second</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen = echo_me()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line">Ready to echo</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(gen.send(<span class="string">&#x27;Hello&#x27;</span>))</span><br><span class="line">Hello</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(gen.send(<span class="string">&#x27;There!&#x27;</span>))</span><br><span class="line">There!</span><br></pre></td></tr></table></figure><p><code>gen.send(&#39;Hello&#39;)</code>ë¡œ ì¸í•´ generatorì˜ ì‹¤í–‰ì´ ì¬ê°œ ë  ê²½ìš°, <code>yield msg_first</code> ì‹ íƒìŠ¤ ìì²´ê°€ <code>&#39;Hello&#39;</code>ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì´ì²˜ëŸ¼, ì‹¤í–‰ì´ ë©ˆì¶°ìˆëŠ” generator objectì˜ <code>send</code> methodë¥¼ í˜¸ì¶œí•¨ìœ¼ë¡œì¨, generatorì—ê²Œ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ í•˜ë‚˜ëŠ”, <strong>generatorì—ì„œ ë‹¤ë¥¸ generatorë¥¼ yieldí•˜ëŠ” ê¸°ëŠ¥</strong>ì…ë‹ˆë‹¤. ì´ëŠ” <a href="https://www.python.org/dev/peps/pep-0380/" title="" target="">PEP380 (Syntax for Delegating to a Subgenerator)</a>ì— ëª…ì‹œë˜ì–´ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;INNER&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;GENERATOR&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;YEAH!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;Get ready for ...&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="keyword">from</span> inner()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen = outer()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line">Get ready <span class="keyword">for</span> ...</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">next</span>(gen), <span class="built_in">next</span>(gen), <span class="built_in">next</span>(gen))</span><br><span class="line">INNER GENERATOR YEAH!</span><br></pre></td></tr></table></figure><p>ë¼ì¸ 8ê³¼ ê°™ì´ <code>yield from</code> í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ generator ë‚´ë¶€ì—ì„œë„ ë‹¤ë¥¸ generatorë¥¼ ìƒì„±í•˜ì—¬ yieldë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, <code>yield from inner()</code>ëŠ” <code>for x from inner(): yield x</code>ì™€ ê°™ì€ ì—­í• ì„ í•˜ëŠ” ì…ˆì…ë‹ˆë‹¤. PEP380ì— ë”°ë¥´ë©´, ì´ ì‹ íƒìŠ¤ëŠ” Python 3.3ë¶€í„° ì¶”ê°€ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤. (ë”°ë¼ì„œ, Python 2.7ì—ì„œ ìœ„ì˜ ì˜ˆì‹œë¥¼ ì‹¤í–‰í•˜ë©´ <code>yield from</code> ì‹ íƒìŠ¤ë¥¼ ì´í•´í•˜ì§€ ëª»í•˜ê³  ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.)</p><p>ìœ„ì—ì„œ ì •ì˜ëœ <code>echo_me</code>ì™€ <code>inner</code>, <code>outer</code>ëŠ” ì¼ì¢…ì˜ coroutineì…ë‹ˆë‹¤. (ì‹¤í–‰ì„ ì¼ì‹œì •ì§€í•˜ê³  ì¬ê°œí•  ìˆ˜ ìˆëŠ” entry pointsë“¤ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.) Generatorë¥¼ ì´ìš©í•˜ì—¬ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ, â€˜generator based coroutineâ€™ë¼ê³  ìƒê°í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤. (ì—¬ê¸°ê¹Œì§€ëŠ” generatorì™€ coroutineì´ë¼ëŠ” ìš©ì–´ì˜ êµ¬ë¶„ì´ ëª…í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</p><p>ì´ëŸ¬í•œ generator based coroutineë“¤ì´ ê°’ì„ yield í•  ê²½ìš°, í•­ìƒ ìì‹ ì˜ callerì—ê²Œë¡œ ì‹¤í–‰ì˜ ìˆœì„œê°€ ë„˜ì–´ê°€ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ coroutineì„ <strong>â€˜Asymmetric coroutineâ€™</strong> ì´ë¼ê³  ë¶€ë¥´ê¸°ë„ í•©ë‹ˆë‹¤. ì´ì™€ êµ¬ë¶„ë˜ëŠ” ê°œë…ì¸ â€˜Symmetric coroutineâ€™ì˜ ê²½ìš°ì—ëŠ” í•˜ë‚˜ì˜ coroutineì—ì„œ ê°’ì„ yieldí•  ë•Œ, ë‹¤ë¥¸ coroutineì—ê²Œ ì‹¤í–‰ ìˆœì„œë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆëŠ” í†µì œê¶Œì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë¬´ì¡°ê±´ ìì‹ ì˜ callerì—ê²Œ ì‹¤í–‰ ìˆœì„œë¥¼ ë„˜ê²¨ì£¼ì–´ì•¼ í•˜ëŠ” asymmetric coroutineê³¼ëŠ” ë‹¤ë¥´ì£ . <em>(Moura)</em></p><h2 id="3-2-asyncio-Module"><a href="#3-2-asyncio-Module" class="headerlink" title="3-2. asyncio Module"></a>3-2. asyncio Module</h2><p>ë¬´ì¡°ê±´ callerì™€ë§Œ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë°˜ìª½ì§œë¦¬ coroutineì´ë¼ë‹ˆâ€¦. ë§Œì•½ callerê°€ ì´ëŸ¬í•œ asymmetric coroutineë“¤ì„ ìœ ê¸°ì ìœ¼ë¡œ ì—®ì–´ì£¼ëŠ” ì—­í• ì„ í•´ì¤€ë‹¤ë©´ (ì˜ˆë¥¼ ë“¤ë©´ í•˜ë‚˜ì˜ coroutineì´ suspend ë˜ì—ˆì„ ë•Œ ë‹¤ë¥¸ coroutineì„ ì‹¤í–‰ì‹œì¼œì£¼ëŠ” ì—­í• ì„ í•´ì¤€ë‹¤ë©´), ì „ì²´ì ìœ¼ë¡œ ë³´ì•˜ì„ ë•Œ ê°ê°ì˜ coroutineë“¤ì´ ì„œë¡œì—ê²Œ ì‹¤í–‰ ìˆœì„œë¥¼ ë„˜ê²¨ì£¼ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p><p><strong>asyncio</strong> ëª¨ë“ˆì´ ì´ëŸ¬í•œ ì—­í• ì„ í•´ì¤ë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤. <a href="https://docs.python.org/3/library/asyncio-task.html#coroutines" title="" target="">asyncio docsì˜ ì˜ˆì‹œ</a> ì¤‘ í•˜ë‚˜ë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@asyncio.coroutine</span><br><span class="line"><span class="meta">... </span><span class="keyword">def</span> <span class="title function_">echo_twice</span>(<span class="params">msg</span>):</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(msg)</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(msg)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>loop = asyncio.get_event_loop()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asyncio.ensure_future(echo_twice(<span class="string">&#x27;Hello&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asyncio.ensure_future(echo_twice(<span class="string">&#x27;There&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>loop.run_forever()</span><br><span class="line">Hello</span><br><span class="line">There</span><br><span class="line"><span class="comment"># ì£¼ì¶¤...</span></span><br><span class="line">Hello</span><br><span class="line">There</span><br></pre></td></tr></table></figure><p><code>asyncio.coroutine</code> ë°ì½”ë ˆì´í„°ë¥¼ í†µí•´ <code>echo_twice</code> í•¨ìˆ˜ë¥¼ coroutineìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤. <code>asyncio.ensure_future(...)</code>ë¥¼ í†µí•´, ì‹¤í–‰í•  coroutineì„ ìƒì„±í•©ë‹ˆë‹¤. <code>asyncio.get_event_loop()</code>ë¡œ ë°›ì€ event loopì˜ <code>run_forever</code>ë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ coroutineë“¤ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p>ì¶œë ¥ëœ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ë³´ë©´, ë‘ ê°œì˜ coroutineì´ ë™ì‹œì— ì§„í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>echo_twice</code> coroutine ì‹¤í–‰ ì¤‘ ë¼ì¸ 5ì— ë‹¤ë‹¤ë¥´ë©´ <code>asyncio.sleep(1)</code>ì´ 1ì´ˆ ë’¤ì— ì‹¤í–‰ì´ ì™„ë£Œë˜ëŠ” (1ì´ˆ ë’¤ì— yieldí•  ìˆ˜ ìˆëŠ”) coroutineì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ coroutineì„ <code>yield from</code>í•˜ê²Œ ë˜ë©´ event loopì—ê²Œë¡œ í†µì œê¶Œì´ ë„˜ì–´ê°€ê³ , event loopì— ì˜í•´ì„œ ë‹¤ë¥¸ coroutineì´ ì‹¤í–‰ë©ë‹ˆë‹¤. <em>(Mansnun)</em></p><p>ì´ëŸ¬í•œ ë°©ë²•ì„ í†µí•´, ì—¬ëŸ¬ coroutineë“¤ì´ ë™ì‹œì— ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ë§í•˜ëŠ” â€˜ë™ì‹œì—â€™ ì‹¤í–‰ëœë‹¤ëŠ” ë§ì€ parallellyê°€ ì•„ë‹ˆë¼ concurrentlyë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. <strong>Event loopì€ single threadì´ë¯€ë¡œ í•œë²ˆì— ì‹¤í–‰ ë˜ëŠ” coroutineì€ í•˜ë‚˜ì…ë‹ˆë‹¤.</strong> ì—¬ëŸ¬ coroutineë“¤ì´ í•˜ë‚˜ì˜ threadë¥¼ íƒ€ì´ë° ì¢‹ê²Œ ë‚˜ëˆ„ì–´ ê°€ì§€ëŠ” ì…ˆì…ë‹ˆë‹¤. <em>(Masnun)</em> Concurrencyì— ê´€í•œ ì´ì•¼ê¸°ì™€ <code>asyncio</code>ì— ê´€í•œ ì¡°ê¸ˆ ë” ë””í…Œì¼í•œ ì„¤ëª…ì€ ë’¤ì—ì„œ ë‹¤ì‹œ í•˜ê² ìŠµë‹ˆë‹¤.</p><h2 id="3-3-Native-Coroutine"><a href="#3-3-Native-Coroutine" class="headerlink" title="3-3. Native Coroutine"></a>3-3. Native Coroutine</h2><p>Python 3.5ë¶€í„° ìƒˆë¡œìš´ ì‹ íƒìŠ¤ì¸ <strong><code>async</code></strong> ì™€ <strong><code>await</code></strong> ê°€ ë“±ì¥í•©ë‹ˆë‹¤. (<a href="https://www.python.org/dev/peps/pep-0492/" title="" target="">PEP492</a>) ì´ë¥¼ ì´ìš©í•˜ë©´ ìœ„ì—ì„œ ì„ ì–¸í•œ <code>echo_twice</code>ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë‹¤ì‹œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">echo_twice</span>(<span class="params">msg</span>):</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(msg)</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(msg)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>loop = asyncio.get_event_loop()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asyncio.ensure_future(echo_twice(<span class="string">&#x27;Hello&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asyncio.ensure_future(echo_twice(<span class="string">&#x27;There&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>loop.run_forever()</span><br><span class="line">Hello</span><br><span class="line">There</span><br><span class="line"><span class="comment"># ì£¼ì¶¤...</span></span><br><span class="line">Hello</span><br><span class="line">There</span><br></pre></td></tr></table></figure><p><code> @asyncio.coroutine</code> ë°ì½”ë ˆì´í„° ëŒ€ì‹  <code>async</code> í‚¤ì›Œë“œë¥¼, <code>yield from</code> í‚¤ì›Œë“œ ëŒ€ì‹  <code>await</code> í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Pythonì˜ ì‹ íƒìŠ¤ë§Œì„ ì´ìš©í•˜ì—¬ ì •ì˜í•œ coroutineì´ë‹ˆ, ì´ë¥¼ <strong>â€˜Native Coroutineâ€™</strong> ì´ë¼ê³  ë¶ˆëŸ¬ë„ ê´œì°®ê² ìŠµë‹ˆë‹¤. <em>(Masnun)</em> ì‹¤í–‰ ë„ì¤‘ ë¼ì¸ 4ì˜ <code>await asyncio.sleep(1)</code>ì— ë‹¤ë‹¤ë¥´ë©´, <code>echo_twice</code> í•¨ìˆ˜ëŠ” event loopì—ê²Œ ì»¨íŠ¸ë¡¤ì„ ë„˜ê²¨ì¤ë‹ˆë‹¤.<br>ì´ ë•Œ, generator based coroutineì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‹ íƒìŠ¤ì™€ native coroutineì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‹ íƒìŠ¤ëŠ” í˜¼ìš©ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì•„ë˜ì™€ ê°™ì€ ì½”ë“œëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>@asyncio.coroutine</span><br><span class="line"><span class="meta">... </span><span class="keyword">def</span> <span class="title function_">this_is_nono</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">...</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">3</span></span><br><span class="line">SyntaxError: <span class="string">&#x27;await&#x27;</span> outside <span class="keyword">async</span> function</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">this_is_nono</span>():</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">...</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">2</span></span><br><span class="line">SyntaxError: <span class="string">&#x27;yield from&#x27;</span> inside <span class="keyword">async</span> function</span><br></pre></td></tr></table></figure><h1 id="4-Concurrencyì™€-Parallelism"><a href="#4-Concurrencyì™€-Parallelism" class="headerlink" title="4. Concurrencyì™€ Parallelism"></a>4. Concurrencyì™€ Parallelism</h1><p>CPythonì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” thread-safeí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ GIL(Global Interpreter Lock)ì´ë¼ ë¶ˆë¦¬ëŠ” mutexë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ë™ì‹œì— Python ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ëª»í•˜ë„ë¡ ë³´í˜¸í•©ë‹ˆë‹¤. <em>(ThomasWouters)</em></p><p>ì—¬ê¸°ì„œ ë¨¸ë¦¬ê°€ ë³µì¡í•´ì¡ŒìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ìœ„ì—ì„œ ë§í–ˆë˜ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” coroutineì€ ì–´ë–»ê²Œ â€˜ë™ì‹œì—â€™ ëŒì•„ê°ˆ ìˆ˜ ìˆëŠ” ê²ƒì¼ê¹Œìš”? ì´ë¥¼ ì˜ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” concurrencyì™€ parallelismì„ êµ¬ë¶„í•˜ì—¬ ì •ì˜ë‚´ë¦´ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p><strong>Concurrency</strong> is about <em>dealing with lots of things at once</em><br><strong>Parallelism</strong> is about <em>doing lots of things at once</em></p><footer><strong>Skrew Everything</strong><cite><a href="https://medium.com/from-the-scratch/dont-be-confused-between-concurrency-and-parallelism-eac8e703943a">Don't be confused between Concurrency and Parallelism</a></cite></footer></blockquote><p>ë‘ ìš©ì–´ëŠ” ë‹¤ë¥¸ ì°¨ì›ì˜ ê°œë…ì…ë‹ˆë‹¤. <strong>Parallelism</strong>ì€ í•˜ë‚˜ì˜ ì‘ì—…ì´ ì—¬ëŸ¬ê°œì˜ ì‘ì€ ì‘ì—…ë“¤ë¡œ ë‚˜ë‰˜ì–´ì ¸ ë¬¼ë¦¬ì ìœ¼ë¡œ ë™ì‹œì— ì§„í–‰ë˜ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤. ì—¬ëŸ¬ê°œì˜ CPUê°€ ë™ì‹œì— ëŒì•„ê°€ëŠ” ê²ƒì„ ìƒê°í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤. ë°˜ë©´, <strong>Concurrency</strong>ëŠ” ì—¬ëŸ¬ ì‘ì—…ë“¤ì´ ê°™ì€ ìˆœê°„ì— (<strong>physically or logically</strong>) ì²˜ë¦¬ë˜ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.</p><p>ì´ ì •ì˜ë¥¼ í†µí•´ ì•Œ ìˆ˜ ìˆëŠ” ì‚¬ì‹¤ì´ ëª‡ ê°€ì§€ ìˆìŠµë‹ˆë‹¤.</p><ol><li>Single Thread í™˜ê²½ì—ì„œë„ concurrentí•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. (CPU time-slicing í˜¹ì€ Application levelì˜ schedulingì„ í™œìš©)</li><li>Parallelí•œ ì‘ì—…ì€ Concurrentí•˜ë‹¤. ê·¸ ë°˜ëŒ€ëŠ” í•­ìƒ ì„±ë¦½í•˜ì§€ ì•ŠëŠ”ë‹¤. <em>(Skrew Everything)</em></li></ol><p><strong>Pythonì˜ coroutineë“¤ì€ concurrentí•˜ê²Œ ì‹¤í–‰ë©ë‹ˆë‹¤. Parallelí•˜ê²Œ ëŒì•„ê°€ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.</strong> ì•ì„œ ì´ì•¼ê¸° í–ˆë“¯ì´, Pythonì€ GILë¡œ ì¸í•˜ì—¬ í•œë²ˆì— í•˜ë‚˜ì˜ threadë§Œ ì‹¤í–‰ì´ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ìœ„ì—ì„œ ì´ì•¼ê¸° í–ˆë˜ asynchronousí•œ coroutineë“¤ì€ â€˜One process, One threadâ€™ í™˜ê²½ì—ì„œ concurrentí•˜ê²Œ ëŒì•„ê°€ëŠ” ê²ƒì…ë‹ˆë‹¤. ì•„ë˜ëŠ” <a href="https://medium.com/from-the-scratch/dont-be-confused-between-concurrency-and-parallelism-eac8e703943a" title="" target="">Skrew Everthingë‹˜ì˜ í¬ìŠ¤íŠ¸</a>ì— ì‚½ì…ëœ Parallelismê³¼ Concurrency without Parallelismì„ ì‹œê°í™”í•œ ê·¸ë¦¼ì…ë‹ˆë‹¤. Pythonì˜ GILì„ ê³ ë ¤í•˜ì˜€ì„ ë•Œ, ê·¸ë¦¼ì˜ ì•„ë«ë¶€ë¶„ì— ìˆëŠ” <em>Concurrency without Parallelism</em>ì´ Pythonì—ì„œì˜ coroutineë“¤ì˜ ë™ì‘ í˜•íƒœì™€ ìœ ì‚¬í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><img src="/images/2019-02-parallelism_concurrency.png" class="" width="500" title="Parallelism &amp; Concurrency"><p>ê·¸ëŸ¬ë¯€ë¡œ, <strong>â€œí•˜ë‚˜ì˜ ì‘ì—…ì„ ì—¬ëŸ¬ê°œì˜ coroutineìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì‹¤í–‰ í•  ê²½ìš° ì‘ì—…ì´ ë¹¨ë¼ì§„ë‹¤â€ë¼ëŠ” statementëŠ” í•­ìƒ ì˜³ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong> â€˜One process, One threadâ€™ í™˜ê²½ì—ì„œ ëŒì•„ê°€ê¸° ë•Œë¬¸ì—, <del>coroutineì„ context switchingí•˜ëŠ” costë¡œ ì¸í•˜ì—¬</del> coroutine ìŠ¤ì¼€ì¥´ë§ ì˜¤ë²„í—¤ë“œë¡œ ì¸í•˜ì—¬ ê²½ìš°ì— ë”°ë¼ì„œëŠ” performanceê°€ ë” ë‚˜ë¹ ì§ˆ ê°€ëŠ¥ì„±ë„ ìˆìŠµë‹ˆë‹¤.</p><hr><h1 id="5-More-about-async-await-and-asyncio"><a href="#5-More-about-async-await-and-asyncio" class="headerlink" title="5. More about async, await and asyncio"></a>5. More about <code>async</code>, <code>await</code> and <code>asyncio</code></h1><h2 id="Awaitable-Objects"><a href="#Awaitable-Objects" class="headerlink" title="Awaitable Objects"></a>Awaitable Objects</h2><p><strong><code>__await__()</code> methodê°€ êµ¬í˜„ë˜ì–´ ìˆëŠ” object</strong>ë¥¼ awaitable objectë¼ê³  í•©ë‹ˆë‹¤. (<a href="https://docs.python.org/3/reference/datamodel.html#coroutines">Python Docs</a>) ì´ë¦„ ê·¸ëŒ€ë¡œ, <code>await</code> ë  ìˆ˜ ìˆëŠ” objectë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. <strong>Coroutines</strong>, <strong>Tasks</strong>, <strong>Futures</strong>ê°€ awaitable objectì— ì†í•©ë‹ˆë‹¤.</p><p><strong>Coroutines</strong><br>ì•ì„œ ì„¤ëª…í•œ coroutineë“¤ì€ awaitable objectì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ë‹¤ë¥¸ coroutineì—ì„œ <code>await</code> ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">coro</span>():</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;hello from coro!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main_coroutines</span>():</span><br><span class="line">  coro() <span class="comment"># Coroutine objectì…ë‹ˆë‹¤. í•˜ì§€ë§Œ await ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì‹¤í–‰ë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="keyword">await</span> coro()) <span class="comment"># ì´ ê²½ìš°, `await coro()` ê°€ ì¸ì‚¬ë¥¼ í•©ë‹ˆë‹¤.</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main_coroutines())</span><br></pre></td></tr></table></figure><p><strong>Futures</strong><br>FutureëŠ” ë¹„ë™ê¸° ì—°ì‚°ì˜ ê²°ê³¼ë¬¼ì„ ëŒ€ì‹ í•˜ëŠ” low-level awaitable objectì…ë‹ˆë‹¤. <em>(A Future is a special low-level awaitable object that represents an eventual result of an asynchronous operation. &#x2F; Represents the result of an asynchronous computation.)</em><br>Future objectê°€ <code>await</code>ë  ê²½ìš°, ë‹¤ë¥¸ ê³³ì—ì„œ resolve ë˜ê¸° ì „ ê¹Œì§€ í•´ë‹¹ coroutineì´ ê¸°ë‹¤ë¦¬ê²Œ ë©ë‹ˆë‹¤. <strong>ì¼ë°˜ì ì¸ ê²½ìš°, application level ì½”ë“œì—ì„œ Future objectë¥¼ ìƒì„± í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.</strong></p><p><strong>Tasks</strong><br>TaskëŠ” coroutineì„ concurrentí•˜ê²Œ ì‹¤í–‰í•˜ê¸° ìœ„í•˜ì—¬ scheduleì„ í•´ ë†“ì€ objectì…ë‹ˆë‹¤. <code>asyncio.create_task()</code> í•¨ìˆ˜ ë“±ì„ ì´ìš©í•˜ì—¬ coroutineì„ Taskë¡œ wrapping í•  ê²½ìš°, í•´ë‹¹ coroutineì€ ìë™ì ìœ¼ë¡œ schedule ë˜ì–´ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ìœ„ì˜ <code>main_coroutines()</code>ì—ì„œëŠ” <code>main_coroutine()</code>ê³¼ <code>coro()</code>ê°€ concurrentí•˜ê²Œ ëŒì•„ê°€ì§€ ì•Šì§€ë§Œ, ì•„ë˜ì˜ <code>main_tasks()</code>ì—ì„œëŠ” <code>main_tasks()</code>ì™€ <code>coro()</code>ê°€ concurrentí•˜ê²Œ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">coro</span>():</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;hello from coro!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main_tasks</span>():</span><br><span class="line">  task = asyncio.create_task(coro()) <span class="comment"># `coro()` coroutineê³¼ `main_tasks()` coroutineì´</span></span><br><span class="line">                                     <span class="comment"># concurrentí•˜ê²Œ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ scheduling í•©ë‹ˆë‹¤</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">print</span>(<span class="keyword">await</span> task) <span class="comment"># `await task` ê°€ ì¸ì‚¬ë¥¼ í•©ë‹ˆë‹¤.</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main_tasks())</span><br></pre></td></tr></table></figure><h2 id="asyncio-module"><a href="#asyncio-module" class="headerlink" title="asyncio module"></a><code>asyncio</code> module</h2><p><code>asyncio</code>ì˜ method ì¤‘ í•µì‹¬ì ì¸ ëª‡ ê°€ì§€ë¥¼ ì •ë¦¬í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><h3 id="asyncio-run-coro-debug-False"><a href="#asyncio-run-coro-debug-False" class="headerlink" title="asyncio.run(coro, *, debug=False)"></a><code>asyncio.run(coro, *, debug=False)</code></h3><p>ì „ë‹¬ ëœ coroutineì„ ì‹¤í–‰í•˜ê³ , asyncioì˜ event loopë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ê°™ì€ threadì—ì„œ ë‹¤ë¥¸ asyncio event loopê°€ ì‹¤í–‰ì¤‘ì¼ ê²½ìš°ì—ëŠ” ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><em>Python 3.7ì—ì„œ ìƒˆë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</em></p><h3 id="asyncio-create-task-coro"><a href="#asyncio-create-task-coro" class="headerlink" title="asyncio.create_task(coro)"></a><code>asyncio.create_task(coro)</code></h3><p>ì „ë‹¬ ëœ coroutineì„ wrappingí•˜ì—¬ Task objectë¥¼ ë§Œë“¤ê³  schedule í•©ë‹ˆë‹¤.<br><em>Python 3.7ì—ì„œ ìƒˆë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</em> ì´ì „ Pythonì—ì„œëŠ” <code>asyncio.ensure_future()</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><h3 id="asyncio-sleep-delay-result-None-loop-None"><a href="#asyncio-sleep-delay-result-None-loop-None" class="headerlink" title="asyncio.sleep(delay, result=None, loop=None)"></a><code>asyncio.sleep(delay, result=None, loop=None)</code></h3><p><code>delay</code>ì´ˆ ë™ì•ˆ ëŒ€ê¸°í•©ë‹ˆë‹¤. <code>result</code>ê°€ ì£¼ì–´ì§„ ê²½ìš°, sleepì´ ì™„ë£Œëœ í›„ í•´ë‹¹ ê°’ì„ callerì—ê²Œ ë¦¬í„´í•©ë‹ˆë‹¤.<br><code>sleep()</code> í•¨ìˆ˜ëŠ” í˜„ì¬ taskë¥¼ suspend ì‹œí‚¤ë¯€ë¡œ, ì´ ì‹œì ì— ë‹¤ë¥¸ taskê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="asyncio-gather-aws-loop-None-return-exceptions-None"><a href="#asyncio-gather-aws-loop-None-return-exceptions-None" class="headerlink" title="asyncio.gather(*aws, loop=None, return_exceptions=None)"></a><code>asyncio.gather(*aws, loop=None, return_exceptions=None)</code></h3><p>ì£¼ì–´ì§„ awaitable objectsë“¤ì„ concurrentí•˜ê²Œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì£¼ì–´ì§„ awaitable object ì¤‘ coroutineì´ ìˆìœ¼ë©´, ìë™ìœ¼ë¡œ Taskë¡œ schedule ë©ë‹ˆë‹¤.<br>ëª¨ë“  awaitableë“¤ì´ ì •ìƒì ìœ¼ë¡œ ëë‚˜ë©´, ê° awaitableì˜ return valueì˜ listê°€ return ë©ë‹ˆë‹¤. ìˆœì„œëŠ” <code>aws</code>ì˜ ìˆœì„œì™€ ë™ì¼í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">whoami_after_sleep</span>(<span class="params">name, t</span>):</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;I am <span class="subst">&#123;name&#125;</span> and gonna sleep for <span class="subst">&#123;t&#125;</span> seconds.&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> asyncio.sleep(t)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;I am <span class="subst">&#123;name&#125;</span>. I slept for <span class="subst">&#123;t&#125;</span> seconds.&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (<span class="string">&#x27;result&#x27;</span>, name, t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  <span class="keyword">await</span> asyncio.gather(</span><br><span class="line">    whoami_after_sleep(<span class="string">&#x27;A&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    whoami_after_sleep(<span class="string">&#x27;B&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">    whoami_after_sleep(<span class="string">&#x27;C&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line"><span class="comment"># I am A and gonna sleep for 1 seconds.</span></span><br><span class="line"><span class="comment"># I am B and gonna sleep for 2 seconds.</span></span><br><span class="line"><span class="comment"># I am C and gonna sleep for 3 seconds.</span></span><br><span class="line"><span class="comment"># I am A. I slept for 1 seconds.</span></span><br><span class="line"><span class="comment"># I am B. I slept for 2 seconds.</span></span><br><span class="line"><span class="comment"># I am C. I slept for 3 seconds.</span></span><br></pre></td></tr></table></figure><h3 id="asyncio-wait-for-aw-timeout-loop-None"><a href="#asyncio-wait-for-aw-timeout-loop-None" class="headerlink" title="asyncio.wait_for(aw, timeout, *, loop=None)"></a><code>asyncio.wait_for(aw, timeout, *, loop=None)</code></h3><p>ì£¼ì–´ì§„ awaitableì„ <code>timeout</code>ì´ˆ ë™ì•ˆ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. <code>aw</code>ê°€ coroutineì¼ ê²½ìš°, ìë™ìœ¼ë¡œ Taskë¡œ schedule ë©ë‹ˆë‹¤.<br>í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚˜ë©´, <code>asyncio.TimeoutError</code>ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p>â€¦</p><p>ì¶”ê°€ì ì¸ ì„¤ëª…ì€ <a href="https://docs.python.org/3/library/asyncio-task.html">Python Doc</a>ì„ ì°¸ì¡°í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><h2 id="Using-asyncio-based-module-aiohttp"><a href="#Using-asyncio-based-module-aiohttp" class="headerlink" title="Using asyncio based module : aiohttp"></a>Using <code>asyncio</code> based module : <code>aiohttp</code></h2><p><strong>aiohttp</strong>ëŠ” asyncioë¥¼ í™œìš©í•œ HTTP í´ë¼ì´ì–¸íŠ¸&#x2F;ì„œë²„ ëª¨ë“ˆì…ë‹ˆë‹¤. ì´ ëª¨ë“ˆê³¼ ìœ„ì˜ ë‚´ìš©ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìˆ˜ì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” asynchronousë¥¼ ë§Œë“¤ì–´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">urls = [<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>) <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">url</span>):</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;start fetching&#x27;</span>, url)</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> res:</span><br><span class="line">      <span class="keyword">assert</span> res.status == <span class="number">200</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> res.text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  <span class="keyword">await</span> asyncio.gather(*[fetch(url) <span class="keyword">for</span> url <span class="keyword">in</span> urls])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start = time.perf_counter()</span><br><span class="line">asyncio.run(main())</span><br><span class="line">end = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Time Elapsed : &#123;&#125; sec&#x27;</span>.<span class="built_in">format</span>(end-start)) <span class="comment"># 1.61 sec</span></span><br></pre></td></tr></table></figure><p>ì´ì™€ ê°™ì€ ë™ì‘ì„ í•˜ëŠ” synchronousí•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹œê°„ì´ ì–¼ë§ˆë‚˜ ê±¸ë¦´ê¹Œìš”? ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">urls = [<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>) <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  <span class="keyword">with</span> requests.Session() <span class="keyword">as</span> client:</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">      res = client.get(url)</span><br><span class="line">      <span class="keyword">assert</span> res.status_code == <span class="number">200</span></span><br><span class="line">      <span class="built_in">print</span>(res.status_code)</span><br><span class="line"></span><br><span class="line">start = time.perf_counter()</span><br><span class="line">main()</span><br><span class="line">end = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Time Elapsed : &#123;&#125; sec&#x27;</span>.<span class="built_in">format</span>(end-start)) <span class="comment"># 10.41 sec</span></span><br></pre></td></tr></table></figure><p>ì˜ ì§œì—¬ì§„ í…ŒìŠ¤íŠ¸ëŠ” ì•„ë‹ˆì§€ë§Œ, 10.41ì´ˆì—ì„œ 1.61ì´ˆë¡œ ì†Œìš” ì‹œê°„ì´ í¬ê²Œ ì¤„ì–´ë“¤ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—…ì˜ I&#x2F;O ëŒ€ê¸°ì‹œê°„ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ë²•ì€ ë”ìš± ë” íš¨ê³¼ì ì…ë‹ˆë‹¤.</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0-ì•ˆë…•-ë¹„ë™ê¸°&quot;&gt;&lt;a href=&quot;#0-ì•ˆë…•-ë¹„ë™ê¸°&quot; class=&quot;headerlink&quot; title=&quot;0. ì•ˆë…•, ë¹„ë™ê¸°!&quot;&gt;&lt;/a&gt;0. ì•ˆë…•, ë¹„ë™ê¸°!&lt;/h1&gt;&lt;p&gt;Pythonìœ¼ë¡œ ë™ì‹œë‹¤ë°œì  HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‘ì—…ì„ í•´ì•¼í•  í•„ìš”ê°€ ìƒê²¼ìŠµë‹ˆë‹¤. Python 3ì—ì„œ asynchronousí•œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸°ê°€ ìˆ˜ì›”í•´ì¡Œë‹¤ëŠ” ì´ì•¼ê¸°ë¥¼ ì–´ë””ì„œ ë“¤ì€ ê²ƒ ê°™ì•„ì„œ êµ¬ê¸€ë§ì„ ê°„ë‹¨íˆ í•´ë´¤ìŠµë‹ˆë‹¤â€¦ë§Œ ë‚´ìš©ë“¤ì´ ì´í•´í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ì™€ ê´€ë ¨ëœ ìˆ˜ ë§ì€ ìš©ì–´ë“¤ì˜ ì •ì˜ì™€ ê·¸ ë²”ìœ„ê°€ ì‚¬ëŒë“¤ë§ˆë‹¤ ë¯¸ë¬˜í•˜ê²Œ ë‹¬ëê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼, â€˜asynchronousâ€™ë¼ëŠ” ìš©ì–´ ìì²´ë¥¼ ë“£ê¸°ë§Œ í•´ë„ ë­”ê°€ ì–´ë µê³  ë³µì¡í•˜ê³  ë§‰ì—°í•˜ê²Œ ë‘ë ¤ìš´ ëŠë‚Œë„ ë“­ë‹ˆë‹¤.&lt;/p&gt;
&lt;img src=&quot;/images/2019-02-why_so_async.png&quot; class=&quot;&quot; width=&quot;500&quot; title=&quot;Async Everywhere&quot;&gt;

&lt;p&gt;í•˜ë£¨ ë‚ ì„ ì¡ê³  asynchronous pythonê³¼ ê´€ë ¨ëœ ìë£Œë“¤ì„ ì™•ì°½ ì½ì–´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ ê¸€ì€ í‚¤ì›Œë“œ &lt;strong&gt;generator, coroutine, asyncio&lt;/strong&gt;ì™€ ì‹ íƒìŠ¤ &lt;strong&gt;&lt;code&gt;yield&lt;/code&gt;, &lt;code&gt;yield from&lt;/code&gt;, &lt;code&gt;async&lt;/code&gt;, &lt;code&gt;await&lt;/code&gt;&lt;/strong&gt; ì— ëŒ€í•œ ì´í•´ê°€ ì—†ë˜ ì œê°€, ë‚˜ë¦„ëŒ€ë¡œ ì´í•´ë¥¼ í•˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•œ ê²ƒì…ë‹ˆë‹¤. &lt;strong&gt;í˜¹ì‹œë‚˜ ì œê°€ ì˜ëª» ì´í•´í•˜ê³  ìˆëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤&lt;/strong&gt;.&lt;/p&gt;</summary>
    
    
    
    <category term="Python" scheme="https://hwangheek.github.io/categories/Python/"/>
    
    
    <category term="Python" scheme="https://hwangheek.github.io/tags/Python/"/>
    
  </entry>
  
</feed>
